/* ! JSON.minify()
    v0.1 (c) Kyle Simpson
    MIT License
*/
/*
Copyright Vassilis Petroulias [DRDigit]

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
//! moment.js
//! version : 2.4.0
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
/*!
 * eslint-disable-line
 * Fuse.js v3.1.0 - Lightweight fuzzy-search (http://fusejs.io)
 * 
 * Copyright (c) 2012-2017 Kirollos Risk (http://kiro.me)
 * All Rights Reserved. Apache Software License 2.0
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 */
/**
 * Accedo VDK
 * https://accedobroadband.jira.com/wiki/display/VDK/VIA+Development+Kit
 *
 * Copyright (c) 2015 Accedo All rights reserved.
 */
 !function (e) {
    'use strict';
    function t(e) {
      var t;
      if (e = e || {
      }, c(ye, e, !0), ke = e.baseUrl || ke, n(ke, '/') || (ke += '/'), e.paths) {
        c(Se, e.paths, !0),
        xe = [
        ];
        for (t in Se) xe.push(t);
        xe.sort().reverse()
      }
      Te = 1000 * (e.waitSeconds || 10)
    }
    function i(e, t) {
      return 0 === e.indexOf(t)
    }
    function n(e, t) {
      return - 1 !== e.indexOf(t, e.length - t.length)
    }
    function s(e, t) {
      return o(e) ? - 1 !== e.indexOf(t) : ve.call(e, t)
    }
    function r(e) {
      return '[object Function]' === me.call(e)
    }
    function o(e) {
      return '[object Array]' === me.call(e)
    }
    function a(e) {
      return '[object Object]' === me.call(e)
    }
    function d(e) {
      return 'string' == typeof e
    }
    function c(e, t, i) {
      if (a(e) && a(t)) {
        var n;
        for (n in t) a(t[n]) ? e[n] = c(e[n] || {
        }, t[n], i) : !i && s(e, n) || (e[n] = t[n]);
        return e
      }
    }
    function l(e) {
      var t,
      n,
      s = '';
      for (n in Se) i(e, Se[n]) && Se[n].length > s.length && (t = n, s = Se[n]);
      return '' !== s && (e = e.replace(s, t)),
      e
    }
    function u(e) {
      var t,
      i,
      n = e.length;
      for (t = 0; t < n; t++) if ('.' === (i = e[t])) e.splice(t, 1),
      t -= 1;
       else if ('..' === i) {
        if (1 === t && ('..' === e[2] || '..' === e[0])) break;
        t > 0 && (e.splice(t - 1, 2), t -= 2)
      }
    }
    function h(e) {
      var t,
      i,
      n,
      s = [
      ];
      for (n in ae) if (ae.hasOwnProperty(n)) {
        if (p(n)) continue;
        for (t = ae[n].dependencies, i = t.length; i--; ) if (t[i] === e) {
          s.push(ae[n]);
          break
        }
      }
      return s
    }
    function _() {
      return re + ne++
    }
    function f() {
      return oe + se++
    }
    function p(e) {
      return 0 === e.indexOf(re)
    }
    function g(e) {
      return e === ee || e === te || e === ie
    }
    function v(e, t, i) {
      var n;
      if (t === ee) n = p(e) ? j : Z[e];
       else if (t === te) n = W(e);
       else {
        if (t !== ie) return !1;
        n = {
          id: e
        }
      }
      return i.depModules[i.dependencies.indexOf(t)] = n,
      !0
    }
    function m(e) {
      return (new Date).getTime() > e.timeLimit
    }
    function E(e) {
      var t,
      i,
      n,
      o = ae[e];
      if (ae[e] && (t = o.dependencies, !s($, e))) {
        if (m(o)) {
          if (r(o.onFailure)) return void o.onFailure(new Error('Required dependencies cannot be loaded for module ' + e + ' wait timeout reached!'));
          var a = [
          ];
          for (i = t.length; i--; ) n = t[i],
          he.test(n) || 'complete' !== q[n] || s($, n) ? he.test(n) && 'complete' !== q[n] && a.push(n) : a.push(n);
          throw new Error('Required dependencies cannot be loaded for module ' + e + ' wait timeout reached! Possibliy one of the following: ' + a.join(','))
        }
        var d = function () {
          setTimeout(function () {
            E(e)
          }, ue)
        };
        for (i = t.length; i--; ) {
          if (n = t[i], 'error' === q[n]) return void delete ae[e];
          if (he.test(n)) {
            if ('complete' !== q[n]) return void d()
          } else {
            if (!s($, n)) {
              if (v(e, n, o)) continue;
              return void d()
            }
            if (void 0 === o.depModules[i]) {
              if (n.indexOf('!') >= 0) return void d();
              o.depModules[i] = $[n]
            }
          }
        }
        o.onSuccess(o.depModules),
        y(e)
      }
    }
    function b(e) {
      q[e] = 'complete',
      y(e)
    }
    function y(e) {
      if (!he.test(e)) {
        var t,
        i,
        n,
        s,
        r,
        o = h(e),
        a = o.length;
        for (e = l(e); a--; ) if (t = o[a], t.started) {
          for (i = t.dependencies, s = i.length, r = !0; s--; ) if (n = i[s], !he.test(n) && 'complete' !== q[n]) {
            r = !1;
            break
          }
          r && E(t.moduleId)
        }
      }
    }
    function k(e) {
      if (!s(X, e)) {
        var t = !1,
        i = X.length - 1;
        if (i >= 0 && p(X[i])) {
          var n = X[i],
          r = ae[n];
          r && (ae[e] = r, r.moduleId = e, X.pop(), X.push(e), r.base = e, t = !0)
        }
        t || ($[e] = {
        })
      }
      b(e)
    }
    function S(e, t, i, n) {
      var s,
      o,
      a,
      d,
      c;
      for (s = 'Error loading module or script \'' + e + '": ' + t + ', at line:' + n + ' URL:' + i, 'undefined' != typeof console && console.error(s), o = l(e), q[o] = 'error', a = h(o), c = a.length; c--; ) d = a[c],
      r(d.onFailure) && d.onFailure(new Error('Required dependencies cannot be loaded for module ' + o + ' wait timeout reached!'))
    }
    function x(e) {
      var t = T(e);
      if (ce) try {
        importScripts(t),
        k(e)
      } catch (t) {
        var i = t.stack.match(/(http:|https:).+\.\w+/gi),
        n = t.stack.match(/\d+:\d+/g);
        S(e, t.message, i[i.length - 1], n[n.length - 1])
      } else {
        var s = document.createElement('script');
        s.type = 'text/javascript',
        s.charset = 'utf-8',
        s.async = !0,
        s.onreadystatechange = s.onload = function () {
          s.readyState && !pe.test(s.readyState) || (s.onload = s.onreadystatechange = null, s.onerror = null, k(e))
        },
        s.onerror = function (t, i, n) {
          s.onload = s.onreadystatechange = null,
          s.onerror = null,
          S(e, t, i, n)
        },
        s.src = t,
        le.appendChild(s)
      }
    }
    function T(e) {
      return he.test(e) ? e : C(e) + '.js'
    }
    function C(e) {
      if (_e.test(e)) return e;
      var t,
      n,
      s = e;
      for (t in xe) if (n = xe[t], i(s, n)) {
        s = s.replace(n, Se[n]);
        break
      }
      return fe.test(s) || _e.test(s) || (s = ke + s),
      s
    }
    function A(e) {
      var t,
      i = '',
      n = e;
      return t = e.indexOf('!'),
      t > - 1 && (i = e.substring(0, t), n = e.substring(t + 1, e.length)),
      {
        plugin: i,
        moduleId: n
      }
    }
    function w(e) {
      return z[e]
    }
    function I(e, t, i, n) {
      var s = e + '!' + t,
      r = O(e);
      !r.dynamic && q[t] || (q[s] = 'loading', r.dynamic && (z[s] = r.dynamic), r.load(t, i, function (e) {
        $[s] = e,
        n.depModules[n.dependencies.indexOf(s)] = e,
        b(s)
      }, c({
        onFailure: function () {
          'error' !== q[s] && S(s, 'Fail to load the resource ' + s)
        }
      }, ye)))
    }
    function L(e, i) {
      var n,
      s,
      r,
      o = i && i.split('/');
      return e && '.' === e.charAt(0) && (i ? (n = o.slice(0, o.length - 1), s = e.split('/'), r = s.length - 1, t.nodeIdCompat && he.test(s[r]) && (s[r] = s[r].replace(he, '')), s = n.concat(s), u(s), e = s.join('/')) : 0 === e.indexOf('./') && (e = e.substring(2))),
      e
    }
    function R(t) {
      var i,
      n,
      r,
      o,
      a,
      d,
      c = t.moduleId,
      l = t.dependencies;
      for (t.timeLimit = (new Date).getTime() + Te, r = l.length, n = 0; n < r; n++) if (i = l[n], o = !1, i !== ee) if (s($, i) && i.indexOf('!') < 0) t.depModules[n] = $[i];
       else {
        for (d in ae) if (ae[d].moduleId === i) {
          o = !0,
          a = !0;
          break
        }
        o || he.test(i) && 'complete' === q[i] || ('loading' !== q[i] && 'complete' !== q[i] ? A(i).plugin ? a = !0 : (a = !0, q[i] = 'loading', e.amd.load(i)) : a = !0)
      } else t.depModules[n] = Z[c];
      a ? E(c) : t.onSuccess(t.depModules)
    }
    function P(t, i) {
      var n = i;
      if (r(i)) {
        if (i.__isExecuting) throw new Error('The module factory is executed while it is being executed. This is probably caused by circular dependency.');
        i.__isInternalWrapper && (n = e.amd.executeFactory(t, i))
      }
      return n
    }
    function D(e, t) {
      return t()
    }
    function O(e, t) {
      var i;
      if (w(e) || g(e)) return i = P(e, t);
      if (s(J, e)) {
        if (i = $[e], i.__isInternalWrapper) return;
        return i
      }
      return void 0 !== (i = t || $[e]) ? ($[e] = P(e, i), J.push(e), $[e]) : void 0
    }
    function M(e, t) {
      var i,
      n,
      s,
      r,
      o = [
      ];
      for (i = 0, n = e.length; i < n; i++) r = e[i],
      s = r === ee || r === te ? t[i] : O(r, t[i]),
      o.push(s);
      return o
    }
    function N(t, i, n, s) {
      if (!r(i)) return i;
      var o = function () {
        o.__isExecuting = !0;
        var r = M(n, s),
        a = i.apply(e, r);
        return void 0 === a && (a = W(t)),
        a
      };
      return o.__isInternalWrapper = !0,
      o
    }
    function F() {
      var t,
      i,
      n,
      s,
      r,
      a = Ee.slice.call(arguments);
      if (d(a[0])) {
        if (t = a.shift(), 'complete' === q[t]) return void ('undefined' != typeof console && console.warn('### Unable to load the multiple module that module is loaded more than once: ' + t))
      } else t = _();
      return i = o(a[0]) ? a.shift() : [
        ee,
        te,
        ie
      ],
      n = a.shift(),
      r = a.shift(),
      X.push(t),
      q[t] || p(t) || (q[t] = 'complete'),
      Z[t] = K(t),
      s = function (t, s) {
        $[s] = e.amd.buildFactory(s, n, i, t)
      },
      G(t, i, t, s, r)
    }
    function B(e) {
      e && delete $[e]
    }
    function G(e, t, i, n, s) {
      var a,
      d,
      c = [
      ];
      o(t) || (t = [
      ]),
      t.length > 0 && (c[t.length - 1] = void 0),
      a = function (t) {
        var i = ae[e].moduleId;
        try {
          n(t, i)
        } catch (e) {
          q[i] = 'error',
          r(ye.onError) ? ye.onError(i, e) : 'undefined' != typeof console && (e.stack && console.error(e.stack), console.error('### Unable to prepare module ' + i + '.\n\tError: ' + e))
        }
        delete ae[e],
        delete ae[i]
      },
      d = {
        base: i,
        moduleId: e,
        onSuccess: a,
        onFailure: s,
        dependencies: t,
        depModules: c
      },
      ae[e] = d;
      var l = function () {
        Z[d.moduleId] = K(d.moduleId),
        d.started = !0,
        U(d) && R(d)
      };
      p(e) ? setTimeout(function () {
        l()
      }, 1) : l()
    }
    function U(e) {
      for (var t = e.base, i = e.dependencies, n = 0, o = i.length; n < o; n++) {
        var a = i[n],
        d = A(a);
        if (d.plugin) {
          var c = l(L(d.plugin, t)),
          u = V(t);
          if (!s($, c)) return u([c], be.bind(G, null, e.moduleId, i, t, e.onSuccess, e.onFailure)),
          !1;
          var h,
          _,
          f = O(c);
          h = r(f.normalize) ? f.normalize(d.moduleId, Y(t)) : l(L(d.moduleId, t)),
          _ = c + '!' + h,
          i[n] = a = _,
          !$[_] || f.dynamic ? I(c, h, u, e) : e.depModules[n] = $[_]
        } else i[n] = l(L(a, t))
      }
      return !0
    }
    function V(e) {
      return !e || p(e) ? j : (Z[e] || (Z[e] = K(e)), Z[e])
    }
    function H(e, t) {
      var i = A(e);
      if (!i.plugin) return l(L(e, t));
      var n = l(L(i.plugin, t));
      if (!s($, n)) throw new Error('Cannot resolve resource id: plugin is not loaded.');
      var o,
      a = O(n);
      return o = r(a.normalize) ? a.normalize(i.moduleId, Y(t)) : l(L(i.moduleId, t)),
      n + '!' + o
    }
    function K(i) {
      var n = function (n, c, l) {
        var u,
        h,
        _,
        p,
        g = [
        ],
        v = arguments.length;
        if (d(n)) {
          if (_ = H(n, i), !s($, _)) throw new Error('### Module \'' + n + '" is not yet loaded!');
          var m,
          E = A(_);
          if (E.plugin && (m = O(E.plugin), m.dynamic)) throw new Error('require(String) cannot load dynamic resources.');
          if (void 0 === (p = O(_))) throw new Error('### Module \'' + n + '" is not yet loaded!');
          return p
        }
        if (1 === v && r(n) && (c = n, n = [
          ee,
          te,
          ie
        ]), o(n) && r(c)) return u = function (t) {
          var i = M(n, t);
          c.apply(e, i)
        },
        G(f(), n, i, u, l);
        if (void 0 !== i || !a(n) || 1 !== arguments.length) {
          for (h = 0; h < v; h++) g[h] = typeof arguments[h];
          throw new Error('The requested usage of require(' + g.join(', ') + ') is undefined')
        }
        t(n)
      };
      return n.toUrl = function (e) {
        var t,
        n = e,
        s = e.lastIndexOf('.'),
        r = e.split('/') [0],
        o = '.' === r || '..' === r;
        - 1 !== s && (!o || s > 1) && (t = e.substring(s, e.length), n = e.substring(0, s));
        var a = C(L(n, i)) + (t || ''),
        d = a.split('/');
        return '.' === d[0] ? (d = d.slice(1), u(d), d.splice(0, 0, '.')) : u(d),
        d.join('/')
      },
      n
    }
    function Y(e) {
      return function (i, n) {
        var s,
        r,
        o;
        return n = n || e,
        i && '.' === i.charAt(0) && (n ? (s = n && n.split('/'), r = s.slice(0, s.length - 1), i = i.split('/'), o = i.length - 1, t.nodeIdCompat && he.test(name[o]) && (name[o] = name[o].replace(he, '')), i = r.concat(i), u(i), i = i.join('/')) : 0 === i.indexOf('./') && (i = i.substring(2))),
        i
      }
    }
    function W(e) {
      return Q[e] || (Q[e] = {
      }),
      Q[e]
    }
    var j,
    q = {
      require: 'complete',
      exports: 'complete',
      module: 'complete'
    },
    z = {
    },
    X = [
    ],
    J = [
    ],
    $ = {
    },
    Z = {
    },
    Q = {
    },
    ee = 'require',
    te = 'exports',
    ie = 'module',
    ne = 0,
    se = 0,
    re = '__anony-module-',
    oe = '__require-',
    ae = {
    },
    de = 'undefined' != typeof window && void 0 !== window.document,
    ce = !de && 'undefined' != typeof importScripts,
    le = ce ? null : document.getElementsByTagName('head') [0],
    ue = 100,
    he = /\.js$/,
    _e = /^(\/\/)|([^:]+:\/\/)/,
    fe = /^\/[^\/]+/,
    pe = 'PLAYSTATION 3' === navigator.platform ? /^complete$/ : /^(complete|loaded)$/,
    ge = Object.prototype,
    ve = ge.hasOwnProperty,
    me = ge.toString,
    Ee = Array.prototype,
    be = {
    },
    ye = {
    },
    ke = './',
    Se = {
    },
    xe = [
    ],
    Te = 10000;
    be.bind = function (e, t) {
      var i = e,
      n = Array.prototype.slice.call(arguments, 2);
      return function () {
        var e = n.concat(arguments);
        return i.apply(t, e)
      }
    },
    j = K(),
    e.amd && e.amd.config && t(e.amd.config),
    F.amd = {
    },
    j.config = t,
    e.define || (e.define = F),
    e.undefine || (e.undefine = B),
    e.require || (e.require = j),
    e.amd || (e.amd = {
      require: j,
      define: F,
      undefine: B,
      config: t,
      load: x,
      completeLoad: b,
      resolvePath: T,
      buildFactory: N,
      executeFactory: D
    })
  }(this),
  define('xdk-base/amd', function () {
  }),
  window.domReady = function () {
    'use strict';
    function e() {
      if (!i) {
        i = !0;
        var e;
        for (e = 0; e < n.length; e += 1) n[e](document)
      }
    }
    function t(e) {
      return i ? e(document) : n.push(e),
      t
    }
    var i = !1,
    n = [
    ];
    return document.addEventListener ? (document.addEventListener('DOMContentLoaded', e, !1), window.addEventListener('load', e, !1), window.addEventListener('show', e, !1), window.onShow = e) : window.attachEvent && window.attachEvent('onload', e),
    'complete' === document.readyState && e(),
    t
  }(),
  define('xdk-base/domReady', function () {
  }),
  require({
    paths: {
      'vdk-appGrid': '../dep/vdk-appGrid',
      'vdk-lib-moment': '../dep/vdk-lib-moment',
      'vdk-banner': '../dep/vdk-banner',
      'vdk-lib-base64': '../dep/vdk-lib-base64',
      'vdk-message': '../dep/vdk-message',
      'vdk-loading': '../dep/vdk-loading',
      'vdk-vast': '../dep/vdk-vast',
      'xdk-ax': '../dep/xdk-ax',
      'xdk-base': '../dep/xdk-base',
      'xdk-history': '../dep/xdk-history',
      'xdk-ui-grid': '../dep/xdk-ui-grid',
      'xdk-ui-basic': '../dep/xdk-ui-basic',
      'xdk-mouse': '../dep/xdk-mouse',
      'xdk-ui-input': '../dep/xdk-ui-input',
      image: '../dep/xdk-base/loader/image',
      json: '../dep/xdk-base/loader/json',
      css: '../dep/xdk-base/loader/css'
    }
  }),
  define('../dep/dep.config.js', function () {
  }),
  require({
    image: {
      map: {
        '../img': [
        ]
      }
    }
  }),
  define('../dep/img.map.js', function () {
  }),
  require({
    baseUrl: 'js',
    paths: {
      Fuse: 'lib/fuse.min',
      'xdk.config': './xdk.config',
      'xdk-base/config': 'app/core/ext/xdk-base/config',
      'xdk-ext-device-sagemcom': 'dep_overrides/ext/device/sagemcom',
      'vdk-vast/vastCtrl': 'dep_overrides/vdk-vast/vastCtrl',
      'vdk-vast/vastCollection': 'dep_overrides/vdk-vast/vastCollection',
      'vdk-vast/vastCollection.wrapper': 'dep_overrides/vdk-vast/vastCollection.wrapper',
      'vdk-vast/vastErrors': 'dep_overrides/vdk-vast/vastErrors',
      'vdk-vast/vastModel': 'dep_overrides/vdk-vast/vastModel',
      'vdk-vast/vastParser': 'dep_overrides/vdk-vast/vastParser'
    }
  }),
  define('amd.config.js', function () {
  }),
  define('xdk-base/core', [
  ], function () {
    'use strict';
    var e = 1,
    t = function (e, t) {
      this.name = e || 'XDKCustomError',
      this.message = t || ''
    };
    return {
      version: '2.9.2',
      buildNumber: '1522051222-35bd25c',
      root: function () {
        return 'undefined' != typeof window ? window : null
      }(),
      createException: function (e, i) {
        return t.prototype = new Error,
        t.prototype.constructor = t,
        new t(e, i)
      },
      getGuid: function () {
        return e++
      }
    }
  }),
  define('xdk-base/exception', {
    ILLEGAL_ARGUMENT: 'ax:exception:illegal-argument',
    ILLEGAL_STATE: 'ax:exception:illegal-state',
    INTERNAL: 'ax:exception:internal',
    UNAUTHORIZED: 'ax:exception:unauthorized',
    UNSUPPORTED_OPERATION: 'ax:exception:unsupported-operation'
  }),
  define('xdk-base/jsGlobals', [
    'exports'
  ], function (e) {
    'use strict';
    e.Array = Array,
    e.Object = Object
  }),
  define('xdk-base/util', [
    'require',
    'xdk-base/core',
    'xdk-base/exception',
    'xdk-base/jsGlobals'
  ], function (e, t, i, n) {
    'use strict';
    function s(e, t, i, n) {
      for (var o = (n || 0) - 1, a = e.length, d = - 1, c = [
      ]; ++o < a; ) {
        var l = e[o];
        if (l && 'object' == typeof l && 'number' == typeof l.length && (r.isArray(l) || r.isArguments(l))) {
          t && (l = s(l, t, i));
          var u = - 1,
          h = l.length;
          for (c.length += h; ++u < h; ) c[++d] = l[u]
        } else i || (c[++d] = l)
      }
      return c
    }
    var r = {
    },
    o = n.Array,
    a = n.Object,
    d = function () {
      return e('xdk-base/promise')
    };
    !function () {
      var e;
      e = a.prototype.toString,
      r.extend = function (e, t, i) {
        var n,
        s,
        r,
        o,
        a;
        for (a in t) s = e[a],
        r = t[a],
        e !== r && (n = this.isArray(r), i && r && (n || this.isPlainObject(r)) ? (n ? (n = !1, o = s && this.isArray(s) ? s : [
        ]) : o = s && this.isPlainObject(t) ? s : {
        }, e[a] = this.extend(o, r, !0)) : this.isUndefined(r) || (e[a] = r));
        return e
      },
      r.clone = function (e, t) {
        return this.isArray(e) ? this.extend([], e, t) : this.extend({
        }, e, t)
      },
      r.isUndefined = function (e) {
        return void 0 === e
      },
      r.isPlainObject = function (e) {
        if (!e || 'object' != typeof e || e.nodeType) return !1;
        if (e.constructor && !e.hasOwnProperty('constructor') && !e.constructor.prototype.hasOwnProperty('isPrototypeOf')) return !1;
        var t;
        for (t in e);
        return void 0 === t || e.hasOwnProperty(t)
      },
      r.isArray = o.isArray ? o.isArray : function (t) {
        return '[object Array]' === e.call(t)
      },
      r.isFunction = function (e) {
        return 'function' == typeof e || !1
      },
      r.isString = function (t) {
        return '[object String]' === e.call(t)
      },
      r.isNumber = function (t) {
        return '[object Number]' === e.call(t)
      },
      r.isNaN = function (e) {
        return r.isNumber(e) && e !== + e
      },
      r.isFinite = function (e) {
        return isFinite(e)
      },
      r.isBoolean = function (t) {
        return '[object Boolean]' === e.call(t)
      },
      r.isDate = function (t) {
        return '[object Date]' === e.call(t)
      },
      r.isDOMElement = function (e) {
        return !!e && ('object' == typeof e && 1 === e.nodeType && 'object' == typeof e.style && 'object' == typeof e.ownerDocument && 'string' == typeof e.nodeName)
      },
      r.isEmpty = function (e) {
        if (!this.isPlainObject(e)) return !1;
        var t;
        for (t in e) if (e.hasOwnProperty(t)) return !1;
        return !0
      },
      r.isNull = function (e) {
        return null === e
      },
      r.isObject = function (e) {
        return e === a(e)
      },
      r.isArguments = function (e) {
        return r.has(e, 'callee')
      },
      r.areObjectsEqual = function (e, t, i) {
        if (!r.isPlainObject(e) || !r.isPlainObject(t)) return !1;
        var n,
        s = {
        },
        o = !1;
        1 === i && (o = !0);
        for (n in e) {
          var a = e[n],
          d = t[n];
          if (r.isPlainObject(a) && r.isPlainObject(d)) {
            if (!o && !r.areObjectsEqual(a, d, i - 1)) return !1
          } else if (r.isArray(a) && r.isArray(d)) {
            if (!o && !r.areArraysEqual(a, d, i - 1)) return !1
          } else if (a !== d) return !1;
          s[n] = !0
        }
        for (n in t) if (!s[n]) return !1;
        return !0
      },
      r.areArraysEqual = function (e, t, i) {
        if (!r.isArray(e) || !r.isArray(t)) return !1;
        var n = e.length,
        s = t.length,
        o = !1;
        if (n !== s) return !1;
        1 === i && (o = !0);
        for (var a = 0; a < n; a++) if (r.isPlainObject(e[a]) && r.isPlainObject(t[a])) {
          if (!o && !r.areObjectsEqual(e[a], t[a], i - 1)) return !1
        } else if (r.isArray(e[a]) && r.isArray(t[a])) {
          if (!o && !r.areArraysEqual(e[a], t[a], i - 1)) return !1
        } else if (e[a] !== t[a]) return !1;
        return !0
      },
      r.sort = function (e, n) {
        function s(e, t) {
          return e < t ? - 1 : e > t ? 1 : 0
        }
        if (!r.isArray(e)) throw t.createException(i.ILLEGAL_ARGUMENT, 'arr parameter must be array');
        var o,
        a,
        d;
        return e.length < 2 ? e : (n && r.isFunction(n) || (n = s), o = Math.round(e.length / 2), a = r.sort(e.slice(0, o), n), d = r.sort(e.slice(o, e.length), n), function (e, t, i) {
          for (var n = [
          ]; e.length && t.length; ) i(e[0], t[0]) <= 0 ? n.push(e.shift()) : n.push(t.shift());
          return e.length && n.push.apply(n, e),
          t.length && n.push.apply(n, t),
          n
        }(a, d, n))
      },
      r.shuffle = function (e) {
        if (!r.isArray(e)) throw t.createException(i.ILLEGAL_ARGUMENT, 'arr parameter must be array');
        for (var n, s, o = e.length; 0 !== o; ) s = Math.floor(Math.random() * o),
        o -= 1,
        n = e[o],
        e[o] = e[s],
        e[s] = n;
        return e
      },
      r.sortByField = function (e, n, s) {
        var o,
        a = 1;
        if (!r.isArray(e)) throw t.createException(i.ILLEGAL_ARGUMENT, 'arr parameter must be array');
        if (s && !r.isFunction(s)) throw t.createException(i.ILLEGAL_ARGUMENT, 'If wrapper is provided, must be a function');
        '-' === n[0] && (a = - 1, n = n.substr(1)),
        o = s && r.isFunction(s) ? function (e) {
          if (!e.hasOwnProperty(n)) throw t.createException(i.ILLEGAL_STATE, 'Unable to sort, as ' + n + ' is not a property in the comparable array item');
          return s(e[n])
        }
         : function (e) {
          if (!e.hasOwnProperty(n)) throw t.createException(i.ILLEGAL_STATE, 'Unable to sort, as ' + n + ' is not a property in the comparable array item');
          return e[n]
        };
        var d = function (e, t) {
          return e = o(e),
          t = o(t),
          a * ((e > t) - (t > e))
        };
        return r.sort(e, d)
      },
      r.sortByFields = function (e, n, s) {
        function o(e) {
          var n = 1;
          return '-' === e[0] && (n = - 1, e = e.substr(1)),
          function (o, a) {
            if (!o.hasOwnProperty(e) || !a.hasOwnProperty(e)) throw t.createException(i.ILLEGAL_STATE, 'Unable to sort, as ' + e + ' is not a property in the comparable array item');
            var d = o[e],
            c = a[e];
            return s && r.isFunction(s) && (d = s(o[e]), c = s(a[e])),
            (d < c ? - 1 : d > c ? 1 : 0) * n
          }
        }
        function a() {
          return function (e, t) {
            var i,
            s;
            for (s = 0, i = 0; 0 === i && s < n.length; s++) i = o(n[s]) (e, t);
            return i
          }
        }
        if (!r.isArray(e)) throw t.createException(i.ILLEGAL_ARGUMENT, 'array parameter must be a array');
        if (!r.isArray(n)) throw t.createException(i.ILLEGAL_ARGUMENT, 'Fields parameter must be a array');
        if (s && !r.isFunction(s)) throw t.createException(i.ILLEGAL_ARGUMENT, 'If wrapper is provided, must be a function');
        return r.sort(e, a.apply(null, n))
      }
    }(),
    function () {
      var e,
      i;
      e = function (e, t) {
        for (var i = e.length, n = t.length; n--; ) e[i + n] = t[n];
        return e
      },
      i = function (t, i) {
        return t = o.prototype.slice.call(t, 0),
        e(t, i)
      },
      r.bind = function (e, t) {
        if (r.isFunction(Function.prototype.bind)) return Function.prototype.bind.apply(e, o.prototype.slice.call(arguments, 1));
        if (arguments.length < 2 && r.isUndefined(arguments[0])) return e;
        var n = e,
        s = o.prototype.slice.call(arguments, 2);
        return function () {
          var e = i(s, arguments);
          return n.apply(t, e)
        }
      },
      r.argumentNames = function (e) {
        var t = e.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/) [1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g, '').replace(/\s+/g, '').split(',');
        return 1 !== t.length || t[0] ? t : [
        ]
      },
      function () {
        function e(e, i) {
          if (e && i) {
            if (s[e]) throw t.createException('Repeated id for deferred creation');
            return s[e] = i,
            s[e]
          }
        }
        function i(e) {
          return s[e]
        }
        function n(e) {
          s[e] = void 0
        }
        var s = {
        };
        r.delay = function (i, s) {
          var r,
          o = d().defer();
          return r = t.root.setTimeout(function () {
            return s && n(s),
            o.resolve()
          }, 1000 * i),
          s && e(s, {
            handle: r,
            deferred: o
          }),
          o.promise
        },
        r.defer = function (e) {
          return r.delay(0.01, e)
        },
        r.clearDelay = function (e) {
          if (e) {
            var t = i(e);
            t && (clearTimeout(t.handle), t.deferred.reject('delay aborted'), n(e))
          }
        }
      }(),
      r.wrap = function (t, i) {
        return function () {
          var n = e([r.bind(t, this)], arguments);
          return i.apply(this, n)
        }
      },
      r.methodize = function (t) {
        if (t._methodized) return t._methodized;
        var i = t;
        return t._methodized = function () {
          var t = e([this], arguments);
          return i.apply(null, t)
        },
        t._methodized
      }
    }(),
    function () {
      r.insert = function (e, t, i) {
        return r.isString(e) || (e = '' + e),
        (r.isUndefined(t) || t < 0 || t > e.length) && (t = e.length),
        i = r.isUndefined(i) ? '' : i,
        e.slice(0, t) + i + e.slice(t, e.length)
      },
      r.truncate = function (e, t, i) {
        r.isString(e) || (e = '' + e),
        t = r.isNumber(t) ? t : 30,
        i = r.isUndefined(i) ? '...' : i;
        var n = t < 0 ? 0 : t;
        return e.length > t ? e.slice(0, n) + i : String(e)
      },
      r.strip = function (e) {
        return r.isString(e) || (e = '' + e),
        e.replace(/^\s+/, '').replace(/\s+$/, '')
      },
      r.camelize = function (e) {
        return r.isString(e) || (e = '' + e),
        e.replace(/-+(.)?/g, function (e, t) {
          return t ? t.toUpperCase() : ''
        })
      },
      r.decamelize = function (e, t) {
        return r.isString(e) || (e = '' + e),
        t = t || '-',
        e.replace(/([a-z])([A-Z])/g, '$1' + t + '$2').toLowerCase()
      },
      r.empty = function (e) {
        return r.isString(e) || (e = '' + e),
        /^\s*$/.test(e)
      },
      r.startsWith = function (e, t) {
        return !r.isUndefined(e) && !r.isUndefined(t) && (r.isString(e) || (e = '' + e), r.isString(t) || (t = '' + t), e.substr(0, t.length) === t)
      },
      r.encodeHTML = function (e) {
        r.isString(e) || (e = '' + e);
        var t = '';
        return 0 === e.length ? '' : (t = e.replace(/&/g, '&amp;'), t = t.replace(/</g, '&lt;'), t = t.replace(/>/g, '&gt;'), t = t.replace(/ /g, '&nbsp;'), t = t.replace(/\'/g, '\''), t = t.replace(/\"/g, '&quot;'), t = t.replace(/\n/g, '<br>'))
      },
      r.decodeHTML = function (e) {
        r.isString(e) || (e = '' + e);
        var t = '';
        return 0 === e.length ? '' : (t = e.replace(/&amp;/g, '&'), t = t.replace(/&lt;/g, '<'), t = t.replace(/&gt;/g, '>'), t = t.replace(/&nbsp;/g, ' '), t = t.replace(/'/g, '\''), t = t.replace(/&quot;/g, '"'), t = t.replace(/<br>/g, '\n'))
      }
    }();
    var c = t.root,
    l = /^\s*null(\s)*$/,
    u = {
      parse: function (e) {
        if (c.JSON && c.JSON.parse) return c.JSON.parse(e);
        if (r.isString(e) || r.isNumber(e)) {
          if (l.test(e)) return null;
          try {
            return new Function('var input = ' + e + '; if (input === undefined || input === null) throw "Unexpected token"; return input;') ()
          } catch (e) {
            throw t.createException('JSONParseError', 'JSON parse Error')
          }
        }
        throw t.createException('JSONParseError', 'JSON parse Error')
      },
      stringify: function (e) {
        if (c.JSON && c.JSON.stringify) return c.JSON.stringify(e);
        var n,
        s,
        o,
        a,
        d = [
        ];
        if (r.isDOMElement(e)) throw t.createException(i.ILLEGAL_ARGUMENT, 'Coverting DOM element to JSON');
        if (null === e) return 'null';
        if (void 0 !== e) {
          if (r.isFunction(e.toJSON)) return e.toJSON();
          if (r.isBoolean(e) || r.isNumber(e)) return e.toString();
          if (r.isString(e)) return '"' + e.replace(/"/g, '"') + '"';
          if (r.isArray(e)) {
            var l = '[';
            for (n = e.length, a = 0; a < n; a++) s = this.stringify(e[a]),
            l += (r.isUndefined(s) ? null : s) + ',';
            return l.substring(0, l.length - 1) + ']'
          }
          if (r.isPlainObject(e)) {
            for (o in e) s = this.stringify(e[o]),
            r.isUndefined(s) || d.push('"' + o.toString() + '":' + s);
            return '{' + d.join(',') + '}'
          }
        }
      }
    };
    return r.parse = u.parse,
    r.stringify = u.stringify,
    r.breaker = {
    },
    function () {
      r.first = function (e) {
        if (!r.isArray(e)) throw t.createException('ArrayFirstError', 'Type is not an array');
        return e[0]
      },
      r.indexOf = function (e, i, n) {
        if (!r.isArray(e)) throw t.createException('ArrayIndexOfError', 'Type is not an array');
        if (r.isFunction(o.prototype.indexOf)) return e.indexOf(i, n);
        n || (n = 0);
        var s = e.length;
        for (n < 0 && (n = s + n); n < s; n++) if (e[n] === i) return n;
        return - 1
      },
      r.last = function (e) {
        if (!r.isArray(e)) throw t.createException('ArrayLastError', 'Type is not an array');
        return e[e.length - 1]
      },
      r.lastIndexOf = function (e, i, n) {
        if (!r.isArray(e)) throw t.createException('ArrayLastError', 'Type is not an array');
        if (r.isFunction(o.prototype.lastIndexOf)) return r.isUndefined(n) ? e.lastIndexOf(i) : e.lastIndexOf(i, n);
        n = r.isNumber(n) ? (n < 0 ? e.length + n : n) + 1 : e.length;
        var s = this.indexOf(e.slice(0, n).reverse(), i);
        return s < 0 ? s : n - s - 1
      },
      r.flatten = function (e, t) {
        return s(e, t, !1)
      },
      r.size = function (e) {
        if (!r.isArray(e)) throw t.createException('ArraySizeError', 'Type is not an array');
        return e.length
      },
      r.remove = function (e, i, n) {
        if (!r.isArray(e)) throw t.createException('ArrayRemoveError', 'Type is not an array');
        if (i >= e.length || n && n >= e.length) throw t.createException('ArrayRemoveError', 'Range is out of the array length');
        var s = e.slice((n || i) + 1 || e.length);
        return e.length = i < 0 ? e.length + i : i,
        e.push.apply(e, s)
      },
      r.reduce = function (e, i, n) {
        if (!r.isArray(e)) throw t.createException('ArrayReduceError', 'Type is not an array');
        if (i = i || function (e) {
          return e
        }, 0 === e.length) return n;
        if (r.isFunction(o.prototype.reduce)) return r.isUndefined(n) ? e.reduce(i) : e.reduce(i, n);
        if (!r.isFunction(i)) throw t.createException('ArrayReduceError', 'iter is not a function');
        var s,
        a = 0,
        d = e.length,
        c = !1;
        for (r.isUndefined(n) || (s = n, c = !0); d > a; ++a) e.hasOwnProperty(a) && (c ? s = i(s, e[a], a, e) : (s = e[a], c = !0));
        return s
      },
      r.reduceRight = function (e, i, n) {
        if (!r.isArray(e)) throw t.createException('ArrayReduceRightError', 'Type is not an array');
        if (i = i || function (e) {
          return e
        }, r.isFunction(o.prototype.reduceRight)) return r.isUndefined(n) ? e.reduceRight(i) : e.reduceRight(i, n);
        if (!r.isFunction(i)) throw t.createException('ArrayReduceRightError', 'iter is not a function');
        var s,
        a = e.length,
        d = a - 1,
        c = !1;
        for (r.isUndefined(n) || (s = n, c = !0); - 1 < d; --d) e.hasOwnProperty(d) && (c ? s = i(s, e[d], d, e) : (s = e[d], c = !0));
        return s
      },
      r.map = function (e, i, n) {
        if (!r.isArray(e)) throw t.createException('ArrayMapError', 'Type is not an array');
        if (i = i || function (e) {
          return e
        }, r.isFunction(o.prototype.map)) return e.map(i, n);
        if (!r.isFunction(i)) throw t.createException('ArrayMapError', 'iter is not a function');
        var s = [
        ];
        return this.each(e, function (e, t) {
          s.push(i.call(n, e, t))
        }),
        s
      },
      r.filter = function (e, i, n) {
        if (!r.isArray(e)) throw t.createException('ArrayFilterError', 'Type is not an array');
        if (i = i || function (e) {
          return e
        }, r.isFunction(o.prototype.filter)) return e.filter(i, n);
        if (!r.isFunction(i)) throw t.createException('ArrayFilterError', 'iter is not a function');
        var s = [
        ];
        return this.each(e, function (t, r) {
          i.call(n, t, r, e) && s.push(t)
        }),
        s
      },
      r.findIndex = function (e, t, i) {
        var n = - 1,
        s = e ? e.length : 0;
        for (t = t || function (e) {
          return e
        }; ++n < s; ) if (t.call(i, e[n], n, e)) return n;
        return - 1
      },
      r.find = function (e, t, i) {
        var n = r.findIndex(e, t, i);
        return n > - 1 ? e[n] : void 0
      },
      r.some = function (e, i, n) {
        if (!r.isArray(e)) throw t.createException('ArraySomeError', 'Type is not an array');
        if (i = i || function (e) {
          return e
        }, r.isFunction(o.prototype.some)) return e.some(i, n);
        if (!r.isFunction(i)) throw t.createException('ArraySomeError', 'iter is not a function');
        var s = !1;
        return this.each(e, function (e, t) {
          if (s = i.call(n, e, t)) return r.breaker
        }, this),
        s
      },
      r.pluck = function (e, t) {
        var i = function (e) {
          return null === t ? void 0 : e[t]
        };
        return r.map(e, i)
      },
      r.pick = function (e, t, i) {
        var n,
        o = {
        };
        if (null === e) return o;
        if (r.isFunction(t)) for (n in e) {
          var d = e[n];
          t.call(i, d, n, e) && (o[n] = d)
        } else {
          var c = s(arguments, !1, !1, 1);
          e = new a(e);
          for (var l = 0, u = c.length; l < u; l++) (n = c[l]) in e && (o[n] = e[n])
        }
        return o
      }
    }(),
    function () {
      r.keys = function (e) {
        var t,
        i = [
        ];
        if (r.isFunction(a.keys)) return a.keys(e);
        for (t in e) e.hasOwnProperty(t) && i.push(t);
        return i
      },
      r.inspect = function (e) {
        var t,
        i,
        n = this.keys(e),
        s = this.values(e),
        r = n.length;
        if (t = '#<object:{', 0 === r) return t + '}>';
        for (i = 0; i < r; i++) t = t + n[i] + ':' + s[i] + ', ';
        return t = t.substr(0, t.length - 2) + '}>'
      },
      r.values = function (e) {
        var t,
        i = [
        ];
        for (t in e) i.push(e[t]);
        return i
      },
      r.toQueryString = function (e) {
        var t,
        i = [
        ];
        return t = function (e, t) {
          return r.isUndefined(t) ? e : e + '=' + encodeURIComponent(null === t ? '' : String(t))
        },
        r.each(e, function (e) {
          var n,
          s,
          o,
          a,
          d = encodeURIComponent(e.key),
          c = e.value;
          if (c && 'object' == typeof c) {
            if (r.isArray(c)) {
              for (n = 0, s = c.length, a = [
              ]; n < s; n++) o = c[n],
              a.push(t(d, o));
              i = i.concat(a)
            }
          } else i.push(t(d, c))
        }, this),
        i.join('&')
      },
      r.has = function (e, t) {
        return null !== e && hasOwnProperty.call(e, t)
      }
    }(),
    function () {
      var e = function () {
        if (r.isArray(arguments[0])) return !0;
        if (r.isPlainObject(arguments[0])) return !1;
        throw t.createException('Exception', 'No such related function of the type' + typeof arguments[0])
      };
      r.clear = function (t) {
        var i,
        n,
        s,
        o,
        a;
        if (e(t)) return s = t,
        s.length = 0,
        s;
        for (i = t, n = 0, a = r.keys(i), o = a.length; n < o; n++) delete i[a[n]];
        return i
      },
      r.each = function (i, n, s) {
        var a,
        d,
        c,
        l,
        u,
        h,
        _;
        if (n = n || function (e) {
          return e
        }, !r.isFunction(n)) throw t.createException('EachError', 'iter is not a function');
        if (e(i)) {
          if (a = i, r.isFunction(o.prototype.some)) return void a.some(function () {
            return n.apply(s, arguments) === r.breaker
          }, s);
          for (d = 0, c = a.length; d < c; d++) if (n.call(s, a[d], d, a) === r.breaker) return
        } else {
          _ = i;
          for (l in _) if (u = _[l], h = [
            l,
            u
          ], h.key = l, h.value = u, n.call(s, h) === r.breaker) return
        }
      },
      r.every = function (t, i, n) {
        var s,
        o = !1;
        return i = i || function (e) {
          return e
        },
        e(t) && (o = !0, r.isFunction(t.every)) ? t.every(i, n) : (s = !0, this.each(t, function (e, t) {
          if (o || (e = e.value), !(s = s && !!i.call(n, e, t, void 0))) return r.breaker
        }, this), s)
      },
      r.contains = function (e, t) {
        return null !== e && (e.length !== + e.length && (e = r.values(e)), r.indexOf(e, t) >= 0)
      }
    }(),
    r
  }),
  define('xdk-base/Interface', [
    'xdk-base/util',
    'xdk-base/core'
  ], function (e, t) {
    'use strict';
    function i(e, i, n) {
      if (!o) throw t.createException('PrivateConstructor', 'Use Interface.create instead');
      this.name = e,
      this.exts = i || [
      ],
      this.methods = n || {
      }
    }
    function n(e) {
      return e instanceof i
    }
    function s() {
      if (arguments.length < 2) throw t.createException('InvalidArgument', 'intf.create called with ' + arguments.length + 'arguments, but expected at least 2.');
      var s,
      r,
      a,
      d,
      c,
      l,
      u,
      h = Array.prototype.slice.call(arguments);
      if (s = h.shift(), !e.isString(s)) throw t.createException('InvalidArgument', 'intf.create: expects the first argument to be String');
      if (h.length > 1) {
        if (!(r = h.shift()) || !e.isArray(r)) throw t.createException('InvalidArgument', 'intf.create: expects the second argument of three provided as an array');
        for (c = 0, l = r.length; c < l; c++) if (!n(r[c])) throw t.createException('InvalidArgument', 'intf.create: expects the first argument array contains only interfaces')
      }
      if (!(a = h.shift()) || !e.isPlainObject(a)) throw t.createException('InvalidArgument', 'intf.create: expects an Object for the last argument');
      return e.each(a, function (i) {
        if (u = i.key, !e.isArray(i.value)) throw t.createException('InvalidArgument', 'intf.create: expects method param list to be passed in as an array.');
        for (c = 0, l = i.value.length; c < l; c++) if (!e.isString(i.value[c])) throw t.createException('InvalidArgument', 'intf.create: expects method param to be passed in as a string.')
      }),
      o = !0,
      d = new i(s, r, a),
      o = !1,
      d
    }
    function r(i, n) {
      var s,
      o,
      a,
      d,
      c,
      l,
      u;
      if (n.exts) for (s = 0, o = n.exts.length; s < o; s++) r(i, n.exts[s]);
      e.each(n.methods, function (s) {
        for (u = s.key, a = s.value, l = i.prototype, d = !1; !d && l; ) l[u] && e.isFunction(l[u]) && (c = l[u].isSuperWrapper ? l[u].orig : l[u], c.length >= n.methods[u].length && (d = !0)),
        l = l.prototype;
        if (!d) throw t.createException('InterfaceViolation', 'intf.ensureImpl: object does not implement the ' + n.name + ' interface. Method ' + n.printFn(u) + ' was not found.')
      })
    }
    var o = !1;
    return i.prototype.toString = function () {
      var e,
      t = 'Interface ' + this.name + ' : { ';
      for (e in this.methods) t += this.printFn(e);
      return t += ' }'
    },
    i.prototype.printFn = function (e) {
      return e + '(' + this.methods[e].join() + ')'
    },
    i.create = s,
    i.ensureImpl = r,
    i
  }),
  define('xdk-base/class', [
    'xdk-base/util',
    'xdk-base/core',
    'xdk-base/Interface',
    'require'
  ], function (e, t, i, n) {
    'use strict';
    function s() {
      function i() {
        if (!(this instanceof i)) {
          throw n('xdk-base/console').error('Please use \'new\' operator! This is a class constructor function, it cannot be called directly!'),
          t.createException('IncorrectInvocation', 'Please use \'new\' operator! This is a class constructor function, it cannot be called directly!')
        }
        f || (g(this, i.__defaults), this.init.apply(this, arguments))
      }
      var s,
      r = null,
      a = Array.prototype.slice.call(arguments),
      d = [
      ],
      u = null,
      h = null;
      if (e.isFunction(a[0]) && (r = a.shift()), e.isArray(a[0]) && (d = a.shift()), u = a.shift(), !e.isPlainObject(u) && !e.isFunction(u)) throw s = n('xdk-base/console'),
      s.error('Static members parameter must be an object or a function!'),
      t.createException('IncorrectParam', 'Static members parameter must be an object or a function!');
      if (h = a.shift(), r ? (p(i, r), f = !0, i.prototype = new r, f = !1, g(i.prototype, r.prototype)) : p(i, o.methods), i._superclass = r, e.isFunction(u) && (u = u.apply(null)), l(i, u), e.isFunction(h) && (h = h.apply(null)), h && (c(i, h), i.__defaults = {
      }, g(i.__defaults, i.prototype), g(i.__defaults, h)), !h) throw t.createException('IncorrectParam', 'Instance memebers are not provided!');
      return i.prototype.init || (i.prototype.init = v),
      i.prototype.constructor = i,
      e.isFunction(i.prototype.deinit) && (i.prototype.destructor = i.prototype.deinit),
      i.intfs = d,
      e.isFunction(i.main) ? i.main() : i.main || (i.main = v),
      r && r.intfs && r.intfs.length > 0 && (i.intfs = i.intfs.concat(r.intfs)),
      i
    }
    function r(t, i) {
      function n(t) {
        var s = !1;
        return e.each(t, function (t) {
          return t === i ? (s = !0, e.breaker) : n(t.exts) ? (s = !0, e.breaker) : void 0
        }),
        s
      }
      for (var s = t, r = !1; s; ) {
        if (n(s.intfs, i)) {
          r = !0;
          break
        }
        s = s._superclass
      }
      return r
    }
    var o,
    a,
    d,
    c,
    l,
    u,
    h,
    _ = !0,
    f = !1,
    p = function (t, i) {
      var n,
      s;
      for (n in i) s = i[n],
      e.isArray(s) ? t[n] = s.slice() : e.isPlainObject(s) ? t[n] = e.clone(s, !0) : t[n] = s
    },
    g = function (t, i) {
      var n,
      s;
      for (n in i) s = i[n],
      e.isArray(s) ? t[n] = s.slice() : e.isPlainObject(s) && (t[n] = e.clone(s, !0))
    },
    v = function () {
    },
    m = function () {
      var e = n('xdk-base/console'),
      t = n('xdk-base/core');
      throw e.error('Abstract function called!'),
      t.createException('AbstractMethodInvoked', 'Abstract method called! This method must be implemented in subclass!')
    };
    for (a in {
      toString: 1
    }) 'toString' === a && (_ = !1);
    return c = function (t, i, n) {
      var s,
      r,
      o,
      a,
      d,
      c,
      l = n ? t._superclass : t._superclass && t._superclass.prototype,
      u = e.keys(i);
      for (_ && (i.toString !== Object.prototype.toString && u.push('toString'), i.valueOf !== Object.prototype.valueOf && u.push('valueOf')), c = function (t, i) {
        var n = function () {
          var n,
          s = this._super;
          return this._super = l[t],
          e.isFunction(this._super) || (this._super = v),
          n = i.apply(this, arguments),
          s ? this._super = s : delete this._super,
          n
        };
        return n.isSuperWrapper = !0,
        n.orig = i,
        n
      }, s = 0, r = u.length; s < r; s++) o = u[s],
      a = i[o],
      l && e.isFunction(a) && (d = a, a = c(o, d), a.valueOf = e.bind(d.valueOf, d), a.toString = e.bind(d.toString, d)),
      n ? t[o] = a : t.prototype[o] = a;
      return t
    },
    l = function (e, t) {
      return c(e, t, !0)
    },
    d = function () {
      var e,
      t;
      if (e = s.apply(this, arguments), e._superclass, e.intfs) for (t = 0; t < e.intfs.length; t++) i.ensureImpl(e, e.intfs[t])
      ;
      return e.__abstract = !1,
      e
    },
    u = function () {
      var e = s.apply(this, arguments);
      return e.__abstract = !0,
      e
    },
    h = function (e) {
      return e.__abstract
    },
    o = {
      create: d,
      addMethods: c,
      addStaticMethods: l,
      abstractFn: m,
      hasImpl: r,
      createAbstract: u,
      isAbstract: h
    }
  }),
  define('app/core/nav/DestinationParserManager', [
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/exception'
  ], function (e, t, i) {
    'use strict';
    var n,
    s;
    return s = e.create({
      singleton: function () {
        return n || (n = new s),
        n
      }
    }, {
      __parserRegistry: [
      ],
      addDestinationParser: function (e) {
        this.__parserRegistry.indexOf(e) > - 1 || this.__parserRegistry.push(e)
      },
      parseFrom: function (e) {
        for (var n, s = 0, r = this.__parserRegistry.length; s < r; s++) if (n = this.__parserRegistry[s], n.canParse(e)) return n.parseFrom(e);
        throw t.createException(i.ILLEGAL_ARGUMENT, 'ParserError: No parser can parse the source: ' + e)
      }
    })
  }),
  define('xdk-base/QueryString', [
    'xdk-base/class',
    'xdk-base/util'
  ], function (e, t) {
    'use strict';
    return e.create({
      parse: function (e) {
        if (!e || !t.isString(e)) return {
        };
        var i,
        n,
        s,
        r,
        o = {
        };
        for (i = e.split('&'), s = 0, r = i.length; s < r; s++) (n = i[s].match(/^([^=]+)=?(.*)$/)) && (o[n[1]] = n[2]);
        return o
      }
    }, {
      __parameters: [
      ],
      __queryString: '',
      init: function (e) {
        e || (e = window.location.href);
        var t;
        t = e.match(/^([^?]*)\?(.*)$/),
        this.__queryString = t ? t[2] : '',
        this.__parameters = this.constructor.parse(this.__queryString)
      },
      getValue: function (e) {
        return t.isString(this.__parameters[e]) ? this.__parameters[e] : null
      },
      getQueryString: function (e) {
        if (!t.isObject(e)) return this.__queryString;
        var i,
        n,
        s,
        r = '';
        if (i = t.clone(this.__parameters), t.isObject(e.extendFrom) && (i = t.extend(i, e.extendFrom)), t.isArray(e.exclude)) {
          s = e.exclude;
          for (n in i) - 1 !== t.indexOf(s, n) && i.hasOwnProperty(n) && delete i[n]
        }
        for (n in i) r += n + '=' + i[n] + '&';
        return r.length > 0 && (r = r.substring(0, r.length - 1)),
        r
      },
      toObject: function () {
        return this.__parameters
      }
    })
  }),
  function (e) {
    'use strict';
    var t = function (e) {
      var t,
      i,
      n,
      s,
      r = /"|(\/\*)|(\*\/)|(\/\/)|\n|\r/g,
      o = !1,
      a = !1,
      d = !1,
      c = [
      ],
      l = 0,
      u = 0;
      for (r.lastIndex = 0; t = r.exec(e); ) n = RegExp.leftContext,
      s = RegExp.rightContext,
      a || d || (i = n.substring(u), o || (i = i.replace(/(\n|\r|\s)*/g, '')), c[l++] = i),
      u = r.lastIndex,
      '"' !== t[0] || a || d ? '/*' !== t[0] || o || a || d ? '*/' !== t[0] || o || !a || d ? '//' !== t[0] || o || a || d ? '\n' !== t[0] && '\r' !== t[0] || o || a || !d ? a || d || /\n|\r|\s/.test(t[0]) || (c[l++] = t[0]) : d = !1 : d = !0 : a = !1 : a = !0 : (i = n.match(/(\\)*$/), o && i && i[0].length % 2 != 0 || (o = !o), u--, s = e.substring(u));
      return c[l++] = s,
      c.join('')
    };
    'undefined' != typeof module && module.exports ? (module.exports = t, JSON.minify = t) : (void 0 !== e.JSON && e.JSON || (e.JSON = {
    }), e.JSON.minify = t)
  }(this),
  define('lib/jsonminify', function () {
  }),
  define('app/core/ext/xdk-base/loader/json', [
    'xdk-base/util',
    'xdk-base/QueryString',
    'lib/jsonminify'
  ], function (e, t) {
    'use strict';
    function i() {
      return new XMLHttpRequest
    }
    function n(e) {
      return readFile(e)
    }
    function s(t) {
      return e.parse(JSON.minify(t))
    }
    function r(e) {
      return 0 === e.indexOf('empty:') || p.test(e)
    }
    function o(e, t, i, n) {
      if (n = n || {
      }, n.failover) return void e({
      });
      t(i)
    }
    function a(e, t, i, n) {
      try {
        t(s(e))
      } catch (e) {
        o(t, i, e, n)
      }
    }
    function d(e, t) {
      return p.test(e) ? e : t.toUrl(e)
    }
    function c(t) {
      var i,
      n = t.split(g);
      return 1 === n.length ? {
        id: t,
        failover: !1,
        waitSeconds: m
      }
       : (i = l(n[0]), e.extend({
        id: n[1]
      }, i))
    }
    function l(e) {
      var i = t.parse(e);
      return i.failover = 'true' === i.failover,
      i.waitSeconds = parseInt(i.waitSeconds, 10),
      isNaN(i.waitSeconds) && (i.waitSeconds = m),
      i
    }
    function u(e, t, n, s) {
      var r = i();
      r.onload = r.onreadystatechange = function () {
        if (4 === r.readyState) {
          r.onload = r.onreadystatechange = null;
          var e = r.status;
          0 === e || e >= 200 && e < 300 || 304 === e ? a(r.responseText, t, n, s) : o(t, n, r, s)
        }
      },
      r.timeout = 1000 * (s.waitSeconds || m),
      r.ontimeout = function () {
        o(t, n, 'Loading ' + e + ' timeout.', s)
      },
      r.open('GET', e),
      r.send()
    }
    function h(e, t, i, s) {
      var o = c(e),
      a = d(o.id, t);
      if (r(e) || r(a)) return void i();
      E = s,
      b[e] = n(a),
      i(b)
    }
    function _(t, i, n, s) {
      var r = s && e.isFunction(s.onFailure) ? s.onFailure : v,
      o = c(t);
      u(d(o.id, i), n, r, o)
    }
    var f = {
      dynamic: !1
    },
    p = /^(\/\/)|([^:]+:\/\/)/,
    g = '|',
    v = function () {
    },
    m = 8,
    E = {
    },
    b = {
    };
    return f.normalize = function (e, t) {
      var i = e.split(g);
      return 1 === i.length ? t(e) : i[0] + g + t(i[1])
    },
    f.load = function (e, t, i, n) {
      n.isBuild ? h(e, t, i, n) : _(e, t, i, n)
    },
    f.write = function (e, t, i) {
      if (!r(t) && b[t]) {
        var n,
        s = e + '!' + t,
        o = E.namespace ? E.namespace + '.' : '';
        n = 'define(\'%MODULE_ID%\',%MODULE_CONTENT%)'.replace('%MODULE_ID%', s).replace('%MODULE_CONTENT%', b[t]),
        i.asModule(s, o + n)
      }
    },
    f
  }),
  define('app/core/ext/xdk-base/loader/json!failover=true|xdk.config.json', {
    appName: 'Mediaworks-3now',
    version: '1.3.4',
    buildNumber: 29,
    ovpEndpointURL: 'http://tveovp-accedops.rhcloud.com/',
    '_device.target-platform': 'xdk-ext-device-sagemcom',
    'device.packages': [
      'xdk-ext-device-sagemcom',
      'xdk-base/device/workstation'
    ],
    'device.players': {
      workstation: [
        'xdk-ext-device-windows/Html5Player'
      ],
      sagemcom: [
        'xdk-ext-device-sagemcom/NativePlayer'
      ]
    },
    __COMMENT__: 'You can change below value of app.config to LOCAL or APPGRID',
    'app.config': 'LOCAL',
    local: {
      landingPageEntryId: 'HOME',
      mainMenuEntryId: 'DEFAULT_MENU',
      ovpEndpointURL: 'http://tveovp-accedops.rhcloud.com/'
    },
    facebook: {
      loginUrl: 'https://graph.facebook.com/v2.6/device/login',
      statusUrl: 'https://graph.facebook.com/v2.6/device/login_status',
      profile: 'https://graph.facebook.com/me',
      appId: '509250819155825',
      token: '860caebc7b46f9ccb3d8638cce50c4a4'
    },
    gigya: {
      baseUrl: 'https://accounts.au1.gigya.com/',
      socialBaseUrl: 'https://socialize.au1.gigya.com/',
      login: 'accounts.login',
      logout: 'accounts.logout',
      resetPassword: 'accounts.resetPassword',
      getAccountInfo: 'accounts.getAccountInfo',
      socialLogin: 'socialize.notifyLogin',
      secret: 'xJFG2uopY/yAoI/JWsv3N2QbYls5TzdwziBM2HZwYDY=',
      apiKey: '3_VkkjwG21lv2-GrMj1BPrHVNkBY3QHmPyvzq286GWnVQAh_lxMDil4mrCYamXFpGD'
    },
    approuter: {
      base: 'app/ctrl'
    },
    deviceType: {
      sagemStb: 'vodafonetv',
      smarttv: 'smarttv'
    },
    remote: {
      brightcove: 'http://media-api.tv3.co.nz/brightcove/',
      segment: 'https://api.segment.io/v1/',
      mediaworks: 'https://now-api4-prod.fullscreen.nz/v4/'
    },
    useVikiMap: !0,
    'device.workstation.resize': !0,
    'mouse.keep-focus': !1,
    environment: 'prod',
    segment: {
      apiKey: 'X01o3XKu2T85jtMNyI1Mmap3va4WY2Sh'
    }
  }),
  define('xdk-base/config', [
    'app/core/ext/xdk-base/loader/json!failover=true|xdk.config.json'
  ], function (e) {
    'use strict';
    var t = e;
    return {
      get: function (e, i) {
        return void 0 === e || null === e ? t : t.hasOwnProperty(e) ? t[e] : i
      },
      set: function (e, i) {
        return null === e || void 0 === e ? 0 : void 0 === i ? (delete t[e], 1) : (t[e] = i, 1)
      }
    }
  }),
  define('xdk-base/logger/loggerBase', [
    'xdk-base/config'
  ], function (e) {
    'use strict';
    return {
      LV_DEBUG: 0,
      LV_INFO: 1,
      LV_LOG: 2,
      LV_WARNING: 3,
      LV_ERROR: 4,
      level: e.get('console.lv', 2),
      log: function () {
        if (!(this.level > this.LV_LOG)) {
          var e = Array.prototype.slice.call(arguments);
          this._log(e.join(' '))
        }
      },
      debug: function () {
        if (!(this.level > this.LV_DEBUG)) {
          var e = Array.prototype.slice.call(arguments);
          this._log('[DEBUG]: ' + e.join(' '))
        }
      },
      info: function () {
        if (!(this.level > this.LV_INFO)) {
          var e = Array.prototype.slice.call(arguments);
          this._log('[INFO]: ' + e.join(' '))
        }
      },
      warn: function () {
        if (!(this.level > this.LV_WARNING)) {
          var e = Array.prototype.slice.call(arguments);
          this._log('[WARN]: ' + e.join(' '))
        }
      },
      error: function () {
        if (!(this.level > this.LV_ERROR)) {
          var e = Array.prototype.slice.call(arguments);
          this._log('[ERROR]: ' + e.join(' '))
        }
      },
      _log: null
    }
  }),
  define('xdk-base/logger/nativeLogger', [
    'xdk-base/logger/loggerBase',
    'xdk-base/core'
  ], function (e, t) {
    'use strict';
    var i = function () {
    },
    n = t.root;
    return (n.navigator && n.navigator.userAgent).toLowerCase().indexOf('maple') > - 1 ? (e._log = function () {
      var e = Array.prototype.slice.call(arguments),
      t = e.join(', ');
      alert && alert(t)
    }, e) : n.console ? n.console : {
      log: i,
      error: i,
      debug: i,
      info: i,
      warn: i
    }
  }),
  define('xdk-base/logger/onScreenLogger', [
    'xdk-base/config',
    'xdk-base/logger/loggerBase',
    'require'
  ], function (e, t, i) {
    'use strict';
    var n,
    s,
    r,
    o = !1;
    s = {
      messages: [
      ],
      messageEle: null,
      maxLine: e.get('onscreenlogger.maxline', 14),
      bgColor: e.get('onscreenlogger.bgcolor', 'green'),
      triggerKey: e.get('onscreenlogger.key', 'KEY_1'),
      dimension: e.get('onscreenlogger.dimension', {
        top: 480,
        left: 0,
        width: 1280,
        height: 240
      }),
      __init: function () {
        o || (o = !0, n = document.createElement('div'), n.setAttribute('id', 'logArea'), n.style.position = 'absolute', n.style.left = this.dimension.left + 'px', n.style.top = this.dimension.top + 'px', n.style.width = this.dimension.width + 'px', n.style.height = this.dimension.height + 'px', n.style.backgroundColor = this.bgColor, n.style.zIndex = '99', n.style.opacity = '0.5', n.style.overflow = 'hidden', this.messageEle = document.createElement('pre'), this.messageEle.style.margin = '0 0 0 10px', n.appendChild(this.messageEle), domReady(function () {
          document.body.appendChild(n)
        }), this.show(), this.__setKey())
      },
      __setKey: function () {
        try {
          var e = i('xdk-base/Env').singleton(),
          t = i('xdk-base/device/vKey');
          e && e.addEventListener(e.EVT_ONKEY, function (e) {
            switch (e.id) {
              case t[s.triggerKey].id:
                'none' === n.style.display ? s.show() : s.hide()
            }
            return !1
          })
        } catch (e) {
          setTimeout(this.__setKey, 500)
        }
      },
      _log: function (e) {
        this.__init(),
        this.messages.unshift(e),
        this.messages.length > this.maxLine && this.messages.pop(),
        this.messageEle.innerHTML = this.messages.join('\n')
      },
      hide: function () {
        n.style.display = 'none'
      },
      show: function () {
        n.style.display = 'block'
      },
      clear: function () {
        this.messages.length = 0,
        this.messageEle.innerHTML = ''
      }
    };
    for (r in t) s[r] || (s[r] = t[r]);
    return s
  }),
  define('xdk-base/logger/remoteLogger', [
    'xdk-base/config',
    'xdk-base/logger/loggerBase'
  ], function (e, t) {
    'use strict';
    var i,
    n,
    s,
    r = [
    ];
    s = function (e, t) {
      var i = new XMLHttpRequest;
      i.open('post', e, t.async),
      i.send(t.parameters)
    },
    i = {
      url: e.get('remotelogger.url', ''),
      logInterval: e.get('remotelogger.logInterval', 10),
      async: e.get('remotelogger.async', !1),
      logFilePath: e.get('remotelogger.logFilePath', 'xdkLog.txt'),
      _timeInterval: null,
      __sendLog: function () {
        if (i.url && !(r.length < 1)) {
          var e,
          t = {
            msg: r,
            logPath: i.logFilePath
          };
          e = JSON && JSON.stringify ? JSON.stringify(t) : i.__stringify(t),
          s(i.url, {
            parameters: e,
            async: i.async
          }),
          r = r.slice(r.length)
        }
      },
      __stringify: function (e) {
        var t,
        n,
        s,
        r = [
        ],
        o = 0;
        if (null === e) return 'null';
        if (e.toJSON && 'function' == typeof e.toJSON) return e.toJSON();
        if ('boolean' == typeof e || 'number' == typeof e) return e.toString();
        if ('string' == typeof e) return '"' + e.replace(/"/g, '\\"') + '"';
        if ('[object Array]' === Object.prototype.toString.call(e)) {
          for (t = e.length; o < t; o++) n = i.__stringify(e[o]),
          void 0 !== e && r.push(n);
          return '[' + r.join(',') + ']'
        }
        if (e) {
          for (s in e) n = i.__stringify(e[s]),
          void 0 !== e && r.push('"' + s.toString() + '":' + n);
          return '{' + r.join(',') + '}'
        }
        return !1
      },
      _log: function (e) {
        r.length >= 500 && (r = r.slice(1)),
        r.push(e),
        this._timeInterval || (this._timeInterval = setInterval(this.__sendLog, 1000 * this.logInterval))
      }
    };
    for (n in t) i[n] || (i[n] = t[n]);
    return i
  }),
  define('xdk-base/console', [
    'xdk-base/config',
    'xdk-base/logger/nativeLogger',
    'xdk-base/logger/onScreenLogger',
    'xdk-base/logger/remoteLogger',
    'require'
  ], function (e, t, i, n) {
    'use strict';
    var s,
    r;
    return r = function (e) {
      if (e) try {
        return e = require(e),
        void (s = e)
      } catch (e) {
        s = t
      }
      s = t
    },
    r(e.get('console.logger', null)),
    s
  }),
  define('xdk-base/EventDispatcher', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/console',
    'xdk-base/core'
  ], function (e, t, i, n) {
    'use strict';
    return e.create({
    }, {
      __eventCallbacks: {
      },
      __getEventHandlers: function (e) {
        var i = this.__eventCallbacks[e];
        return i || t.isArray(i) || (i = [
        ]),
        i
      },
      dispatchEvent: function (e, s, r) {
        if (!e) throw n.createException('IncorrectParam', 'Failed to dispatch event due to no event type!');
        if (this.onDispatchEvent && !this.onDispatchEvent(e, s)) return i.log('Event blocked for type=' + e + ' data=' + s),
        !1;
        var o,
        a,
        d,
        c = [
        ],
        l = this.__getEventHandlers(e),
        u = !0;
        for (t.isUndefined(s) && (s = {
        }), a = 0; a < l.length; a++) {
          if (o = l[a], t.isFunction(o.handler)) if (!0 === r) try {
            d = o.handler.call(this, s)
          } catch (e) {
            i.error(e.name + ':' + e.message),
            e.stack && i.error(e.stack)
          } else d = o.handler.call(this, s);
          o.once && c.push(o),
          !1 === d && (u = !1)
        }
        for (a = 0; a < c.length; a++) this.removeEventListener(e, c[a].handler);
        return u
      },
      addEventListener: function (e, i, s) {
        if (!e || !i) throw n.createException('IncorrectParam', 'Failed to add event listener due to no event type or listener!');
        s || (s = !1);
        var r,
        o,
        a = this.__eventCallbacks[e];
        for (a && t.isArray(a) || (a = [
        ], this.__eventCallbacks[e] = a), o = {
          handler: i,
          once: s
        }, r = 0; r < a.length; r++) if (a[r].handler === i) return this;
        return a.push(o),
        this
      },
      removeEventListener: function (e, t) {
        var i,
        n = this.__eventCallbacks[e];
        if (!n) return this;
        if (!n.length) return delete this.__eventCallbacks[e],
        this;
        if (!t) {
          for (i in n) this.removeEventListener(e, n[i].handler);
          return delete this.__eventCallbacks[e],
          this
        }
        for (i = 0; i < n.length && n[i].handler !== t; i++);
        return i < n.length && n.splice(i, 1),
        this
      },
      removeAllListeners: function () {
        var e;
        for (e in this.__eventCallbacks) this.removeEventListener(e);
        return this
      },
      deinit: function () {
        this.removeAllListeners()
      }
    })
  }),
  define('xdk-ax/mediator', [
    'xdk-base/EventDispatcher',
    'xdk-base/util'
  ], function (e, t) {
    'use strict';
    var i = new e;
    return {
      publish: function (e, t) {
        i.dispatchEvent.apply(i, [
          e,
          t,
          !0
        ])
      },
      subscribe: t.bind(i.addEventListener, i),
      unsubscribe: t.bind(i.removeEventListener, i)
    }
  }),
  define('vdk/errors/LocalErrorConfig', {
    FACILITY: {
      CONFIGURATION_SERVICE: 11,
      USER_SETTINGS_SERVICE: 12,
      ANALYTICS_SERVICE: 13,
      STATUS_SERVICE: 14,
      RESOURCE_SERVICE: 15,
      LOG_SERVICE: 16,
      CONTENT_SERVICE: 17,
      PLAYBACK_SERVICE: 22,
      AUTHENTICATION_SERVICE: 43,
      USER_MANAGER: 52,
      GENERAL: 90
    },
    ERROR: {
      NOT_FOUND: 1,
      NETWORK: 2,
      INTERNAL: 3,
      UNAUTHORIZED: 4,
      INVALID: 5,
      STORAGE: 6,
      EMPTY_COLLECTION: 7,
      SERVICE_UNAVAILABLE: 8,
      UNKNOWN: 911
    }
  }),
  define('vdk/errors/VIAError', [
    'xdk-ax/mediator',
    'xdk-base/class',
    'xdk-base/config',
    'vdk/errors/LocalErrorConfig'
  ], function (e, t, i, n) {
    return t.create(Error, {
      Event: {
        ErrorOccurred: 'VIAErrorEvent:ErrorOccurred'
      },
      FACILITY: {
        CONFIGURATION_SERVICE: 'CONFIGURATION_SERVICE',
        USER_SETTINGS_SERVICE: 'USER_SETTINGS_SERVICE',
        ANALYTICS_SERVICE: 'ANALYTICS_SERVICE',
        STATUS_SERVICE: 'STATUS_SERVICE',
        RESOURCE_SERVICE: 'RESOURCE_SERVICE',
        LOG_SERVICE: 'LOG_SERVICE',
        CONTENT_SERVICE: 'CONTENT_SERVICE',
        PLAYBACK_SERVICE: 'PLAYBACK_SERVICE',
        AUTHENTICATION_SERVICE: 'AUTHENTICATION_SERVICE',
        USER_MANAGER: 'USER_MANAGER',
        GENERAL: 'GENERAL'
      },
      ERROR: {
        NOT_FOUND: 'NOT_FOUND',
        NETWORK: 'NETWORK',
        INTERNAL: 'INTERNAL',
        UNAUTHORIZED: 'UNAUTHORIZED',
        INVALID: 'INVALID',
        STORAGE: 'STORAGE',
        EMPTY_COLLECTION: 'EMPTY_COLLECTION',
        SERVICE_UNAVAILABLE: 'SERVICE_UNAVAILABLE',
        UNKNOWN: 'UNKNOWN'
      }
    }, {
      init: function (t, s, r, o) {
        var a = i.get('via.error') || n;
        this.__facility = a.FACILITY[t],
        this.__errorCode = a.ERROR[s],
        this.__cause = o || null,
        this.__code = 1000 * this.__facility + this.__errorCode,
        this.message = r,
        this.name = this.__code.toString(),
        e.publish(this.constructor.Event.ErrorOccurred, this)
      },
      getFacility: function () {
        return this.__facility
      },
      getErrorCode: function () {
        return this.__errorCode
      },
      getCode: function () {
        return this.__code
      },
      getMessage: function () {
        return this.message
      },
      getCause: function () {
        return this.__cause
      }
    })
  }),
  define('xdk-base/Thennable', [
    'require',
    'xdk-base/util'
  ], function (e, t) {
    'use strict';
    function i(e, t) {
      this.pending = !0,
      this.obj = e,
      this.then = t
    }
    var n = function () {
      return e('./promise')
    };
    return i.prototype.reject = function (e) {
      this.pending && (this.pending = !1, this.rejecter(e))
    },
    i.prototype.fulfil = function (e) {
      if (this.pending) {
        if (this.pending = !1, n().isPromise(e)) return void e.then(this.resolver, this.rejecter);
        try {
          i.handle(e, this.resolver, this.rejecter) || this.resolver(e)
        } catch (e) {
          this.rejecter(e)
        }
      }
    },
    i.prototype.run = function (e, i) {
      var n = this.obj,
      s = this.then;
      this.resolver = e,
      this.rejecter = i;
      try {
        s.call(n, t.bind(this.fulfil, this), t.bind(this.reject, this))
      } catch (e) {
        this.reject(e)
      }
    },
    i.handle = function (e, s, r) {
      if (!e) return !1;
      if (n().isPromise(e)) return !1;
      if (!t.isFunction(e) && !t.isPlainObject(e)) return !1;
      var o = e.then;
      return !!t.isFunction(o) && (new i(e, o).run(s, r), !0)
    },
    i
  }),
  define('xdk-base/promise', [
    'xdk-base/core',
    'require',
    'exports',
    './Thennable',
    'xdk-base/util',
    'xdk-base/exception',
    'xdk-base/console'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    function a() {
      L.off.call(this, I.FULFILLED),
      L.off.call(this, I.REJECTED),
      L.off.call(this, I.PROGRESSED),
      L.off.call(this, I.CANCELLED),
      this._onCancel = null
    }
    function d(t, i) {
      function n(e) {
        this.isPending() && (this._status.state = w.FULFILLED, this._status.value = e, A(s.bind(function () {
          L.fire.call(this, I.FULFILLED, e),
          a.call(this)
        }, this)))
      }
      function d(e) {
        this.isPending() && (this._status.state = w.REJECTED, this._status.reason = e, A(s.bind(function () {
          L.fire.call(this, I.REJECTED, e),
          a.call(this)
        }, this)))
      }
      function c(e) {
        this.isPending() && A(s.bind(function () {
          L.fire.call(this, I.PROGRESSED, e)
        }, this))
      }
      if (!s.isFunction(t)) throw e.createException(r.ILLEGAL_ARGUMENT, 'task is not a Function');
      this._id = e.getGuid(),
      this._status = {
        state: w.PENDING
      },
      this._activeThens = [
      ],
      L.init.apply(this);
      var l = s.bind(n, this),
      u = s.bind(d, this),
      h = s.bind(c, this);
      try {
        t.call(this, l, u, h)
      } catch (e) {
        o.error(e),
        u(e)
      }
      s.isFunction(i) && (this._onCancel = s.bind(i, this))
    }
    function c(e, t) {
      if (this.isPending()) {
        if (t) {
          var i = this._activeThens.indexOf(t);
          if (i > - 1 && this._activeThens.splice(i, 1), L.off.call(this, I.FULFILLED, t), L.off.call(this, I.REJECTED, t), L.off.call(this, I.PROGRESSED, t), this._activeThens.length > 0) return
        }
        this._status.state = w.CANCELLED,
        this._onCancel(e),
        L.fire.call(this, I.CANCELLED),
        a.call(this)
      }
    }
    function l(e) {
      return _(e) && e.isPending()
    }
    function u(e) {
      return !_(e) || e.isFulfilled()
    }
    function h(e) {
      return _(e) && e.isRejected()
    }
    function _(e) {
      return e instanceof d
    }
    function f(e) {
      return new d(function (t, i) {
        t(e)
      })
    }
    function p(e) {
      return new d(function (t, i) {
        i(e)
      })
    }
    function g(e) {
      return _(e) ? e : f(e)
    }
    function v() {
      var e = {
      };
      return e.promise = new d(function (t, i, n) {
        e.fulfill = t,
        e.resolve = t,
        e.reject = i,
        e.notify = n
      }, function (t) {
        var i = e.onCancel;
        s.isFunction(i) && i(t),
        e.onCancel = null
      }),
      e
    }
    function m(e, t) {
      return b(e, void 0, t)
    }
    function E(e, t) {
      return b(e, void 0, void 0, t)
    }
    function b(e, t, i, n, s) {
      return g(e).then(t, i, n, s)
    }
    function y(e, t) {
      return b(e, function (e) {
        return b(t(), function () {
          return e
        })
      }, function (e) {
        return b(t(), function () {
          return p(e)
        })
      }, null, function () {
        t()
      })
    }
    function k(e, t, n, s, r) {
      var a,
      d;
      d = function (e) {
        A(function () {
          if (i.onerror) i.onerror(e);
           else {
            if (e instanceof Error) throw e;
            o.warn(e)
          }
        })
      },
      a = t || n || s || r ? b(e, t, n, s, r) : e,
      m(a, d)
    }
    function S(e) {
      return function () {
        function t(t, i) {
          var n = t.then(function (n) {
            e[i] = n,
            delete l[t.getId()],
            0 == --c && (r(e), s.clear(l))
          }, function (e) {
            o(e),
            s.clear(l)
          }, function (e) {
            a({
              index: i,
              value: e
            })
          });
          l[t.getId()] = n.getId()
        }
        function i(i, n, d) {
          r = i,
          o = n,
          a = d,
          s.each(e, function (i, n) {
            if (_(i)) {
              if (h(i) && o(i.inspect().reason), u(i)) return void (e[n] = i.inspect().value);
              ++c,
              t(i, n)
            }
          }),
          0 === c && r(e)
        }
        function n(t) {
          s.each(e, function (e, i) {
            _(e) && e.isPending() && (e.cancel(t, l[e.getId()]), delete l[e.getId()])
          })
        }
        var r,
        o,
        a,
        c = 0,
        l = {
        };
        return new d(i, n)
      }()
    }
    function x(e) {
      return S(s.map(e, function (e) {
        function t() {
          return e.inspect()
        }
        return _(e) || (e = g(e)),
        e.then(t, t)
      }))
    }
    function T(e) {
      var t = v(),
      i = [
      ];
      return b(e, function (e) {
        s.each(e, function (e, n) {
          _(e) || (e = g(e));
          var s = b(e, t.resolve, t.reject);
          i.push(s)
        })
      }),
      t.onCancel = function (e) {
        s.each(i, function (t, i) {
          t.cancel(e)
        })
      },
      t.promise
    }
    function C(e, t, i) {
      return b(e, function (e) {
        return S(e).then(function (e) {
          return t.apply(void 0, e)
        }, i)
      }, i)
    }
    var A;
    i.nextTick = function () {
      var e = {
        task: void 0,
        next: null
      },
      t = e,
      i = !1;
      return A = function (n) {
        t.next = {
          task: n,
          next: null
        },
        t = t.next,
        i || (i = !0, setTimeout(function () {
          for (; e.next; ) {
            e = e.next;
            try {
              e.task(),
              e.task = void 0
            } catch (e) {
              throw o.error(e),
              e
            }
          }
          e = void 0,
          e = {
            task: void 0,
            next: null
          },
          t = void 0,
          t = e,
          i = !1
        }, 0))
      }
    }();
    var w = {
      PENDING: 'pending',
      FULFILLED: 'fulfilled',
      REJECTED: 'rejected',
      CANCELLED: 'cancelled'
    },
    I = {
      PROGRESSED: 'progressed',
      FULFILLED: 'fulfilled',
      REJECTED: 'rejected',
      CANCELLED: 'cancelled'
    },
    L = {
      init: function () {
        this._listeners = {
        }
      },
      on: function (e, t, i) {
        this._listeners[e] = this._listeners[e] || {
        },
        this._listeners[e][t] = this._listeners[e][t] || [
        ],
        this._listeners[e][t].push(i)
      },
      off: function (e, t) {
        if (t && this._listeners[e]) return void delete this._listeners[e][t];
        delete this._listeners[e]
      },
      fire: function (e, t) {
        var i = this._listeners[e];
        i && s.each(i, function (e) {
          for (var i = e.value, n = 0; n < i.length; n++) i[n](t)
        })
      }
    };
    d.prototype.getId = function () {
      return this._id
    },
    d.prototype.then = function (e, t, i, r) {
      var a = function (a) {
        function c(r, d, c) {
          function l(e, t, i) {
            if (!s.isFunction(e)) return void t(i);
            try {
              var c = e(i);
              if (c === this) return void d(new TypeError('promise\'s handler cannot return itself (same promise instance)'));
              if (_(c)) return void (a = c.then(r, d));
              n.handle(c, r, d) || r(c)
            } catch (e) {
              o.error(e),
              d(e)
            }
          }
          function u(e) {
            if (!s.isFunction(i)) return void c(e);
            try {
              var t = i(e);
              c(t)
            } catch (e) {
              o.error(e),
              d(e)
            }
          }
          return a.isPending() ? (L.on.call(a, I.FULFILLED, this.getId(), s.bind(l, this, e, r)), L.on.call(a, I.REJECTED, this.getId(), s.bind(l, this, t, d)), void L.on.call(a, I.PROGRESSED, this.getId(), u)) : a.isFulfilled() ? void A(s.bind(l, this, e, r, a.inspect().value)) : a.isRejected() ? void A(s.bind(l, this, t, d, a.inspect().reason)) : void 0
        }
        function l(e) {
          a.cancel(e, this.getId())
        }
        function u() {
          h.cancel(),
          s.isFunction(r) && A(r)
        }
        var h = new d(c, l);
        return a.isPending() && L.on.call(a, I.CANCELLED, h.getId(), u),
        h
      }(this);
      return this._activeThens.push(a.getId()),
      a
    },
    d.prototype.inspect = function () {
      return this._status
    },
    d.prototype.isPending = function () {
      return this._status.state === w.PENDING
    },
    d.prototype.isFulfilled = function () {
      return this._status.state === w.FULFILLED
    },
    d.prototype.isRejected = function () {
      return this._status.state === w.REJECTED
    },
    d.prototype.isCancelled = function () {
      return this._status.state === w.CANCELLED
    },
    d.prototype.cancel = c,
    i.Promise = d,
    i.promise = function (e) {
      return new d(e)
    },
    i.isPending = l,
    i.isFulfilled = u,
    i.isRejected = h,
    i.isPromise = _,
    i.fulfill = f,
    i.reject = p,
    i.resolve = g,
    i.defer = v,
    i.fail = m,
    d.prototype.fail = function (e) {
      return m(this, e)
    },
    i.progress = E,
    d.prototype.progress = function (e) {
      return E(this, e)
    },
    i.when = b,
    d.prototype.complete = function (e) {
      return y(this, e)
    },
    i.complete = y,
    i.done = k,
    d.prototype.done = function (e, t, i, n) {
      return k(this, e, t, i, n)
    },
    i.all = S,
    i.allSettled = x,
    i.race = T,
    d.prototype.spread = function (e, t) {
      return C(this, e, t)
    },
    i.spread = C
  }),
  define('xdk-base/ajax', [
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/promise',
    'xdk-base/console',
    'xdk-base/config'
  ], function (e, t, i, n, s) {
    function r(e) {
      var t = navigator.userAgent.toLowerCase();
      return ( - 1 === t.indexOf('maple 5.1') || 'delete' !== e) && (!(t.indexOf('aquosbrowser') > - 1 || t.indexOf('ipad;') > - 1) || 'delete' !== e && 'put' !== e)
    }
    function o(e) {
      return !s.get('ajax-method-override', !0) || !!~['get',
      'post',
      'delete',
      'put'].indexOf(e)
    }
    function a(t, i) {
      if (t && i) {
        if (p[t]) throw e.createException('Repeated id for deferred creation');
        return p[t] = i,
        p[t]
      }
    }
    function d(e) {
      return p[e]
    }
    function c(e) {
      p[e] = void 0
    }
    function l() {
      try {
        return new XMLHttpRequest
      } catch (e) {
      }
    }
    function u() {
      try {
        return new ActiveXObject('Msxml2.XMLHTTP')
      } catch (e) {
      }
    }
    function h() {
      try {
        return new ActiveXObject('Microsoft.XMLHTTP')
      } catch (e) {
      }
    }
    function _() {
      return l() || u() || h() || !1
    }
    function f(s, d) {
      function l() {
        var e = this.readyState;
        e > 1 && (4 !== e || !x) && u.apply(this)
      }
      function u() {
        var e,
        i,
        s,
        r,
        o = this.readyState;
        try {
          if (4 === o && !T) {
            if (E && (clearTimeout(E), E = null), x = !0, e = this.status, !0, i = this.responseText, (s = this.getResponseHeader('content-type')) && s.toLowerCase().indexOf('json') > - 1) try {
              this.responseJSON = t.parse(i)
            } catch (e) {
              n.info('Unable to parse JSON')
            }
            g && (r = {
            }, r.response = this.response || '', r.responseText = this.responseText || '', r.responseType = this.responseType || '', r.responseJSON = this.responseJSON || '', r.responseXML = this.responseXML || '', r.readyState = this.readyState || null, r.status = this.status, r.statusText = this.statusText || '', function (e) {
              r.getAllResponseHeaders = function () {
                return e
              };
              var i;
              r.getResponseHeader = function (n) {
                return n ? (i || (i = {
                }, e && t.each(e.split('\n'), function (e) {
                  var t = e.indexOf(':');
                  if (!(t < 0)) {
                    var n = e.substr(0, t).toLowerCase();
                    i[n] = e.substr(t + 1)
                  }
                })), n = n.toLowerCase(), n in i ? i[n] : null) : null
              }
            }(this.getAllResponseHeaders())),
            e >= 200 && e < 300 || 304 === e ? m.resolve(r || this) : (!1, m.reject({
              transport: r || this,
              type: 'failure'
            })),
            h()
          }
        } catch (e) {
          m.reject({
            transport: r || this,
            ex: e,
            type: 'exception'
          }),
          h(),
          n.error(e)
        }
      }
      function h() {
        b && b.id && c(b.id),
        S && (S.destroy && S.destroy(), S.onreadystatechange = null, S = null, delete S)
      }
      function f() {
        n.info('abort the transport'),
        T = !0;
        try {
          S.abort()
        } catch (e) {
          T = null
        }
        E && (clearTimeout(E), E = null),
        h()
      }
      function p() {
        n.info('abort the transport'),
        f(),
        m.reject({
          transport: S,
          type: 'abort'
        })
      }
      function v() {
        var s,
        o;
        m = i.defer();
        try {
          S.open(b.method.toUpperCase(), C, b.async),
          S.onreadystatechange = l,
          !1,
          s = b.requestHeaders || {
          };
          for (o in s) n.info(o + ' - ' + s[o]),
          S.setRequestHeader(o, s[o]);
          if (b.withCredentials) {
            var a = function () {
              return f(),
              n.warn('withCredentials is not supported in this browser'),
              i.reject({
                transport: S,
                ex: e.createException('withCredentials is not supported in this browser'),
                type: 'exception'
              })
            };
            if (!('withCredentials' in S)) return a();
            try {
              S.withCredentials = !0
            } catch (e) {
              return a()
            }
          }
          if (k = null, t.isUndefined(b.postBody) ? t.isUndefined(y) || (k = y) : k = b.postBody, !r(b.method)) return f(),
          n.info('unsupport method in this device' + b.method),
          i.reject({
            transport: S,
            ex: e.createException('unsupport method in this device'),
            type: 'exception'
          });
          E = setTimeout(function () {
            f(),
            m.reject({
              transport: S,
              type: 'timeout'
            }),
            h(),
            E = null
          }, 1000 * b.timeOut),
          k ? S.send(k) : S.send()
        } catch (e) {
          m.reject({
            transport: S,
            ex: e,
            type: 'exception'
          }),
          n.error(e.stack)
        }
        return m.promise
      }
      d = d || {
      };
      var m,
      E,
      b,
      y,
      k,
      S = null,
      x = !1,
      T = !1,
      C = s;
      d.timeOut = t.isNumber(d.timeOut) ? d.timeOut : 30,
      t.isFunction(d.toObject) && (d = d.toObject()),
      b = {
        method: 'get',
        async: !0,
        checkContentType: !1,
        parameters: ''
      },
      t.extend(b, d),
      b.method = b.method.toLowerCase(),
      S = _(),
      b.id && a(b.id, this),
      y = t.isString(b.parameters) ? b.parameters : t.toQueryString(b.parameters),
      o(b.method) || (y += (y ? '&' : '') + '_method=' + b.method, b.method = 'post'),
      y && 'get' === b.method && t.isString(y) && y.length > 0 && (C += (C.indexOf('?') > 0 ? '&' : '?') + y),
      this.abort = p,
      this.send = v
    }
    var p = {
    },
    g = function () {
      return - 1 !== navigator.userAgent.toLowerCase().indexOf('maple') || 'undefined' != typeof tizen
    }();
    return {
      request: function (e, t) {
        return new f(e, t).send()
      },
      abort: function (e) {
        var t = d(e);
        t && t.abort()
      }
    }
  }),
  define('xdk-base/MemCache', [
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/promise',
    'xdk-base/console',
    'xdk-base/util'
  ], function (e, t, i, n, s) {
    'use strict';
    var r = e.create({
      GC: {
        EXPIRY: 0,
        EXCEED_LIMIT: 1
      },
      TTL: {
        NO_CACHE: - 2,
        FOREVER: - 1,
        DEFAULT: 0
      }
    }, {
      __ttl: null,
      __size: null,
      __cache: null,
      __gc: null,
      __gcInterval: null,
      __gcIntervalTime: null,
      init: function (e) {
        e = e || {
        },
        this.__ttl = e.ttl || 300,
        this.__size = e.size || 100,
        this.__gc = e.gc || this.constructor.GC.EXPIRY,
        this.__gcIntervalTime = e.gcIntervalTime || 5000,
        this.__cacheReference = [
        ],
        this.__cache = {
        },
        this.__gc === r.GC.EXPIRY && (this.__gcInterval = setInterval(s.bind(this.__garbageCollector, this), this.__gcIntervalTime))
      },
      __garbageCollector: function () {
        var e = this.__cacheReference;
        s.each(e, s.bind(function (t, i) {
          this.isExpired(t) && (delete this.__cache[t], s.remove(e, i))
        }, this))
      },
      set: function (e, t, i) {
        if (!i || i !== r.TTL.NO_CACHE) {
          var n = this.__cacheReference,
          o = s.size(n),
          a = s.indexOf(n, e),
          d = i || this.__ttl,
          c = (new Date).getTime();
          a > - 1 ? s.remove(n, a) : o && o === this.__size && (delete this.__cache[n[0]], s.remove(n, 0)),
          n.push(e),
          this.__cache[e] = {
            data: t,
            timestamp: c,
            expiration: d === r.TTL.FOREVER ? r.TTL.FOREVER : c + 1000 * d
          },
          i && (this.__cache[e].ttl = i)
        }
      },
      renewTimestamp: function (e) {
        var t,
        i,
        n = this.__cache[e];
        n && (i = n.ttl || this.__ttl, t = (new Date).getTime(), n.timestamp = t, i !== r.TTL.FOREVER && (n.expiration = t + 1000 * i))
      },
      isExpired: function (e) {
        var t = this.__cache[e];
        return !t || t.expiration !== r.TTL.FOREVER && (new Date).getTime() > t.expiration
      },
      get: function (e) {
        var t = this.__cache[e];
        if (t && (this.__gc !== r.GC.EXPIRY || !this.isExpired(e))) return t.data
      },
      getTimestamp: function (e) {
        var t = this.__cache[e];
        if (t && (this.__gc !== r.GC.EXPIRY || !this.isExpired(e))) return t.timestamp
      },
      getCacheSize: function () {
        return s.size(this.__cacheReference)
      },
      deinit: function () {
        this.__gc === this.constructor.GC.EXPIRY && this.__gcInterval && clearInterval(this.__gcInterval)
      }
    });
    return r
  }),
  define('app/service/RemoteService', [
    'vdk/errors/VIAError',
    'xdk-base/ajax',
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/MemCache',
    'xdk-base/promise',
    'xdk-base/util'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a,
    d;
    return d = i.create([], {
      singleton: function () {
        return a || (a = new d),
        a
      }
    }, {
      init: function () {
        var t = n.get('remote');
        if (!t || !t.api) throw new e(e.FACILITY.CONFIGURATION_SERVICE, e.ERROR.INVALID, 'Cannot init the remote service without config api.');
        this.__baseURL = t.api,
        this.__memCache = new s({
          ttl: 18000,
          gc: s.GC.EXCEED_LIMIT
        })
      },
      getAllConfigs: function () {
        var e = this.__memCache.get('REMOTE_SERVICE_ALL_CONFIGS');
        return void 0 === e || this.__memCache.isExpired('REMOTE_SERVICE_ALL_CONFIGS') ? t.request(this.__baseURL).then(o.bind(function (e) {
          var t = o.parse(e.responseText);
          return this.__memCache.set('REMOTE_SERVICE_ALL_CONFIGS', t),
          o.parse(e.responseText)
        }, this)) : r.resolve(e)
      }
    })
  }),
  define('vdk-appGrid/LocalSession', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/promise',
    'xdk-base/ajax',
    'vdk/errors/VIAError',
    'xdk-base/config'
  ], function (e, t, i, n, s, r) {
    var o,
    a = e.create({
      singleton: function () {
        if (!o) {
          var e = r.get('appgrid'),
          t = e.localApi;
          o = new a(t)
        }
        return o
      }
    }, {
      sendGetRequest: function (e) {
        return e = e.replace(/\*/g, '$'),
        - 1 === e.indexOf('http://') && (e = this.__baseURL + e),
        n.request(e)
      },
      sendPostRequest: function (e) {
        return i.reject()
      },
      init: function (e) {
        this.__baseURL = e
      },
      getEndPoint: function () {
        return this.__baseURL
      }
    });
    return a
  }),
  define('xdk-base/device/playerRegistry', [
    'xdk-base/util',
    'require'
  ], function (e, t) {
    'use strict';
    var i = [
    ];
    return {
      register: function (t, n) {
        var s,
        r,
        o,
        a = t.getCapabilities(),
        d = a.type || [
          '*'
        ],
        c = a.drms || [
        ],
        l = {
          type: {
          },
          drm: {
          },
          player: null
        };
        e.isArray(d) || (d = [
          d
        ]),
        e.isArray(c) || (c = [
          c
        ]);
        for (o in d) (s = d[o]) && (l.type[s] = !0);
        for (o in c) (r = c[o]) && (l.drm[r] = !0);
        t.setId(n),
        l.id = n,
        l.player = t,
        i.push(l)
      },
      unregister: function (t) {
        e.each(i, function (n, s) {
          if (n.player === t) return t.reset(),
          i.splice(s, 1),
          e.breaker
        })
      },
      deinit: function () {
        for (var t, n; i.length; ) t = i.pop(),
        n = t.player,
        n.reset(),
        e.isFunction(n.deinit) && n.deinit(),
        t.player = null
      },
      getPlayerByClass: function (n) {
        var s = t(n),
        r = null;
        return e.each(i, function (t) {
          if (t.player.constructor === s) return r = t.player,
          e.breaker
        }),
        r
      },
      getPlayer: function (e) {
        var t = this.getPlayers(e);
        return 0 === t.length ? null : t[0]
      },
      getPlayers: function (t) {
        var n = [
        ],
        s = t.type,
        r = t.drm;
        return s || r ? (e.each(i, function (e) {
          (s && e.type[s] || '*' === s) && (r && e.drm[r] || !r) && n.push(e.player),
          !s && r && e.drm[r] && n.push(e.player)
        }), n) : (e.each(i, function (e) {
          n.push(e.player)
        }), n)
      }
    }
  }),
  define('xdk-base/device/interface/Player', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    var t = e.create('Player', {
      getCapabilities: [
      ],
      prepare: [
        'opts'
      ],
      reset: [
      ],
      load: [
        'mediaUrl',
        'opts'
      ],
      play: [
        'opts'
      ],
      stop: [
      ],
      pause: [
      ],
      resume: [
      ],
      seek: [
        'sec'
      ],
      skip: [
        'sec'
      ],
      speed: [
        'speed'
      ],
      getPlaybackSpeed: [
      ],
      setWindowSize: [
        'param'
      ],
      setFullscreen: [
      ],
      getBitrates: [
      ],
      getCurTime: [
      ],
      getDuration: [
      ],
      getId: [
      ],
      setId: [
        'id'
      ]
    });
    t.PLAYBACK_STATE = {
      PLAYING: 'playing',
      PAUSED: 'paused',
      STOPPED: 'stopped'
    };
    var i = {
      RENDER: 'onRenderError',
      NETWORK: 'onConnectionError',
      DRM: 'onDRMError',
      GENERIC: 'onUnknownError'
    };
    return t.PLAYBACK_ERRORS = {
      RENDER: {
        FAILED: {
          evt: i.RENDER,
          code: 1001,
          id: 'player.error.render.failed',
          desc: 'Stream Playback Generic Error'
        },
        ABORTED: {
          evt: i.RENDER,
          code: 1002,
          id: 'player.error.render.aborted',
          desc: 'You aborted the video playback'
        },
        DECODE: {
          evt: i.RENDER,
          code: 1003,
          id: 'player.error.render.decode',
          desc: 'Decoding error, The video playback was aborted due to a corruption problem or because the video used features your browser did not support.'
        },
        CORRUPTED: {
          evt: i.RENDER,
          code: 1004,
          id: 'player.error.render.corrupted',
          desc: 'Corrupted Stream Error'
        },
        UNSUPPORTED: {
          evt: i.RENDER,
          code: 1005,
          id: 'player.error.render.unsupported',
          desc: 'Unsupported Video Format, The media resource indicated by the src attribute or assigned media provider object was not suitable.'
        },
        DEVICE: {
          evt: i.RENDER,
          code: 1006,
          id: 'player.error.render.device',
          desc: 'Device system Error, out of memory or other reason.'
        },
        PLAYLIST: {
          evt: i.RENDER,
          code: 1007,
          id: 'player.error.render.playlist',
          desc: 'Unrecognized play list or Play list is empty'
        }
      },
      NETWORK: {
        FAILED: {
          evt: i.NETWORK,
          code: 2001,
          id: 'player.error.network.failed',
          desc: 'A network error caused the video download to fail part-way'
        },
        FILE: {
          evt: i.NETWORK,
          code: 2002,
          id: 'player.error.network.file',
          desc: 'File is not found or network error while trying to load the file'
        },
        TIMEOUT: {
          evt: i.NETWORK,
          code: 2003,
          id: 'player.error.network.timeout',
          desc: 'Network Timeout'
        },
        DISCONNECTED: {
          evt: i.NETWORK,
          code: 2004,
          id: 'player.error.network.disconnected',
          desc: 'Network Disconnected'
        },
        PROTOCOL: {
          evt: i.NETWORK,
          code: 2005,
          id: 'player.error.network.protocol',
          desc: 'Invalid Protocol'
        }
      },
      DRM: {
        FAILED: {
          evt: i.DRM,
          code: 3001,
          id: 'player.error.drm.failed',
          desc: 'Authentication Failed, general message'
        },
        NOLICENCE: {
          evt: i.DRM,
          code: 3002,
          id: 'player.error.drm.nolicense',
          desc: 'No License'
        },
        INVALID: {
          evt: i.DRM,
          code: 3003,
          id: 'player.error.drm.invalid',
          desc: 'Invalid license'
        }
      },
      GENERIC: {
        UNKNOWN: {
          evt: i.GENERIC,
          code: 4001,
          id: 'player.error.generic.unknown',
          desc: 'Unidentified Error on Playback'
        },
        LOAD: {
          evt: i.GENERIC,
          code: 4002,
          id: 'player.error.generic.load',
          desc: 'Exception caught when trying to load the media'
        }
      }
    },
    t
  }),
  define('xdk-base/device/interface/DevicePackage', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('DevicePackage', {
      setup: [
        'onDeviceLoaded'
      ],
      getId: [
      ],
      getDefaultPlayer: [
      ]
    })
  }),
  define('xdk-base/device/AbstractDevicePackage', [
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/console',
    'xdk-base/device/playerRegistry',
    'xdk-base/device/interface/Player',
    'xdk-base/util',
    'xdk-base/config',
    'xdk-base/promise',
    'require',
    'xdk-base/device/interface/DevicePackage'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    var l = {
      STORAGE: 'Storage',
      STORAGE_HANDLE: 'storage',
      MEDIA_PLAYER: 'Media',
      MEDIA_PLAYER_HANDLE: 'media',
      TV_KEY: 'TvKey',
      TV_KEY_HANDLE: 'tvkey',
      ID: 'Id',
      ID_HANDLE: 'id',
      CONSOLE: 'Console',
      CONSOLE_HANDLE: 'console',
      SYSTEM: 'System',
      SYSTEM_HANDLE: 'system'
    },
    u = e.createAbstract([c], {
      STORAGE: l.STORAGE,
      STORAGE_HANDLE: l.STORAGE_HANDLE,
      MEDIA_PLAYER: l.MEDIA_PLAYER,
      MEDIA_PLAYER_HANDLE: l.MEDIA_PLAYER_HANDLE,
      TV_KEY: l.TV_KEY,
      TV_KEY_HANDLE: l.TV_KEY_HANDLE,
      ID: l.ID,
      ID_HANDLE: l.ID_HANDLE,
      CONSOLE: l.CONSOLE,
      CONSOLE_HANDLE: l.CONSOLE_HANDLE,
      SYSTEM: l.SYSTEM,
      SYSTEM_HANDLE: l.SYSTEM_HANDLE,
      BASIC_INTERFACES: [
        {
          name: l.STORAGE,
          handle: l.STORAGE_HANDLE
        },
        {
          name: l.MEDIA_PLAYER,
          handle: l.MEDIA_PLAYER_HANDLE
        },
        {
          name: l.TV_KEY,
          handle: l.TV_KEY_HANDLE
        },
        {
          name: l.ID,
          handle: l.ID_HANDLE
        },
        {
          name: l.SYSTEM,
          handle: l.SYSTEM_HANDLE
        }
      ],
      _onDeviceReady: null,
      _shouldSetup: !1,
      prepare: function (e) {
        u._onDeviceReady = e
      }
    }, {
      __onDeviceReady: null,
      __interfaceTypes: {
      },
      __device: {
      },
      init: function (e) {
        return this.__onDeviceReady = e,
        i.info('init of abstractDevicePackage'),
        this
      },
      setup: function (e) {
        if (this._shouldSetup) return this.__onDeviceReady = e,
        i.info('set up abstractDevicePackage'),
        t.root.onunload = this.deinit,
        this
      },
      addInterfaceType: function (e, t, i) {
        this.__interfaceTypes[e] = {
          handle: t,
          interfaceObj: i
        },
        this.__device[t] = i
      },
      getInterface: function (e) {
        return this.__interfaceTypes[e] ? this.__interfaceTypes[e].interfaceObj : null
      },
      getId: e.abstractFn,
      ready: function (e) {
        if (e = e || {
        }, this.__onDeviceReady && r.isFunction(this.__onDeviceReady)) return void this.__onDeviceReady(this.__device, e);
        u._onDeviceReady(this.__device, e)
      },
      _preparePlayerList: function (e) {
        e()
      },
      getDefaultPlayer: function () {
        return []
      },
      _getDefaultPlayer: function () {
        return []
      },
      deinit: function () {
        var e = d('xdk-base/device');
        i.info('[XDK] DOM Unloaded'),
        n.deinit(),
        e.deinit()
      }
    });
    return u
  }),
  define('xdk-base/device/vKey', [
  ], function () {
    'use strict';
    return {
      KEY_0: {
        id: 'device:vkey:0',
        text: '0'
      },
      KEY_1: {
        id: 'device:vkey:1',
        text: '1'
      },
      KEY_2: {
        id: 'device:vkey:2',
        text: '2'
      },
      KEY_3: {
        id: 'device:vkey:3',
        text: '3'
      },
      KEY_4: {
        id: 'device:vkey:4',
        text: '4'
      },
      KEY_5: {
        id: 'device:vkey:5',
        text: '5'
      },
      KEY_6: {
        id: 'device:vkey:6',
        text: '6'
      },
      KEY_7: {
        id: 'device:vkey:7',
        text: '7'
      },
      KEY_8: {
        id: 'device:vkey:8',
        text: '8'
      },
      KEY_9: {
        id: 'device:vkey:9',
        text: '9'
      },
      OK: {
        id: 'device:vkey:ok'
      },
      UP: {
        id: 'device:vkey:up'
      },
      DOWN: {
        id: 'device:vkey:down'
      },
      LEFT: {
        id: 'device:vkey:left'
      },
      RIGHT: {
        id: 'device:vkey:right'
      },
      EXIT: {
        id: 'device:vkey:exit'
      },
      BACK: {
        id: 'device:vkey:back'
      },
      RED: {
        id: 'device:vkey:red'
      },
      GREEN: {
        id: 'device:vkey:green'
      },
      YELLOW: {
        id: 'device:vkey:yellow'
      },
      BLUE: {
        id: 'device:vkey:blue'
      },
      PLAY: {
        id: 'device:vkey:play'
      },
      PLAY_PAUSE: {
        id: 'device:vkey:playPause'
      },
      PAUSE: {
        id: 'device:vkey:pause'
      },
      STOP: {
        id: 'device:vkey:stop'
      },
      FF: {
        id: 'device:vkey:ff'
      },
      RW: {
        id: 'device:vkey:rw'
      },
      NEXT: {
        id: 'device:vkey:next'
      },
      PREV: {
        id: 'device:vkey:prev'
      }
    }
  }),
  define('xdk-base/interface/DeviceHandler', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('DeviceHandler', {
      onDeviceDetect: [
        'platform'
      ],
      onDeviceLoad: [
        'launchData'
      ],
      onDevicePause: [
      ],
      onDeviceResume: [
      ],
      onDeviceUnload: [
      ],
      onDeviceKey: [
      ]
    })
  }),
  define('xdk-base/device/basicInterfaces', [
  ], function () {
    'use strict';
    return {
      STORAGE: 'storage',
      MEDIA_PLAYER: 'media',
      TV_KEY: 'tvkey',
      ID: 'id',
      SYSTEM: 'system'
    }
  }),
  define('xdk-base/device', [
    'xdk-base/config',
    'xdk-base/console',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/device/AbstractDevicePackage',
    'xdk-base/device/vKey',
    'require',
    'xdk-base/class',
    'xdk-base/interface/DeviceHandler',
    'xdk-base/exception',
    'xdk-base/device/interface/Player',
    'xdk-base/promise',
    'xdk-base/device/playerRegistry',
    'xdk-base/device/basicInterfaces'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _) {
    'use strict';
    var f,
    p,
    g,
    v,
    m,
    E = !1,
    b = !1,
    y = !1,
    k = null,
    S = function (s, r) {
      var d,
      f,
      m;
      if (b = !0, n.each(_, function (e) {
        m = e.value,
        f = s[m],
        f || t.error('Basic interface not implemented in device package:name=' + m),
        L[m] = f
      }), clearTimeout(v), L.tvkey.initKeyHandling(function () {
        return !1
      }), d = e.get('device.players', !1), d && d[g.getId()] ? d = d[g.getId()] : (g.getDefaultPlayer && (d = g.getDefaultPlayer()), 0 === d.length && g._getDefaultPlayer && (d = g._getDefaultPlayer())), d.length > 0) return void o(d, function () {
        var s,
        _ = [
        ];
        s = function (n, s) {
          if (!a.hasImpl(n, l)) throw i.createException(c.ILLEGAL_ARGUMENT, 'Player does not implement ax/device/interface/Player: ' + p);
          var r,
          f,
          p,
          v,
          m,
          E,
          b = [
          ];
          p = d[s];
          try {
            r = new n(g)
          } catch (e) {
            return void t.warn('[XDK] Fail to load the player : ' + p + ' : ' + e.name)
          }
          h.register(r, p),
          f = e.get('device.multiAudioTrackStgy', null),
          f && f[p] && (b.push(f[p]), t.info('[XDK] Multi Audio Track exist ' + f + ' for ' + p)),
          v = e.get('device.subtitleStgy', null),
          v && v[p] && (m = v[p], m.internal && (t.info('[XDK] Loading the internal player strategy ' + m.internal), b.push(m.internal)), m.external && (t.info('[XDK] Loading the external player strategy ' + m.external), b.push(m.external))),
          0 !== b.length && (E = u.defer(), _.push(E.promise), o(b, function () {
            t.info('[XDK] Loading the player strategies'),
            E.resolve()
          }, function () {
            throw i.createException(c.ILLEGAL_ARGUMENT, 'Unable to load the player related strategies. Please check the paths.')
          }))
        },
        n.each(Array.prototype.slice.call(arguments), s),
        u.all(_).then(n.bind(p, this, r)).done()
      }, function () {
        throw i.createException(c.UNSUPPORTED_OPERATION, 'Unable to load the player list. Please check the paths.')
      });
      p(r)
    },
    x = function () {
      throw clearTimeout(v),
      t.error('Initialize device package timeout!'),
      i.createException(c.UNSUPPORTED_OPERATION, 'Initialize device package timeout!')
    },
    T = function (t) {
      var i,
      s = e.get('device.initTimeout', 10000);
      if (v = setTimeout(x, s), !t) return void C('Device package reference not found.');
      t.prepare && t.prepare(S),
      i = n.wrap(S, function (e, t) {
        n.delay().then(n.bind(e, L, t))
      }),
      g = new t(i),
      g.setup(function () {
        L.platform = g.getId(),
        S.apply(null, arguments)
      })
    },
    C = function (e) {
      throw t.error('Device package is unable to load due to: ' + e.message),
      i.createException(c.UNSUPPORTED_OPERATION, 'Device package is unable to load due to: ' + e.message)
    },
    A = function () {
      y || (k || (k = 'xdk-base/device/workstation'), y = !0, f(k), o([k + '/DevicePackage'], T, C))
    },
    w = function () {
      var t = e.get('device.target-platform', null),
      s = e.get('device.packages', [
        'xdk-base/device/workstation'
      ]),
      r = [
      ];
      if (b) return void (n.isFunction(p) && p());
      if (t) return k = t,
      void n.defer().then(A).done();
      if (!n.isArray(s) || 0 === s.length) throw i.createException(c.ILLEGAL_ARGUMENT, 'device.packages should be an array:' + s + ' and should not be empty');
      n.each(s, function (e) {
        r.push(e + '/detection')
      }),
      o(r, function () {
        n.each(Array.prototype.slice.call(arguments), n.bind(function (e, t) {
          if (e) return k = s[t],
          n.breaker
        })),
        n.defer().then(A).done()
      }, function (e) {
        throw i.createException(c.UNSUPPORTED_OPERATION, 'Unable to load detection from the provided packages list: ' + s.toString(), '. Please check your detection file. Stack: ' + e.stack)
      })
    },
    I = function () {
      E || (E = !0, t.info('[XDK] DOM loaded'), L.bootstrap())
    },
    L = {
      id: null,
      system: null,
      media: null,
      tvkey: null,
      storage: null,
      vKey: r,
      init: function (e) {
        if (!a.hasImpl(e.constructor, d)) throw i.createException(c.ILLEGAL_ARGUMENT, '[XDK] Not a valid device handler.');
        m = e,
        domReady(I)
      },
      _bootstrap: function (e, i) {
        f = e.platformDetecetedCb || function (e) {
          t.log('platform detected' + e)
        },
        p = e.inited,
        n.isFunction(i) && (C = i),
        w()
      },
      bootstrap: function () {
        var e = this.getDeviceHandler();
        f = n.bind(e.onDeviceDetect, e),
        p = n.bind(e.onDeviceLoad, e),
        w()
      },
      getDeviceHandler: function () {
        return m
      },
      deinit: function (e) {
        n.isFunction(e) && e(),
        this.getDeviceHandler().onDeviceUnload()
      }
    };
    return L
  }),
  define('vdk-lib-base64/base64', [
  ], function () {
    var e = {
      alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',
      lookup: null,
      ie: /MSIE /.test(navigator.userAgent),
      ieo: /MSIE [67]/.test(navigator.userAgent),
      encode: function (t) {
        var i,
        n,
        s,
        r = e.toUtf8(t),
        o = - 1,
        a = r.length,
        d = [
          ,
          ,
          ,
        ];
        if (e.ie) {
          for (var c = [
          ]; ++o < a; ) i = r[o],
          n = r[++o],
          d[0] = i >> 2,
          d[1] = (3 & i) << 4 | n >> 4,
          isNaN(n) ? d[2] = d[3] = 64 : (s = r[++o], d[2] = (15 & n) << 2 | s >> 6, d[3] = isNaN(s) ? 64 : 63 & s),
          c.push(e.alphabet.charAt(d[0]), e.alphabet.charAt(d[1]), e.alphabet.charAt(d[2]), e.alphabet.charAt(d[3]));
          return c.join('')
        }
        for (var c = ''; ++o < a; ) i = r[o],
        n = r[++o],
        d[0] = i >> 2,
        d[1] = (3 & i) << 4 | n >> 4,
        isNaN(n) ? d[2] = d[3] = 64 : (s = r[++o], d[2] = (15 & n) << 2 | s >> 6, d[3] = isNaN(s) ? 64 : 63 & s),
        c += e.alphabet[d[0]] + e.alphabet[d[1]] + e.alphabet[d[2]] + e.alphabet[d[3]];
        return c
      },
      decode: function (t) {
        if (t.length % 4) throw new Error('InvalidCharacterError: \'B64.decode\' failed: The string to be decoded is not correctly encoded.');
        var i = e.fromUtf8(t),
        n = 0,
        s = i.length;
        if (e.ieo) {
          for (var r = [
          ]; n < s; ) i[n] < 128 ? r.push(String.fromCharCode(i[n++])) : i[n] > 191 && i[n] < 224 ? r.push(String.fromCharCode((31 & i[n++]) << 6 | 63 & i[n++])) : r.push(String.fromCharCode((15 & i[n++]) << 12 | (63 & i[n++]) << 6 | 63 & i[n++]));
          return r.join('')
        }
        for (var r = ''; n < s; ) i[n] < 128 ? r += String.fromCharCode(i[n++]) : i[n] > 191 && i[n] < 224 ? r += String.fromCharCode((31 & i[n++]) << 6 | 63 & i[n++]) : r += String.fromCharCode((15 & i[n++]) << 12 | (63 & i[n++]) << 6 | 63 & i[n++]);
        return r
      },
      toUtf8: function (e) {
        var t,
        i = - 1,
        n = e.length,
        s = [
        ];
        if (/^[\x00-\x7f]*$/.test(e)) for (; ++i < n; ) s.push(e.charCodeAt(i));
         else for (; ++i < n; ) t = e.charCodeAt(i),
        t < 128 ? s.push(t) : t < 2048 ? s.push(t >> 6 | 192, 63 & t | 128) : s.push(t >> 12 | 224, t >> 6 & 63 | 128, 63 & t | 128);
        return s
      },
      fromUtf8: function (t) {
        var i,
        n = - 1,
        s = [
        ],
        r = [
          ,
          ,
          ,
        ];
        if (!e.lookup) {
          for (i = e.alphabet.length, e.lookup = {
          }; ++n < i; ) e.lookup[e.alphabet.charAt(n)] = n;
          n = - 1
        }
        for (i = t.length; ++n < i && (r[0] = e.lookup[t.charAt(n)], r[1] = e.lookup[t.charAt(++n)], s.push(r[0] << 2 | r[1] >> 4), r[2] = e.lookup[t.charAt(++n)], 64 != r[2]) && (s.push((15 & r[1]) << 4 | r[2] >> 2), r[3] = e.lookup[t.charAt(++n)], 64 != r[3]); ) s.push((3 & r[2]) << 6 | r[3]);
        return s
      }
    };
    return e
  }),
  define('vdk-lib-moment/moment', [
  ], function () {
    function e(e, t) {
      return function (i) {
        return o(e.call(this, i), t)
      }
    }
    function t() {
    }
    function i(e) {
      v(e),
      s(this, e)
    }
    function n(e) {
      var t = h(e),
      i = t.year || 0,
      n = t.month || 0,
      s = t.week || 0,
      r = t.day || 0,
      o = t.hour || 0,
      a = t.minute || 0,
      d = t.second || 0,
      c = t.millisecond || 0;
      this._input = e,
      this._milliseconds = + c + 1000 * d + 60000 * a + 3600000 * o,
      this._days = + r + 7 * s,
      this._months = + n + 12 * i,
      this._data = {
      },
      this._bubble()
    }
    function s(e, t) {
      for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i]);
      return t.hasOwnProperty('toString') && (e.toString = t.toString),
      t.hasOwnProperty('valueOf') && (e.valueOf = t.valueOf),
      e
    }
    function r(e) {
      return e < 0 ? Math.ceil(e) : Math.floor(e)
    }
    function o(e, t) {
      for (var i = e + ''; i.length < t; ) i = '0' + i;
      return i
    }
    function a(e, t, i, n) {
      var s,
      r,
      o = t._milliseconds,
      a = t._days,
      d = t._months;
      o && e._d.setTime( + e._d + o * i),
      (a || d) && (s = e.minute(), r = e.hour()),
      a && e.date(e.date() + a * i),
      d && e.month(e.month() + d * i),
      o && !n && J.updateOffset(e),
      (a || d) && (e.minute(s), e.hour(r))
    }
    function d(e) {
      return '[object Array]' === Object.prototype.toString.call(e)
    }
    function c(e) {
      return '[object Date]' === Object.prototype.toString.call(e) || e instanceof Date
    }
    function l(e, t, i) {
      var n,
      s = Math.min(e.length, t.length),
      r = Math.abs(e.length - t.length),
      o = 0;
      for (n = 0; n < s; n++) (i && e[n] !== t[n] || !i && _(e[n]) !== _(t[n])) && o++;
      return o + r
    }
    function u(e) {
      if (e) {
        var t = e.toLowerCase().replace(/(.)s$/, '$1');
        e = Ie[e] || Le[t] || t
      }
      return e
    }
    function h(e) {
      var t,
      i,
      n = {
      };
      for (i in e) e.hasOwnProperty(i) && (t = u(i)) && (n[t] = e[i]);
      return n
    }
    function _(e) {
      var t = + e,
      i = 0;
      return 0 !== t && isFinite(t) && (i = t >= 0 ? Math.floor(t) : Math.ceil(t)),
      i
    }
    function f(e, t) {
      return new Date(Date.UTC(e, t + 1, 0)).getUTCDate()
    }
    function p(e) {
      return g(e) ? 366 : 365
    }
    function g(e) {
      return e % 4 == 0 && e % 100 != 0 || e % 400 == 0
    }
    function v(e) {
      var t;
      e._a && - 2 === e._pf.overflow && (t = e._a[ee] < 0 || e._a[ee] > 11 ? ee : e._a[te] < 1 || e._a[te] > f(e._a[Q], e._a[ee]) ? te : e._a[ie] < 0 || e._a[ie] > 23 ? ie : e._a[ne] < 0 || e._a[ne] > 59 ? ne : e._a[se] < 0 || e._a[se] > 59 ? se : e._a[re] < 0 || e._a[re] > 999 ? re : - 1, e._pf._overflowDayOfYear && (t < Q || t > te) && (t = te), e._pf.overflow = t)
    }
    function m(e) {
      e._pf = {
        empty: !1,
        unusedTokens: [
        ],
        unusedInput: [
        ],
        overflow: - 2,
        charsLeftOver: 0,
        nullInput: !1,
        invalidMonth: null,
        invalidFormat: !1,
        userInvalidated: !1,
        iso: !1
      }
    }
    function E(e) {
      return null == e._isValid && (e._isValid = !isNaN(e._d.getTime()) && e._pf.overflow < 0 && !e._pf.empty && !e._pf.invalidMonth && !e._pf.nullInput && !e._pf.invalidFormat && !e._pf.userInvalidated, e._strict && (e._isValid = e._isValid && 0 === e._pf.charsLeftOver && 0 === e._pf.unusedTokens.length)),
      e._isValid
    }
    function b(e) {
      return e ? e.toLowerCase().replace('_', '-') : e
    }
    function y(e, i) {
      return i.abbr = e,
      oe[e] || (oe[e] = new t),
      oe[e].set(i),
      oe[e]
    }
    function k(e) {
      delete oe[e]
    }
    function S(e) {
      var t,
      i,
      n,
      s,
      r = 0,
      o = function (e) {
        if (!oe[e] && ae) try {
          require('./lang/' + e)
        } catch (e) {
        }
        return oe[e]
      };
      if (!e) return J.fn._lang;
      if (!d(e)) {
        if (i = o(e)) return i;
        e = [
          e
        ]
      }
      for (; r < e.length; ) {
        for (s = b(e[r]).split('-'), t = s.length, n = b(e[r + 1]), n = n ? n.split('-') : null; t > 0; ) {
          if (i = o(s.slice(0, t).join('-'))) return i;
          if (n && n.length >= t && l(s, n, !0) >= t - 1) break;
          t--
        }
        r++
      }
      return J.fn._lang
    }
    function x(e) {
      return e.match(/\[[\s\S]/) ? e.replace(/^\[|\]$/g, '') : e.replace(/\\/g, '')
    }
    function T(e) {
      var t,
      i,
      n = e.match(ue);
      for (t = 0, i = n.length; t < i; t++) Oe[n[t]] ? n[t] = Oe[n[t]] : n[t] = x(n[t]);
      return function (s) {
        var r = '';
        for (t = 0; t < i; t++) r += n[t] instanceof Function ? n[t].call(s, e) : n[t];
        return r
      }
    }
    function C(e, t) {
      return e.isValid() ? (t = A(t, e.lang()), Re[t] || (Re[t] = T(t)), Re[t](e)) : e.lang().invalidDate()
    }
    function A(e, t) {
      function i(e) {
        return t.longDateFormat(e) || e
      }
      var n = 5;
      for (he.lastIndex = 0; n >= 0 && he.test(e); ) e = e.replace(he, i),
      he.lastIndex = 0,
      n -= 1;
      return e
    }
    function w(e, t) {
      switch (e) {
        case 'DDDD':
          return pe;
        case 'YYYY':
        case 'GGGG':
        case 'gggg':
          return ge;
        case 'YYYYY':
        case 'GGGGG':
        case 'ggggg':
          return ve;
        case 'S':
        case 'SS':
        case 'SSS':
        case 'DDD':
          return fe;
        case 'MMM':
        case 'MMMM':
        case 'dd':
        case 'ddd':
        case 'dddd':
          return Ee;
        case 'a':
        case 'A':
          return S(t._l)._meridiemParse;
        case 'X':
          return ke;
        case 'Z':
        case 'ZZ':
          return be;
        case 'T':
          return ye;
        case 'SSSS':
          return me;
        case 'MM':
        case 'DD':
        case 'YY':
        case 'GG':
        case 'gg':
        case 'HH':
        case 'hh':
        case 'mm':
        case 'ss':
        case 'M':
        case 'D':
        case 'd':
        case 'H':
        case 'h':
        case 'm':
        case 's':
        case 'w':
        case 'ww':
        case 'W':
        case 'WW':
        case 'e':
        case 'E':
          return _e;
        default:
          return new RegExp(N(M(e.replace('\\', ''))))
      }
    }
    function I(e) {
      var t = (be.exec(e) || [
      ]) [0],
      i = (t + '').match(Ce) || [
        '-',
        0,
        0
      ],
      n = 60 * i[1] + _(i[2]);
      return '+' === i[0] ? - n : n
    }
    function L(e, t, i) {
      var n,
      s = i._a;
      switch (e) {
        case 'M':
        case 'MM':
          null != t && (s[ee] = _(t) - 1);
          break;
        case 'MMM':
        case 'MMMM':
          n = S(i._l).monthsParse(t),
          null != n ? s[ee] = n : i._pf.invalidMonth = t;
          break;
        case 'D':
        case 'DD':
          null != t && (s[te] = _(t));
          break;
        case 'DDD':
        case 'DDDD':
          null != t && (i._dayOfYear = _(t));
          break;
        case 'YY':
          s[Q] = _(t) + (_(t) > 68 ? 1900 : 2000);
          break;
        case 'YYYY':
        case 'YYYYY':
          s[Q] = _(t);
          break;
        case 'a':
        case 'A':
          i._isPm = S(i._l).isPM(t);
          break;
        case 'H':
        case 'HH':
        case 'h':
        case 'hh':
          s[ie] = _(t);
          break;
        case 'm':
        case 'mm':
          s[ne] = _(t);
          break;
        case 's':
        case 'ss':
          s[se] = _(t);
          break;
        case 'S':
        case 'SS':
        case 'SSS':
        case 'SSSS':
          s[re] = _(1000 * ('0.' + t));
          break;
        case 'X':
          i._d = new Date(1000 * parseFloat(t));
          break;
        case 'Z':
        case 'ZZ':
          i._useUTC = !0,
          i._tzm = I(t);
          break;
        case 'w':
        case 'ww':
        case 'W':
        case 'WW':
        case 'd':
        case 'dd':
        case 'ddd':
        case 'dddd':
        case 'e':
        case 'E':
          e = e.substr(0, 1);
        case 'gg':
        case 'gggg':
        case 'GG':
        case 'GGGG':
        case 'GGGGG':
          e = e.substr(0, 2),
          t && (i._w = i._w || {
          }, i._w[e] = t)
      }
    }
    function R(e) {
      var t,
      i,
      n,
      s,
      r,
      o,
      a,
      d,
      c,
      l,
      u = [
      ];
      if (!e._d) {
        for (n = D(e), e._w && null == e._a[te] && null == e._a[ee] && (r = function (t) {
          return t ? t.length < 3 ? parseInt(t, 10) > 68 ? '19' + t : '20' + t : t : null == e._a[Q] ? J().weekYear() : e._a[Q]
        }, o = e._w, null != o.GG || null != o.W || null != o.E ? a = j(r(o.GG), o.W || 1, o.E, 4, 1) : (d = S(e._l), c = null != o.d ? H(o.d, d) : null != o.e ? parseInt(o.e, 10) + d._week.dow : 0, l = parseInt(o.w, 10) || 1, null != o.d && c < d._week.dow && l++, a = j(r(o.gg), l, c, d._week.doy, d._week.dow)), e._a[Q] = a.year, e._dayOfYear = a.dayOfYear), e._dayOfYear && (s = null == e._a[Q] ? n[Q] : e._a[Q], e._dayOfYear > p(s) && (e._pf._overflowDayOfYear = !0), i = V(s, 0, e._dayOfYear), e._a[ee] = i.getUTCMonth(), e._a[te] = i.getUTCDate()), t = 0; t < 3 && null == e._a[t]; ++t) e._a[t] = u[t] = n[t];
        for (; t < 7; t++) e._a[t] = u[t] = null == e._a[t] ? 2 === t ? 1 : 0 : e._a[t];
        u[ie] += _((e._tzm || 0) / 60),
        u[ne] += _((e._tzm || 0) % 60),
        e._d = (e._useUTC ? V : U).apply(null, u)
      }
    }
    function P(e) {
      var t;
      e._d || (t = h(e._i), e._a = [
        t.year,
        t.month,
        t.day,
        t.hour,
        t.minute,
        t.second,
        t.millisecond
      ], R(e))
    }
    function D(e) {
      var t = new Date;
      return e._useUTC ? [
        t.getUTCFullYear(),
        t.getUTCMonth(),
        t.getUTCDate()
      ] : [
        t.getFullYear(),
        t.getMonth(),
        t.getDate()
      ]
    }
    function O(e) {
      e._a = [
      ],
      e._pf.empty = !0;
      var t,
      i,
      n,
      s,
      r,
      o = S(e._l),
      a = '' + e._i,
      d = a.length,
      c = 0;
      for (n = A(e._f, o).match(ue) || [
      ], t = 0; t < n.length; t++) s = n[t],
      i = (w(s, e).exec(a) || [
      ]) [0],
      i && (r = a.substr(0, a.indexOf(i)), r.length > 0 && e._pf.unusedInput.push(r), a = a.slice(a.indexOf(i) + i.length), c += i.length),
      Oe[s] ? (i ? e._pf.empty = !1 : e._pf.unusedTokens.push(s), L(s, i, e)) : e._strict && !i && e._pf.unusedTokens.push(s);
      e._pf.charsLeftOver = d - c,
      a.length > 0 && e._pf.unusedInput.push(a),
      e._isPm && e._a[ie] < 12 && (e._a[ie] += 12),
      !1 === e._isPm && 12 === e._a[ie] && (e._a[ie] = 0),
      R(e),
      v(e)
    }
    function M(e) {
      return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g, function (e, t, i, n, s) {
        return t || i || n || s
      })
    }
    function N(e) {
      return e.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')
    }
    function F(e) {
      var t,
      i,
      n,
      r,
      o;
      if (0 === e._f.length) return e._pf.invalidFormat = !0,
      void (e._d = new Date(NaN));
      for (r = 0; r < e._f.length; r++) o = 0,
      t = s({
      }, e),
      m(t),
      t._f = e._f[r],
      O(t),
      E(t) && (o += t._pf.charsLeftOver, o += 10 * t._pf.unusedTokens.length, t._pf.score = o, (null == n || o < n) && (n = o, i = t));
      s(e, i || t)
    }
    function B(e) {
      var t,
      i = e._i,
      n = Se.exec(i);
      if (n) {
        for (e._pf.iso = !0, t = 4; t > 0; t--) if (n[t]) {
          e._f = xe[t - 1] + (n[6] || ' ');
          break
        }
        for (t = 0; t < 4; t++) if (Te[t][1].exec(i)) {
          e._f += Te[t][0];
          break
        }
        be.exec(i) && (e._f += 'Z'),
        O(e)
      } else e._d = new Date(i)
    }
    function G(e) {
      var t = e._i,
      i = de.exec(t);
      void 0 === t ? e._d = new Date : i ? e._d = new Date( + i[1]) : 'string' == typeof t ? B(e) : d(t) ? (e._a = t.slice(0), R(e)) : c(t) ? e._d = new Date( + t) : 'object' == typeof t ? P(e) : e._d = new Date(t)
    }
    function U(e, t, i, n, s, r, o) {
      var a = new Date(e, t, i, n, s, r, o);
      return e < 1970 && a.setFullYear(e),
      a
    }
    function V(e) {
      var t = new Date(Date.UTC.apply(null, arguments));
      return e < 1970 && t.setUTCFullYear(e),
      t
    }
    function H(e, t) {
      if ('string' == typeof e) if (isNaN(e)) {
        if ('number' != typeof (e = t.weekdaysParse(e))) return null
      } else e = parseInt(e, 10);
      return e
    }
    function K(e, t, i, n, s) {
      return s.relativeTime(t || 1, !!i, e, n)
    }
    function Y(e, t, i) {
      var n = Z(Math.abs(e) / 1000),
      s = Z(n / 60),
      r = Z(s / 60),
      o = Z(r / 24),
      a = Z(o / 365),
      d = n < 45 && [
        's',
        n
      ] || 1 === s && [
        'm'
      ] || s < 45 && [
        'mm',
        s
      ] || 1 === r && [
        'h'
      ] || r < 22 && [
        'hh',
        r
      ] || 1 === o && [
        'd'
      ] || o <= 25 && [
        'dd',
        o
      ] || o <= 45 && [
        'M'
      ] || o < 345 && [
        'MM',
        Z(o / 30)
      ] || 1 === a && [
        'y'
      ] || [
        'yy',
        a
      ];
      return d[2] = t,
      d[3] = e > 0,
      d[4] = i,
      K.apply({
      }, d)
    }
    function W(e, t, i) {
      var n,
      s = i - t,
      r = i - e.day();
      return r > s && (r -= 7),
      r < s - 7 && (r += 7),
      n = J(e).add('d', r),
      {
        week: Math.ceil(n.dayOfYear() / 7),
        year: n.year()
      }
    }
    function j(e, t, i, n, s) {
      var r,
      o,
      a = new Date(Date.UTC(e, 0)).getUTCDay();
      return i = null != i ? i : s,
      r = s - a + (a > n ? 7 : 0),
      o = 7 * (t - 1) + (i - s) + r + 1,
      {
        year: o > 0 ? e : e - 1,
        dayOfYear: o > 0 ? o : p(e - 1) + o
      }
    }
    function q(e) {
      var t = e._i,
      n = e._f;
      return void 0 === e._pf && m(e),
      null === t ? J.invalid({
        nullInput: !0
      }) : ('string' == typeof t && (e._i = t = S().preparse(t)), J.isMoment(t) ? (e = s({
      }, t), e._d = new Date( + t._d)) : n ? d(n) ? F(e) : O(e) : G(e), new i(e))
    }
    function z(e, t) {
      J.fn[e] = J.fn[e + 's'] = function (e) {
        var i = this._isUTC ? 'UTC' : '';
        return null != e ? (this._d['set' + i + t](e), J.updateOffset(this), this) : this._d['get' + i + t]()
      }
    }
    function X(e, t) {
      J.duration.fn['as' + e] = function () {
        return + this / t
      }
    }
    for (var J, $, Z = Math.round, Q = 0, ee = 1, te = 2, ie = 3, ne = 4, se = 5, re = 6, oe = {
    }, ae = 'undefined' != typeof module && module.exports, de = /^\/?Date\((\-?\d+)/i, ce = /(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/, le = /^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/, ue = /(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g, he = /(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g, _e = /\d\d?/, fe = /\d{1,3}/, pe = /\d{3}/, ge = /\d{1,4}/, ve = /[+\-]?\d{1,6}/, me = /\d+/, Ee = /[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i, be = /Z|[\+\-]\d\d:?\d\d/i, ye = /T/i, ke = /[\+\-]?\d+(\.\d{1,3})?/, Se = /^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d:?\d\d|Z)?)?$/, xe = [
      'YYYY-MM-DD',
      'GGGG-[W]WW',
      'GGGG-[W]WW-E',
      'YYYY-DDD'
    ], Te = [
      ['HH:mm:ss.SSSS',
      /(T| )\d\d:\d\d:\d\d\.\d{1,3}/],
      [
        'HH:mm:ss',
        /(T| )\d\d:\d\d:\d\d/
      ],
      [
        'HH:mm',
        /(T| )\d\d:\d\d/
      ],
      [
        'HH',
        /(T| )\d\d/
      ]
    ], Ce = /([\+\-]|\d\d)/gi, Ae = 'Date|Hours|Minutes|Seconds|Milliseconds'.split('|'), we = {
      Milliseconds: 1,
      Seconds: 1000,
      Minutes: 60000,
      Hours: 3600000,
      Days: 86400000,
      Months: 2592000000,
      Years: 31536000000
    }, Ie = {
      ms: 'millisecond',
      s: 'second',
      m: 'minute',
      h: 'hour',
      d: 'day',
      D: 'date',
      w: 'week',
      W: 'isoWeek',
      M: 'month',
      y: 'year',
      DDD: 'dayOfYear',
      e: 'weekday',
      E: 'isoWeekday',
      gg: 'weekYear',
      GG: 'isoWeekYear'
    }, Le = {
      dayofyear: 'dayOfYear',
      isoweekday: 'isoWeekday',
      isoweek: 'isoWeek',
      weekyear: 'weekYear',
      isoweekyear: 'isoWeekYear'
    }, Re = {
    }, Pe = 'DDD w W M D d'.split(' '), De = 'M D H h m s w W'.split(' '), Oe = {
      M: function () {
        return this.month() + 1
      },
      MMM: function (e) {
        return this.lang().monthsShort(this, e)
      },
      MMMM: function (e) {
        return this.lang().months(this, e)
      },
      D: function () {
        return this.date()
      },
      DDD: function () {
        return this.dayOfYear()
      },
      d: function () {
        return this.day()
      },
      dd: function (e) {
        return this.lang().weekdaysMin(this, e)
      },
      ddd: function (e) {
        return this.lang().weekdaysShort(this, e)
      },
      dddd: function (e) {
        return this.lang().weekdays(this, e)
      },
      w: function () {
        return this.week()
      },
      W: function () {
        return this.isoWeek()
      },
      YY: function () {
        return o(this.year() % 100, 2)
      },
      YYYY: function () {
        return o(this.year(), 4)
      },
      YYYYY: function () {
        return o(this.year(), 5)
      },
      gg: function () {
        return o(this.weekYear() % 100, 2)
      },
      gggg: function () {
        return this.weekYear()
      },
      ggggg: function () {
        return o(this.weekYear(), 5)
      },
      GG: function () {
        return o(this.isoWeekYear() % 100, 2)
      },
      GGGG: function () {
        return this.isoWeekYear()
      },
      GGGGG: function () {
        return o(this.isoWeekYear(), 5)
      },
      e: function () {
        return this.weekday()
      },
      E: function () {
        return this.isoWeekday()
      },
      a: function () {
        return this.lang().meridiem(this.hours(), this.minutes(), !0)
      },
      A: function () {
        return this.lang().meridiem(this.hours(), this.minutes(), !1)
      },
      H: function () {
        return this.hours()
      },
      h: function () {
        return this.hours() % 12 || 12
      },
      m: function () {
        return this.minutes()
      },
      s: function () {
        return this.seconds()
      },
      S: function () {
        return _(this.milliseconds() / 100)
      },
      SS: function () {
        return o(_(this.milliseconds() / 10), 2)
      },
      SSS: function () {
        return o(this.milliseconds(), 3)
      },
      SSSS: function () {
        return o(this.milliseconds(), 3)
      },
      Z: function () {
        var e = - this.zone(),
        t = '+';
        return e < 0 && (e = - e, t = '-'),
        t + o(_(e / 60), 2) + ':' + o(_(e) % 60, 2)
      },
      ZZ: function () {
        var e = - this.zone(),
        t = '+';
        return e < 0 && (e = - e, t = '-'),
        t + o(_(10 * e / 6), 4)
      },
      z: function () {
        return this.zoneAbbr()
      },
      zz: function () {
        return this.zoneName()
      },
      X: function () {
        return this.unix()
      }
    }, Me = [
      'months',
      'monthsShort',
      'weekdays',
      'weekdaysShort',
      'weekdaysMin'
    ]; Pe.length; ) $ = Pe.pop(),
    Oe[$ + 'o'] = function (e, t) {
      return function (i) {
        return this.lang().ordinal(e.call(this, i), t)
      }
    }(Oe[$], $);
    for (; De.length; ) $ = De.pop(),
    Oe[$ + $] = e(Oe[$], 2);
    for (Oe.DDDD = e(Oe.DDD, 3), s(t.prototype, {
      set: function (e) {
        var t,
        i;
        for (i in e) t = e[i],
        'function' == typeof t ? this[i] = t : this['_' + i] = t
      },
      _months: 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_'),
      months: function (e) {
        return this._months[e.month()]
      },
      _monthsShort: 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_'),
      monthsShort: function (e) {
        return this._monthsShort[e.month()]
      },
      monthsParse: function (e) {
        var t,
        i,
        n;
        for (this._monthsParse || (this._monthsParse = [
        ]), t = 0; t < 12; t++) if (this._monthsParse[t] || (i = J.utc([2000,
        t]), n = '^' + this.months(i, '') + '|^' + this.monthsShort(i, ''), this._monthsParse[t] = new RegExp(n.replace('.', ''), 'i')), this._monthsParse[t].test(e)) return t
      },
      _weekdays: 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_'),
      weekdays: function (e) {
        return this._weekdays[e.day()]
      },
      _weekdaysShort: 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_'),
      weekdaysShort: function (e) {
        return this._weekdaysShort[e.day()]
      },
      _weekdaysMin: 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_'),
      weekdaysMin: function (e) {
        return this._weekdaysMin[e.day()]
      },
      weekdaysParse: function (e) {
        var t,
        i,
        n;
        for (this._weekdaysParse || (this._weekdaysParse = [
        ]), t = 0; t < 7; t++) if (this._weekdaysParse[t] || (i = J([2000,
        1]).day(t), n = '^' + this.weekdays(i, '') + '|^' + this.weekdaysShort(i, '') + '|^' + this.weekdaysMin(i, ''), this._weekdaysParse[t] = new RegExp(n.replace('.', ''), 'i')), this._weekdaysParse[t].test(e)) return t
      },
      _longDateFormat: {
        LT: 'h:mm A',
        L: 'MM/DD/YYYY',
        LL: 'MMMM D YYYY',
        LLL: 'MMMM D YYYY LT',
        LLLL: 'dddd, MMMM D YYYY LT'
      },
      longDateFormat: function (e) {
        var t = this._longDateFormat[e];
        return !t && this._longDateFormat[e.toUpperCase()] && (t = this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g, function (e) {
          return e.slice(1)
        }), this._longDateFormat[e] = t),
        t
      },
      isPM: function (e) {
        return 'p' === (e + '').toLowerCase().charAt(0)
      },
      _meridiemParse: /[ap]\.?m?\.?/i,
      meridiem: function (e, t, i) {
        return e > 11 ? i ? 'pm' : 'PM' : i ? 'am' : 'AM'
      },
      _calendar: {
        sameDay: '[Today at] LT',
        nextDay: '[Tomorrow at] LT',
        nextWeek: 'dddd [at] LT',
        lastDay: '[Yesterday at] LT',
        lastWeek: '[Last] dddd [at] LT',
        sameElse: 'L'
      },
      calendar: function (e, t) {
        var i = this._calendar[e];
        return 'function' == typeof i ? i.apply(t) : i
      },
      _relativeTime: {
        future: 'in %s',
        past: '%s ago',
        s: 'a few seconds',
        m: 'a minute',
        mm: '%d minutes',
        h: 'an hour',
        hh: '%d hours',
        d: 'a day',
        dd: '%d days',
        M: 'a month',
        MM: '%d months',
        y: 'a year',
        yy: '%d years'
      },
      relativeTime: function (e, t, i, n) {
        var s = this._relativeTime[i];
        return 'function' == typeof s ? s(e, t, i, n) : s.replace(/%d/i, e)
      },
      pastFuture: function (e, t) {
        var i = this._relativeTime[e > 0 ? 'future' : 'past'];
        return 'function' == typeof i ? i(t) : i.replace(/%s/i, t)
      },
      ordinal: function (e) {
        return this._ordinal.replace('%d', e)
      },
      _ordinal: '%d',
      preparse: function (e) {
        return e
      },
      postformat: function (e) {
        return e
      },
      week: function (e) {
        return W(e, this._week.dow, this._week.doy).week
      },
      _week: {
        dow: 0,
        doy: 6
      },
      _invalidDate: 'Invalid date',
      invalidDate: function () {
        return this._invalidDate
      }
    }), J = function (e, t, i, n) {
      return 'boolean' == typeof i && (n = i, i = void 0),
      q({
        _i: e,
        _f: t,
        _l: i,
        _strict: n,
        _isUTC: !1
      })
    }, J.utc = function (e, t, i, n) {
      return 'boolean' == typeof i && (n = i, i = void 0),
      q({
        _useUTC: !0,
        _isUTC: !0,
        _l: i,
        _i: e,
        _f: t,
        _strict: n
      }).utc()
    }, J.unix = function (e) {
      return J(1000 * e)
    }, J.duration = function (e, t) {
      var i,
      s,
      r,
      o = J.isDuration(e),
      a = 'number' == typeof e,
      d = o ? e._input : a ? {
      }
       : e,
      c = null;
      return a ? t ? d[t] = e : d.milliseconds = e : (c = ce.exec(e)) ? (i = '-' === c[1] ? - 1 : 1, d = {
        y: 0,
        d: _(c[te]) * i,
        h: _(c[ie]) * i,
        m: _(c[ne]) * i,
        s: _(c[se]) * i,
        ms: _(c[re]) * i
      }) : (c = le.exec(e)) && (i = '-' === c[1] ? - 1 : 1, r = function (e) {
        var t = e && parseFloat(e.replace(',', '.'));
        return (isNaN(t) ? 0 : t) * i
      }, d = {
        y: r(c[2]),
        M: r(c[3]),
        d: r(c[4]),
        h: r(c[5]),
        m: r(c[6]),
        s: r(c[7]),
        w: r(c[8])
      }),
      s = new n(d),
      o && e.hasOwnProperty('_lang') && (s._lang = e._lang),
      s
    }, J.version = '2.4.0', J.defaultFormat = 'YYYY-MM-DDTHH:mm:ssZ', J.updateOffset = function () {
    }, J.lang = function (e, t) {
      var i;
      return e ? (t ? y(b(e), t) : null === t ? (k(e), e = 'en') : oe[e] || S(e), i = J.duration.fn._lang = J.fn._lang = S(e), i._abbr) : J.fn._lang._abbr
    }, J.langData = function (e) {
      return e && e._lang && e._lang._abbr && (e = e._lang._abbr),
      S(e)
    }, J.isMoment = function (e) {
      return e instanceof i
    }, J.isDuration = function (e) {
      return e instanceof n
    }, $ = Me.length - 1; $ >= 0; --$) !function (e) {
      var t,
      i;
      if (0 === e.indexOf('week')) t = 7,
      i = 'day';
       else {
        if (0 !== e.indexOf('month')) return;
        t = 12,
        i = 'month'
      }
      J[e] = function (n, s) {
        var r,
        o,
        a = J.fn._lang[e],
        d = [
        ];
        if ('number' == typeof n && (s = n, n = void 0), o = function (e) {
          var t = J().utc().set(i, e);
          return a.call(J.fn._lang, t, n || '')
        }, null != s) return o(s);
        for (r = 0; r < t; r++) d.push(o(r));
        return d
      }
    }(Me[$]);
    for (J.normalizeUnits = function (e) {
      return u(e)
    }, J.invalid = function (e) {
      var t = J.utc(NaN);
      return null != e ? s(t._pf, e) : t._pf.userInvalidated = !0,
      t
    }, J.parseZone = function (e) {
      return J(e).parseZone()
    }, s(J.fn = i.prototype, {
      clone: function () {
        return J(this)
      },
      valueOf: function () {
        return + this._d + 60000 * (this._offset || 0)
      },
      unix: function () {
        return Math.floor( + this / 1000)
      },
      toString: function () {
        return this.clone().lang('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ')
      },
      toDate: function () {
        return this._offset ? new Date( + this) : this._d
      },
      toISOString: function () {
        return C(J(this).utc(), 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]')
      },
      toArray: function () {
        var e = this;
        return [e.year(),
        e.month(),
        e.date(),
        e.hours(),
        e.minutes(),
        e.seconds(),
        e.milliseconds()]
      },
      isValid: function () {
        return E(this)
      },
      isDSTShifted: function () {
        return !!this._a && (this.isValid() && l(this._a, (this._isUTC ? J.utc(this._a) : J(this._a)).toArray()) > 0)
      },
      parsingFlags: function () {
        return s({
        }, this._pf)
      },
      invalidAt: function () {
        return this._pf.overflow
      },
      utc: function () {
        return this.zone(0)
      },
      local: function () {
        return this.zone(0),
        this._isUTC = !1,
        this
      },
      format: function (e) {
        var t = C(this, e || J.defaultFormat);
        return this.lang().postformat(t)
      },
      add: function (e, t) {
        var i;
        return i = 'string' == typeof e ? J.duration( + t, e) : J.duration(e, t),
        a(this, i, 1),
        this
      },
      subtract: function (e, t) {
        var i;
        return i = 'string' == typeof e ? J.duration( + t, e) : J.duration(e, t),
        a(this, i, - 1),
        this
      },
      diff: function (e, t, i) {
        var n,
        s,
        o = this._isUTC ? J(e).zone(this._offset || 0) : J(e).local(),
        a = 60000 * (this.zone() - o.zone());
        return t = u(t),
        'year' === t || 'month' === t ? (n = 43200000 * (this.daysInMonth() + o.daysInMonth()), s = 12 * (this.year() - o.year()) + (this.month() - o.month()), s += (this - J(this).startOf('month') - (o - J(o).startOf('month'))) / n, s -= 60000 * (this.zone() - J(this).startOf('month').zone() - (o.zone() - J(o).startOf('month').zone())) / n, 'year' === t && (s /= 12)) : (n = this - o, s = 'second' === t ? n / 1000 : 'minute' === t ? n / 60000 : 'hour' === t ? n / 3600000 : 'day' === t ? (n - a) / 86400000 : 'week' === t ? (n - a) / 604800000 : n),
        i ? s : r(s)
      },
      from: function (e, t) {
        return J.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)
      },
      fromNow: function (e) {
        return this.from(J(), e)
      },
      calendar: function () {
        var e = this.diff(J().zone(this.zone()).startOf('day'), 'days', !0),
        t = e < - 6 ? 'sameElse' : e < - 1 ? 'lastWeek' : e < 0 ? 'lastDay' : e < 1 ? 'sameDay' : e < 2 ? 'nextDay' : e < 7 ? 'nextWeek' : 'sameElse';
        return this.format(this.lang().calendar(t, this))
      },
      isLeapYear: function () {
        return g(this.year())
      },
      isDST: function () {
        return this.zone() < this.clone().month(0).zone() || this.zone() < this.clone().month(5).zone()
      },
      day: function (e) {
        var t = this._isUTC ? this._d.getUTCDay() : this._d.getDay();
        return null != e ? (e = H(e, this.lang()), this.add({
          d: e - t
        })) : t
      },
      month: function (e) {
        var t,
        i = this._isUTC ? 'UTC' : '';
        return null != e ? 'string' == typeof e && 'number' != typeof (e = this.lang().monthsParse(e)) ? this : (t = this.date(), this.date(1), this._d['set' + i + 'Month'](e), this.date(Math.min(t, this.daysInMonth())), J.updateOffset(this), this) : this._d['get' + i + 'Month']()
      },
      startOf: function (e) {
        switch (e = u(e)) {
          case 'year':
            this.month(0);
          case 'month':
            this.date(1);
          case 'week':
          case 'isoWeek':
          case 'day':
            this.hours(0);
          case 'hour':
            this.minutes(0);
          case 'minute':
            this.seconds(0);
          case 'second':
            this.milliseconds(0)
        }
        return 'week' === e ? this.weekday(0) : 'isoWeek' === e && this.isoWeekday(1),
        this
      },
      endOf: function (e) {
        return e = u(e),
        this.startOf(e).add('isoWeek' === e ? 'week' : e, 1).subtract('ms', 1)
      },
      isAfter: function (e, t) {
        return t = void 0 !== t ? t : 'millisecond',
        + this.clone().startOf(t) > + J(e).startOf(t)
      },
      isBefore: function (e, t) {
        return t = void 0 !== t ? t : 'millisecond',
        + this.clone().startOf(t) < + J(e).startOf(t)
      },
      isSame: function (e, t) {
        return t = void 0 !== t ? t : 'millisecond',
        + this.clone().startOf(t) == + J(e).startOf(t)
      },
      min: function (e) {
        return e = J.apply(null, arguments),
        e < this ? this : e
      },
      max: function (e) {
        return e = J.apply(null, arguments),
        e > this ? this : e
      },
      zone: function (e) {
        var t = this._offset || 0;
        return null == e ? this._isUTC ? t : this._d.getTimezoneOffset() : ('string' == typeof e && (e = I(e)), Math.abs(e) < 16 && (e *= 60), this._offset = e, this._isUTC = !0, t !== e && a(this, J.duration(t - e, 'm'), 1, !0), this)
      },
      zoneAbbr: function () {
        return this._isUTC ? 'UTC' : ''
      },
      zoneName: function () {
        return this._isUTC ? 'Coordinated Universal Time' : ''
      },
      parseZone: function () {
        return 'string' == typeof this._i && this.zone(this._i),
        this
      },
      hasAlignedHourOffset: function (e) {
        return e = e ? J(e).zone() : 0,
        (this.zone() - e) % 60 == 0
      },
      daysInMonth: function () {
        return f(this.year(), this.month())
      },
      dayOfYear: function (e) {
        var t = Z((J(this).startOf('day') - J(this).startOf('year')) / 86400000) + 1;
        return null == e ? t : this.add('d', e - t)
      },
      weekYear: function (e) {
        var t = W(this, this.lang()._week.dow, this.lang()._week.doy).year;
        return null == e ? t : this.add('y', e - t)
      },
      isoWeekYear: function (e) {
        var t = W(this, 1, 4).year;
        return null == e ? t : this.add('y', e - t)
      },
      week: function (e) {
        var t = this.lang().week(this);
        return null == e ? t : this.add('d', 7 * (e - t))
      },
      isoWeek: function (e) {
        var t = W(this, 1, 4).week;
        return null == e ? t : this.add('d', 7 * (e - t))
      },
      weekday: function (e) {
        var t = (this.day() + 7 - this.lang()._week.dow) % 7;
        return null == e ? t : this.add('d', e - t)
      },
      isoWeekday: function (e) {
        return null == e ? this.day() || 7 : this.day(this.day() % 7 ? e : e - 7)
      },
      get: function (e) {
        return e = u(e),
        this[e]()
      },
      set: function (e, t) {
        return e = u(e),
        'function' == typeof this[e] && this[e](t),
        this
      },
      lang: function (e) {
        return void 0 === e ? this._lang : (this._lang = S(e), this)
      }
    }), $ = 0; $ < Ae.length; $++) z(Ae[$].toLowerCase().replace(/s$/, ''), Ae[$]);
    z('year', 'FullYear'),
    J.fn.days = J.fn.day,
    J.fn.months = J.fn.month,
    J.fn.weeks = J.fn.week,
    J.fn.isoWeeks = J.fn.isoWeek,
    J.fn.toJSON = J.fn.toISOString,
    s(J.duration.fn = n.prototype, {
      _bubble: function () {
        var e,
        t,
        i,
        n,
        s = this._milliseconds,
        o = this._days,
        a = this._months,
        d = this._data;
        d.milliseconds = s % 1000,
        e = r(s / 1000),
        d.seconds = e % 60,
        t = r(e / 60),
        d.minutes = t % 60,
        i = r(t / 60),
        d.hours = i % 24,
        o += r(i / 24),
        d.days = o % 30,
        a += r(o / 30),
        d.months = a % 12,
        n = r(a / 12),
        d.years = n
      },
      weeks: function () {
        return r(this.days() / 7)
      },
      valueOf: function () {
        return this._milliseconds + 86400000 * this._days + this._months % 12 * 2592000000 + 31536000000 * _(this._months / 12)
      },
      humanize: function (e) {
        var t = + this,
        i = Y(t, !e, this.lang());
        return e && (i = this.lang().pastFuture(t, i)),
        this.lang().postformat(i)
      },
      add: function (e, t) {
        var i = J.duration(e, t);
        return this._milliseconds += i._milliseconds,
        this._days += i._days,
        this._months += i._months,
        this._bubble(),
        this
      },
      subtract: function (e, t) {
        var i = J.duration(e, t);
        return this._milliseconds -= i._milliseconds,
        this._days -= i._days,
        this._months -= i._months,
        this._bubble(),
        this
      },
      get: function (e) {
        return e = u(e),
        this[e.toLowerCase() + 's']()
      },
      as: function (e) {
        return e = u(e),
        this['as' + e.charAt(0).toUpperCase() + e.slice(1) + 's']()
      },
      lang: J.fn.lang,
      toIsoString: function () {
        var e = Math.abs(this.years()),
        t = Math.abs(this.months()),
        i = Math.abs(this.days()),
        n = Math.abs(this.hours()),
        s = Math.abs(this.minutes()),
        r = Math.abs(this.seconds() + this.milliseconds() / 1000);
        return this.asSeconds() ? (this.asSeconds() < 0 ? '-' : '') + 'P' + (e ? e + 'Y' : '') + (t ? t + 'M' : '') + (i ? i + 'D' : '') + (n || s || r ? 'T' : '') + (n ? n + 'H' : '') + (s ? s + 'M' : '') + (r ? r + 'S' : '') : 'P0D'
      }
    });
    for ($ in we) we.hasOwnProperty($) && (X($, we[$]), function (e) {
      J.duration.fn[e] = function () {
        return this._data[e]
      }
    }($.toLowerCase()));
    return X('Weeks', 604800000),
    J.duration.fn.asMonths = function () {
      return ( + this - 31536000000 * this.years()) / 2592000000 + 12 * this.years()
    },
    J.lang('en', {
      ordinal: function (e) {
        var t = e % 10;
        return e + (1 === _(e % 100 / 10) ? 'th' : 1 === t ? 'st' : 2 === t ? 'nd' : 3 === t ? 'rd' : 'th')
      }
    }),
    function (e) {
      !function (e) {
        e.lang('en-au', {
          months: 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_'),
          monthsShort: 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_'),
          weekdays: 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_'),
          weekdaysShort: 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_'),
          weekdaysMin: 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_'),
          longDateFormat: {
            LT: 'h:mm A',
            L: 'DD/MM/YYYY',
            LL: 'D MMMM YYYY',
            LLL: 'D MMMM YYYY LT',
            LLLL: 'dddd, D MMMM YYYY LT'
          },
          calendar: {
            sameDay: '[Today at] LT',
            nextDay: '[Tomorrow at] LT',
            nextWeek: 'dddd [at] LT',
            lastDay: '[Yesterday at] LT',
            lastWeek: '[Last] dddd [at] LT',
            sameElse: 'L'
          },
          relativeTime: {
            future: 'in %s',
            past: '%s ago',
            s: 'a few seconds',
            m: 'a minute',
            mm: '%d minutes',
            h: 'an hour',
            hh: '%d hours',
            d: 'a day',
            dd: '%d days',
            M: 'a month',
            MM: '%d months',
            y: 'a year',
            yy: '%d years'
          },
          ordinal: function (e) {
            var t = e % 10;
            return e + (1 == ~~(e % 100 / 10) ? 'th' : 1 === t ? 'st' : 2 === t ? 'nd' : 3 === t ? 'rd' : 'th')
          },
          week: {
            dow: 1,
            doy: 4
          }
        })
      }(J)
    }(),
    function (e) {
      !function (e) {
        e.lang('en-ca', {
          months: 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_'),
          monthsShort: 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_'),
          weekdays: 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_'),
          weekdaysShort: 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_'),
          weekdaysMin: 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_'),
          longDateFormat: {
            LT: 'h:mm A',
            L: 'YYYY-MM-DD',
            LL: 'D MMMM, YYYY',
            LLL: 'D MMMM, YYYY LT',
            LLLL: 'dddd, D MMMM, YYYY LT'
          },
          calendar: {
            sameDay: '[Today at] LT',
            nextDay: '[Tomorrow at] LT',
            nextWeek: 'dddd [at] LT',
            lastDay: '[Yesterday at] LT',
            lastWeek: '[Last] dddd [at] LT',
            sameElse: 'L'
          },
          relativeTime: {
            future: 'in %s',
            past: '%s ago',
            s: 'a few seconds',
            m: 'a minute',
            mm: '%d minutes',
            h: 'an hour',
            hh: '%d hours',
            d: 'a day',
            dd: '%d days',
            M: 'a month',
            MM: '%d months',
            y: 'a year',
            yy: '%d years'
          },
          ordinal: function (e) {
            var t = e % 10;
            return e + (1 == ~~(e % 100 / 10) ? 'th' : 1 === t ? 'st' : 2 === t ? 'nd' : 3 === t ? 'rd' : 'th')
          }
        })
      }(J)
    }(),
    function (e) {
      !function (e) {
        e.lang('en-gb', {
          months: 'January_February_March_April_May_June_July_August_September_October_November_December'.split('_'),
          monthsShort: 'Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_'),
          weekdays: 'Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_'),
          weekdaysShort: 'Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_'),
          weekdaysMin: 'Su_Mo_Tu_We_Th_Fr_Sa'.split('_'),
          longDateFormat: {
            LT: 'HH:mm',
            L: 'DD/MM/YYYY',
            LL: 'D MMMM YYYY',
            LLL: 'D MMMM YYYY LT',
            LLLL: 'dddd, D MMMM YYYY LT'
          },
          calendar: {
            sameDay: '[Today at] LT',
            nextDay: '[Tomorrow at] LT',
            nextWeek: 'dddd [at] LT',
            lastDay: '[Yesterday at] LT',
            lastWeek: '[Last] dddd [at] LT',
            sameElse: 'L'
          },
          relativeTime: {
            future: 'in %s',
            past: '%s ago',
            s: 'a few seconds',
            m: 'a minute',
            mm: '%d minutes',
            h: 'an hour',
            hh: '%d hours',
            d: 'a day',
            dd: '%d days',
            M: 'a month',
            MM: '%d months',
            y: 'a year',
            yy: '%d years'
          },
          ordinal: function (e) {
            var t = e % 10;
            return e + (1 == ~~(e % 100 / 10) ? 'th' : 1 === t ? 'st' : 2 === t ? 'nd' : 3 === t ? 'rd' : 'th')
          },
          week: {
            dow: 1,
            doy: 4
          }
        })
      }(J)
    }(),
    function (e) {
      !function (e) {
        e.lang('fr', {
          months: 'janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre'.split('_'),
          monthsShort: 'janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.'.split('_'),
          weekdays: 'dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi'.split('_'),
          weekdaysShort: 'dim._lun._mar._mer._jeu._ven._sam.'.split('_'),
          weekdaysMin: 'Di_Lu_Ma_Me_Je_Ve_Sa'.split('_'),
          longDateFormat: {
            LT: 'HH:mm',
            L: 'DD/MM/YYYY',
            LL: 'D MMMM YYYY',
            LLL: 'D MMMM YYYY LT',
            LLLL: 'dddd D MMMM YYYY LT'
          },
          calendar: {
            sameDay: '[Aujourd\'hui  ] LT',
            nextDay: '[Demain  ] LT',
            nextWeek: 'dddd [ ] LT',
            lastDay: '[Hier  ] LT',
            lastWeek: 'dddd [dernier  ] LT',
            sameElse: 'L'
          },
          relativeTime: {
            future: 'dans %s',
            past: 'il y a %s',
            s: 'quelques secondes',
            m: 'une minute',
            mm: '%d minutes',
            h: 'une heure',
            hh: '%d heures',
            d: 'un jour',
            dd: '%d jours',
            M: 'un mois',
            MM: '%d mois',
            y: 'un an',
            yy: '%d ans'
          },
          ordinal: function (e) {
            return e + (1 === e ? 'er' : '')
          },
          week: {
            dow: 1,
            doy: 4
          }
        })
      }(J)
    }(),
    J.lang('en'),
    J
  }),
  define('vdk-appGrid/Session', [
    'xdk-base/ajax',
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/device',
    'xdk-base/MemCache',
    'xdk-base/promise',
    'xdk-base/util',
    'vdk-lib-base64/base64',
    'vdk-lib-moment/moment',
    'vdk/errors/VIAError'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    var l,
    u = t.create({
      singleton: function () {
        if (!l) {
          var e = i.get('appgrid'),
          t = e.api,
          n = e.appKey,
          s = require('xdk-base/device'),
          r = s.id.getUniqueID();
          l = new u(t, n, r)
        }
        return l
      }
    }, {
      __sessionKey: null,
      __uuid: null,
      __sessionExpiration: null,
      getSessionKey: function () {
        if (this.__isSessionValid()) return r.resolve(this.__sessionKey);
        if (this.__getSessionPromise) return this.__getSessionPromise;
        var e = this.__baseURL + '/session',
        t = {
        };
        return t.requestHeaders = {
        },
        t.requestHeaders['X-Application-Key'] = this.__appKey,
        t.requestHeaders['X-User-Id'] = this.__uuid,
        this.__getSessionPromise = this.__sendRequest(e, t).then(o.bind(function (e) {
          var t = e.responseJSON || null;
          if (t && t.sessionKey && t.expiration) {
            if (this.__sessionKey = t.sessionKey, this.__sessionExpiration = d(t.expiration, 'YYYYMMDD HH:mm:SS Z').valueOf(), this.__sessionExpiration < (new Date).getTime()) throw new c(c.FACILITY.GENERAL, c.ERROR.INVALID, 'GetSession: Unable to get the correct expiration.');
            return this.__getSessionPromise = null,
            this.__sessionKey
          }
          throw this.__getSessionPromise = null,
          new c(c.FACILITY.GENERAL, c.ERROR.INVALID, 'GetSession: Unable to get the session. Cannot get the sessionKey or expiration.')
        }, this), o.bind(function (e) {
          throw this.__getSessionPromise = null,
          new c(c.FACILITY.GENERAL, c.ERROR.NOT_FOUND, 'GetSession: Unable to get the session.', e)
        }, this)),
        this.__getSessionPromise
      },
      sendGetRequest: function (e, t, i) {
        - 1 === e.indexOf('http://') && (e = this.__baseURL + e),
        t = t || {
        },
        t.parameters = t.parameters || '';
        var n = o.bind(function () {
          return this.getSessionKey().then(o.bind(function (i) {
            return this.__sendRequest(e, t, i)
          }, this))
        }, this);
        if (o.isUndefined(i)) return n();
        var s = this.__generateCacheKey(e, t.parameters),
        a = this.__memCache,
        d = a.get(s);
        return void 0 === d || a.isExpired(s) ? void 0 !== d ? this.getSessionKey().then(o.bind(function (n) {
          return t = o.extend(t, {
            requestHeaders: {
              'If-Modified-Since': new Date(a.getTimestamp(s)).toUTCString()
            }
          }),
          this.__sendRequest(e, t, n).then(function (e) {
            return 304 === e.status ? (a.renewTimestamp(s), d) : 200 === e.status ? (a.set(s, e, i), e) : void 0
          })
        }, this)) : n().then(function (e) {
          return a.set(s, e, i),
          e
        }) : r.resolve(d)
      },
      sendPostRequest: function (e, t) {
        return - 1 === e.indexOf('http://') && (e = this.__baseURL + e),
        t = t || {
        },
        t.method = 'post',
        t.requestHeaders = t.requestHeaders || {
          'content-type': 'application/json'
        },
        this.getSessionKey().then(o.bind(function (i) {
          return this.__sendRequest(e, t, i)
        }, this))
      },
      sendDeleteRequest: function (e, t) {
        return - 1 === e.indexOf('http://') && (e = this.__baseURL + e),
        t = t || {
        },
        t.method = 'delete',
        this.getSessionKey().then(o.bind(function (i) {
          return this.__sendRequest(e, t, i)
        }, this))
      },
      __sendRequest: function (t, i, n) {
        return i = i || {
        },
        i.requestHeaders = i.requestHeaders || {
        },
        n && (i.requestHeaders['X-Session'] = n),
        e.request(t, i)
      },
      __isSessionValid: function () {
        return this.__sessionKey && this.__sessionExpiration > (new Date).getTime() + 300000
      },
      __generateCacheKey: function (e, t, i) {
        var n = i ? '__body[' + i.toString() + ']' : '',
        s = o.isString(t) ? t : o.toQueryString(t),
        r = e + '?' + s + '&' + n;
        return window.btoa ? window.btoa(r) : a.encode(r)
      },
      init: function (e, t, i) {
        this.__baseURL = e,
        this.__appKey = t,
        this.__uuid = i,
        this.__memCache = new s({
          gc: s.GC.EXCEED_LIMIT
        })
      },
      getEndPoint: function () {
        return this.__baseURL
      }
    });
    return u
  }),
  define('vdk-appGrid/interface/AnalyticsService', [
    'xdk-base/Interface'
  ], function (e) {
    return e.create('AnalyticsService', {
      applicationStart: [
      ],
      applicationStop: [
      ]
    })
  }),
  define('vdk-appGrid/interface/ConfigurationService', [
    'xdk-base/Interface'
  ], function (e) {
    var t = e.create('ConfigurationService', {
      getConfig: [
        'key',
        'defaultValue'
      ],
      getConfigs: [
        'keys',
        'defaultValues'
      ],
      getAllConfigs: [
      ]
    });
    return t.Event = {
      ConfigurationUpdated: 'ConfigurationServiceEvent:ConfigurationUpdated'
    },
    t
  }),
  define('vdk-appGrid/interface/LogService', [
    'xdk-base/Interface'
  ], function (e) {
    return e.create('LogService', {
      getLevel: [
      ],
      debug: [
        'code',
        'msg',
        'dimensions'
      ],
      warn: [
        'code',
        'msg',
        'dimensions'
      ],
      error: [
        'code',
        'msg',
        'dimensions'
      ]
    })
  }),
  define('vdk-appGrid/interface/ResourceService', [
    'xdk-base/Interface'
  ], function (e) {
    return e.create('ResourceService', {
      getResource: [
        'key'
      ],
      getAllResources: [
      ]
    })
  }),
  define('vdk-appGrid/interface/StatusService', [
    'xdk-base/Interface'
  ], function (e) {
    var t = e.create('StatusService', {
      getStatus: [
      ],
      getMessage: [
      ]
    });
    return t.Event = {
      MaintenanceStarted: 'StatusServiceEvent:MaintenanceStarted',
      MaintenanceEnded: 'StatusServiceEvent:MaintenanceEnded'
    },
    t
  }),
  define('vdk-appGrid/interface/UserSettingsService', [
    'xdk-base/Interface'
  ], function (e) {
    return e.create('UserSettingsService', {
      getSetting: [
        'key',
        'defaultValue'
      ],
      getSharedSetting: [
        'key',
        'defaultValue'
      ],
      getSettings: [
        'keys',
        'defaultValues'
      ],
      getSharedSettings: [
        'keys',
        'defaultValues'
      ],
      getAllSettings: [
      ],
      getAllSharedSettings: [
      ],
      setSetting: [
        'key',
        'value'
      ],
      setSharedSetting: [
        'key',
        'value'
      ],
      setAllSettings: [
        'data'
      ],
      setAllSharedSettings: [
        'data'
      ],
      setUUID: [
        'uuid'
      ]
    })
  }),
  define('vdk-appGrid/AppGridService', [
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/MemCache',
    'xdk-base/promise',
    'xdk-base/util',
    'vdk-appGrid/LocalSession',
    'vdk-appGrid/Session',
    'vdk-appGrid/interface/AnalyticsService',
    'vdk-appGrid/interface/ConfigurationService',
    'vdk-appGrid/interface/LogService',
    'vdk-appGrid/interface/ResourceService',
    'vdk-appGrid/interface/StatusService',
    'vdk-appGrid/interface/UserSettingsService',
    'vdk/errors/VIAError'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _) {
    var f,
    p = _.FACILITY,
    g = _.ERROR,
    v = e.create([a,
    d,
    c,
    l,
    u,
    h], {
      singleton: function () {
        return f || (f = new v),
        f
      }
    }, {
      __logLevels: [
        'off',
        'error',
        'warn',
        'debug'
      ],
      getStatus: function () {
        return this.__getSession().then(s.bind(function (e) {
          return e.sendGetRequest('/status').then(function (e) {
            if (e.responseJSON && e.responseJSON.status) return e.responseJSON.status;
            throw new _(p.STATUS_SERVICE, g.INVALID, 'Cannot get the status')
          }, function (e) {
            throw new _(p.STATUS_SERVICE, g.NETWORK, 'Cannot get the status', e)
          })
        }, this))
      },
      getMessage: function () {
        return this.__getSession().then(s.bind(function (e) {
          return e.sendGetRequest('/status').then(function (e) {
            if (e.responseJSON && e.responseJSON.message) return e.responseJSON.message;
            throw new _(p.STATUS_SERVICE, g.INVALID, 'Cannot get the message through status service')
          }, function (e) {
            throw new _(p.STATUS_SERVICE, g.NETWORK, 'Cannot get the message through status service', e)
          })
        }, this))
      },
      applicationStart: function () {
        return this.__sendApplicationEvent('START')
      },
      applicationStop: function () {
        return this.__sendApplicationEvent('QUIT')
      },
      getConfig: function (e, t) {
        var i = '/metadata/' + e;
        return this.__getSession().then(s.bind(function (s) {
          return s.sendGetRequest(i, null, 18000).then(function (i) {
            if (i.responseJSON && i.responseJSON[e]) return i.responseJSON[e];
            if (t) return t;
            throw new _(p.CONFIGURATION_SERVICE, _.ERROR.INVALID, 'cannot get the config value')
          }, function (e) {
            if (t) return n.resolve(t);
            throw new _(p.CONFIGURATION_SERVICE, _.ERROR.NETWORK, 'cannot get the config value', e)
          })
        }, this))
      },
      getConfigs: function (e, t) {
        var i = '/metadata/' + e.join(',');
        return this.__getSession().then(s.bind(function (e) {
          return e.sendGetRequest(i, null, 18000).then(function (e) {
            if (e.responseJSON) return t ? s.extend(t, e.responseJSON) : e.responseJSON;
            throw new _(p.CONFIGURATION_SERVICE, _.ERROR.INVALID, 'cannot get values of configs')
          }, function (e) {
            if (t) return n.resolve(t);
            throw new _(p.CONFIGURATION_SERVICE, _.ERROR.NETWORK, 'cannot get values of configs', e)
          })
        }, this))
      },
      getAllConfigs: function () {
        return this.__getSession().then(s.bind(function (e) {
          return e.sendGetRequest('/metadata', null, 18000).then(function (e) {
            if (e.responseJSON) return e.responseJSON;
            throw new _(p.CONFIGURATION_SERVICE, _.ERROR.INVALID, 'cannot get all configs')
          }, function (e) {
            throw new _(p.CONFIGURATION_SERVICE, _.ERROR.NETWORK, 'cannot get all configs', e)
          })
        }, this))
      },
      getResource: function (e) {
        return this.getAllResources().then(s.bind(function (t) {
          var i = t[e];
          if (i) return 0 === i.indexOf('/') ? this.__getSession().then(function (e) {
            return e.getEndPoint() + i
          }) : i;
          throw new _(p.CONFIGURATION_SERVICE, _.ERROR.INVALID, 'cannot get the requested resource')
        }, this), function (e) {
          throw new _(p.CONFIGURATION_SERVICE, _.ERROR.NETWORK, 'cannot get the requested resource', e)
        })
      },
      getAllResources: function () {
        if (this.__getAllResourcesPromise) return this.__getAllResourcesPromise;
        return this.__getSession().then(s.bind(function (e) {
          return this.__getAllResourcesPromise = e.sendGetRequest('/asset', null, 18000).then(function (e) {
            if (this.__getAllResourcesPromise = null, e.responseJSON) return e.responseJSON;
            throw new _(p.CONFIGURATION_SERVICE, _.ERROR.INVALID, 'cannot get all resources')
          }, function (e) {
            throw this.__getAllResourcesPromise = null,
            new _(p.CONFIGURATION_SERVICE, _.ERROR.NETWORK, 'cannot get all resources', e)
          }),
          this.__getAllResourcesPromise
        }, this))
      },
      getLevel: function () {
        if (this.__getLevelPromise) return this.__getLevelPromise;
        return this.__getLevelPromise = this.__getSession().then(s.bind(function (e) {
          return e.sendGetRequest('/application/log/level').then(s.bind(function (e) {
            if (this.__getLevelPromise = null, e.responseJSON && e.responseJSON.logLevel) return e.responseJSON.logLevel;
            throw new _(p.LOG_SERVICE, g.INVALID, 'Cannot get the log level')
          }, this), s.bind(function (e) {
            throw this.__getLevelPromise = null,
            new _(p.LOG_SERVICE, g.NETWORK, 'Cannot get the log level', e)
          }, this))
        }, this)),
        this.__getLevelPromise
      },
      debug: function (e, t, i) {
        this.__sendLog('debug', e, t, i)
      },
      warn: function (e, t, i) {
        this.__sendLog('warn', e, t, i)
      },
      error: function (e, t, i) {
        this.__sendLog('error', e, t, i)
      },
      getSetting: function (e, t) {
        return this.__getSettingHelper('user', e, t)
      },
      getSharedSetting: function (e, t) {
        return this.__getSettingHelper('group', e, t)
      },
      getSettings: function (e, t) {
        if (t && e.length !== s.keys(t).length) throw new _(p.USER_SETTINGS_SERVICE, g.INVALID, 'Default values number doesn\'t match the keys length.');
        return this.__getSettingsHelper('user', e, t)
      },
      getSharedSettings: function (e, t) {
        if (t && e.length !== s.keys(t).length) throw new _(p.USER_SETTINGS_SERVICE, g.INVALID, 'Default values number doesn\'t match the keys length.');
        return this.__getSettingsHelper('group', e, t)
      },
      getAllSettings: function () {
        return this.__getAllSettingsHelper('user')
      },
      getAllSharedSettings: function () {
        return this.__getAllSettingsHelper('group')
      },
      __getSettingHelper: function (e, t, i) {
        var s = '/' + e + '/' + this.__uuid + '/' + t;
        return this.__getSettingResponse(s).fail(function (e) {
          if (i) return n.resolve(i);
          if (e.transport && 404 === e.transport.status) return n.resolve(null);
          throw new _(p.USER_SETTINGS_SERVICE, g.NETWORK, 'cannot get requested setting', e)
        })
      },
      __getSettingsHelper: function (e, t, i) {
        var r = '/' + e + '/' + this.__uuid,
        o = t.length;
        return this.__getSettingResponse(r).then(function (e) {
          var n,
          r = e;
          for (var o in r) {
            n = !1;
            for (var a = 0, d = t.length; a < d; a++) if (o === t[a]) {
              n = !0;
              break
            }
            n || delete r[o]
          }
          return i ? s.extend(i, r) : r
        }, function (e) {
          if (i && o) return n.resolve(i);
          if (e.transport && 404 === e.transport.status) return n.resolve({
          });
          throw new _(p.USER_SETTINGS_SERVICE, g.NETWORK, 'cannot get requested setting', e)
        })
      },
      __getAllSettingsHelper: function (e) {
        var t = '/' + e + '/' + this.__uuid;
        return this.__getSettingResponse(t).fail(function (e) {
          if (e.transport && 404 === e.transport.status) return n.resolve({
          });
          throw new _(p.USER_SETTINGS_SERVICE, g.NETWORK, 'cannot get requested setting', e)
        })
      },
      __getSettingResponse: function (e) {
        return this.__getSession().then(function (t) {
          return t.sendGetRequest(e).then(function (e) {
            if (e.responseJSON && (s.isPlainObject(e.responseJSON) || s.isArray(e.responseJSON))) return e.responseJSON;
            if (e.responseText) return e.responseText;
            throw new _(p.USER_SETTINGS_SERVICE, g.INVALID, 'cannot get requested setting')
          })
        })
      },
      __setSettingHelper: function (e, t) {
        var i = {
        },
        n = s.keys(t),
        r = n.length,
        o = '/' + e + '/' + this.__uuid;
        return 1 === r ? (o += '/' + n[0], i.postBody = t[n[0]]) : i.postBody = JSON.stringify(t),
        this.__getSession().then(s.bind(function (e) {
          return e.sendPostRequest(o, i).then(function () {
          }, function (e) {
            throw new _(p.USER_SETTINGS_SERVICE, g.NETWORK, 'cannot set the setting', e)
          })
        }, this))
      },
      setSetting: function (e, t) {
        var i = {
        };
        return i[e] = t,
        this.__setSettingHelper('user', i)
      },
      setSharedSetting: function (e, t) {
        var i = {
        };
        return i[e] = t,
        this.__setSettingHelper('group', i)
      },
      setAllSettings: function (e) {
        return this.__setSettingHelper('user', e)
      },
      setAllSharedSettings: function (e) {
        return this.__setSettingHelper('group', e)
      },
      setUUID: function (e) {
        return this.__getSession().then(s.bind(function (t) {
          return t === r.singleton() ? n.reject(new _(_.FACILITY.GENERAL, _.ERROR.SERVICE_UNAVAILABLE, 'Cannot do this operation in offline mode.')) : e ? e !== this.__uuid ? void (this.__uuid = e) : n.reject(new _(_.FACILITY.GENERAL, _.ERROR.INVALID, 'The UUID is as same as the old one.')) : n.reject(new _(_.FACILITY.GENERAL, _.ERROR.INVALID, 'No UUID provided.'))
        }, this))
      },
      init: function () {
        var e = o.singleton();
        this.__getSession = s.bind(function () {
          return e.getSessionKey().then(s.bind(function () {
            return e
          }, this), s.bind(function () {
            return r.singleton()
          }, this))
        }, this)
      },
      __sendApplicationEvent: function (e) {
        var t = {
        },
        i = {
        };
        return t.eventType = e,
        i.postBody = JSON.stringify(t),
        this.__getSession().then(s.bind(function (e) {
          return e.sendPostRequest('/event/log', i).then(function () {
          }, function (e) {
            throw new _(p.ANALYTICS_SERVICE, g.NETWORK, 'Cannot send the application event', e)
          })
        }, this))
      },
      __sendLog: function (e, t, i, n) {
        if (!(t > - 1 && t < 100000 && - 1 === t.toString().indexOf('.'))) throw new _(p.LOG_SERVICE, g.INVALID, 'LogService: Invalid code.');
        var r = this.__logLevels;
        this.getLevel().then(s.bind(function (o) {
          if (s.indexOf(r, e) <= s.indexOf(r, o)) {
            var a = {
            },
            d = {
            },
            c = '/application/log/' + e;
            d.code = t,
            d.message = i,
            n && s.isObject(n) && s.extend(d, n),
            a.postBody = s.stringify(d),
            this.__getSession().then(function (e) {
              e.sendPostRequest(c, a)
            })
          }
        }, this), function (e) {
          throw new _(p.LOG_SERVICE, g.NETWORK, 'Cannot send the log', e)
        }).done()
      },
      getUUID: function () {
        return this.__uuid
      },
      getEntryById: function (e, t) {
        var i = '/entry/' + e;
        return t && (delete t.offset, delete t.size),
        this.__getEntriesHelper(i, t)
      },
      getAllEntries: function (e) {
        return e && (delete e.preview, delete e.at),
        this.__getEntriesHelper('/entries', e)
      },
      getEntriesByIds: function (e, t) {
        return t = t || {
        },
        t.id = e.toString(),
        this.__getEntriesHelper('/entries', t)
      },
      getEntriesByEntryTypeId: function (e, t) {
        return t = t || {
        },
        t.typeId = e,
        this.__getEntriesHelper('/entries', t)
      },
      __getEntriesHelper: function (e, t) {
        var i = '/content' + e,
        n = {
        };
        return t.offset && (n.offset = t.offset),
        t.size && (n.size = t.size),
        t.preview && (n.preview = t.preview),
        t.at && (n.at = t.at),
        t.id && (n.id = t.id),
        t.typeId && (n.typeId = t.typeId),
        this.__getSession().then(function (e) {
          return e.sendGetRequest(i, {
            parameters: n
          }, 18000).then(function (e) {
            if (e.responseJSON) return e.responseJSON;
            throw new _(p.CONTENT_SERVICE, _.ERROR.INVALID, 'cannot get the content')
          }, function (e) {
            throw new _(p.CONTENT_SERVICE, _.ERROR.NETWORK, 'cannot get the content', e)
          })
        })
      }
    });
    return v
  }),
  define('app/service/ServiceHolder', [
    'app/service/RemoteService',
    'vdk-appGrid/AppGridService',
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/config'
  ], function (e, t, i, n, s) {
    'use strict';
    var r,
    o;
    return r = i.create({
      singleton: function () {
        return o || (o = new r),
        o
      }
    }, {
      init: function () {
        this.__appConfigPlacement = s.get('app.config')
      },
      getConfigurationService: function () {
        return this.__configurationService ? this.__configurationService : 'APPGRID' === this.__appConfigPlacement ? (this.__configurationService = this.__getAppGridService(), this.__configurationService) : 'REMOTE' === this.__appConfigPlacement ? (this.__configurationService = e.singleton(), this.__configurationService) : null
      },
      getStatusService: function () {
        return 'APPGRID' === this.__appConfigPlacement ? (this.__statusService = this.__statusService || this.__getAppGridService(), this.__statusService) : null
      },
      getResourceService: function () {
        return 'APPGRID' === this.__appConfigPlacement ? (this.__resourceService = this.__resourceService || this.__getAppGridService(), this.__resourceService) : null
      },
      getLoggingService: function () {
        return 'APPGRID' === this.__appConfigPlacement ? (this.__loggingService = this.__loggingService || this.__getAppGridService(), this.__loggingService) : null
      },
      __getAppGridService: function () {
        return this.__appGridService = this.__appGridService || t.singleton(),
        this.__appGridService
      }
    })
  }),
  define('xdk-base/device/interface/Storage', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('Storage', {
      set: [
      ],
      get: [
        'key'
      ],
      unset: [
      ],
      clear: [
      ]
    })
  }),
  define('xdk-base/device/AbstractStorage', [
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/device/interface/Storage',
    'require'
  ], function (e, t, i, n) {
    'use strict';
    return e.createAbstract([i], {
    }, {
      _uniquePrefix: t.get('device.storage.prefix', 'AccedoXDK'),
      get: function (e) {
        return !1
      },
      clear: function () {
        var e,
        t = n('xdk-base/device'),
        i = t.id.__UUID_KEY;
        e = this.get(i),
        this._doClear(),
        this.set(i, e)
      }
    })
  }),
  define('xdk-base/device/shared/LocalStorage', [
    'xdk-base/class',
    'xdk-base/device/AbstractStorage',
    'xdk-base/console'
  ], function (e, t, i) {
    'use strict';
    return e.create(t, {
    }, {
      set: function (e, t) {
        i.log('using Localstorage'),
        localStorage.setItem(e, t)
      },
      get: function (e) {
        return localStorage.getItem(e)
      },
      unset: function (e) {
        localStorage.removeItem(e)
      },
      _doClear: function () {
        localStorage.clear()
      }
    })
  }),
  define('json', [
    'xdk-base/util',
    'xdk-base/QueryString'
  ], function (e, t) {
    'use strict';
    function i() {
      return new XMLHttpRequest
    }
    function n(e) {
      return readFile(e)
    }
    function s(t) {
      return e.parse(t)
    }
    function r(e) {
      return 0 === e.indexOf('empty:') || p.test(e)
    }
    function o(e, t, i, n) {
      if (n = n || {
      }, n.failover) return void e({
      });
      t(i)
    }
    function a(e, t, i, n) {
      try {
        t(s(e))
      } catch (e) {
        o(t, i, e, n)
      }
    }
    function d(e, t) {
      return p.test(e) ? e : t.toUrl(e)
    }
    function c(t) {
      var i,
      n = t.split(g);
      return 1 === n.length ? {
        id: t,
        failover: !1,
        waitSeconds: m
      }
       : (i = l(n[0]), e.extend({
        id: n[1]
      }, i))
    }
    function l(e) {
      var i = t.parse(e);
      return i.failover = 'true' === i.failover,
      i.waitSeconds = parseInt(i.waitSeconds, 10),
      isNaN(i.waitSeconds) && (i.waitSeconds = m),
      i
    }
    function u(e, t, n, s) {
      var r = i();
      r.onload = r.onreadystatechange = function () {
        if (4 === r.readyState) {
          r.onload = r.onreadystatechange = null;
          var e = r.status;
          0 === e || e >= 200 && e < 300 || 304 === e ? a(r.responseText, t, n, s) : o(t, n, r, s)
        }
      },
      r.timeout = 1000 * (s.waitSeconds || m),
      r.ontimeout = function () {
        o(t, n, 'Loading ' + e + ' timeout.', s)
      },
      r.open('GET', e),
      r.send()
    }
    function h(e, t, i, s) {
      var o = c(e),
      a = d(o.id, t);
      if (r(e) || r(a)) return void i();
      E = s,
      b[e] = n(a),
      i(b)
    }
    function _(t, i, n, s) {
      var r = s && e.isFunction(s.onFailure) ? s.onFailure : v,
      o = c(t);
      u(d(o.id, i), n, r, o)
    }
    var f = {
      dynamic: !1
    },
    p = /^(\/\/)|([^:]+:\/\/)/,
    g = '|',
    v = function () {
    },
    m = 8,
    E = {
    },
    b = {
    };
    return f.normalize = function (e, t) {
      var i = e.split(g);
      return 1 === i.length ? t(e) : i[0] + g + t(i[1])
    },
    f.load = function (e, t, i, n) {
      n.isBuild ? h(e, t, i, n) : _(e, t, i, n)
    },
    f.write = function (e, t, i) {
      if (!r(t) && b[t]) {
        var n,
        s = e + '!' + t,
        o = E.namespace ? E.namespace + '.' : '';
        n = 'define(\'%MODULE_ID%\',%MODULE_CONTENT%)'.replace('%MODULE_ID%', s).replace('%MODULE_CONTENT%', b[t]),
        i.asModule(s, o + n)
      }
    },
    f
  }),
  define('json!failover=true|map.json', {
    config_pages: [
      {
        id: 'HOME',
        title: 'Home',
        template: 'HOME'
      },
      {
        id: 'BROWSE',
        title: 'Browse',
        template: 'BROWSE'
      },
      {
        id: 'SEARCH',
        title: 'Search',
        template: 'SEARCH'
      },
      {
        id: 'HELP',
        title: 'Help',
        template: 'HELP'
      },
      {
        id: 'DETAILS',
        title: 'Details',
        template: 'DETAILS'
      },
      {
        id: 'FULLSCREENPLAYER',
        template: 'FULLSCREENPLAYER'
      }
    ],
    config_menus: [
      {
        id: 'DEFAULT_MENU',
        title: '',
        items: [
          {
            id: 'HOME',
            title: 'Home',
            action: 'vdk://page/HOME'
          },
          {
            id: 'BROWSE',
            title: 'Browse',
            action: 'vdk://page/BROWSE'
          },
          {
            id: 'SEARCH',
            title: 'Search',
            action: 'vdk://page/SEARCH'
          },
          {
            id: 'HELP',
            title: 'Help',
            action: 'vdk://page/HELP'
          }
        ]
      }
    ],
    config_containers: [
    ],
    messages: [
      {
        id: '12345',
        code: 'SAMPLE_CODE',
        log: !1,
        title: 'Sample',
        message: 'This is a sample message from map.json',
        type: 'popup'
      }
    ]
  }),
  define('app/mgr/AppConfigManager', [
    'app/core/nav/DestinationParserManager',
    'app/service/ServiceHolder',
    'vdk/errors/VIAError',
    'xdk-base/ajax',
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/console',
    'xdk-base/device',
    'xdk-base/device/shared/LocalStorage',
    'xdk-base/promise',
    'xdk-base/util',
    'json!failover=true|map.json'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u) {
    var h,
    _;
    return h = s.create({
      STATUS: {
        ACTIVE: 'active',
        MAINTENANCE: 'maintenance',
        OFFLINE: 'offline'
      },
      singleton: function () {
        return _ || (_ = new h),
        _
      }
    }, {
      getStatus: function () {
        var e = t.singleton().getStatusService();
        return e ? e.getStatus() : c.resolve(this.constructor.STATUS.ACTIVE)
      },
      getStatusMessage: function () {
        var e = t.singleton().getStatusService();
        return e ? e.getMessage() : c.resolve('')
      },
      getSitemap: function () {
        return this.__sitemap ? c.resolve(this.__sitemap) : 'LOCAL' === r.get('app.config') ? (this.__sitemap = u, c.resolve(u)) : this.__getSitemapFromAppGridCMS()
      },
      getLandingPageEntryId: function () {
        return 'LOCAL' === r.get('app.config') ? c.resolve(r.get('local').landingPageEntryId) : this.__getAllAppConfigs().then(function (e) {
          return e.landingPageEntryId
        })
      },
      getMainMenuEntryId: function () {
        return 'LOCAL' === r.get('app.config') ? c.resolve(r.get('local').mainMenuEntryId) : this.__getAllAppConfigs().then(function (e) {
          return e.mainMenuEntryId
        })
      },
      __getSitemapFromAppGridCMS: function () {
        if (this.__getSitemapFromAppGridCMSPromise) return this.__getSitemapFromAppGridCMSPromise;
        var e = t.singleton().getConfigurationService();
        return this.__getSitemapFromAppGridCMSPromise = e.getAllEntries({
          size: 50
        }).then(l.bind(function (e) {
          return this.__sitemap = this.__convertCMSDataToSitemap(e),
          this.__sitemap
        }, this)).complete(l.bind(function () {
          this.__getSitemapFromAppGridCMSPromise = null
        }, this)),
        this.__getSitemapFromAppGridCMSPromise
      },
      __convertCMSDataToSitemap: function (e) {
        var t,
        i,
        n,
        s,
        o,
        a,
        d = r.get('appgrid').CMS.type,
        c = {
          config_pages: [
          ],
          config_containers: [
          ],
          config_menus: [
          ],
          config_items: [
          ]
        },
        u = [
        ];
        for (o = 0, a = e.entries.length; o < a; o++) switch (n = e.entries[o], s = l.extend(n, n._meta), s.typeId) {
          case d.Container:
            c.config_containers.push(s);
            break;
          case d.Item:
            c.config_items.push(s);
            break;
          case d.Menu:
            s.template = s.typeId,
            c.config_menus.push(s);
            break;
          case d.MenuItem:
            s.page ? (s.action = 'vdk://page/' + s.page, u.push(s)) : s.action && (s.action = 'vdk://action/' + s.action + (s.actiondata ? '?' + s.actiondata : ''), u.push(s));
            break;
          case d.Page:
            c.config_pages.push(s)
        }
        for (o = 0, a = c.config_menus.length; o < a; o++) {
          i = c.config_menus[o],
          t = [
          ];
          for (var h = 0, _ = i.items.length; h < _; h++) for (var f = i.items[h], p = 0, g = u.length; p < g; p++) u[p].id === f && t.push(u[p]);
          i.items = t
        }
        return c
      },
      getMenuItemsByMenuId: function (t) {
        var n = function (t, s) {
          for (var r, o, a = l.clone(t, !0), d = [
          ], c = e.singleton(), u = 0, h = a.length; u < h; u++) {
            if (r = a[u], !r.action || !r.id || !r.title) throw new i(i.FACILITY.CONFIGURATION_SERVICE, i.ERROR.INVALID, 'menu item doesn\'t have action, id or title.');
            o = {
            },
            o.id = r.id,
            o.title = r.displaytext || r.displayText || r.title,
            o.order = u;
            var _ = c.parseFrom(r.action);
            if (_.destination ? o.navigationDestination = _ : _.actionId && (o.action = _), r.state && !l.isArray(r.state) ? o.state = r.state.split('&') : o.state = r.state, s && (o.parent = s), r.items) {
              var f = r.items[0];
              f.action && f.id && f.title && (o.items = n(r.items, o))
            }
            d[u] = o
          }
          return d
        };
        return this.__getMenuMetadataByMenuId(t).then(l.bind(function (e) {
          if (!e || !e.items) throw new i(i.FACILITY.CONFIGURATION_SERVICE, i.ERROR.INVALID, 'The app cannot get navigation items.');
          return n(e.items)
        }, this))
      },
      getPagesMetadata: function () {
        return this.getSitemap().then(function (e) {
          var t = e.config_pages || [
          ];
          if ('LOCAL' !== r.get('app.config')) for (var i = 0, n = t.length; i < n; i++) t[i].state && !l.isArray(t.state) && (t[i].state = t[i].state.split('&'));
          return t
        })
      },
      getPageMetadataById: function (e) {
        return this.getPagesMetadata().then(function (t) {
          for (var i = 0, n = t.length; i < n; i++) if (t[i].id === e) return t[i]
        })
      },
      getContainerMetadataById: function (e) {
        return this.getSitemap().then(function (t) {
          for (var i = t.config_containers, n = 0, s = i.length; n < s; n++) if (i[n].id === e) return i[n];
          return null
        })
      },
      getContainersMetadataByIds: function (e) {
        return this.getSitemap().then(function (t) {
          var i,
          n,
          s,
          r = t.config_containers,
          o = [
          ],
          a = e.length,
          d = r.length;
          for (i = 0; i < a; i++) {
            for (n = 0; n < d; n++) if (r[n].id === e[i]) {
              o.push(r[n]),
              s = !0;
              break
            }
            s || o.push(null)
          }
          return o
        })
      },
      getMessagesConfig: function () {
        return 'LOCAL' === r.get('app.config') ? c.resolve(u.messages) : this.__getAllAppConfigs().then(l.bind(function (e) {
          return e.messages || [
          ]
        }, this))
      },
      __getMenuMetadataByMenuId: function (e) {
        return this.getSitemap().then(function (t) {
          for (var i = t.config_menus, n = 0, s = i.length; n < s; n++) if (i[n].id === e) return i[n]
        })
      },
      __getAllAppConfigs: function () {
        if (this.__getAllAppConfigsPromise) return this.__getAllAppConfigsPromise;
        var e = t.singleton().getConfigurationService();
        return e ? (this.__getAllAppConfigsPromise = e.getAllConfigs().complete(l.bind(function () {
          this.__getAllAppConfigsPromise = null
        }, this)), this.__getAllAppConfigsPromise) : c.resolve({
        })
      },
      initI18n: function () {
        return 'undefined' == typeof i18next ? (o.warn('No i18n package found in AppConfigManager, you can install localization package vdk-lib-i18next if necessary'), c.reject()) : this.__initI18nPromise ? this.__initI18nPromise : (this.__initI18nPromise = c.promise(l.bind(function (e, t) {
          i18next.init({
          }, l.bind(function (i) {
            return i ? void t('failed to init i18next:' + i) : (this.__i18n = i18next, 'LOCAL' === r.get('app.config') ? (this.__initI18nPromise = null, void e()) : void this.getCurrentDictionaryId().then(l.bind(function (e) {
              return this.addResourcesByDictionaryId(e).then(l.bind(this.changeLanguageByDictionaryId, this, e))
            }, this)).then(e).fail(l.bind(t, this)).complete(l.bind(function () {
              this.__initI18nPromise = null
            }, this)))
          }, this))
        }, this)), this.__initI18nPromise)
      },
      translate: function (e) {
        if (this.__i18n) return this.__i18n.t(e);
        throw new i(i.FACILITY.CONFIGURATION_SERVICE, i.ERROR.INVALID, 'i18n is not initialized.')
      },
      t: function (e) {
        return this.translate(e)
      },
      addResourcesByDictionaryId: function (e) {
        return this.__getDictionaryById(e).then(l.bind(function (e) {
          return this.__getCMSTranslationsByDictionary(e).then(l.bind(function (t) {
            this.__addCMSTranslationsToResources(e.title, t)
          }, this))
        }, this))
      },
      changeLanguageByDictionaryId: function (e) {
        return c.promise(l.bind(function (t, i) {
          this.__getDictionaryById(e).then(l.bind(function (e) {
            this.__i18n.changeLanguage(e.title, function (e) {
              if (e) return void i('failed to change language:' + e);
              t()
            })
          }, this), l.bind(i, this, 'failed to add resources to i18n')).done()
        }, this))
      },
      __getDictionaryById: function (e) {
        var i = t.singleton().getConfigurationService(),
        n = r.get('appgrid').CMS.type.Dictionary;
        return i.getEntriesByEntryTypeId(n).then(l.bind(function (t) {
          for (var i = 0, n = t.entries.length; i < n; i++) if (t.entries[i]._meta.id === e) return t.entries[i]
        }, this))
      },
      getCurrentDictionaryId: function () {
        return this.__currentDictionaryId || (this.__currentDictionaryId = r.get('appgrid').CMS.defaultDictionaryId),
        c.resolve(this.__currentDictionaryId)
      },
      __getCMSTranslationsByDictionary: function (e) {
        var i = t.singleton().getConfigurationService(),
        n = [
        ],
        s = r.get('appgrid').CMS.dictionaryTranslations;
        for (var o in e) e.hasOwnProperty(o) && s.indexOf(o) > - 1 && n.push(e[o]);
        return i.getEntriesByIds(n).then(function (e) {
          return e.entries
        })
      },
      __addCMSTranslationsToResources: function (e, t) {
        for (var i, n, s = [
          '_meta',
          'id',
          'publishedFrom',
          'title',
          'typeAlias',
          'typeId'
        ], r = 0, o = t.length; r < o; r++) {
          i = t[r],
          n = i._meta.attrs.namespace;
          for (var a in i) i.hasOwnProperty(a) && s.indexOf(a) > - 1 && delete i[a];
          this.__i18n.addResources(e, n, i)
        }
      }
    })
  }),
  define('xdk-ax/evt/DualEventDispatcher', [
    'xdk-base/class',
    'xdk-base/EventDispatcher'
  ], function (e, t) {
    'use strict';
    return e.create(t, {
    }, {
      __capturingCallbacks: {
      },
      __bubblingCallbacks: {
      },
      __switchMode: function (e) {
        this.__eventCallbacks = e ? this.__capturingCallbacks : this.__bubblingCallbacks
      },
      dispatchEvent: function (e, t, i) {
        return i = !!i,
        this.__switchMode(i),
        this._super(e, t)
      },
      addEventListener: function (e, t, i, n) {
        return i = !!i,
        this.__switchMode(i),
        this._super(e, t, n)
      },
      removeEventListener: function (e, t, i) {
        return i = !!i,
        this.__switchMode(i),
        this._super(e, t)
      },
      removeAllListeners: function () {
        return this.__switchMode(!1),
        this._super(),
        this.__switchMode(!0),
        this._super(),
        this
      }
    })
  }),
  define('xdk-ax/evt/Event', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/console'
  ], function (e, t, i) {
    'use strict';
    return e.create({
    }, {
      _isPropagationStopped: !1,
      _isDefaultPrevented: !1,
      _defaultAction: null,
      target: null,
      type: '',
      init: function (e, n, s, r) {
        var o;
        this.type = e,
        this.target = n,
        this._defaultAction = r;
        for (o in s) t.isUndefined(this[o]) || i.warn('Data parameter have collision with some event class members! They will be ignored!'),
        this[o] = s[o]
      },
      _setDefaultAction: function (e) {
        this._defaultAction = e
      },
      preventDefault: function () {
        this._isDefaultPrevented = !0
      },
      isDefaultPrevented: function () {
        return this._isDefaultPrevented
      },
      stopPropagation: function () {
        this._isPropagationStopped = !0
      },
      isPropagationStopped: function () {
        return this._isPropagationStopped
      },
      performDefaultAction: function () {
        this._defaultAction && this._defaultAction(this)
      }
    })
  }),
  define('xdk-ax/evt/type', {
    SHOWN: 'ui:evt:shown',
    HIDDEN: 'ui:evt:hidden',
    DETACH: 'ui:evt:detach',
    DETACHED_FROM_DOM: 'ui:evt:detachDOM',
    ATTACH: 'ui:evt:attach',
    ATTACHED_TO_DOM: 'ui:evt:attachDOM',
    ATTACHED_TO_CONTROLLER: 'ui:evt:attach-controller',
    DETACHED_FROM_CONTROLLER: 'ui:evt:detach-controller',
    FOCUS: 'ui:evt:focus',
    BLUR: 'ui:evt:blur',
    KEY: 'ui:evt:key',
    OPEN: 'ui:evt:open',
    CLOSE: 'ui:evt:close',
    CLICK: 'ui:evt:click',
    MOUSEOVER: 'ui:evt:mouseover',
    CANCEL: 'ui:evt:cancel',
    CONFIRM: 'ui:evt:confirm',
    SCROLL: 'ui:evt:scroll',
    SELECTION_CHANGED: 'ui:evt:selection-changed',
    TEXT_CHANGED: 'ui:evt:text-changed',
    VALUE_CHANGED: 'ui:evt:value-changed',
    MOVED: 'ui:evt:moved',
    SCROLLED_TO_TOP: 'ui:evt:scroll-to-top',
    SCROLLED_TO_BOTTOM: 'ui:evt:scroll-to-bottom',
    ACTIVED: 'ui:evt:actived',
    INACTIVED: 'ui:evt:inactived',
    DRAG_MOVING: 'ui:evt:drag-moving',
    DRAG_RELEASE: 'ui:evt:drag-release',
    INDICATOR_UPDATED: 'ui:evt:indicator-updated',
    SCROLLED_INDICATOR: 'ui:evt:scrolled-indicator',
    SCROLLED_PERCENTAGE: 'ui:evt:scrolled-percentage',
    CHANNEL_CHANGED: 'device:evt:channel-changed',
    ANIM_ITERATION_ENDED: 'ui:evt:anim-iteration-ended'
  }),
  define('xdk-ax/iterator/interface/Iterator', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('Iterator', {
      next: [
      ],
      hasNext: [
      ]
    })
  }),
  define('xdk-ax/iterator/BubblingCompIt', [
    'xdk-base/class',
    'xdk-ax/iterator/interface/Iterator',
    'xdk-base/core'
  ], function (e, t, i) {
    'use strict';
    return e.create([t], {
    }, {
      __curComp: null,
      init: function (e) {
        this.__curComp = e
      },
      next: function () {
        this.__curComp || i.createException('NoSuchElement', 'No more element is available for current iteraion!');
        var e = this.__curComp;
        return this.__curComp = this.__curComp.getParent(),
        e
      },
      hasNext: function () {
        return !!this.__curComp
      }
    })
  }),
  define('xdk-ax/iterator/CapturingCompIt', [
    'xdk-base/class',
    'xdk-ax/iterator/interface/Iterator',
    'xdk-base/core'
  ], function (e, t, i) {
    'use strict';
    return e.create([t], {
    }, {
      __compArr: [
      ],
      init: function (e) {
        for (var t = e; t; ) this.__compArr.push(t),
        t = t.getParent()
      },
      next: function () {
        return this.__compArr.length || i.createException('NoSuchElement', 'No more element is available for current iteraion!'),
        this.__compArr.pop()
      },
      hasNext: function () {
        return !!this.__compArr.length
      }
    })
  }),
  define('xdk-ax/iterator/DFSCompIt', [
    'xdk-base/class',
    'xdk-ax/iterator/interface/Iterator',
    'xdk-base/core'
  ], function (e, t, i) {
    'use strict';
    return e.create([t], {
    }, {
      __compArr: [
      ],
      init: function (e) {
        this._include(e)
      },
      _include: function (e) {
        if (e.isLeaf()) return void this.__compArr.unshift(e);
        var t,
        i = e.getChildren();
        for (t in i) this._include(i[t]);
        this.__compArr.unshift(e)
      },
      next: function () {
        return this.__compArr.length || i.createException('NoSuchElement', 'No more element is available for current iteraion!'),
        this.__compArr.pop()
      },
      hasNext: function () {
        return !!this.__compArr.length
      }
    })
  }),
  define('xdk-ax/evt/eventManager', [
    'xdk-ax/evt/Event',
    'xdk-ax/evt/type',
    'xdk-ax/iterator/BubblingCompIt',
    'xdk-ax/iterator/CapturingCompIt',
    'xdk-ax/iterator/DFSCompIt'
  ], function (e, t, i, n, s) {
    'use strict';
    var r = {
    };
    return r[t.ATTACH] = {
      bubblingIt: s
    },
    r[t.ATTACHED_TO_DOM] = {
      bubblingIt: s
    },
    r[t.DETACH] = {
      bubblingIt: s
    },
    r[t.DETACHED_FROM_DOM] = {
      bubblingIt: s
    },
    {
      trigger: function (t, s, o) {
        o = o || {
        };
        var a,
        d,
        c,
        l;
        if (r[t] ? (a = r[t].capturingIt, d = r[t].bubblingIt, a = a ? new a(s) : null, d = d ? new d(s) : null) : (a = new n(s), d = new i(s)), c = new e(t, s, o, o.defaultAction), a) for (; !c.isPropagationStopped() && a.hasNext(); ) l = a.next(),
        !1 === l.dispatchEvent(t, c, !0) && (c.stopPropagation(), c.preventDefault());
        if (d) for (; !c.isPropagationStopped() && d.hasNext(); ) l = d.next(),
        !1 === l.dispatchEvent(t, c, !1) && (c.stopPropagation(), c.preventDefault());
        c.isDefaultPrevented() || c.performDefaultAction()
      }
    }
  }),
  define('xdk-base/Element', [
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/console',
    'xdk-base/util',
    'xdk-base/device'
  ], function (e, t, i, n, s) {
    'use strict';
    var r,
    o = function () {
      var e = navigator.userAgent.toLowerCase();
      return - 1 !== e.indexOf('maple') && - 1 !== e.indexOf('5.1')
    }(),
    a = function () {
      var e = document.getElementsByTagName('script') [0];
      return !(!e.classList || !e.classList.add)
    }(),
    d = function () {
      this.returnValue = !1
    },
    c = function () {
      this.cancelBubble = !0
    },
    l = function (e) {
      return e.preventDefault || (e.preventDefault = d),
      e.stopPropagation && (e.stopPropagation = c),
      e
    },
    u = {
      mouseenter: 'mouseover',
      mouseleave: 'mouseout'
    },
    h = function (e, t) {
      return u[e] ? function (i) {
        for (var n = i.relatedTarget, s = i.type; n && n !== this._dom; ) try {
          n = n.parentNode
        } catch (e) {
          break
        }
        n !== this._dom && (i.type = e, t.apply(this, arguments), i.type = s)
      }
       : null
    };
    return r = e.create({
      getById: function (e) {
        var t = document.getElementById(e);
        return t && n.isDOMElement(t) ? new r(t) : null
      }
    }, {
      _dom: null,
      __events: null,
      __origDisplayStyle: '',
      init: function (e, t, i) {
        n.isDOMElement(e) ? this._dom = e : this._dom = document.createElement(e),
        n.isPlainObject(t) && this.attr(t),
        i && (i && n.isDOMElement(i) && (i = new r(i)), i.append(this._dom))
      },
      getHTMLElement: function () {
        return this._dom
      },
      getParent: function () {
        var e = this._dom.parentNode;
        return e ? new r(e) : null
      },
      detach: function () {
        if (!this._dom) return this;
        var e = this._dom.parentNode;
        return e && e.removeChild(this._dom),
        null,
        e = null,
        this
      },
      show: function () {
        var e = this._dom.style.display;
        return 'none' !== e ? (this.__origDisplayStyle = e, this) : (this._dom.style.display = this.__origDisplayStyle, this)
      },
      hide: function () {
        var e = this._dom.style.display;
        return 'none' !== e && (this.__origDisplayStyle = e),
        this._dom.style.display = 'none',
        this
      },
      toggle: function () {
        return 'none' === this._dom.style.display ? (this.show(), !0) : (this.hide(), !1)
      },
      addEventListener: function (e, i, s) {
        var r,
        o,
        a = this._dom,
        d = this.__events,
        c = e,
        l = i;
        return s = !!s,
        u[c] && (e = u[c], i = h(c, i)),
        i = n.bind(i, this),
        l.$$guid || (l.$$guid = t.getGuid()),
        d || (this.__events = d = {
        }),
        r = d[c],
        r || (r = d[c] = {
        }, c === e && a['on' + e] && (r[0] = {
        }, r[0][!1] = [
          a['on' + e]
        ])),
        r[l.$$guid] = r[l.$$guid] || {
        },
        o = r[l.$$guid],
        o[s] = o[s] || [
        ],
        o[s].push(i),
        a.addEventListener ? a.addEventListener(e, i, s) : a['on' + e] = n.bind(this._handleEvent, this),
        this
      },
      _handleEvent: function (e) {
        var t,
        i,
        n,
        s,
        r = !0,
        o = e.type;
        e = e || l(window.event),
        t = this.__events[o],
        u[o] && (t = t.concat(this.__events[u[o]]));
        for (n in t) {
          i = t[n][(!1).toString()];
          for (s in i) this.$$handleEvent = i[s],
          !1 === this.$$handleEvent(e) && (r = !1)
        }
        return r
      },
      removeEventListener: function (e, t, i) {
        var n,
        s,
        r,
        o,
        a = this._dom,
        d = this.__events,
        c = null,
        l = t,
        h = e;
        if (!e) {
          if (!d) return this;
          for (s in d) this.removeEventListener(s);
          return this.__events = null,
          this
        }
        if (!t) {
          if (!d) return this;
          n = d[e];
          for (r in n) for (o in n[r]) for (; n[r] && n[r][o] && n[r][o].length; ) this.removeEventListener(e, {
            $$guid: r
          }, o === (!0).toString());
          return delete d[e],
          this
        }
        return i = !!i,
        d && d[e] && d[e][t.$$guid] && d[e][t.$$guid][i] && (c = d[e][t.$$guid][i], l = c.pop(), h = u[e] || e, 0 === c.length && (delete d[e][t.$$guid][i], d[e][t.$$guid][!i] && 0 !== d[e][t.$$guid][!i].length || delete d[e][t.$$guid])),
        a.removeEventListener && a.removeEventListener(h, l, i),
        this
      },
      removeAllListeners: function () {
        return this.__events ? (this.removeEventListener(), this) : this
      },
      removeChild: function (e) {
        return n.isDOMElement(e) || (e = e.getHTMLElement()),
        e.parentNode !== this._dom ? (i.warn('unable to remove the non children node'), this) : (n.isFunction(this._dom.removeChild) ? this._dom.removeChild(e) : n.each(Array.prototype.slice.call(this._dom.childNodes, 0), function (t) {
          if (t === e) {
            this._dom.removeChild(t);
            null
          }
        }, this), this)
      },
      removeAll: function () {
        for (var e = this._dom.childNodes[0]; e; ) this.removeChild(e),
        e = this._dom.childNodes[0];
        return this
      },
      append: function (e) {
        return n.isDOMElement(e) ? this._dom.appendChild(e) : this._dom.appendChild(e.getHTMLElement()),
        this
      },
      appendTo: function (e) {
        return n.isDOMElement(e) ? e.appendChild(this._dom) : e.append(this),
        this
      },
      insertBefore: function (e, t) {
        var i,
        s;
        return i = n.isDOMElement(e) ? e : e.getHTMLElement(),
        s = n.isDOMElement(t) ? t : t.getHTMLElement(),
        this._dom.insertBefore(s, i),
        this
      },
      insertAfter: function (e, t) {
        var i,
        s;
        return i = n.isDOMElement(e) ? e : e.getHTMLElement(),
        s = n.isDOMElement(t) ? t : t.getHTMLElement(),
        this._dom.lastChild === i ? this._dom.appendChild(s) : this._dom.insertBefore(s, i.nextSibling),
        this
      },
      replaceChild: function (e, t) {
        var i,
        s,
        r;
        return i = n.isDOMElement(e) ? e : e.getHTMLElement(),
        s = n.isDOMElement(t) ? t : t.getHTMLElement(),
        this._dom.lastChild === i ? (this._dom.removeChild(i), this._dom.appendChild(s)) : (r = i.nextSibling, this._dom.removeChild(i), this._dom.insertBefore(s, r)),
        this
      },
      prepend: function (e) {
        return n.isDOMElement(e) ? this._dom.insertBefore(e, this._dom.firstChild) : this._dom.insertBefore(e.getHTMLElement(), this._dom.firstChild),
        this
      },
      prependTo: function (e) {
        return n.isDOMElement(e) ? e.insertBefore(this._dom, e.childNodes[0]) : e.prepend(this),
        this
      },
      isAttached: function () {
        return null !== this.getHTMLElement().parentNode
      },
      removeAttr: function (e) {
        return this.hasAttr(e) && this._dom.removeAttribute(e),
        this
      },
      removeStyle: function (e) {
        return this.css(e) && (this._dom.style[e] = '', delete this._dom.style[e]),
        this
      },
      hasAttr: function (e) {
        return this._dom.hasAttribute ? this._dom.hasAttribute(e) : !n.isUndefined(this._dom[e])
      },
      __getStyleText: function () {
        return n.isUndefined(this._dom.style.cssText) ? this._dom.getAttribute('style') : this._dom.style.cssText
      },
      __setStyleText: function (e) {
        n.isUndefined(this._dom.style.cssText) ? this._dom.setAttribute('style', e) : this._dom.style.cssText = e
      },
      __setStyle: function (e) {
        var t,
        i,
        s,
        r = this.__getStyleText() || '',
        a = r,
        d = !r,
        c = [
        ];
        if (o) {
          for (t in e) e.hasOwnProperty(t) && (this._dom.style[t] = e[t]);
          return this
        }
        for (t in e) e.hasOwnProperty(t) && (t = n.camelize(t), i = n.decamelize(t, '-') + ':' + e[t] + ';', d ? a += i : n.isNull(this._dom.style[t]) || n.isUndefined(this._dom.style[t]) || '' === this._dom.style[t] ? a = i + a : c.push(t));
        this.__setStyleText(a);
        for (s in c) t = c[s],
        this._dom.style[t] = e[t];
        return this
      },
      __getStyle: function (e) {
        e = 'float' === e ? 'cssFloat' : n.camelize(e);
        var t = null;
        return this._dom.currentStyle && (t = this._dom.currentStyle[e]),
        t || (t = this._dom.style[e]),
        'opacity' === e ? t ? parseFloat(t) : 1 : 'auto' === t ? null : t
      },
      cumulativeOffset: function () {
        var e = 0,
        t = 0,
        i = this._dom;
        if (i.parentNode) do {
          e += i.offsetTop || 0,
          t += i.offsetLeft || 0,
          i = i.offsetParent
        } while (i);
        return {
          x: t,
          y: e
        }
      },
      addClass: function (e) {
        return n.isArray(e) ? n.each(e, function (e) {
          this.addClass(e)
        }, this) : n.isString(e) && (e = e.replace(/\s+/g, ' ').replace(/^\s/, '').replace(/\s$/, ''), e.indexOf(' ') >= 0 ? n.each(e.split(' '), function (e) {
          this.addClass(e)
        }, this) : a ? this._dom.classList.add(e) : this.hasClass(e) || (this._dom.className += (this._dom.className ? ' ' : '') + e)),
        this
      },
      hasClass: function (e) {
        if (a) return this._dom.classList.contains(e);
        var t = this._dom.className;
        return t.length > 0 && (t === e || new RegExp('(^|\\s)' + e + '(\\s|$)').test(t))
      },
      removeClass: function (e) {
        if (a) return this._dom.classList.remove(e),
        this;
        var t = this._dom.className.replace(new RegExp('(^|\\s+)' + e + '(\\s+|$)'), ' ');
        return t = n.strip(t),
        this._dom.className = t,
        this
      },
      setClass: function (e) {
        return this._dom.className = n.strip(e),
        this
      },
      setInnerText: function (e) {
        return n.isUndefined(this._dom.innerText) ? n.isUndefined(this._dom.textContent) ? i.warn('fail to set Text' + e) : this._dom.textContent = e : this._dom.innerText = e,
        s.system && s.system.redraw(this._dom),
        this
      },
      setInnerHTML: function (e) {
        return this._dom.innerHTML = e,
        s.system && s.system.redraw(this._dom),
        this
      },
      getInnerText: function () {
        return n.isUndefined(this._dom.innerText) ? n.isUndefined(this._dom.textContent) ? void i.warn('Fail to get innerText!') : this._dom.textContent : this._dom.innerText
      },
      getInnerHTML: function () {
        return this._dom.innerHTML
      },
      _findUltimateAncestor: function () {
        for (var e = this._dom; e.parentNode; ) e = e.parentNode;
        return e
      },
      isInDOMTree: function () {
        return this._findUltimateAncestor().body === t.root.document.body
      },
      discard: function () {
        this.detach(),
        this.removeAllListeners(),
        this._dom = null
      },
      deinit: function () {
        this.discard()
      },
      attr: function (e, i) {
        var s;
        if (n.isUndefined(e)) throw t.createException('elementAttrError', 'Undefined attribute name');
        if (n.isPlainObject(e)) {
          for (s in e) this.attr(s, e[s]);
          return this
        }
        return n.isUndefined(i) ? n.isFunction(this._dom.getAttribute) ? this._dom.getAttribute(e) : null : n.isString(i) || n.isNumber(i) ? (this._dom.setAttribute(e, i), this) : ('style' === e && n.isPlainObject(i) && this.css(i), this)
      },
      css: function (e, i) {
        if (n.isUndefined(e)) throw t.createException('elementCssError', 'Undefined css name');
        if (n.isPlainObject(e)) return e.display && ('none' === e.display ? this.__origDisplayStyle = this._dom.style.display : this.__origDisplayStyle = i),
        this.__setStyle(e),
        this;
        if (n.isUndefined(i)) return this.__getStyle(e);
        if ('display' === e && ('none' === i ? this.hide() : (this.__origDisplayStyle = i, this._dom.style.display = this.__origDisplayStyle)), n.isString(i) || n.isNumber(i)) {
          var s = {
          };
          return s[e] = i,
          this.__setStyle(s),
          this
        }
        return this
      },
      toggleClass: function (e) {
        return this.hasClass(e) ? this.removeClass(e) : this.addClass(e)
      }
    })
  }),
  define('xdk-ax/mvc/Model', [
    'xdk-base/class',
    'xdk-base/EventDispatcher',
    'xdk-base/util'
  ], function (e, t, i) {
    'use strict';
    return e.create(t, {
      defaults: {
      }
    }, {
      _attrs: {
      },
      _changed: {
      },
      init: function (e, t) {
        this._attrs = i.clone(this.constructor.defaults, !0),
        i.extend(this._attrs, e),
        this._super()
      },
      changedAttrs: function () {
        var e = {
        },
        t = this;
        return i.each(this._changed, function (i) {
          e[i.key] = t._attrs[i.key]
        }),
        e
      },
      get: function (e) {
        return this._attrs[e]
      },
      set: function (e, t) {
        var n = this;
        return i.isPlainObject(e) ? (i.each(e, function (e) {
          n.set(e.key, e.value)
        }), this) : (this.__updateAttr(e, t), this)
      },
      unset: function (e) {
        return this.has(e) ? (this.set(e), this) : this
      },
      has: function (e) {
        return this._attrs.hasOwnProperty(e)
      },
      clear: function () {
        var e = this;
        return i.each(this._attrs, function (t) {
          e.unset(t.key, t.value)
        }),
        this
      },
      attributes: function () {
        return this._attrs
      },
      on: function (e, t) {
        this.addEventListener(e, t, !1)
      },
      once: function (e, t) {
        this.addEventListener(e, t, !0)
      },
      off: function (e, t) {
        this.removeEventListener(e, t)
      },
      __updateAttr: function (e, t) {
        var n,
        s,
        r = this._attrs[e];
        t !== r && (i.isUndefined(t) ? delete this._attrs[e] : this._attrs[e] = t, this._changed[e] = !0, n = 'change:' + e, s = {
          attr: e,
          type: 'change',
          oldVal: r,
          newVal: t
        }, this.dispatchEvent(n, s), this.dispatchEvent('change', s))
      }
    })
  }),
  define('xdk-ax/mvc/ModelRef', [
    'xdk-base/class',
    'xdk-ax/mvc/Model',
    'xdk-base/core'
  ], function (e, t, i) {
    'use strict';
    return e.create({
    }, {
      _model: null,
      _attr: null,
      init: function (e, n) {
        if (!(e instanceof t && n)) throw i.createException('IncorrectParam', 'Incorrect parameter when trying to create a ModelRef instance!');
        this._model = e,
        this._attr = n
      },
      getModel: function () {
        return this._model
      },
      getAttr: function () {
        return this._attr
      },
      getVal: function () {
        return this._model.get(this._attr)
      }
    })
  }),
  define('xdk-ax/Component', [
    'xdk-base/class',
    'xdk-ax/evt/DualEventDispatcher',
    'xdk-ax/evt/eventManager',
    'xdk-base/util',
    'xdk-ax/evt/type',
    'xdk-ax/evt/Event',
    'xdk-base/core',
    'xdk-base/Element',
    'xdk-base/device',
    'xdk-ax/mvc/ModelRef',
    'xdk-base/exception',
    'xdk-base/console'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u) {
    'use strict';
    return e.create(t, {
      PLACE_BEFORE: 'before',
      PLACE_AFTER: 'after',
      PLACE_APPEND: 'append',
      PLACE_PREPEND: 'prepend'
    }, {
      _disabled: !1,
      _hidden: !1,
      _ancestorHidden: !1,
      _inDOMTree: !1,
      _parent: null,
      _root: null,
      _controller: null,
      _opts: null,
      __wrappedListeners: {
      },
      __visibilityModelRef: null,
      __visibilityListener: null,
      init: function (e) {
        var t,
        i;
        e = e || {
        },
        e.root = e.root || new a('div'),
        this._super(e),
        this._root = e.root,
        this._root && (this._root.getHTMLElement().__comp = this),
        this._parent = e.parent,
        this._opts = n.clone(e, !0),
        this._root && this._parent && (t = e.placement ? e.placement : this.PLACE_APPEND, i = e.marker ? e.marker : void 0, this._parent.attach(this, t, i)),
        e.id && this.setId(e.id),
        e.css && this._root.addClass(e.css),
        n.isUndefined(e.visible) || this.setVisibility(e.visible),
        this.postInit()
      },
      postInit: function () {
        var e = this._opts.style;
        e && e.display && 'none' === e.display.toLowerCase() && this.hide()
      },
      deinit: function () {
        this.detach(),
        this._super(),
        delete this._root.getHTMLElement().__comp,
        this._root.deinit(),
        this._root = null
      },
      isClickable: function () {
        return this.getOption('clickable', !1)
      },
      isDisabled: function () {
        return this._disabled
      },
      disable: function () {
        return this._disabled = !0,
        this._root.addClass('disabled'),
        this
      },
      enable: function () {
        return this._disabled = !1,
        this._root.removeClass('disabled'),
        this
      },
      isHidden: function () {
        return this._hidden
      },
      isAncestorHidden: function () {
        return this._ancestorHidden
      },
      _updateAncestorHidden: function () {
        var e = this.getParent();
        if (!e) return void (this._ancestorHidden = !1);
        this._ancestorHidden = e.isAncestorHidden() || e.isHidden()
      },
      _updateInDOMTree: function (e) {
        this._inDOMTree = e
      },
      show: function () {
        return this.setVisibility(!0)
      },
      hide: function () {
        return this.setVisibility(!1)
      },
      toggle: function () {
        return this.isHidden() ? this.setVisibility(!0) : this.setVisibility(!1)
      },
      addClass: function (e) {
        return this._root ? (this._root.addClass(e), this) : this
      },
      removeClass: function (e) {
        return this._root ? (this._root.removeClass(e), this) : this
      },
      setId: function (e) {
        n.startsWith(e, '#') ? e.length > 1 && (this._root.id = e.substr(1), this._root.attr('id', this._root.id)) : this._root.id = e
      },
      getId: function () {
        return this._root.id || null
      },
      find: function (e) {
        return this.getId() === e ? this : null
      },
      isAncestorOf: function (e) {
        return e.isDescendantOf(this)
      },
      isDescendantOf: function (e) {
        return !!this._parent && (this._parent === e || this._parent.isDescendantOf(e))
      },
      getOption: function (e, t) {
        var i = this._opts[e];
        return n.isUndefined(i) && (i = t),
        i
      },
      setOption: function (e, t) {
        return this._opts[e] = t,
        this
      },
      getRoot: function () {
        return this._root
      },
      getParent: function () {
        return this._parent
      },
      attachController: function (e) {
        this._controller = e
      },
      detachController: function () {
        this._controller = null
      },
      getAttachedController: function () {
        return this._controller
      },
      getController: function () {
        if (!this._controller) {
          var e = this.getParent();
          return e ? e.getController() : null
        }
        return this._controller
      },
      getRootController: function () {
        for (var e = [
        ], t = this.getParent(); t; ) e.push(t),
        t = t.getParent();
        for (; e.length; ) if (t = e.shift(), t.getAttachedController()) return t.getAttachedController();
        return null
      },
      detach: function () {
        return this._parent ? (this._parent.detach(this), this) : this
      },
      setActive: function (e) {
        var t = this.getParent();
        t && (t.setActiveChild(this), !0 !== e && t !== e && t.setActive(e))
      },
      isActive: function (e) {
        var t = this.getParent();
        return !(!t || !e && t && !t.isActive()) && t.isChildActive(this)
      },
      isLeaf: function () {
        return !0
      },
      __getMappedDOMEvent: function (e) {
        switch (e) {
          case s.CLICK:
            if ('wiiu' === d.platform && nwf) {
              var t = nwf.display.DisplayManager.getInstance();
              if (window === t.getTVDisplay().window) return !1
            }
            return 'click';
          case s.MOUSEOVER:
            return 'mouseover'
        }
        return !1
      },
      addEventListener: function (e, t, i, a) {
        var d,
        c,
        l = this.__getMappedDOMEvent(e);
        return l ? (i = !!i, d = function (o) {
          for (var d = this.getHTMLElement().__comp, l = o.target, u = l.__comp; !u; ) l = l.parentNode,
          u = l.__comp;
          if (e === s.CLICK) for (; !u.isClickable(); ) {
            if (u === d) return;
            u = u.getParent()
          }
          c = new r(e, u),
          n.bind(t, d) (c),
          a && d.removeEventListener(e, t, i),
          o.stopPropagation(),
          o.preventDefault()
        }, this._root.addEventListener(l, d, i), t.$$guid || (t.$$guid = o.getGuid()), this.__wrappedListeners[l] || (this.__wrappedListeners[l] = {
        }), this.__wrappedListeners[l][t.$$guid] || (this.__wrappedListeners[l][t.$$guid] = {
        }), this.__wrappedListeners[l][t.$$guid][i] || (this.__wrappedListeners[l][t.$$guid][i] = [
        ]), this.__wrappedListeners[l][t.$$guid][i].push(d), this._super(e, t, i, a)) : this._super(e, t, i, a)
      },
      removeEventListener: function (e, t, i) {
        var n,
        s = this.__getMappedDOMEvent(e);
        return s ? (i = !!i, this.__wrappedListeners && this.__wrappedListeners[s] && this.__wrappedListeners[s][t.$$guid] && this.__wrappedListeners[s][t.$$guid][i] && this.__wrappedListeners[s][t.$$guid][i].length ? (n = this.__wrappedListeners[s][t.$$guid][i].pop(), this._root.removeEventListener(s, n, i), this._super(e, t, i)) : this._super(e, t, i)) : this._super(e, t, i)
      },
      removeAllListeners: function () {
        return this.__wrappedListeners = {
        },
        this._root.removeAllListeners(),
        this._super()
      },
      setVisibility: function (e) {
        return this.__visibilityModelRef && this.__visibilityListener && (this.__visibilityModelRef.getModel().off('change:' + this.__visibilityModelRef.getAttr(), this.__visibilityListener), this.__visibilityModelRef = null),
        e instanceof c && (this.__visibilityListener || (this.__visibilityListener = n.bind(function (e) {
          this.__setVisible(e.newVal)
        }, this)), e.getModel().on('change:' + e.getAttr(), this.__visibilityListener), this.__visibilityModelRef = e, e = this.__visibilityModelRef.getVal()),
        this.__setVisible(e)
      },
      __setVisible: function (e) {
        var t;
        if ('boolean' != typeof e) {
          var n = this.getOption('id', void 0);
          u.warn('[Component] Expecting boolean value for visibility' + (n ? ' on component ' + n : '') + '; actual: ' + e)
        }
        return this._hidden = !e,
        this._hidden ? (this._root.hide(), t = s.HIDDEN) : (this._root.show(), t = s.SHOWN),
        this._updateAncestorHidden(),
        i.trigger(t, this, {
          hidden: this._hidden
        }),
        this
      }
    })
  }),
  define('xdk-ax/Container', [
    'xdk-base/class',
    'xdk-ax/Component',
    'xdk-base/core',
    'xdk-ax/evt/eventManager',
    'xdk-base/util',
    'xdk-ax/evt/type',
    'xdk-base/console'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a = e.create(t, {
    }, {
      _children: [
      ],
      __activeness: [
      ],
      init: function (e) {
        this._super(e)
      },
      deinit: function () {
        var e,
        t = this._children.slice(0),
        i = t.length;
        for (e = 0; e < i; e++) t[e].deinit();
        this._super()
      },
      postInit: function () {
        if (this._super(), this._opts.children && s.isArray(this._opts.children)) {
          var e,
          t = 0,
          i = this._opts.children.length;
          if (!(i <= 0)) for (; t < i; t++) e = this._opts.children[t],
          this.attach(e)
        }
      },
      find: function (e) {
        if (this.getId() === e) return this;
        var t,
        i,
        n = this._children.length;
        for (t = 0; t < n; t++) if (i = this._children[t].find(e)) return i;
        return null
      },
      getChildren: function () {
        return this._children.slice(0)
      },
      attach: function (e, t, d) {
        if (s.indexOf(this._children, e) >= 0) return o.warn('Child is already attached to container'),
        this;
        t || (t = a.PLACE_APPEND);
        var c = d ? s.indexOf(this._children, d) : this._children.length - 1;
        switch (t) {
          case a.PLACE_APPEND:
            this._children.push(e);
            break;
          case a.PLACE_PREPEND:
            this._children.unshift(e);
            break;
          case a.PLACE_BEFORE:
            if (c < 0) throw i.createException('IncorrectParam', 'The insert place marker component must be a child of this container!');
            this._children.splice(c, 0, e);
            break;
          case a.PLACE_AFTER:
            if (c < 0) throw i.createException('IncorrectParam', 'The insert place marker component must be a child of this container!');
            this._children.splice(c + 1, 0, e)
        }
        return this._doAttach(e, t, d),
        this.__activeness.push(e),
        e._parent = this,
        e._updateAncestorHidden(),
        this._root.isInDOMTree() && e._updateInDOMTree(!0),
        n.trigger(r.ATTACH, e),
        this._root.isInDOMTree() && n.trigger(r.ATTACHED_TO_DOM, e),
        this
      },
      _doAttach: function (e, t, i) {
        switch (t) {
          case a.PLACE_APPEND:
            this._root.append(e.getRoot());
            break;
          case a.PLACE_PREPEND:
            this._root.prepend(e.getRoot());
            break;
          case a.PLACE_BEFORE:
            this._root.insertBefore(i.getRoot(), e.getRoot());
            break;
          case a.PLACE_AFTER:
            this._root.insertAfter(i.getRoot(), e.getRoot())
        }
      },
      replace: function (e, t) {
        if (t !== e) {
          var o = s.indexOf(this._children, e),
          a = s.indexOf(this.__activeness, e),
          d = this._root.isInDOMTree();
          if (o < 0) throw i.createException('IncorrectParam', 'The replace target component must be a child of this container!');
          this._children.splice(o, 1, t),
          this.__activeness.splice(a, 1, t),
          this._doReplace(e, t),
          t._parent = this,
          e._parent = null,
          t._updateAncestorHidden(),
          d && t._updateInDOMTree(!0),
          n.trigger(r.ATTACH, t),
          d && n.trigger(r.ATTACHED_TO_DOM, t),
          e._updateAncestorHidden(),
          d && e._updateInDOMTree(!1),
          n.trigger(r.DETACH, e),
          d && n.trigger(r.DETACHED_FROM_DOM, e)
        }
      },
      _doReplace: function (e, t) {
        this._root.replaceChild(e.getRoot(), t.getRoot())
      },
      detach: function (e) {
        if (!e) return this._super();
        var t,
        o = s.indexOf(this._children, e);
        if (o < 0) throw i.createException('IncorrectParam', 'The detach target component must be a child of this container!');
        return this._children.splice(o, 1),
        t = s.indexOf(this.__activeness, e),
        this.__activeness.splice(t, 1),
        e.getRoot().detach(),
        e._parent = null,
        e._updateAncestorHidden(),
        this._root.isInDOMTree() && e._updateInDOMTree(!1),
        n.trigger(r.DETACH, e),
        this._root.isInDOMTree() && n.trigger(r.DETACHED_FROM_DOM, e),
        this
      },
      detachAll: function () {
        for (var e = this._children.length; e--; ) this._children[e].detach();
        this._children = [
        ]
      },
      setActiveChild: function (e) {
        e instanceof t || (e = this.find(e));
        var o = s.indexOf(this.__activeness, e);
        if (o < 0) throw i.createException('IncorrectParam', 'The target component must be a child of this container!');
        0 !== o && (this.__activeness.splice(o, 1), this.__activeness.unshift(e), n.trigger(r.INACTIVED, this.__activeness[1]), n.trigger(r.ACTIVED, this.__activeness[0]))
      },
      getActiveChildren: function () {
        return this.__activeness.slice(0)
      },
      getActiveChild: function (e) {
        return s.isUndefined(e) && (e = 0),
        e < 0 || e > this.__activeness.length - 1 ? null : this.__activeness[e]
      },
      getActiveLeaf: function () {
        for (var e = this; !e.isLeaf(); ) e = e.getActiveChild();
        return e
      },
      isChildActive: function (e) {
        return e === this.__activeness[0]
      },
      _updateAncestorHidden: function () {
        this._super(),
        s.each(this._children, function (e) {
          e._updateAncestorHidden()
        })
      },
      _updateInDOMTree: function (e) {
        this._super(e),
        s.each(this._children, function (t) {
          t._updateInDOMTree(e)
        })
      },
      isLeaf: function () {
        return 0 === this._children.length
      }
    });
    return a
  }),
  define('xdk-ax/iterator/BFSCompIt', [
    'xdk-base/class',
    'xdk-ax/iterator/interface/Iterator',
    'xdk-base/core'
  ], function (e, t, i) {
    'use strict';
    return e.create([t], {
    }, {
      __compArr: [
      ],
      init: function (e) {
        this._include(e)
      },
      _include: function (e) {
        if (!e.isLeaf()) {
          var t,
          i = e.getChildren();
          for (t in i) this.__compArr.unshift(i[t]);
          for (t in i) this._include(i[t])
        }
      },
      next: function () {
        return this.__compArr.length || i.createException('NoSuchElement', 'No more element is available for current iteraion!'),
        this.__compArr.pop()
      },
      hasNext: function () {
        return !!this.__compArr.length
      }
    })
  }),
  define('xdk-ax/iterator/AFSCompIt', [
    'xdk-base/class',
    'xdk-ax/iterator/interface/Iterator',
    'xdk-base/core'
  ], function (e, t, i) {
    'use strict';
    return e.create([t], {
    }, {
      __compArr: [
      ],
      init: function (e) {
        this._include(e)
      },
      _include: function (e) {
        if (e.isLeaf()) return void this.__compArr.unshift(e);
        var t,
        i = e.getActiveChildren();
        for (t = 0; t < i.length; t++) this._include(i[t]);
        this.__compArr.unshift(e)
      },
      next: function () {
        return this.__compArr.length || i.createException('NoSuchElement', 'No more element is available for current iteraion!'),
        this.__compArr.pop()
      },
      hasNext: function () {
        return !!this.__compArr.length
      }
    })
  }),
  define('xdk-ax/focusManager', [
    'xdk-ax/Component',
    'xdk-base/util',
    'xdk-ax/evt/eventManager',
    'xdk-ax/evt/type',
    'xdk-base/device/vKey',
    'xdk-base/console',
    'xdk-base/config',
    'xdk-ax/iterator/BFSCompIt',
    'xdk-ax/iterator/AFSCompIt',
    'xdk-ax/Container',
    'xdk-base/core',
    'xdk-base/exception'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u) {
    'use strict';
    function h(e) {
      for (var t; !t && (e = e.getParent()); ) t = e.getOption('forwardFocus');
      return t
    }
    function _(e) {
      var t,
      i,
      n;
      if (e.isLeaf()) return null;
      for (n = e.getChildren(), i = 0; i < n.length; i++) if (t = n[i], b(t)) return t;
      return null
    }
    function f(e, t) {
      var i,
      n,
      s,
      r = null;
      if (e.isLeaf()) return null;
      for (s = e.getChildren(), n = 0; n < s.length; n++) if (i = s[n], r = g(i, t)) return r;
      return r
    }
    function p(t) {
      var i = t._lastFocusChild;
      return i instanceof e && t.isAncestorOf(i) && b(i) ? (r.info('Using last focus for forward focus'), i) : (r.info('Find the next level focusable item'), _(t))
    }
    var g,
    v,
    m,
    E,
    b,
    y,
    k,
    S,
    x = null,
    T = null,
    C = null,
    A = null;
    return g = function (i, n) {
      if (!i) return null;
      if (b(i)) return i;
      var s,
      r;
      if (!0 === (s = i.getOption('forwardFocus'))) (r = p(i)) || (r = f(i, !0));
       else {
        if (!1 === s) return null;
        t.isUndefined(s) ? n ? r = f(i, n) : !0 === (s = h(i)) && ((r = p(i)) || (r = f(i, !0))) : r = s
      }
      return r && t.isString(r) && (r = i.find(r)),
      r && r instanceof e ? b(r) ? r : g(r) : null
    },
    k = function (e) {
      return e._focused || !1
    },
    y = function (e) {
      return e._root.hasClass('focus-trail') || !t.isUndefined(e._focusTrail) && e._focusTrail
    },
    b = function (e) {
      return !(e._disabled || e.isHidden() || e.isAncestorHidden()) && e.getOption('focusable', !1)
    },
    S = function (e) {
      return e._lastFocused
    },
    v = function (e) {
      e = e || T.getView();
      for (var t, i = 0, n = null, s = new d(e); s.hasNext(); ) t = s.next(),
      b(t) ? i < S(t) && (n = t, i = S(t)) : t = t.getParent();
      return i ? n : null
    },
    function () {
      x.focus(v(), {
        noActive: !0
      })
    },
    m = function (e, t) {
      var s,
      r = A.getParent();
      for (e.removeClass('focused'), e._focused = !1; r; ) x.isCompFocusTrailOn(r) ? r.removeClass('focus-trail') : r._focusTrail = !1,
      r = r.getParent();
      t && (s = {
        relatedTarget: t
      }),
      i.trigger(n.BLUR, A, s),
      C = A,
      A = null
    },
    E = function (e, t, s) {
      var o,
      a = e.getParent();
      for (A = e, e.getRoot().addClass('focused'), e._focused = !0, e._lastFocused = (new Date).getTime(); a; ) x.isCompFocusTrailOn(a) ? a.getRoot().addClass('focus-trail') : a._focusTrail = !0,
      !0 === a.getOption('forwardFocus') && (a._lastFocusChild = e),
      a = a.getParent();
      s && s.noActive || A.setActive(),
      r.info('[FocusMgr] focused on component ' + A + ' with id\'' + A.getId() + '\''),
      t && (o = {
        relatedTarget: t
      }),
      i.trigger(n.FOCUS, A, o)
    },
    x = {
      FOCUS_UP: 1,
      FOCUS_DOWN: 2,
      FOCUS_LEFT: 4,
      FOCUS_RIGHT: 8,
      _setRootController: function (e) {
        T = e
      },
      setFocusRoot: function (e) {
        if (e && !(e instanceof c)) throw l.createException(u.ILLEGAL_ARGUMENT, 'Focus root should be an instance of xdk-ax/Container');
        this._focusRoot = e,
        r.info('[focusManager] focus root is set to [' + (e ? e.getId() : e) + ']')
      },
      getFocusRoot: function () {
        return this._focusRoot
      },
      _isComponentOutsideFocusRoot: function (e) {
        return this._focusRoot && !(e.isDescendantOf(this._focusRoot) || e === this._focusRoot)
      },
      focus: function (i, n) {
        if (n = n || {
        }, !i) return A && m(A),
        !0;
        var s,
        o = !!n.skipForwardFocus,
        a = null,
        d = A;
        if (i.getOption('focusable')) {
          if (t.isFunction(i.onRequestFocus) && (s = i.onRequestFocus()), t.isString(s) && (s = i.find(s)), s instanceof e) return x.focus(s);
          if (s) return !0
        } else if (!o) return a = g(i),
        a instanceof e ? a === i ? (r.warn('[focusManager] forward focus is the same as the original component, abort focus process.'), !1) : x.focus(a) : (r.warn('[focusManger] no valid forward focus, abort focus process.'), !1);
        return this._isComponentOutsideFocusRoot(i) ? (r.warn('[focusManager] the requested focus target [' + i.getId() + '] is out of the focus root [' + this._focusRoot.getId() + ']'), !1) : b(i) ? (A && !k(i) && m(A, i), E(i, d, n), !0) : (r.warn('Delegated component is not Focusable! Component ID: ' + i.getId()), !1)
      },
      getCurFocus: function () {
        return A || null
      },
      directionalFocusChangeByKey: function (e, t) {
        var i = !1;
        switch (e.id) {
          case s.UP.id:
            i = this.directionalFocusChange(x.FOCUS_UP, t);
            break;
          case s.DOWN.id:
            i = this.directionalFocusChange(x.FOCUS_DOWN, t);
            break;
          case s.LEFT.id:
            i = this.directionalFocusChange(x.FOCUS_LEFT, t);
            break;
          case s.RIGHT.id:
            i = this.directionalFocusChange(x.FOCUS_RIGHT, t)
        }
        return i
      },
      directionChangeByKey: function (e, t) {
        var i = !1;
        switch (e.id) {
          case s.UP.id:
            i = this.directionChange(x.FOCUS_UP, t);
            break;
          case s.DOWN.id:
            i = this.directionChange(x.FOCUS_DOWN, t);
            break;
          case s.LEFT.id:
            i = this.directionChange(x.FOCUS_LEFT, t);
            break;
          case s.RIGHT.id:
            i = this.directionChange(x.FOCUS_RIGHT, t)
        }
        return i
      },
      directionalFocusChange: function (e, t) {
        return !!this.directionChange(e, t)
      },
      directionChange: function (i, n) {
        if (n && !this.isCompChildFocused(n)) return r.warn('Directional focus change is not possible!'),
        !1;
        n = n || T.getView();
        var s,
        o,
        a;
        if (!A) {
          if (!(s = v())) return !1;
          if (this.focus(s)) return s
        }
        for (a = A, i === x.FOCUS_UP ? i = 'nextUp' : i === x.FOCUS_DOWN ? i = 'nextDown' : i === x.FOCUS_LEFT ? i = 'nextLeft' : i === x.FOCUS_RIGHT && (i = 'nextRight'); a && a !== n; ) {
          if (this._isComponentOutsideFocusRoot(a)) return r.warn('[focusManager] abort direction check: the parent component [' + a.getId() + '] is out of the focus root [' + this._focusRoot.getId() + ']'),
          !1;
          if (o = a.getOption(i), t.isFunction(o) && (o = o.call(A), r.debug('directional focus callback return value: ' + o)), !0 === o) return o;
          if (!1 === o || t.isUndefined(o)) a = a.getParent();
           else {
            if (null === o) return !0;
            if (t.isString(o)) {
              s = n.find(o),
              s || n === T.getView() || (s = T.getView().find(o));
              break
            }
            if (o instanceof e) {
              s = o;
              break
            }
            a = a.getParent()
          }
        }
        return !!s && (this.focus(s) ? s : void 0)
      },
      ensureFocus: function () {
        return !!A || !!C && this.focus(C)
      },
      setCompFocusTrail: function (e, i) {
        return t.isBoolean(i) && (e._enableTrail = i),
        e._enableTrail
      },
      resetCompFocusTrail: function (e) {
        return e._enableTrail = void 0,
        e._enableTrail
      },
      isCompFocusTrailOn: function (e) {
        return e && t.isUndefined(e._enableTrail) ? o.get('ui.focus.enableTrail', !0) : !!e._enableTrail
      },
      getLastActiveFocus: v,
      isCompFocused: k,
      isCompChildFocused: y,
      isCompFocusable: b,
      getCompLastFocusedTime: S
    }
  }),
  define('xdk-ui-basic/Label', [
    'xdk-base/class',
    'xdk-ax/Component',
    'xdk-base/Element',
    'xdk-base/util',
    'xdk-ax/mvc/ModelRef',
    'xdk-base/console'
  ], function (e, t, i, n, s, r) {
    'use strict';
    return e.create(t, {
    }, {
      _lastModelRef: null,
      _modelListener: null,
      init: function (e) {
        e.text = e.text || '',
        e.root = new i('div'),
        e.root.addClass('wgt-label'),
        this._super(e),
        this.setText(e.text, !!e.isPureText)
      },
      deinit: function () {
        this._lastModelRef && this._modelListener && (this._lastModelRef.getModel().off('change:' + this._lastModelRef.getAttr(), this._modelListener), this._lastModelRef = null),
        this._modelListener = null,
        this._super()
      },
      _isPureText: !1,
      setText: function (e, t) {
        this._lastModelRef && this._modelListener && (this._lastModelRef.getModel().off('change:' + this._lastModelRef.getAttr(), this._modelListener), this._lastModelRef = null),
        t = !!t,
        this._isPureText = t;
        var i = n.bind(function (e) {
          this._isPureText ? this.getRoot().setInnerText(e) : this.getRoot().setInnerHTML(e)
        }, this);
        e instanceof s && (this._modelListener || (this._modelListener = n.bind(function (e, t) {
          var n = t.newVal;
          void 0 !== n && null !== n || (r.warn('[Label] Text' + (e ? ' of label ' + e : '') + ' binded to the model value is changing to an undesired data type/value: ' + n), n = ''),
          i(n)
        }, null, this.getOption('id', void 0))), e.getModel().on('change:' + e.getAttr(), this._modelListener), this._lastModelRef = e, e = e.getVal()),
        i(e)
      },
      getText: function () {
        return this._isPureText ? this.getRoot().getInnerText() : this.getRoot().getInnerHTML()
      }
    })
  }),
  define('css', [
  ], function () {
    'use strict';
    function e(e, t) {
      - 1 === e.indexOf('.css') && (e += '.css');
      var n = document.createElement('link');
      n.type = 'text/css',
      n.rel = 'stylesheet',
      n.href = e,
      i.appendChild(n),
      t(e)
    }
    var t = {
      dynamic: !1,
      pluginBuilder: 'xdk-base/loader/cssBuilder'
    },
    i = document.getElementsByTagName('head') [0];
    return t.load = function (t, i, n) {
      e(i.toUrl(t), function (e) {
        n(e)
      })
    },
    t
  }),
  define('css', function () {
  }),
  define('css!xdk-ui-basic/css/Button', [
  ], function () {
  }),
  define('xdk-ui-basic/Button', [
    'xdk-base/class',
    'xdk-ax/Container',
    'xdk-ui-basic/Label',
    'xdk-base/Element',
    'css!./css/Button'
  ], function (e, t, i, n) {
    'use strict';
    return e.create(t, {
    }, {
      _label: null,
      init: function (e) {
        e.focusable = !0,
        e.clickable = !0,
        e.text = e.text || '',
        e.root = e.root || new n('div'),
        this._super(e),
        this.getRoot().addClass('wgt-button'),
        this._label = new i({
          text: e.text,
          isPureText: !!e.isPureText,
          parent: this
        })
      },
      setText: function (e, t) {
        this._label.setText(e || '', !!t)
      },
      getText: function () {
        return this._label.getText()
      }
    })
  }),
  define('css!xdk-ui-basic/css/Layout', [
  ], function () {
  }),
  define('xdk-ui-basic/Layout', [
    'xdk-base/class',
    'xdk-ax/Container',
    'xdk-ax/focusManager',
    'xdk-ax/evt/type',
    'xdk-base/device/vKey',
    'xdk-base/util',
    'css!./css/Layout'
  ], function (e, t, i, n, s, r) {
    'use strict';
    return e.create(t, {
      VERTICAL: 1,
      HORIZONTAL: 2
    }, {
      _rows: [
      ],
      init: function (e) {
        r.isBoolean(e.autoNavigation) || (e.autoNavigation = !0),
        e.alignment || (e.alignment = this.constructor.HORIZONTAL),
        r.isUndefined(e.width) && (e.width = e.children ? e.children.length : 10),
        this._super(e),
        this._root.addClass('wgt-layout'),
        e.alignment === this.constructor.HORIZONTAL ? this._root.addClass('align-h') : this._root.addClass('align-v')
      },
      postInit: function () {
        this._super(),
        this._opts.autoNavigation && this.addEventListener(n.KEY, this._keyHandler)
      },
      __redraw: function () {
        var e,
        t,
        i,
        n,
        s,
        r;
        for (n = this._children, s = this._opts.width, this._rows.length = 0, this.getRoot().removeAll(), this.__refresh(), i = 0; i < n.length; i++) e = Math.floor(i / s),
        t = i % s,
        e > 0 ? (r = this._rows[t][e - 1], this._root.insertAfter(r.getRoot(), n[i].getRoot())) : this._root.append(n[i].getRoot())
      },
      __refresh: function (e) {
        r.isUndefined(e) && (e = 0);
        var t,
        i,
        n,
        s,
        o = this._opts.width,
        a = this._opts.alignment,
        d = this._children.slice(0);
        for (s = e; s < d.length; s++) n = d[s],
        a === this.constructor.HORIZONTAL ? (t = Math.floor(s / o), i = s % o) : (i = Math.floor(s / o), t = s % o),
        this.__updateChild(n, t, i)
      },
      __updateChild: function (e, t, i) {
        var n;
        return n = this._opts.alignment === this.constructor.HORIZONTAL ? this._opts.width - 1 : (i + 1) * this._opts.width + t >= this._children.length ? i : Math.floor((this._children.length - 1) / this._opts.width),
        e.removeClass('row-begin'),
        e.removeClass('row-end'),
        this._rows[t] || (this._rows[t] = [
        ]),
        this._rows[t][i] = e,
        e.getRoot().css({
          float: 'left'
        }),
        e.getRoot().css({
          clear: 'none'
        }),
        0 === i && (e.addClass('row-begin'), e.getRoot().css({
          clear: 'left'
        })),
        i === n && e.addClass('row-end'),
        e
      },
      _doAttach: function (e, i, n) {
        var s,
        o,
        a,
        d,
        c,
        l,
        u,
        h = this._opts.width,
        _ = this._opts.alignment;
        if (o = r.indexOf(this._children, e), _ === this.constructor.HORIZONTAL ? (d = Math.floor(o / h), a = o % h) : (a = Math.floor(o / h), d = o % h), this.__updateChild(e, d, a), u = this._children, this.getRoot().isInDOMTree() && (l = this.getRoot().getHTMLElement().nextSibling, c = this.getRoot().getParent(), c.removeChild(this.getRoot())), _ === this.constructor.HORIZONTAL) {
          switch (i) {
            case t.PLACE_APPEND:
              this._root.append(e.getRoot());
              break;
            case t.PLACE_PREPEND:
              this._root.prepend(e.getRoot());
              break;
            case t.PLACE_BEFORE:
              this._root.insertBefore(n.getRoot(), e.getRoot());
              break;
            case t.PLACE_AFTER:
              this._root.insertAfter(n.getRoot(), e.getRoot())
          }
          o + 1 < u.length && this.__refresh(o + 1)
        } else this.__refresh(),
        i === t.PLACE_APPEND ? a > 0 ? (s = this._rows[d][a - 1], this._root.insertAfter(s.getRoot(), e.getRoot())) : this._root.append(e.getRoot()) : this.__redraw();
        c && (l ? c.insertBefore(l, this.getRoot()) : c.append(this.getRoot()))
      },
      detach: function (e) {
        if (!e) return this._super();
        var t,
        i,
        n = r.indexOf(this._children, e),
        s = this._super(e);
        return this._opts.alignment === this.constructor.HORIZONTAL ? (this.__refresh(n), this._rows[this._rows.length - 1].splice([this._rows[this._rows.length - 1].length - 1], 1), 0 === this._rows[this._rows.length - 1].length && this._rows.splice(this._rows.length - 1, 1), s) : (this.getRoot().isInDOMTree() && (i = this.getRoot().getHTMLElement().previousSibling, t = this.getRoot().getParent(), t.removeChild(this.getRoot())), this.__redraw(), t && (i ? t.insertAfter(i, this.getRoot()) : t.append(this.getRoot())), s)
      },
      getAlignment: function () {
        return this._opts.alignment
      },
      _keyHandler: function (e) {
        if (this._opts.autoNavigation) {
          var t,
          n,
          o,
          a,
          d,
          c,
          l,
          u = e.id,
          h = this._opts.width,
          _ = this._opts.alignment;
          switch (u) {
            case s.UP.id:
            case s.DOWN.id:
            case s.LEFT.id:
            case s.RIGHT.id:
              t = i.directionChangeByKey(e, this);
              break;
            default:
              return
          }
          if (t) return !1;
          for (n = i.getCurFocus(), a = n, o = a.getParent(); o && o !== this; ) a = o,
          o = a.getParent();
          if (o) for (d = r.indexOf(this._children, a); d >= 0; ) {
            switch (_ === this.constructor.HORIZONTAL ? (c = Math.floor(d / h), l = d % h) : (l = Math.floor(d / h), c = d % h), e.id) {
              case s.UP.id:
                c--;
                break;
              case s.DOWN.id:
                c++;
                break;
              case s.LEFT.id:
                l--;
                break;
              case s.RIGHT.id:
                l++
            }
            if (this._opts.connectRows && (_ === this.constructor.HORIZONTAL && (l >= h || l < 0) ? (c += Math.floor(l / h), l = (l % h + h) % h) : (c >= h || c < 0) && (l += Math.floor(c / h), c = (c % h + h) % h)), !this._rows[c] || !this._rows[c][l]) return;
            if (i.focus(this._rows[c][l])) return !1;
            d = r.indexOf(this._children, this._rows[c][l])
          }
        }
      }
    })
  }),
  define('css!xdk-ui-basic/css/Dialog', [
  ], function () {
  }),
  define('xdk-ui-basic/Dialog', [
    'xdk-base/class',
    'xdk-ax/Container',
    'xdk-ax/focusManager',
    'xdk-ui-basic/Layout',
    'xdk-ui-basic/Button',
    'xdk-ui-basic/Label',
    'xdk-base/util',
    'xdk-ax/evt/type',
    'xdk-base/console',
    'xdk-base/device/vKey',
    'require',
    'css!./css/Dialog'
  ], function (e, t, i, n, s, r, o, a, d, c, l) {
    'use strict';
    return e.create(t, {
    }, {
      _headerComp: null,
      _contentComp: null,
      _footerComp: null,
      _overlay: null,
      _view: null,
      _container: null,
      _isOpen: !1,
      _buttons: null,
      _lastFocus: null,
      init: function (e) {
        e = e || {
        },
        e.focusable = !1,
        o.isUndefined(e.forwardFocus) && (e.forwardFocus = !0),
        e.dialogCss = e.dialogCss || '',
        this._super(e),
        this._root.addClass('wgt-dialog'),
        !1 !== e.modal && (this._root.addClass('wgt-dialog-modal'), this._overlay = new t({
          parent: this,
          css: 'wgt-dialog-overlay'
        })),
        !1 !== e.horizontalFooter && (e.horizontalFooter = !0),
        this._headerComp = new t({
          css: 'wgt-dialog-header',
          nextDown: o.bind(function () {
            return this._contentComp
          }, this)
        }),
        this._contentComp = new t({
          css: 'wgt-dialog-content',
          nextUp: o.bind(function () {
            return this._headerComp
          }, this),
          nextDown: o.bind(function () {
            return this._footerComp
          }, this)
        }),
        this._footerComp = new t({
          css: 'wgt-dialog-footer',
          nextUp: o.bind(function () {
            return this._contentComp
          }, this)
        }),
        this._container = new t({
          type: t,
          parent: this,
          css: 'wgt-dialog-container ' + e.dialogCss,
          children: [
            this._headerComp,
            this._contentComp,
            this._footerComp
          ]
        });
        var i,
        c,
        l = this,
        u = e.header,
        h = e.content,
        _ = e.footer;
        o.isString(e.title) && (u = new r({
          text: e.title,
          isPureText: e.isPureText
        })),
        u && this._headerComp.attach(u),
        o.isString(h) && (h = new r({
          text: e.content,
          isPureText: e.isPureText
        })),
        h ? (this._contentComp.attach(h), this._contentComp.setOption('forwardFocus', h), this.setOption('forwardFocus', this._contentComp)) : d.info('Dialog widget: content is set to empty!'),
        e.closeText && (e.buttons = e.buttons || [
        ], e.buttons.push({
          text: e.closeText,
          click: function () {
            this.close()
          }
        })),
        !_ && e.buttons && e.buttons.length && (i = [
        ], o.each(e.buttons, function (t) {
          c = new s({
            text: t.text,
            isPureText: e.isPureText
          }),
          c.addEventListener(a.CLICK, o.bind(t.click, l)),
          i.push(c)
        }), _ = new n({
          alignment: e.horizontalFooter ? n.HORIZONTAL : n.VERTICAL,
          fowardFocus: !0,
          children: i
        }), _.setOption('forwardFocus', i[0]), this._buttons = i),
        _ && (this._footerComp.attach(_), this._footerComp.setOption('forwardFocus', _), this.setOption('forwardFocus', this._footerComp)),
        !1 !== e.autoOpen && this.open(),
        this.addEventListener(a.KEY, this._keyHandler)
      },
      attachToHeader: function (e, t, i) {
        this._headerComp.attach(e, t, i)
      },
      attachToContent: function (e, t, i) {
        this._contentComp.attach(e, t, i)
      },
      attachToFooter: function (e, t, i) {
        this._footerComp.attach(e, t, i)
      },
      open: function () {
        var e = this._opts.parent;
        e = e || (this.getRootController() || l('xdk-ax/mvc/AppRoot').singleton()).getView(),
        e.attach(this),
        this._isOpen = !0,
        this.dispatchEvent(a.OPEN),
        this._buttons && this._buttons.length ? (this._lastFocus = i.getCurFocus(), i.focus(this)) : this.setActive()
      },
      close: function () {
        this.detach(),
        this._isOpen = !1,
        this.dispatchEvent(a.CLOSE),
        this._lastFocus && (i.focus(this._lastFocus), this._lastFocus = null)
      },
      _keyHandler: function (e) {
        if (!1 === this._opts.closeOnBack) return !0;
        switch (e.id) {
          case c.UP.id:
          case c.DOWN.id:
          case c.LEFT.id:
          case c.RIGHT.id:
            return i.directionalFocusChangeByKey(e, this),
            !1;
          case c.BACK.id:
            return this.close(),
            !1;
          default:
            return
        }
      }
    })
  }),
  define('app/utils/Constants', [
  ], function () {
    'use strict';
    return {
      AD_TIMEOUT: 30,
      AD_TYPE: {
        PRE: 'pre',
        MID: 'mid',
        POS: 'pos'
      },
      FACEBOOK_CHECKER_INTERVAL: 5,
      ErrorCode: {
        FACEBOOK_SESSION_EXPIRED: 463,
        FACEBOOK_PENDING_ACTION: 31,
        FACEBOOK_PENDING_ERROR_CODE: 206001,
        GENERIC: 400
      },
      ErrorMessage: {
        ERROR_UNKNOWN: 'UNKNOWN ERROR',
        AUTH_GENERAL: 'auth_general',
        APP_GENERAL: 'app_general',
        PLAYBACK_GENERAL: 'playback_general',
        FB_PENDING: 'auth_206001'
      },
      Messages: {
        Buttons: {
          BACK: 'Back',
          CONTINUE: 'Continue',
          FORGOT_PASSWORD: 'Forgot Password',
          GET_NEW_CODE: 'Get new code',
          LOGIN: 'Login',
          LOGIN_WITH_FACEBOOK: 'Login with Facebook'
        },
        Login: {
          CODE_EXPIRED: 'Code Expired',
          EMAIL: 'Email',
          ERROR: 'Login Error',
          FACEBOOK_CODE_EXPIRED: 'Facebook code has expired',
          FACEBOOK_URL: 'facebook.com/device',
          GO_TO: 'Go to',
          HEADER: 'Please Login with your account',
          LOGIN_WITH_FACEBOOK: 'Log in with Facebook',
          LOGIN_WITH_FACEBOOK_MESSAGE: 'on your desktop or smartphone and enter this code:',
          OR: 'or',
          PASSWORD: 'Password',
          SIGNUP_MESSAGE: 'If you don\'t have a Three ID you can create one online at threenow.co.nz/login',
          RESET_PASSWORD: 'Reset Password',
          RESET_PASSWORD_MESSAGE: 'To reset your password, please visit threenow.co.nz/login, click the LOG IN button then click on Forgotten your password? at the bottom of the page and then enter your Email Address',
          SUCCESS: 'Success!',
          SUCCESS_MESSAGE: 'You are now logged in as ',
          WATCH_LOGIN_TITLE: 'ThreeNow',
          WATCH_LOGIN_CONTENT: 'Watch your favourite TV shows on demand. Enjoy full episodes, video extras and finish watching where you left off on any device.'
        },
        Logout: {
          TITLE: 'Logout',
          MESSAGE: 'Are you sure you want to log out?',
          CONFIRM: 'Yes',
          CANCEL: 'No'
        },
        Search: {
          SEARCH_FOR: 'Search for Show or Movie',
          INITIAL_MESSAGE: 'Start typing to find a show or movie',
          MORE_CHARACTER: 'Please enter more than 1 character',
          NO_RESULT: 'Sorry, no result found',
          SEARCH_RESULT: 'Search results of \'%1\''
        },
        Network: {
          TITLE: 'Network Disconnected'
        },
        Exit: {
          TITLE: 'Confirm Exit',
          MESSAGE: 'Are you sure you want to exit?',
          YES: 'Yes',
          CANCEL: 'Cancel'
        },
        Continue: {
          TITLE: 'Continue Playback?',
          MESSAGE: 'Would you like to resume playback at last played position?',
          YES: 'Yes, Resume playback from %time',
          NO: 'No, Play from beginning'
        }
      },
      Home: {
        CONTINUE_WATCHLIST_TITLE: 'CONTINUE WATCHING'
      },
      Details: {
        EPISODES_BELT_TITLE: 'EPISODES',
        SEASONS_BELT_TITLE: 'SEASONS',
        EXTRAS_BELT_TITLE: 'EXTRAS',
        AVAIABLE_FROM: 'Available from: ',
        WATCH_NOW: 'Watch Now',
        LEFT_TO_VIEW: 'left to view',
        DAY: 'Day',
        DAYS: 'Days'
      },
      Events: {
        LAST_BELT_LOADED: 'last_belt_loaded',
        ASSET_GRID_LOADED: 'asset_grid_loaded',
        BANNER_LOADED: 'banner_loaded',
        USER_SESSION_UPDATED: 'User_Session_Updated',
        LAST_WATCHED_ITEM_FOCUS: 'last_watched_item_focus'
      }
    }
  }),
  define('app/wgt/AlertWgt', [
    'xdk-ax/Container',
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ui-basic/Button',
    'xdk-ui-basic/Dialog',
    'xdk-ui-basic/Label',
    'xdk-ui-basic/Layout',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    return n.create(o, {
    }, {
      init: function (i) {
        i = i || {
        };
        var n = [
        ],
        o = i.contentButtons || [
          {
          }
        ];
        s.each(o, s.bind(function (e) {
          var i = new r({
            text: e.buttonText || 'OK',
            css: 'button button--primary button--' + (e.buttonText ? 'full' : 'fixed-170')
          }),
          o = e.buttonClickCallback;
          i.addEventListener(t.CLICK, s.bind(this.close, this, o)),
          n.push(i)
        }, this));
        var l,
        u = s.isString(i.footerContent),
        h = {
          css: 'wgt-dialog-button-container',
          children: n
        };
        o.length > 1 ? (h.alignment = d.VERTICAL, l = new d(h)) : l = new e(h),
        i.closeText = null,
        i.forwardFocus = n[0],
        i.title = i.title || '',
        i.content = i.content || new e({
          forwardFocus: n[0],
          children: [
            new a({
              css: 'wgt-dialog-message',
              text: i.message
            }),
            l,
            new a({
              css: 'wgt-dialog-sub-message',
              text: i.subMessage
            })
          ]
        }),
        this._super(i),
        this._closeCallback = i.closeCallback,
        this.footerFull = new e({
          css: 'wgt-dialog-footer-full',
          parent: this,
          children: [
            new a({
              css: 'wgt-dialog-footer-full-text ' + (u ? '' : 'back'),
              text: u ? i.footerContent : c.Messages.Buttons.BACK
            })
          ]
        }),
        this.addClass('wgt-alert')
      },
      isOpen: function () {
        return this._isOpen
      },
      open: function () {
        this._super(),
        this._lastFocus = i.getCurFocus(),
        this.setOption('forwardFocus', this.getOption('content')),
        i.focus(this)
      },
      close: function (e) {
        this._super(),
        s.isFunction(this._closeCallback) && this._closeCallback(),
        this._closeCallback = null,
        s.isFunction(e) && e()
      }
    })
  }),
  define('app/wgt/Popup', [
    'xdk-ax/Container',
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ui-basic/Button',
    'xdk-ui-basic/Dialog',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    return n.create(o, {
    }, {
      init: function (e) {
        e = e || {
        },
        e.forwardFocus = !0,
        e.closeText = e.closeText || a.Messages.Buttons.BACK,
        this._super(e),
        this.addClass('wgt-popup')
      },
      isOpen: function () {
        return this._isOpen
      },
      open: function () {
        this._super(),
        this.setOption('forwardFocus', this.getOption('content')),
        i.focus(this)
      }
    })
  }),
  define('app/mgr/MessageDisplayHelper', [
    'xdk-base/class',
    'xdk-base/config',
    'app/wgt/AlertWgt',
    'app/wgt/Popup'
  ], function (e, t, i, n) {
    var s,
    r;
    return r = e.create({
      TYPE: {
        ALERT: 'alert',
        POPUP: 'popup'
      },
      singleton: function () {
        return s || (s = new r),
        s
      }
    }, {
      currentDisplay: null,
      isOpen: function () {
        return !!this.currentDisplay && this.currentDisplay.isOpen()
      },
      close: function () {
        this.currentDisplay && this.currentDisplay.close()
      },
      showMessage: function (e) {
        var t = {
          closeCallback: e.closeCallback,
          contentButtons: e.contentButtons,
          content: e.content,
          subMessage: e.subMessage || '',
          css: e.css || ''
        },
        s = this.constructor.TYPE;
        e.code ? t.message = e.code + ' ' + e.message : t.message = e.message,
        t.title = e.title;
        var r = e.type === s.POPUP ? n : i;
        return this.currentDisplay = new r(t),
        this.currentDisplay
      },
      showError: function (e) {
        var t = e.getCode().toString(),
        n = this.findMessageById(t);
        return n ? this.showMessage(n) : new i({
          title: 'Error',
          message: t + ' ' + e.getMessage()
        })
      },
      findMessageById: function (e) {
        if (this.__messagesConfig = this.__messagesConfig || t.get('app.messages'), !this.__messagesConfig) return null;
        e = e.toString();
        for (var i = 0, n = this.__messagesConfig.length; i < n; i++) if (this.__messagesConfig[i].id === e && this.__messagesConfig[i].message) return this.__messagesConfig[i];
        return null
      }
    })
  }),
  define('app/model/User', [
    'xdk-base/class',
    'xdk-ax/mvc/Model'
  ], function (e, t) {
    'use strict';
    return e.create(t, {
      defaults: {
        profile: {
        },
        sessionInfo: {
        },
        newUser: !1,
        uid: '',
        loginProvider: '',
        socialProvider: '',
        isActive: !1,
        isRegistered: !1,
        isVerified: !1,
        isLockedOut: !1
      }
    }, {
      init: function (e) {
        this._super(this._getAttrs(e))
      },
      _getAttrs: function (e) {
        return e = e || {
        },
        {
          profile: e.profile,
          sessionInfo: e.sessionInfo,
          newUser: e.newUser,
          uid: e.UID,
          loginProvider: e.loginProvider,
          socialProvider: e.socialProviders,
          isActive: e.isActive,
          isRegistered: e.isRegistered,
          isVerified: e.isVerified,
          isLockedOut: e.isLockedOut
        }
      }
    })
  }),
  define('app/service/LoginService', [
    'xdk-base/ajax',
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/console',
    'xdk-base/promise',
    'xdk-base/util',
    'app/model/User'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a,
    d,
    c = i.get('gigya'),
    l = i.get('facebook');
    return a = t.create({
      singleton: function () {
        return d || (d = new a),
        d
      }
    }, {
      _request: function (t) {
        var i,
        n = {
          method: t.method || 'get',
          parameters: t.param,
          requestHeaders: t.requestHeaders || {
          }
        };
        return t.url ? (i = t.url, delete t.url, e.request(i, n).then(this._getJSON).fail(r.bind(function (e) {
          throw this._getJSON(e.transport)
        }, this))) : s.reject('no url provided')
      },
      _getJSON: function (e) {
        var t = {
        };
        return e.responseJSON && (t = e.responseJSON),
        r.isUndefined(e.responseText) || '' === e.responseText || (t = JSON.parse(e.responseText)),
        t
      },
      getProfileFromFb: function (e) {
        return this.socialLogin(e).then(r.bind(function (e) {
          return this.getAccountInfo({
            UID: e
          })
        }, this))
      },
      loginWithCredential: function (e) {
        return e.format = 'json',
        e.apiKey = c.apiKey,
        this._request({
          method: 'post',
          url: c.baseUrl + c.login,
          param: e,
          requestHeaders: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }).then(this.parseUserData).fail(function (e) {
          return n.error(e),
          s.reject(e)
        })
      },
      logout: function (e) {
        var t = {
          apiKey: c.apiKey,
          secret: c.secret,
          UID: e
        };
        return this._request({
          method: 'post',
          url: c.baseUrl + c.logout,
          param: t,
          requestHeaders: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        })
      },
      getAccountInfo: function (e) {
        return e.format = 'json',
        e.apiKey = c.apiKey,
        e.secret = c.secret,
        this._request({
          method: 'get',
          url: c.baseUrl + c.getAccountInfo,
          param: e,
          requestHeaders: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }).then(this.parseUserData).fail(function (e) {
          return n.error(e),
          s.reject(e)
        })
      },
      socialLogin: function (e) {
        var t = {
          providerSessions: r.stringify({
            facebook: {
              authToken: e
            }
          }),
          format: 'json',
          apiKey: c.apiKey
        };
        return this._request({
          method: 'get',
          url: c.socialBaseUrl + c.socialLogin,
          param: t,
          requestHeaders: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }).then(function (e) {
          if (e = e || {
          }, !e.UID) throw e;
          return e.UID
        }).fail(function (e) {
          return n.error(e),
          s.reject(e)
        })
      },
      fbLogin: function (e) {
        return e.access_token = [
          l.appId,
          l.token
        ].join('|'),
        this._request({
          method: 'post',
          url: l.loginUrl,
          param: e
        })
      },
      fbStatus: function (e) {
        var t;
        return e.access_token = [
          l.appId,
          l.token
        ].join('|'),
        this._request({
          method: 'post',
          url: l.statusUrl,
          param: e,
          requestHeaders: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }).then(function (e) {
          return e.error ? s.reject(e) : e
        }).fail(function (e) {
          return t = {
            message: e.error.message,
            details: e.error.error_user_msg,
            code: e.error.code
          },
          s.reject(t)
        })
      },
      resetPassword: function (e) {
        var t;
        return e.apiKey = c.apiKey,
        e.format = 'json',
        this._request({
          method: 'post',
          url: c.baseUrl + c.resetPassword,
          param: e,
          requestHeaders: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }).then(function (e) {
          return e.errorCode ? (t = {
            message: e.errorMessage,
            details: e.errorDetails,
            status: e.statusCode,
            code: e.errorCode
          }, s.reject(t)) : e
        })
      },
      parseUserData: function (e) {
        e = e || {
        };
        var t,
        i = require('app/mgr/AnalyticsManager').singleton();
        return e.errorCode ? (t = {
          message: e.errorMessage,
          details: e.errorDetails,
          status: e.statusCode,
          code: e.errorCode
        }, i.trackLogin('error', t), s.reject(t)) : new o(e)
      }
    })
  }),
  define('app/mgr/UserManager', [
    'xdk-base/class',
    'app/service/LoginService',
    'xdk-base/util',
    'xdk-base/promise',
    'xdk-base/device/shared/LocalStorage',
    'xdk-ax/mediator',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a,
    d,
    c = t.singleton(),
    l = new s;
    return a = e.create({
      USER_STATE: {
        AUTH: 'AUTH',
        DEFAULT: 'DEFAULT',
        GUEST: 'GUEST'
      },
      singleton: function () {
        return d || (d = new a),
        d
      }
    }, {
      _currentUser: null,
      _currentActivationCode: null,
      _isLoggedIn: !1,
      login: function (e, t) {
        return c.loginWithCredential({
          loginID: e,
          password: t
        }).then(i.bind(this._loginActionAndTrackEvent, this))
      },
      getProfileFromFb: function (e) {
        return c.getProfileFromFb(e).then(i.bind(this._loginActionAndTrackEvent, this))
      },
      fbLogin: function (e) {
        return c.fbLogin({
          scope: e
        }).then(i.bind(function (e) {
          return this._currentActivationCode = e.code,
          e
        }, this))
      },
      fbStatus: function (e) {
        return c.fbStatus({
          code: e
        })
      },
      logout: function () {
        var e = this.getUserToken();
        if (e) return this._currentUser = null,
        this._isLoggedIn = !1,
        l.unset('UID'),
        r.publish(o.Events.USER_SESSION_UPDATED),
        c.logout(e)
      },
      restorePersistentLogin: function () {
        var e = l.get('UID');
        if (e) return this.getAccountInfo(e).then(i.bind(this._loginAction, this))
      },
      getAccountInfo: function (e) {
        return c.getAccountInfo({
          UID: e
        })
      },
      getUserState: function () {
        return this.constructor.USER_STATE.DEFAULT
      },
      getLoginStatus: function () {
        return this._isLoggedIn
      },
      setCurrentUser: function (e) {
        this._currentUser = e
      },
      getCurrentUser: function () {
        return this._currentUser
      },
      getUserToken: function () {
        return this._currentUser ? this._currentUser.get('uid') : ''
      },
      _loginAction: function (e) {
        return this.setCurrentUser(e),
        this._isLoggedIn = !0,
        l.set('UID', e.get('uid')),
        e
      },
      _loginActionAndTrackEvent: function (e) {
        var t = require('app/mgr/AnalyticsManager').singleton();
        return this._loginAction(e),
        t.trackLogin('success', e),
        e
      }
    })
  }),
  define('xdk-ax/data/interface/Datasource', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    var t = e.create('Datasource', {
      getTotalCount: [
      ],
      setTotalCount: [
        'count'
      ],
      hasData: [
        'from',
        'to'
      ],
      getRange: [
        'from',
        'to'
      ],
      setDataLoader: [
        'loaderFn'
      ],
      setDataUpdater: [
        'updaterFn'
      ],
      fetch: [
        'from',
        'size'
      ],
      remove: [
        'from',
        'to'
      ],
      insert: [
        'newData',
        'index'
      ],
      reset: [
      ]
    });
    return t.ACTION = {
      INSERT: 'insert',
      REMOVE: 'remove',
      FETCH: 'fetch',
      RESET: 'reset'
    },
    t
  }),
  define('xdk-ax/data/Datasource', [
    'xdk-base/class',
    'xdk-base/EventDispatcher',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/promise',
    'xdk-base/console',
    'xdk-base/exception',
    'xdk-ax/data/interface/Datasource'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    return e.create(t, [
      a
    ], {
      EVT_UPDATED: 'ui:ds:updated'
    }, {
      __minFetchSize: 1,
      _totalCount: - 1,
      _dataLoader: null,
      _dataUpdater: null,
      _data: [
      ],
      __dataObjArray: [
      ],
      getTotalCount: function () {
        return this._totalCount
      },
      setTotalCount: function (e) {
        var t = this._totalCount;
        return this._totalCount = e,
        - 1 === t ? void (this._data = new Array(e)) : t < e ? void (this._data = this._data.concat(new Array(e - t))) : this._data.length > e ? void this._data.splice(e, this._data.length - e) : void 0
      },
      setMinFetchSize: function (e) {
        this.__minFetchSize = e
      },
      getMinFetchSize: function () {
        return this.__minFetchSize
      },
      hasData: function (e, t) {
        return (e < 0 || e >= this.getTotalCount() || t < 0 || t > this.getTotalCount()) && !1,
        this.__hasFetchedData(e, t)
      },
      getRange: function (e, t) {
        var r,
        o,
        a = this.getTotalCount(),
        d = this,
        c = [
        ];
        if (n.isUndefined(t) && (t = this.getTotalCount()), e < 0 || e >= t || e > 0 && - 1 === t) return s.reject(i.createException('IncorrectParam', 'Incorrect "from" or "to" parameter!'));
        if ( - 1 !== a && e >= a) return s.reject(i.createException('IncorrectState', 'No more data available!'));
        if (c = this.__checkFetchedData(e, t), 0 === c.length) return s.resolve(this.__getFetchedData(e, t));
        for (o = s.resolve(), r = 0; r < c.length; r++) o = o.then(n.bind(function (e, t) {
          var i,
          n;
          return d.hasData(e, t) ? s.resolve() : (i = e, n = t - i, d._load(i, n))
        }, null, c[r].from, c[r].to));
        return o.then(function () {
          return d.__getFetchedData(e, t)
        })
      },
      setDataLoader: function (e) {
        this._dataLoader = e
      },
      setDataUpdater: function (e) {
        this._dataUpdater = e
      },
      fetch: function (e, t) {
        return this._load(e, t).then(n.bind(function (t) {
          this.dispatchEvent(this.constructor.EVT_UPDATED, {
            action: a.ACTION.FETCH,
            newData: t,
            index: e,
            length: t.length
          })
        }, this))
      },
      _load: function (e, t) {
        var i,
        s = t,
        r = this.getTotalCount();
        return e = e || 0,
        t = t || 0,
        t < this.__minFetchSize && (t = this.__minFetchSize, - 1 !== r && e + t > r && (t = r - e), this.hasData(e + s, e + t) && (t = s)),
        i = {
          from: e,
          size: t
        },
        this._dataLoader(e, t).then(n.bind(this._processFetchedData, this, i))
      },
      _processFetchedData: function (e, t) {
        var s = t.data,
        r = t.total,
        a = e.from,
        d = a;
        if (n.isNumber(r) && this.setTotalCount(r), n.isNumber(t.from) && (d = t.from), !s) throw i.createException(o.ILLEGAL_ARGUMENT, 'Data is missing');
        return n.isArray(s) || (s = [
          s
        ]),
        this.__setFetchedData(d, s),
        this.__getFetchedData(a, a + e.size)
      },
      remove: function (e, t) {
        return n.isNumber(e) ? (n.isNumber(t) || (t = e + 1), n.isFunction(this._dataUpdater) ? this._dataUpdater(a.ACTION.REMOVE, {
          from: e,
          to: t
        }).then(n.bind(function (e) {
          if (!e) return s.reject(i.createException('Datasource: invalid data update via remove: no removed data received'));
          var t = e.from,
          r = e.to,
          o = [
          ];
          n.isNumber(t) && (o = this.__removeFetchedData(t, r)),
          this.dispatchEvent(this.constructor.EVT_UPDATED, {
            action: a.ACTION.REMOVE,
            index: t,
            length: o.length,
            removedData: o
          })
        }, this)) : s.reject(i.createException('Datasource: invalid data updater function.'))) : s.reject(i.createException('Invalid param'))
      },
      insert: function (e, t) {
        return n.isArray(e) || (e = [
          e
        ]),
        n.isNumber(t) || (t = this.getTotalCount()),
        n.isFunction(this._dataUpdater) ? this._dataUpdater(a.ACTION.INSERT, {
          newData: e,
          from: t
        }).then(n.bind(function (e) {
          if (!e) throw i.createException('Datasource: invalid data update via insert: no new data received');
          var t = e.newData,
          s = e.index;
          n.isArray(t) && this.__insertFetchedData(s, t),
          this.dispatchEvent(this.constructor.EVT_UPDATED, {
            action: a.ACTION.INSERT,
            index: s,
            length: t.length,
            newData: t
          })
        }, this)) : s.reject(i.createException('Datasource: invalid data updater function.'))
      },
      getFetchedCount: function () {
        return this._data.length
      },
      getFetchedData: function (e) {
        return e < 0 || e >= this._data.length ? null : this._data[e]
      },
      getAllFetchedData: function () {
        return this._data
      },
      reset: function () {
        this.__minFetchSize = 1,
        this._data.length = 0,
        this.__dataObjArray.length = 0,
        this._totalCount = - 1,
        this.dispatchEvent(this.constructor.EVT_UPDATED, {
          action: a.ACTION.RESET
        })
      },
      __removeFetchedData: function (e, t) {
        var i,
        s = [
        ],
        o = e,
        a = e,
        d = !1,
        c = !1,
        l = this.__dataObjArray.length;
        return n.isNumber(a) && t > 0 && (a = t - 1),
        i = a - o + 1,
        n.each(this.__dataObjArray, n.bind(function (e, t) {
          return c && a < e.start || a < e.start && o < e.start ? (e.start -= i, e.end -= i, t < l - 1 ? e.next -= i : e.next = - 1, d ? void (t > 0 ? e.prev -= i : e.prev = - 1) : void (d = !0)) : o > e.end ? void (e.next > a && (e.next -= i)) : o >= e.start && o <= e.end && a >= e.start && a <= e.end ? (e.end -= i, c = !0, void r.debug('remove dataset completely inside the cur data set ' + o)) : o <= e.start && e.end <= a ? (s.push(t), t > 0 ? this.__dataObjArray[t - 1].next = e.next - i : this.__dataObjArray[t].next = - 1, t < l - 1 ? this.__dataObjArray[t + 1].prev = e.prev : this.__dataObjArray[t].prev = - 1, c = !0, void r.debug('remove dataset completely cover the cur data set ' + o)) : o < e.start && e.start <= a ? (e.start = o, e.end -= i, t > 0 ? this.__dataObjArray[t - 1].next = e.start : e.prev = - 1, t < l - 1 ? this.__dataObjArray[t + 1].prev = e.end : e.next = - 1, c = !0, t > 0 && - 1 !== e.prev && e.prev + 1 === e.start && (this.__dataObjArray[t - 1].end = e.end, this.__dataObjArray[t - 1].next = e.next, s.push(t)), void r.debug('remove dataset overlap with the cur data set startIndex ' + o)) : o > e.start && e.end <= a ? (e.end = o - 1, t < l - 1 ? this.__dataObjArray[t + 1].prev = e.end : this.__dataObjArray[t].prev = - 1, c = !0, void r.debug('remove dataset overlap with the cur data set endIndex' + o)) : void 0
        }, this)),
        n.each(s, n.bind(function (e, t) {
          this.__dataObjArray.splice(e - t, 1)
        }, this)),
        this._totalCount -= i,
        this._data.splice(o, i)
      },
      __insertFetchedData: function (e, t) {
        var i,
        s = - 1,
        o = e,
        a = t.length,
        d = o + a - 1,
        c = !1,
        l = !1,
        u = this.__dataObjArray.length;
        return 0 === this.__dataObjArray.length ? (i = {
          prev: - 1,
          next: - 1,
          start: o,
          end: d
        }, this.__dataObjArray.push(i), this._totalCount += a, this._data.splice.apply(this._data, [
          i.start,
          0
        ].concat(t)), this) : (n.each(this.__dataObjArray, n.bind(function (e, t) {
          return l ? (e.start += a, e.end += a, t < u - 1 ? e.next += a : e.next = - 1, c ? void (t > 0 ? e.prev += a : e.prev = - 1) : void (c = !0)) : o < e.start && o > e.prev ? (s = t, l = !0, i = {
            prev: e.prev,
            next: e.start + a,
            start: o,
            end: d
          }, e.prev = d, e.end += a, void (e.start += a)) : o > e.end && (e.next > d || - 1 === e.next) ? (s = t + 1, l = !0, i = {
            prev: e.end,
            next: - 1 !== e.next ? e.next + a : - 1,
            start: o,
            end: d
          }, e.next = o, void (t < this.__dataObjArray.length - 1 && (this.__dataObjArray[t + 1].prev = d))) : o >= e.start && o <= e.end ? (e.end += a, l = !0, void r.debug('insert dataset completely inside the cur data set ' + o)) : void 0
        }, this)), s > - 1 && i && this.__dataObjArray.splice(s, 0, i), this._totalCount += a, this._data.splice.apply(this._data, [
          o,
          0
        ].concat(t)), this)
      },
      __setFetchedData: function (e, t) {
        var i,
        s,
        o = {
          start: e,
          prev: - 1,
          next: - 1,
          end: e + t.length - 1
        },
        a = !1,
        d = 0;
        return - 1 !== this.getTotalCount() && o.end >= this.getTotalCount() ? (r.warn(e + t.length + 'the size is over the total available size' + this.getTotalCount()), this) : 0 === this.__dataObjArray.length ? (this.__dataObjArray.push(o), this._data.splice.apply(this._data, [
          o.start,
          t.length
        ].concat(t)), this) : (n.each(this.__dataObjArray, n.bind(function (e, c) {
          if (s = this.__dataObjArray.length, !(c !== s - 1 && o.start > e.end + 1)) {
            if (( - 1 === e.prev || e.prev < o.start) && o.end + 1 < e.start) return d = c,
            o.next = e.start,
            o.prev = e.prev,
            a = !0,
            r.debug('complete before the data set with startIndex ' + e.start),
            n.breaker;
            if (( - 1 === e.next || e.next > o.end) && o.start > e.end + 1) return d = c + 1,
            o.prev = e.end,
            o.next = e.next,
            a = !0,
            r.debug('complete after the data set with startIndex ' + e.start),
            n.breaker;
            if (o.start > e.prev && ( - 1 === e.next || o.end < e.next)) return o.start < e.start && (e.start = o.start, c > 0 && (this.__dataObjArray[c - 1].next = e.start)),
            o.end > e.end && (e.end = o.end, c < s - 1 && (e.end + 1 === this.__dataObjArray[c + 1].start ? (e.end = this.__dataObjArray[c + 1].end, e.next = this.__dataObjArray[c + 1].next, this.__dataObjArray.splice(c + 1, 1)) : this.__dataObjArray[c + 1].prev = e.end)),
            a = !1,
            r.debug('overlapped and update the data set' + e.start),
            this._data.splice.apply(this._data, [
              o.start,
              t.length
            ].concat(t)),
            n.breaker;
            for (i = e, d = c; c < s && o.end > i.start; ) o.next = i.next,
            o.prev = i.prev,
            i.start < o.start && (o.start = i.start),
            i.end > o.end && (o.end = i.end),
            this.__dataObjArray.splice(c, 1),
            s = this.__dataObjArray.length,
            i = this.__dataObjArray[c];
            return a = !0,
            r.debug('overlap with multiple range of dataset'),
            n.breaker
          }
        }, this)), a && (this._data.splice.apply(this._data, [
          e,
          t.length
        ].concat(t)), this.__dataObjArray.splice(d, 0, o), s = this.__dataObjArray.length, d < s - 1 ? this.__dataObjArray[d + 1].prev = o.end : o.next = - 1, d > 0 ? this.__dataObjArray[d - 1].next = o.start : o.prev = - 1), this)
      },
      __getFetchedData: function (e, t) {
        return n.isUndefined(t) && (t = e + 1),
        this._data.slice(e, t)
      },
      __checkFetchedData: function (e, t) {
        var i = [
        ],
        s = e,
        r = t,
        o = !1;
        return n.each(this.__dataObjArray, n.bind(function (e) {
          return r < e.start ? n.breaker : s < e.start ? (i.push({
            from: s,
            to: e.start
          }), r > e.end + 1 ? void (s = e.end + 1) : (o = !0, n.breaker)) : s <= e.end ? r > e.end + 1 ? void (s = e.end + 1) : (o = !0, n.breaker) : void 0
        }, this)),
        o || i.push({
          from: s,
          to: r
        }),
        i
      },
      __hasFetchedData: function (e, t) {
        var i = !1;
        return n.each(this.__dataObjArray, n.bind(function (s) {
          if (e >= s.start && e <= s.end) return (n.isUndefined(t) || t - 1 <= s.end) && (i = !0),
          r.info('[XDK] Datasource contains part of the target range of data.'),
          n.breaker
        }, this)),
        i
      }
    })
  }),
  define('xdk-ax/data/LocalDatasource', [
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/promise',
    'xdk-ax/data/Datasource',
    'xdk-ax/data/interface/Datasource'
  ], function (e, t, i, n, s) {
    'use strict';
    return e.create(n, {
    }, {
      init: function () {
        var e = this;
        this.setDataUpdater(function (n, r) {
          var o = i.defer();
          switch (n) {
            case s.ACTION.REMOVE:
              !function (i, n) {
                var s = e.getTotalCount();
                n = Math.min(n, s),
                i >= n ? o.reject(t.createException('Trying to remove self more local data then locally have')) : - 1 === s ? o.reject(t.createException('ds incorrect total count', 'Total Item should be set before insert the data')) : o.resolve({
                  from: i,
                  to: n
                })
              }(r.from, r.to);
              break;
            case s.ACTION.INSERT:
              !function (i, n) {
                if ( - 1 === e.getTotalCount()) return void o.reject(t.createException('ds incorrect total count', 'Total Item should be set before insert the data'));
                o.resolve({
                  newData: i,
                  index: n
                })
              }(r.newData, r.from)
          }
          return o.promise
        })
      }
    })
  }),
  define('xdk-ax/mvc/view', [
    'xdk-base/core',
    'xdk-ax/Component',
    'xdk-base/util'
  ], function (e, t, i) {
    'use strict';
    return {
      _templateRenderHooks: {
      },
      hookTemplateRenderer: function (t, n) {
        if (!i.isString(t)) throw e.createException('IncorrectParam', 'Template hook attribute (hookAttr) should be a string : ' + t);
        if (!i.isFunction(n)) throw e.createException('IncorrectParam', 'Template hook helper (helperFn) should be a function : ' + n);
        if (this._templateRenderHooks[t]) throw e.createException('TemplateRenderHelperTaken', 'Template helper for hook (' + t + ') is already taken.');
        this._templateRenderHooks[t] = n
      },
      render: function (n, s) {
        if (i.isFunction(n) && (n = n(s)), !i.isPlainObject(n)) throw e.createException('ViewTemplateInvalid', 'View template is incorrect: ' + i.stringify(n));
        if (!i.isFunction(n.klass)) throw e.createException('ViewTemplateInvalid', 'Trying to create an unknown type. Template: ' + i.stringify(n));
        if (!(n.klass.prototype instanceof t)) throw e.createException('ViewTemplateInvalid', 'View template root must be a component! Template:' + i.stringify(n));
        var r,
        o,
        a,
        d,
        c,
        l;
        if (o = i.clone(n), delete o.klass, delete o.children, r = new n.klass(o), i.isArray(n.children) && n.children.length) for (d = n.children.length, a = 0; a < d; a++) {
          if (l = null, c = n.children[a], !i.isPlainObject(c)) throw e.createException('ViewTemplateInvalid', 'Sub-view template rendering has failed for: ' + n.children[a]);
          if (i.each(this._templateRenderHooks, function (n) {
            if (!i.isUndefined(c[n.key])) {
              if (!((l = this._templateRenderHooks[n.key](c)) instanceof t)) throw e.createException('UnexpectedViewTemplateHelperResponse', 'View template helper did not return a Component: ' + l);
              return r.attach(l),
              i.breaker
            }
          }, this), !l) {
            if (!(c.klass.prototype instanceof t)) throw e.createException('ViewTemplateInvalid', 'Sub-view template contains unknown class! Sub-view template: ' + i.stringify(c));
            l = this.render(c, !0),
            r.attach(l)
          }
        }
        return r
      }
    }
  }),
  define('xdk-ax/mvc/Controller', [
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-ax/mvc/view',
    'xdk-base/console',
    'xdk-base/promise'
  ], function (e, t, i, n, s, r) {
    'use strict';
    n.hookTemplateRenderer('controller', function (e) {
      var i = e.controller;
      if (!i.prototype instanceof o) throw t.createException('IncorrectAttribute', 'Controller attribute should be a Sub-Class of Controller');
      return n = (new i).getView()
    });
    var o = e.create({
    }, {
      _view: null,
      _subControllers: [
      ],
      _parentController: null,
      __id: null,
      deinit: function () {
        this._view.deinit(),
        this._view = null
      },
      setView: function (e) {
        if (this._view) throw t.createException('ViewAlreadySet', 'This controller already has a view set, it is not supposed to be overwritten!');
        this._view = e,
        this._view.attachController(this);
        var n = this._extraSubController(),
        s = this;
        i.each(n, function (e) {
          s._addSubController(e)
        })
      },
      _extraSubController: function (e, t) {
        !e && this._view && (e = this._view),
        t || (t = [
        ]);
        var i,
        n,
        s,
        r,
        o = e.getAttachedController();
        if (e !== this._view && o) return t.push(o),
        t;
        if (e.isLeaf()) return t;
        for (i = e.getChildren(), r = i.length, s = 0; s < r; s++) n = i[s],
        t = this._extraSubController(n, t);
        return t
      },
      getView: function () {
        return this._view
      },
      getId: function () {
        return this.__id || (this.__id = '' + t.getGuid()),
        this.__id
      },
      getControllerByClass: function (e) {
        if (this instanceof e) return this;
        var t,
        i,
        n = this._subControllers.length;
        for (t = 0; t < n; t++) if (i = this._subControllers[t].getControllerByClass(e)) return i;
        return !1
      },
      _setupSubtree: function (e) {
        var t,
        n,
        s,
        o,
        a,
        d = 0,
        c = this._subControllers.length,
        l = [
        ],
        u = !1;
        for (a = this.setup(e), r.isPromise(a) && (u = !0); d < c; d++) t = this._subControllers[d],
        n = t.getId(),
        s = e && e.subContexts && e.subContexts[n] ? e.subContexts[n] : {
        },
        u ? l.push(a.then(function () {
          return t._setupSubtree(s)
        })) : l.push(t._setupSubtree(s));
        return o = l.length > 0 ? r.all(l) : a,
        this.postSetup ? o && u ? o.then(i.bind(function () {
          this.postSetup(e)
        }, this)) : r.resolve(this.postSetup(e)) : r.isPromise(o) ? o : r.resolve()
      },
      setup: function (e) {
        s.debug('controller set up' + e)
      },
      _resetSubtree: function () {
        for (var e = 0, t = this._subControllers.length; e < t; e++) this._subControllers[e]._resetSubtree();
        this.reset()
      },
      reset: function () {
      },
      _addSubController: function (e) {
        return this._subControllers.indexOf(e) > 0 ? (s.warn(e.getId() + ' is already a sub-controller of ' + this.getId()), !1) : (this._subControllers.push(e), e._parentController = this, !0)
      },
      _removeSubController: function (e) {
        var t = this._subControllers.indexOf(e);
        return !(t < 0) && (this._subControllers.splice(t, 1), !0)
      },
      getSubControllers: function () {
        return this._subControllers
      },
      getSubController: function (e) {
        if (i.isNumber(e)) return this._subControllers[e];
        var t,
        n,
        s = this._subControllers.length;
        for (n = 0; n < s; n++) if ((t = this._subControllers[n]) instanceof e) return t;
        for (n = 0; n < s; n++) if (t = this._subControllers[n].getSubController()) return t;
        return null
      },
      getParentController: function () {
        return this._parentController
      },
      getContextTree: function () {
        for (var e, t = this.getContext(), i = null, n = 0, s = this._subControllers.length; n < s; n++) e = this._subControllers[n],
        (i = e.getContextTree()) && (t = t || {
        }, t.subContexts = t.subContexts || {
        }, t.subContexts[e.getId()] = i);
        return t
      },
      getContext: function () {
        return null
      }
    });
    return o
  }),
  define('xdk-base/Env', [
    'xdk-base/class',
    'xdk-base/EventDispatcher',
    'xdk-base/console',
    'xdk-base/device/vKey',
    'xdk-base/util',
    'xdk-base/device',
    'xdk-base/core',
    'xdk-base/interface/DeviceHandler'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    var d,
    c;
    return d = e.create(t, [
      a
    ], {
      singleton: function () {
        return c || (c = new d),
        c
      }
    }, {
      EVT_ONDETECT: 'env:device:ondetect',
      EVT_ON_PLATFORM_DETECTED: 'env:device:ondetect',
      EVT_ONLOAD: 'env:onload',
      EVT_ONUNLOAD: 'env:onunload',
      EVT_ONKEY: 'env:onkey',
      EVT_ON_MOUSE_WHEEL: 'env:onmousewheel',
      EVT_ONPAUSE: 'env:onpause',
      EVT_ONRESUME: 'env:onresume',
      __ready: !1,
      __deviceReady: !1,
      resolution: null,
      __notBlockedKeysList: {
      },
      __isBlockingKeys: !1,
      __hasMouse: !1,
      __isBlockingMouse: !1,
      __launchData: null,
      isLoaded: function () {
        return this.__deviceReady
      },
      blockMouse: function () {
        this.__isBlockingMouse = !0
      },
      unblockMouse: function () {
        this.__isBlockingMouse = !1
      },
      isBlockingMouse: function () {
        return this.__isBlockingMouse
      },
      blockKeys: function () {
        this.__isBlockingKeys = !0
      },
      unblockKeys: function () {
        this.__isBlockingKeys = !1
      },
      isBlockingKeys: function () {
        return this.__isBlockingKeys
      },
      addNotBlockedKey: function (e) {
        var t;
        if (s.isString(e)) this.__notBlockedKeysList[e] = !0;
         else for (t in e) this.__notBlockedKeysList[e[t]] = !0
      },
      setWhitelist: function (e) {
        this.__notBlockedKeysList = e
      },
      removeWhitelistedKey: function (e) {
        delete this.__notBlockedKeysList[e]
      },
      dispatchEvent: function (e, t) {
        return this.__isBlockingKeys && e === this.EVT_ONKEY && !this.__notBlockedKeysList[t.id] ? (i.debug('Key blocked by env.'), !1) : this._super(e, t)
      },
      addEventListener: function (e, t, i) {
        return e === this.EVT_ONLOAD && this.__deviceReady ? (t(this.__launchData), this) : this._super(e, t, i)
      },
      hasMouse: function () {
        return r.system.hasMouse()
      },
      init: function () {
        this.addNotBlockedKey([n.EXIT.id,
        n.STOP.id]),
        r.init(this),
        this._super()
      },
      _onDeviceInited: function () {
        this.__deviceReady = !0,
        this.resolution = r.system.getDisplayResolution(),
        i.info('[XDK] env ready'),
        this.dispatchEvent(this.EVT_ONLOAD)
      },
      onDeviceLoad: function (e) {
        e = e || {
        },
        e.isPaused = e.isPaused || !1,
        e.deeplinkData = e.deeplinkData || null,
        this.__deviceReady = !0,
        this.__launchData = e,
        this.resolution = r.system.getDisplayResolution(),
        i.info('[XDK] env ready from ' + e.isPaused),
        i.info('[XDK] deeplink data: ' + e.deeplinkData),
        this.dispatchEvent(this.EVT_ONLOAD, e)
      },
      onDeviceKey: function (e, t) {
        var i = d.singleton();
        t = t || 'device',
        e && i.dispatchEvent(i.EVT_ONKEY, s.extend({
          source: t
        }, e))
      },
      _onload: function () {
        this.__ready || (i.info('[XDK] DOM loaded'), this.__ready = !0, r._bootstrap && r._bootstrap({
          inited: s.bind(this._onDeviceInited, this),
          platformDetecetedCb: s.bind(this._onPlatformDetected, this)
        }))
      },
      onDeviceUnload: function () {
        i.info('[XDK] Application unload'),
        this.__launchData = null,
        this._onunload()
      },
      _onunload: function () {
        this.__ready = !1,
        this.__deviceReady = !1,
        this.dispatchEvent(this.EVT_ONUNLOAD)
      },
      onDeviceDetect: function (e) {
        i.info('[XDK] device detected  ' + e),
        this.dispatchEvent(this.EVT_ONDETECT, e)
      },
      _onPlatformDetected: function (e) {
        this.onDeviceDetect(e)
      },
      onDevicePause: function () {
        i.info('[XDK] Application pause'),
        this.dispatchEvent(this.EVT_ONPAUSE)
      },
      onDeviceResume: function () {
        i.info('[XDK] Application resume'),
        this.dispatchEvent(this.EVT_ONRESUME)
      }
    }),
    d.singleton(),
    d
  }),
  define('xdk-ax/mvc/ControllerManager', [
    'xdk-base/core',
    'xdk-base/class',
    'xdk-base/EventDispatcher',
    'xdk-ax/mvc/Controller',
    'xdk-base/promise',
    'xdk-base/util',
    'xdk-base/exception',
    'require'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    var d,
    c;
    return d = t.create(i, {
      EVT_REPLACED: 'ui:ctrlMgr:replaced',
      EVT_OPENED: 'ui:ctrlMgr:opened',
      EVT_CLOSED: 'ui:ctrlMgr:closed',
      singleton: function () {
        return c || (c = new d),
        c
      }
    }, {
      replace: function (t, i, d) {
        var c,
        l,
        u,
        h,
        _,
        f;
        if (c = a('xdk-ax/mvc/AppRoot').singleton(), !(t instanceof n)) {
          if (!(t.prototype instanceof n)) return s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'Fail to get the current controller instance.'));
          t = c.getControllerByClass(t)
        }
        if (!(i instanceof n)) {
          if (!(i.prototype instanceof n)) return s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'Replacement controller is not a Controller class!'));
          i = new i
        }
        return l = t.getView(),
        u = i.getView(),
        h = t.getParentController(),
        l && u ? (_ = l.getParent()) ? (d = d || {
        }, f = d.context || {
        }, _.replace(l, u), h && (h._removeSubController(t), h._addSubController(i)), t._resetSubtree(), i._setupSubtree(f).then(r.bind(function () {
          return this.dispatchEvent(this.constructor.EVT_REPLACED, {
            exist: t,
            replacement: i,
            options: d
          }),
          i
        }, this))) : s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'Controller to be replaced is not attached to a parent!')) : s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'One of the controllers does not have a view!'))
      },
      open: function (t, i, a) {
        var d,
        c,
        l;
        if (a = a || {
        }, d = a.context || {
        }, i instanceof n && (i = i.getView()), !i) return s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'Fail to find the container to open a new controller.'));
        if (!(t instanceof n)) {
          if (!(t.prototype instanceof n)) return s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'Fail to get the controller instance when opening controller.'));
          t = new t
        }
        return c = t.getView(),
        l = i.getController(),
        c ? (i.attach(c), l && l._addSubController(t), t._setupSubtree(d).then(r.bind(function () {
          return this.dispatchEvent(this.constructor.EVT_OPENED, {
            controller: t,
            container: i,
            options: a
          }),
          t
        }, this))) : s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'Fail to get the view from the controller instance.'))
      },
      close: function (t, i) {
        var r,
        d,
        c,
        l;
        if (i = i || {
        }, r = a('xdk-ax/mvc/AppRoot').singleton(), !(t instanceof n)) {
          if (!(t.prototype instanceof n)) return s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'Fail to get the controller instance when closing controller.'));
          t = r.getControllerByClass(t)
        }
        return d = t.getView(),
        c = t.getParentController(),
        d ? (l = d.getParent()) ? (c && c._removeSubController(t), d.detach(), t._resetSubtree(), this.dispatchEvent(this.constructor.EVT_CLOSED, {
          controller: t,
          container: l,
          options: i
        }), s.resolve()) : s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'The controller instance to be closed is not attached to a parent!')) : s.reject(e.createException(o.ILLEGAL_ARGUMENT, 'Fail to get the view from the controller instance.'))
      }
    }),
    d.singleton(),
    d
  }),
  define('css!xdk-ax/mvc/css/AppRoot', [
  ], function () {
  }),
  define('xdk-ax/mvc/AppRoot', [
    'xdk-base/class',
    'xdk-ax/mvc/Controller',
    'xdk-base/core',
    'xdk-base/Env',
    'xdk-ax/Container',
    'xdk-base/promise',
    'xdk-base/util',
    'xdk-base/device/vKey',
    'xdk-ax/evt/type',
    'xdk-ax/evt/eventManager',
    'xdk-base/device',
    'xdk-ax/mvc/ControllerManager',
    'xdk-ax/focusManager',
    'xdk-base/exception',
    'require',
    'css',
    'css!./css/AppRoot'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f) {
    'use strict';
    var p,
    g,
    v = n.singleton(),
    m = u.singleton();
    return p = e.create(t, {
      singleton: function () {
        return g || (g = new p),
        g
      }
    }, {
      _envLoaded: !1,
      _keyActions: {
      },
      init: function () {
        this._super();
        var e = this;
        v.addEventListener(v.EVT_ONLOAD, function () {
          e._onEnvLoad()
        })
      },
      _onEnvLoad: function () {
        this._envLoaded = !0;
        var e,
        t = this,
        n = new s({
          id: '#TVArea'
        }),
        r = l.system.getDisplayResolution();
        n.getRoot().appendTo(i.root.document.body),
        n.addClass(l.platform),
        n.addClass('_' + r.width + 'x' + r.height),
        this.setView(n),
        h._setRootController(this),
        e = o.bind(function (e) {
          if (!this._keyActions[e.id] || !this._keyActions[e.id](e)) switch (e.id) {
            case a.EXIT.id:
              l.system.exit();
              break;
            case a.UP.id:
            case a.DOWN.id:
            case a.LEFT.id:
            case a.RIGHT.id:
              h.directionChangeByKey(e, this.getView());
              break;
            case a.OK.id:
              e.target.isClickable() && c.trigger(d.CLICK, e.target);
              break;
            default:
              return
          }
        }, this),
        v.addEventListener(v.EVT_ONKEY, function (i) {
          var n = f('xdk-ax/focusManager').getCurFocus();
          n = n || t.getView(),
          c.trigger(d.KEY, n, o.extend({
            source: i.source,
            defaultAction: e
          }, i))
        })
      },
      setDefaultKeyAction: function (e, t) {
        o.isArray(e) || (e = [
          e
        ]),
        o.each(e, function (e) {
          if (this._keyActions[e]) throw i.createException('KeyactionAlreadyRegisterd', 'Key (' + e + ') is already set');
          this._keyActions[e] = t
        }, this)
      },
      setMainController: function (e, t) {
        if (!this._envLoaded) return r.reject(i.createException(_.ILLEGAL_STATE, 'AppRoot is waiting for environment to load, therefore it is not ready!'));
        t = t || {
        };
        var n,
        s;
        return (n = this.getView().getActiveChild()) ? (s = n.getController(), m.replace(s, e, t)) : (t.appRootFirstController = !0, m.open(e, this, t))
      },
      getParentController: function () {
        return null
      }
    }),
    p.singleton(),
    p
  }),
  define('app/mgr/MenuManager', [
    'app/mgr/AppConfigManager',
    'app/mgr/MessageDisplayHelper',
    'app/mgr/UserManager',
    'xdk-ax/data/LocalDatasource',
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-ax/mediator',
    'xdk-ax/mvc/AppRoot',
    'xdk-base/class',
    'xdk-base/promise',
    'xdk-base/util',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u) {
    var h,
    _;
    return h = d.create({
      Event: {
        MenuItemUpdated: 'MenuManagerEvent:MenuItemUpdated'
      },
      singleton: function () {
        return _ || (_ = new h),
        _
      }
    }, {
      setMainMenu: function (e, t) {
        return this.__menuList === e ? c.resolve() : (this.__menuList = e, this.__menuId = t.menuId, this.__hasAddedSubscription || this.__addSubscription(), this.__getMainMenuDs().then(l.bind(function (i) {
          if (i !== e.getDatasource()) return e.setDatasource(i).then(l.bind(function () {
            if (this.__currentMenuStatus) return void e.selectItem(this.__currentMenuStatus);
            var i = {
              newState: {
                pageId: t.pageId
              }
            };
            e.selectItem(i),
            this.__currentMenuStatus = i
          }, this))
        }, this)))
      },
      getCurrentMenuStatus: function () {
        return this.__currentMenuStatus || null
      },
      __getMainMenuDs: function () {
        return e.singleton().getMenuItemsByMenuId(this.__menuId).then(l.bind(function (e) {
          var t = new n,
          i = l.bind(function () {
            var t = this.__filterItemsForCurrentState(e);
            return c.resolve({
              data: t,
              total: t.length
            })
          }, this);
          return t.setDataLoader(i),
          t
        }, this), function (e) {
          t.singleton().showError(e)
        })
      },
      __filterItemsForCurrentState: function (e) {
        var t = i.singleton().getUserState(),
        n = function (e) {
          for (var i = [
          ], s = 0, r = e.length; s < r; s++) (!e[s].state || e[s].state.indexOf(t) > - 1) && (e[s].items && (e[s].items = n(e[s].items)), i.push(e[s]));
          return i
        };
        return n(e)
      },
      __addSubscription: function () {
        this.__onUserSessionUpdatedRef = l.bind(this.__onUserSessionUpdated, this),
        this.__onMenuItemUpdatedRef = l.bind(this.__onMenuItemUpdated, this),
        o.subscribe(u.Events.USER_SESSION_UPDATED, this.__onUserSessionUpdatedRef),
        o.subscribe(this.constructor.Event.MenuItemUpdated, this.__onMenuItemUpdatedRef),
        this.__hasAddedSubscription = !0
      },
      __onUserSessionUpdated: function () {
        this.__getMainMenuDs().then(l.bind(function (e) {
          this.__menuList.setDatasource(e).then(l.bind(function () {
            this.__currentMenuStatus && this.__menuList.selectItem(this.__currentMenuStatus)
          }, this))
        }, this)).done()
      },
      __onMenuItemUpdated: function (e) {
        this.__currentMenuStatus = e,
        this.__menuList.selectItem(e)
      }
    })
  }),
  define('app/core/RoutableController', [
    'app/mgr/MenuManager',
    'xdk-base/class',
    'xdk-ax/focusManager',
    'xdk-ax/mediator',
    'xdk-ax/mvc/Controller',
    'xdk-base/console',
    'xdk-base/promise',
    'xdk-base/util',
    'require'
  ], function (e, t, i, n, s, r, o, a, d) {
    'use strict';
    var c = t.create(s, {
      getDefaultRouteState: function () {
        return {
        }
      },
      getAppRouter: function () {
        return d('app/core/appRouter')
      }
    }, {
      __state: {
      },
      __historyFocus: null,
      init: function (e) {
        this.__state = this.constructor.getDefaultRouteState(),
        this._super(e)
      },
      setup: function (t) {
        this._super(t),
        this.getRouteState().pageId = t.pageId || '',
        this.getRouteState().pageData = t.pageData || null,
        t.historyBack ? n.publish(e.Event.MenuItemUpdated, this.__menuStatus) : this.__menuStatus = e.singleton().getCurrentMenuStatus()
      },
      setView: function (e) {
        this._super(e),
        e.setOption('forwardFocus', !0)
      },
      getContext: function () {
        return a.clone(this.getRouteState())
      },
      getRouteState: function () {
        return this.__state
      },
      getAncestorsRouteState: function () {
        for (var e = this.getRouteState(), t = this.getParentController(); t && t instanceof c; ) e = a.extend(e, t.getRouteState()),
        t = t.getParentController();
        return e
      },
      extendPathStates: function (e) {
        return a.extend(e, this.getAncestorsRouteState())
      },
      updateState: function (e) {
        var t,
        i = this.constructor.getDefaultRouteState();
        for (t in e) a.isUndefined(i[t]) && r.error('Unmatched state. All the state should be predefined with a default State by getDefaultRouteState function.');
        return this.__state = a.clone(e, !0),
        this
      },
      getSubRouteContainer: function () {
        return this.getView()
      },
      retainView: function () {
        return !1
      },
      _setupSubtree: function (e) {
        var t,
        i,
        n,
        s,
        r = 0,
        d = this._subControllers.length,
        c = [
        ];
        for (this.setup(e); r < d; r++) t = this._subControllers[r],
        i = t.getId(),
        n = e && e.subContexts && e.subContexts[i] ? e.subContexts[i] : {
        },
        n = a.extend(n, e),
        e.setupPending ? c.push(e.setupPending.then(function () {
          return t._setupSubtree(n)
        })) : c.push(t._setupSubtree(n));
        return s = c.length > 0 ? o.all(c) : e.setupPending,
        this.postSetup ? (s && s.then(a.bind(function () {
          this.postSetup(e)
        }, this)), o.resolve(this.postSetup(e))) : o.resolve(!0)
      }
    });
    return c
  }),
  define('xdk-base/device/interface/Suspendable', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    var t = e.create('Suspendable', {
      suspend: [
      ],
      getSuspendedCount: [
      ]
    });
    return t.SuspendedPlayback = e.create('SuspendedPlayback', {
      restore: [
        'cb'
      ],
      dispose: [
      ],
      getMediaMeta: [
      ],
      getPlayer: [
      ]
    }),
    t
  }),
  define('xdk-base/device/interface/Preloadable', [
    'xdk-base/Interface',
    'xdk-base/class'
  ], function (e, t) {
    'use strict';
    var i = e.create('Preloadable', {
      preload: [
        'url',
        'opts'
      ],
      getPreloadedCount: [
      ]
    });
    return i.PreloadedPlayback = e.create('PreloadedPlayback', {
      play: [
        'pos'
      ],
      dispose: [
      ],
      getMediaMeta: [
      ],
      getPlayer: [
      ]
    }),
    i
  }),
  define('xdk-base/device/AbstractPlayer', [
    'xdk-base/class',
    'xdk-base/console',
    'xdk-base/device/interface/Player'
  ], function (e, t, i) {
    'use strict';
    return e.createAbstract([i], {
      PLAYBACK_STATE: {
        PLAYING: 'playing',
        PAUSED: 'paused',
        STOPPED: 'stopped'
      }
    }, {
      __id: null,
      speed: function (e) {
        t.warn('Speeding ' + e + ' is not supported in the player')
      },
      getPlaybackSpeed: function () {
        return t.warn('no play back speed in the player'),
        1
      },
      getBitrates: function () {
        return t.debug('no bitrate provided'),
        null
      },
      getId: function () {
        return this.__id
      },
      setId: function (e) {
        this.__id = e
      }
    })
  }),
  define('xdk-base/device/FallbackSuspendedPlayback', [
    'xdk-base/class',
    'xdk-base/device/interface/Suspendable',
    'xdk-base/device/AbstractPlayer',
    'xdk-base/util'
  ], function (e, t, i, n) {
    'use strict';
    return e.create([t.SuspendedPlayback], {
    }, {
      init: function (e, t, i) {
        this.__media = e,
        this.__player = t,
        this.__url = i.url,
        this.__opts = i.opts || {
        },
        this.__pos = i.pos || 0,
        this.__state = i.state
      },
      restore: function (e) {
        var t = this.__media,
        s = n.extend(n.extend({
        }, this.__opts, !0), {
          player: this.__player
        }),
        r = this.__state === i.PLAYBACK_STATE.STOPPED;
        if (!r) {
          var o = n.bind(function (n) {
            switch (n.toState) {
              case t.PLAYING:
                this.__state === i.PLAYBACK_STATE.PAUSED && t._doPause(),
                t.__stateMachine.removeEventListener(t.EVT_STATE_CHANGED, o),
                e()
            }
          }, this);
          t.__stateMachine.addEventListener(t.EVT_STATE_CHANGED, o)
        }
        if (t._doLoad(this.__url, s), r) return void e();
        t._doPlay({
          sec: this.__pos
        })
      },
      dispose: function () {
        this.__player = null
      },
      getMediaMeta: function () {
        return {
          url: this.__url,
          opts: this.__opts
        }
      },
      getPlayer: function () {
        return this.__player
      }
    })
  }),
  define('xdk-base/device/FallbackPreloadedPlayback', [
    'xdk-base/class',
    'xdk-base/device/interface/Preloadable',
    'xdk-base/util',
    'xdk-base/device/playerRegistry',
    'xdk-base/core',
    'xdk-base/exception'
  ], function (e, t, i, n, s, r) {
    'use strict';
    return e.create([t.PreloadedPlayback], {
    }, {
      init: function (e, t, i) {
        this.__media = e,
        this.__url = t,
        this.__opts = i || {
        },
        this.__opts.player ? this.__player = this.__opts.player : this.__player = n.getPlayer(this.__opts)
      },
      play: function (e) {
        var t = this.__media;
        t.load(this.__url, this.__opts),
        t.play({
          sec: e
        })
      },
      dispose: function () {
      },
      getMediaMeta: function () {
        return {
          url: this.__url,
          opts: this.__opts
        }
      },
      getPlayer: function () {
        return this.__player
      }
    })
  }),
  define('xdk-base/device/interface/SubtitleStgy', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    var t = e.create('SubtitleStgy', {
      setPlayer: [
        'player'
      ],
      showSubtitle: [
        'id'
      ],
      hideSubtitle: [
      ],
      getCurrentSubtitle: [
      ],
      getSubtitles: [
      ]
    });
    return t.TYPE = 'internal',
    t
  }),
  define('xdk-base/device/interface/ExtSubtitleStgy', [
    'xdk-base/Interface',
    'xdk-base/device/interface/SubtitleStgy'
  ], function (e, t) {
    'use strict';
    var i = e.create('ExtSubtitleStgy', [
      t
    ], {
      prepare: [
        'subtitleOption'
      ]
    });
    return i.TYPE = 'external',
    i
  }),
  define('xdk-base/device/MediaSubtitle', [
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/console',
    'xdk-base/promise',
    'xdk-base/core',
    'xdk-base/exception',
    'xdk-base/util',
    'xdk-base/device/interface/SubtitleStgy',
    'xdk-base/device/interface/ExtSubtitleStgy',
    'require'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    var l = a.TYPE,
    u = d.TYPE;
    return e.create({
    }, {
      __player: null,
      __currentId: - 1,
      __subtitleArr: null,
      __idMapping: [
      ],
      __internalStgy: null,
      __externalStgy: null,
      __subtitleStgy: null,
      init: function (e, t, i) {
        this.__subtitleStgy = e || {
        },
        this.__player = t,
        this.__preloaded = i
      },
      prepare: function (t) {
        var n,
        o,
        l,
        u;
        if (n = this.__subtitleStgy.internal, i.info('[XDK] internal strategy is loading now'), n) {
          if (o = c(n), !e.hasImpl(o, a)) throw s.createException(r.ILLEGAL_STATE, 'Internal Subtitle doesn\'t implement subtitle strategy');
          try {
            this.__internalStgy = new o,
            i.info('[XDK] Success to create subtitle internal strategy ' + n)
          } catch (e) {
            i.warn('[XDK] Fail to create subtitle internal strategy ' + n)
          }
          this.__internalStgy.setPlayer(this.__player, this.__preloaded)
        }
        if (l = this.__subtitleStgy.external, i.info('[XDK] external strategy is loading now'), l) {
          if (u = c(l), !e.hasImpl(u, d)) throw s.createException(r.ILLEGAL_STATE, 'External Subtitle doesn\'t implement subtitle strategy');
          try {
            this.__externalStgy = new u,
            i.info('[XDK] Success to create subtitle external strategy ' + l)
          } catch (e) {
            i.warn('[XDK] Fail to create subtitle external strategy ' + l)
          }
          this.__externalStgy.setPlayer(this.__player, this.__preloaded),
          this.__externalStgy.prepare(t)
        }
      },
      showSubtitle: function (e) {
        if (o.isUndefined(e)) {
          if ( - 1 === this.__currentId) return n.reject(s.createException(r.ILLEGAL_STATE, ' Fail to sho the subtitle when no available subtitle strategy.'));
          e = this.__currentId
        }
        var t;
        try {
          t = this.__getStgyById(e)
        } catch (e) {
          return n.reject(e)
        }
        if (t) {
          var i = this.__idMapping[e];
          return this.__currentId = e,
          t.showSubtitle(i)
        }
        return n.reject(s.createException(r.ILLEGAL_STATE, ' Fail to show the subtitle when no available subtitle strategy.'))
      },
      hideSubtitle: function () {
        if ( - 1 === this.__currentId) return n.reject(s.createException(r.ILLEGAL_STATE, ' Fail hide the subtitle when no available subtitle to hide.'));
        var e = this.__getStgyById(this.__currentId);
        return e ? e.hideSubtitle() : n.reject(s.createException(r.ILLEGAL_STATE, ' Fail hide the subtitle when no available subtitle strategy.'))
      },
      __getStgyById: function (e) {
        if (!this.__subtitleArr || e > this.__subtitleStgy.length) throw s.createException(r.ILLEGAL_ARGUMENT, ' the id is not in a possible range');
        var t = this.__subtitleArr[e];
        return t.type === l && this.__internalStgy ? this.__internalStgy : t.type === u && this.__externalStgy ? this.__externalStgy : null
      },
      getCurrentSubtitle: function () {
        return - 1 === this.__currentId ? n.reject(s.createException(r.ILLEGAL_STATE, ' Fail to get current substitle since it doesn\'t exist or set')) : n.resolve(this.__subtitleArr[this.__currentId])
      },
      getSubtitles: function () {
        if (this.__subtitleArr) return n.resolve(this.__subtitleArr);
        var e = [
        ],
        t = o.bind(function (e) {
          this.__idMapping.push(e.id),
          e.id = this.__subtitleArr.length,
          this.__subtitleArr.push(e)
        }, this);
        return this.__subtitleArr = [
        ],
        this.__externalStgy && e.push(this.__externalStgy.getSubtitles().then(o.bind(function (e) {
          o.each(e, t)
        }, this))),
        this.__internalStgy && e.push(this.__internalStgy.getSubtitles().then(o.bind(function (e) {
          o.each(e, t)
        }, this))),
        n.all(e).then(o.bind(function () {
          return this.__subtitleArr
        }, this))
      },
      deinit: function () {
        this.__externalStgy && this.__externalStgy.deinit && this.__externalStgy.deinit(),
        this.__internalStgy && this.__internalStgy.deinit && this.__internalStgy.deinit()
      }
    })
  }),
  define('css!xdk-base/device/css/Media', [
  ], function () {
  }),
  define('xdk-base/device/Media', [
    'xdk-base/class',
    'xdk-base/EventDispatcher',
    'xdk-base/device/interface/Suspendable',
    'xdk-base/device/interface/Preloadable',
    'xdk-base/device/FallbackSuspendedPlayback',
    'xdk-base/device/FallbackPreloadedPlayback',
    'xdk-base/device/playerRegistry',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/console',
    'xdk-base/config',
    'require',
    'xdk-base/exception',
    'xdk-base/promise',
    'xdk-base/device/AbstractPlayer',
    'xdk-base/device/interface/Player',
    'xdk-base/device/MediaSubtitle',
    'css!./css/Media'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p, g) {
    'use strict';
    var v,
    m,
    E = p.PLAYBACK_STATE,
    b = p.PLAYBACK_ERRORS;
    return v = e.create(t, {
      singleton: function () {
        return m || (m = new v),
        m
      }
    }, {
      STOPPED: 0,
      PLAYING: 1,
      PAUSED: 2,
      SKIPPING: 3,
      SPEEDING: 4,
      BUFFERING: 5,
      CONNECTING: 6,
      EVT_STATE_CHANGED: 'media:state-change',
      EVT_BUFFERING_PROGRESS: 'media:buffering-progress',
      EVT_TIME_UPDATE: 'media:time-update',
      EVT_FINISHED: 'media:finish',
      EVT_ERROR: 'media:error',
      EVT_PUSHED: 'media:pushed',
      EVT_POPPED: 'media:popped',
      __state: 0,
      __prevState: 0,
      __lastReceivedNonSkipState: 0,
      __hasError: !1,
      __player: null,
      __url: '',
      __opts: null,
      __type: null,
      __drm: null,
      __parentNode: null,
      __skipDelayHandle: null,
      __accumulatedArrivalTime: null,
      __accumulatedStep: null,
      __updatedTime: null,
      __multiAudioStgy: null,
      __playbackStack: [
      ],
      __pushing: !1,
      __popping: !1,
      __stateMachine: null,
      __preloaded: {
      },
      __backgroundPlayerList: [
      ],
      __subtitleModule: null,
      __savedStrategies: {
      },
      __suspendedStrategies: [
      ],
      init: function () {
        this._super(),
        this.__stateMachine = new t
      },
      deinit: function () {
        this.__player && this.__player.reset(),
        this.__resetStgies(),
        this.__url = '',
        this.__opts = null,
        this._super()
      },
      _extractMediaContainer: function (e) {
        return /.mp4\?|\.mp4$/i.test(e) ? 'mp4' : /.wmv\?|\.wmv$|.wma\?|\.wma$|.asf\?|\.asf$/i.test(e) ? 'asf' : /.m3u8\?|\.m3u8$/i.test(e) ? 'hls' : /.mp3\?|\.mp3$/i.test(e) ? 'mp3' : '*'
      },
      load: function (e, t) {
        this.__popping || this._doLoad(e, t)
      },
      _doLoad: function (e, t) {
        var i,
        n = d.bind(function () {
          this.__resetStgies(),
          this.__multiAudioStgy = this.__prepareAudioTrack(this.__player),
          this.__subtitleModule = this.__prepareSubtitle(this.__player, t)
        }, this);
        t = t || {
        },
        t.type = t.type || this._extractMediaContainer(e),
        t.drm = t.drm || void 0;
        try {
          i = this.__getPlayer(t)
        } catch (e) {
          throw this._onError(b.RENDER.UNSUPPORTED, 'Exception caught when trying to load the media with type = ' + t.type + ', drm = ' + t.drm + ':\n' + e.message),
          this.__player && (this.__backgroundPlayerList.indexOf(this.__player) < 0 && this.__player.reset(), this.__player = null),
          e
        }
        if (this.__url === e && i === this.__player && !t.forceReload && !this.__hasError) return void n();
        this.__hasError = !1,
        this.__url = e,
        this.__player !== i && (this.__player && this.__backgroundPlayerList.indexOf(this.__player) < 0 && this.__player.reset(), this.__player = i),
        this.__player.prepare(t),
        n(),
        this.__type = t.type,
        this.__drm = t.drm,
        this.__url = e,
        this.__opts = t,
        this.__player.load(e, t)
      },
      __prepareSubtitle: function (e, t, i) {
        var n,
        s,
        r,
        o;
        if (n = e.getId(), !(r = l.get('device.subtitleStgy', null))) return null;
        if (!(s = r[n]) || !s.internal && !s.external) return null;
        try {
          o = new g(s, e, i),
          o.prepare(t.subtitle),
          c.info('[XDK] create the subtitle')
        } catch (e) {
          c.warn('[XDK] Fail to prepare subtitle')
        }
        return o
      },
      __prepareAudioTrack: function (e, t) {
        var i,
        n,
        s,
        r,
        o;
        if (i = e.getId(), !(n = l.get('device.multiAudioTrackStgy', null))) return null;
        if (s = n[i], !n || !s) return null;
        c.info('[XDK] Multi Audio Track exist ' + s),
        r = u(s);
        try {
          o = new r(e),
          c.info('[XDK] Linked the player and multi audio track')
        } catch (e) {
          c.warn('[XDK] Fail to load the audio track : ' + s + ' : ' + e.name)
        }
        return o
      },
      play: function (e) {
        this.__popping || this._doPlay(e)
      },
      _doPlay: function (e) {
        if (!(this.isState(this.SKIPPING) || this.isState(this.BUFFERING) || this.isState(this.CONNECTING))) {
          if (!this.__player) return void c.warn('Player is not ready, please call load() first to load up a player implementation.');
          d.isNumber(e) ? e = {
            sec: e
          }
           : e || (e = {
          }),
          this.__player.play(e)
        }
      },
      stop: function () {
        this.isState(this.STOPPED) || this.__popping || (this._clearSkipDelayData(), this.__player && this.__player.stop())
      },
      pause: function () {
        this.__popping || this._doPause()
      },
      _doPause: function () {
        (this.isState(this.PLAYING) || this.isState(this.SPEEDING)) && this.__player.pause()
      },
      resume: function () {
        this.isState(this.PAUSED) && !this.__popping && this.__player.resume()
      },
      seek: function (e) {
        this.isState(this.STOPPED) || this.__popping || (this.isState(this.SKIPPING) && (this._clearSkipDelayData(), this._changeState(this.__prevState)), e > this.getDuration() ? (c.info('[Media] Seek time ' + e + ' is larger than the duration ' + this.getDuration() + ', now it will seek the duration time'), e = this.getDuration()) : e < 0 && (c.info('[Media] Seek time ' + e + ' is smaller than 0 ' + this.getDuration() + ', now it will seek 0s'), e = 0), this.__player.seek(e))
      },
      _clearSkipDelayData: function () {
        this._clearSkipDelay(),
        this.__accumulatedArrivalTime = null,
        this.__accumulatedStep = null
      },
      _clearSkipDelay: function () {
        this.__skipDelayHandle && (d.clearDelay(this.__skipDelayHandle), this.__skipDelayHandle = null)
      },
      skip: function (e) {
        if (this.__state !== this.STOPPED && !this.__popping) {
          d.isNumber(e) && (e = {
            sec: e
          }),
          e = e || {
          },
          e.sec = e.sec || 10;
          var t,
          i,
          n = e.multipleFactor || 1,
          s = e.delaySec || 2,
          r = e.progressiveCap || 300;
          if (!e.progressive || this.__player._noProgressive) return this.__accumulatedArrivalTime ? void c.warn('Simple skip is forbidden during progressive skip. Abort the skip operation.') : (t = this.getCurTime() + e.sec, t > this.getDuration() ? t = this.getDuration() : t < 0 && (t = 0), this._clearSkipDelayData(), void this.__player.skip(t - this.getCurTime()));
          this._onSkipping(),
          n < 1 && (n = 1),
          d.isNumber(this.__accumulatedArrivalTime) || (this.__accumulatedArrivalTime = this.getCurTime(!0)),
          !this.__accumulatedStep || this.__accumulatedStep * e.sec < 0 ? this.__accumulatedStep = e.sec : this.__accumulatedStep = Math.round(this.__accumulatedStep * n),
          this.__accumulatedStep > r ? this.__accumulatedStep = r : this.__accumulatedStep < - r && (this.__accumulatedStep = - r),
          e.sec >= r || e.sec <= - r ? this.__accumulatedArrivalTime += e.sec : this.__accumulatedArrivalTime += this.__accumulatedStep,
          t = this.__accumulatedArrivalTime,
          t > this.getDuration() ? t = this.getDuration() : t < 0 && (t = 0),
          i = d.bind(function () {
            this.__player.skip(t - this.__player.getCurTime()),
            this._clearSkipDelayData(),
            this._changeState(this.__lastReceivedNonSkipState),
            c.info('[XDK] delayed skip action committed.')
          }, this),
          this._clearSkipDelay(),
          this.__skipDelayHandle = a.getGuid(),
          d.delay(s, this.__skipDelayHandle).then(i),
          this._onTimeUpdate(t, !0)
        }
      },
      speed: function (e) {
        (this.isState(this.PLAYING) || this.isState(this.SPEEDING) || this.isState(this.PAUSED)) && !this.__popping && this.__player.speed(e)
      },
      getPlaybackSpeed: function () {
        return this.__state === this.STOPPED ? 0 : this.__state === this.PLAYING ? 0 : this.__player.getPlaybackSpeed()
      },
      setWindowSize: function (e) {
        if (!this.__player) return void c.warn('Player is not ready, please call load() first to load up a player implementation.');
        this.__player.setWindowSize(e)
      },
      setFullscreen: function () {
        if (!this.__player) return void c.warn('Player is not ready, please call load() first to load up a player implementation.');
        this.__player.setFullscreen()
      },
      getBitrates: function () {
        return this.__state === this.STOPPED ? null : this.__player.getBitrates()
      },
      getState: function () {
        return this.__state
      },
      isState: function (e) {
        return e === this.__state
      },
      getCurTime: function () {
        return this.__state === this.STOPPED ? 0 : this.__player.getCurTime()
      },
      getDuration: function () {
        return this.__player ? this.__player.getDuration() : (c.warn('Player is not ready, please call load() first to load up a player implementation.'), 0)
      },
      push: function () {
        var t;
        this.__pushing = !0,
        this._clearSkipDelayData();
        var n,
        r = this.getState();
        switch (r) {
          case this.STOPPED:
            n = E.STOPPED;
            break;
          case this.PAUSED:
            n = E.PAUSED;
            break;
          default:
            n = E.PLAYING,
            r = this.PLAYING
        }
        var o = {
          url: this.getUrl(),
          opts: this.getOpts(),
          pos: this.getCurTime(),
          state: r,
          player: this.__player
        };
        e.hasImpl(this.__player.constructor, i) ? (t = this.__player.suspend(), - 1 === this.__backgroundPlayerList.indexOf(this.__player) && this.__backgroundPlayerList.push(this.__player)) : (t = new s(this, this.__player, {
          url: o.url,
          opts: o.opts,
          pos: o.pos,
          state: n
        }), this.__player.stop()),
        t.__evtObject = o,
        this.__playbackStack.push(t),
        this.__suspendedStrategies.push({
          audioTrack: this.__multiAudioStgy,
          subtitleModule: this.__subtitleModule
        }),
        this.__state = this.STOPPED,
        this.__url = void 0,
        this.__opts = void 0,
        this.__type = void 0,
        this.__drm = void 0,
        this.__player = void 0,
        this.__subtitleModule = void 0,
        this.__multiAudioStgy = void 0,
        this.__pushing = !1,
        this.dispatchEvent(this.EVT_PUSHED, o)
      },
      pop: function () {
        var e = this.__playbackStack.pop(),
        t = this.__suspendedStrategies.pop();
        if (!e) throw a.createException(h.ILLEGAL_STATE, 'There is no suspended playback state in the stack.');
        this.__popping = !0,
        this.__player && this.__player.stop(),
        e.restore(d.bind(function () {
          var i = e.getMediaMeta(),
          n = e.__evtObject;
          this.__url = i.url,
          this.__opts = i.opts,
          this.__player = e.getPlayer(),
          this.__state = n.state,
          this.__subtitleModule = t.subtitleModule,
          this.__multiAudioStgy = t.audioTrack,
          e.dispose(),
          this.__resetUnusedPlayers(),
          this.__popping = !1,
          this.dispatchEvent(this.EVT_POPPED, n)
        }, this))
      },
      preload: function (t, i) {
        var s;
        i = d.extend({
        }, i || {
        }, !0),
        i.type = i.type || this._extractMediaContainer(t);
        var o,
        a,
        c = this.__getPlayer(i);
        return e.hasImpl(c.constructor, n) ? (delete i.player, c.prepare(i), s = c.preload(t, i), - 1 === this.__backgroundPlayerList.indexOf(c) && this.__backgroundPlayerList.push(c)) : s = new r(this, t, i),
        a = {
          audioTrack: this.__prepareAudioTrack(c, s),
          subtitleModule: this.__prepareSubtitle(c, i, s)
        },
        o = this.__savePreloaded(s),
        this.__savedStrategies[o] = a,
        o
      },
      playPreloaded: function (e, t) {
        this.stop();
        var i = this.__getPreloadedByToken(e),
        n = i.getMediaMeta();
        if (i.play(t), this.__url = n.url, this.__opts = n.opts, this.__player = i.getPlayer(), !this.__savedStrategies[e]) return this.__subtitleModule = null,
        void (this.__multiAudioStgy = null);
        i instanceof r ? (this.__savedStrategies[e].subtitleModule = this.__subtitleModule, this.__savedStrategies[e].audioTrack = this.__multiAudioStgy) : (this.__subtitleModule = this.__savedStrategies[e].subtitleModule, this.__multiAudioStgy = this.__savedStrategies[e].audioTrack)
      },
      disposePreloaded: function (e) {
        this.__getPreloadedByToken(e).dispose(),
        this.__savedStrategies[e] = null,
        this.__deletePreloadedByToken(e),
        this.__resetUnusedPlayers()
      },
      __getPreloadedByToken: function (e) {
        var t = this.__preloaded[e];
        if (!t) throw a.createException(h.ILLEGAL_ARGUMENT, 'No associated preloaded playback.');
        return t
      },
      __savePreloaded: function (e) {
        var t = a.getGuid() + '';
        return this.__preloaded[t] = e,
        t
      },
      __deletePreloadedByToken: function (e) {
        this.__preloaded[e] = null
      },
      __getPlayer: function (e) {
        var t;
        if (e.player) {
          if (t = e.player, !this.__checkCapabilities(t, e)) throw a.createException(h.ILLEGAL_ARGUMENT, 'The specified player is not capable to play the media.');
          return t
        }
        if (!(t = o.getPlayer(e))) throw a.createException(h.ILLEGAL_ARGUMENT, 'None of the registered player can play this type of media.');
        return t
      },
      __checkCapabilities: function (e, t) {
        var i = e.getCapabilities(),
        n = t.type,
        s = t.drm,
        r = !(n && - 1 === i.type.indexOf(n)) || '*' === n,
        o = !(s && - 1 === i.drms.indexOf(s));
        return r && o
      },
      __resetUnusedPlayers: function () {
        for (var t = this.__backgroundPlayerList.length - 1; t >= 0; t--) {
          var s = this.__backgroundPlayerList[t];
          e.hasImpl(s.constructor, n) && 0 !== s.getPreloadedCount() || e.hasImpl(s.constructor, i) && 0 !== s.getSuspendedCount() || (this.__backgroundPlayerList.splice(t, 1), s !== this.__player && s.reset())
        }
      },
      _onTimeUpdate: function (e, t) {
        this.isState(this.SKIPPING) && !t || (this.__updatedTime = e, this.dispatchEvent(this.EVT_TIME_UPDATE, e))
      },
      _onConnecting: function () {
        this._changeState(this.CONNECTING)
      },
      _onPlaying: function () {
        this._changeState(this.PLAYING)
      },
      _onPause: function () {
        this._changeState(this.PAUSED)
      },
      _onStopped: function () {
        this._changeState(this.STOPPED)
      },
      _onSkipping: function () {
        this._changeState(this.SKIPPING)
      },
      _onSpeeding: function () {
        this._changeState(this.SPEEDING)
      },
      _onBufferingStart: function () {
        this._changeState(this.BUFFERING)
      },
      _onBufferingProgress: function (e) {
        this.dispatchEvent(this.EVT_BUFFERING_PROGRESS, e)
      },
      _onBufferingFinish: function () {
        if (!this.isState(this.STOPPED)) {
          if (this.__prevState === this.CONNECTING || this.__prevState === this.BUFFERING) return void this._changeState(this.PLAYING);
          c.debug('change back to prev state' + this.__prevState),
          this._changeState(this.__prevState)
        }
      },
      _onFinish: function () {
        this._changeState(this.STOPPED),
        this.dispatchEvent(this.EVT_FINISHED)
      },
      _onError: function (e, t, i) {
        this.__hasError = !0,
        this.__popping && (this.__popping = !1),
        this._changeState(this.STOPPED);
        var n,
        s,
        r,
        o = {
          errorType: '',
          errorMessage: '',
          errorCode: 0,
          errorData: null
        };
        d.isObject(e) ? (n = e.code, s = e.desc, r = e.evt, o.errorCode = n) : r = e,
        d.isObject(t) ? s = t.msg || e.desc : d.isString(t) && (s = t),
        o.errorType = r,
        o.errorMessage = s,
        i && (o.errorData = i),
        this.dispatchEvent(this.EVT_ERROR, o)
      },
      _changeState: function (e, t) {
        if (this.__state === e) return void c.debug('[XDK] Change State Fail as in the same state ' + e);
        if (e !== this.SKIPPING && (this.__lastReceivedNonSkipState = e), null === this.__skipDelayHandle) {
          this.__prevState = this.__state,
          this.__state = e;
          var i = d.extend({
            fromState: this.__prevState,
            toState: this.__state
          }, t || {
          });
          if (this._shouldSkipOutgoingStateChangeEvent()) return void this.__stateMachine.dispatchEvent(this.EVT_STATE_CHANGED, i);
          this.dispatchEvent(this.EVT_STATE_CHANGED, i)
        }
      },
      _shouldSkipOutgoingStateChangeEvent: function () {
        return this.__pushing || this.__popping
      },
      getAudioTracks: function () {
        return this.__multiAudioStgy ? this.__multiAudioStgy.getAudioTracks() : _.reject(a.createException(h.UNSUPPORTED_OPERATION, 'MultiAudioTracks strategy hasn\'t set yet'))
      },
      setAudioTrack: function (e) {
        return this.__multiAudioStgy ? d.isString(e) ? this.__multiAudioStgy.setAudioTrack(e) : _.reject(a.createException(h.ILLEGAL_ARGUMENT, 'Argument type is not valid')) : _.reject(a.createException(h.UNSUPPORTED_OPERATION, 'MultiAudioTracks strategy hasn\'t set yet'))
      },
      getAudioTrackAttr: function (e, t, i) {
        return this.__multiAudioStgy ? d.isString(e) && d.isString(t) && d.isString(i) ? this.__multiAudioStgy.getAudioTrackAttr(e, t, i) : _.reject(a.createException(h.ILLEGAL_ARGUMENT, 'Argument type is not valid or missing')) : _.reject(a.createException(h.UNSUPPORTED_OPERATION, 'MultiAudioTracks strategy hasn\'t set yet'))
      },
      getCurrentAudioTrackId: function () {
        return this.__multiAudioStgy ? this.__multiAudioStgy.getCurrentAudioTrackId() : _.reject(a.createException(h.UNSUPPORTED_OPERATION, 'MultiAudioTracks strategy hasn\'t set yet'))
      },
      getUrl: function () {
        return this.__url
      },
      getOpts: function () {
        return this.__opts
      },
      showSubtitle: function (e) {
        return this.__subtitleModule ? this.__subtitleModule.showSubtitle(e) : _.reject(a.createException(h.ILLEGAL_STATE, 'No available subtitle strategy'))
      },
      hideSubtitle: function () {
        return this.__subtitleModule ? this.__subtitleModule.hideSubtitle() : _.reject(a.createException(h.ILLEGAL_STATE, 'No available subtitle strategy'))
      },
      getCurrentSubtitle: function () {
        return this.__subtitleModule ? this.__subtitleModule.getCurrentSubtitle() : _.reject(a.createException(h.ILLEGAL_STATE, 'No available subtitle strategy'))
      },
      getSubtitles: function () {
        return this.__subtitleModule ? this.__subtitleModule.getSubtitles() : _.reject(a.createException(h.ILLEGAL_STATE, 'No available subtitle strategy'))
      },
      __resetStgies: function () {
        this.__multiAudioStgy && this.__multiAudioStgy.deinit && this.__multiAudioStgy.deinit(),
        this.__subtitleModule && this.__subtitleModule.deinit && this.__subtitleModule.deinit(),
        this.__subtitleModule = null,
        this.__multiAudioStgy = null
      }
    }),
    v.singleton(),
    v
  }),
  define('xdk-base/ax', [
    'xdk-base/core',
    'xdk-base/Element',
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/device',
    'xdk-base/Env',
    'xdk-base/util',
    'xdk-base/console',
    'xdk-base/ajax',
    'xdk-base/promise'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    var l = {
    },
    u = r.singleton();
    return l.core = e,
    l.Element = t,
    l.klass = i,
    l.config = n,
    l.sEnv = u,
    l.util = o,
    l.ajax = d,
    l.promise = c,
    l.console = a,
    u.addEventListener(u.EVT_ONLOAD, function () {
      l.platform = s.platform,
      l.vKey = s.vKey,
      l.id = s.id,
      l.system = s.system,
      l.storage = s.storage,
      l.media = s.media
    }),
    l
  }),
  define('vdk-vast/vast', [
    'xdk-base/ax',
    'xdk-base/class',
    'xdk-base/EventDispatcher',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/console'
  ], function (e, t, i, n, s, r) {
    'use strict';
    var o,
    a;
    return o = t.create(i, {
      singleton: function () {
        return a || (a = new o),
        a
      }
    }, {
      init: function () {
      },
      getRequest: function (t, i) {
        return t = t.trim(),
        e.ajax.request(t).then(function (e) {
          var n = i || ':: Vast - request';
          return r.log(n, {
            url: t,
            data: e
          }),
          e
        }, function (e) {
          r.warn(':: Vast - Generic Request Error', {
            url: t,
            err: e
          })
        })
      }
    })
  }),
  define('vdk-vast/vmap/AdSource', [
    'xdk-base/class'
  ], function (e) {
    'use strict';
    return e.create({
    }, {
      init: function (e) {
        var t,
        i,
        n,
        s;
        for (this.id = e.getAttribute('id'), this.allowMultipleAds = e.getAttribute('allowMultipleAds'), this.followRedirects = e.getAttribute('followRedirects'), this.vastAdData = null, this.adTagURI = null, this.customData = null, s = e.childNodes, i = 0, n = s.length; i < n; i++) switch (t = s[i], t.localName) {
          case 'AdTagURI':
            this.adTagURI = {
              templateType: t.getAttribute('templateType'),
              uri: (t.textContent || t.text || '').trim()
            };
            break;
          case 'VASTAdData':
            for (this.vastAdData = t.firstChild; this.vastAdData && 1 !== this.vastAdData.nodeType; ) this.vastAdData = this.vastAdData.nextSibling;
            break;
          case 'CustomAdData':
            this.customData = t
        }
      }
    })
  }),
  define('vdk-vast/vmap/AdBreak', [
    'xdk-base/class',
    'vdk-vast/vmap/AdSource'
  ], function (e, t) {
    'use strict';
    return e.create({
    }, {
      init: function (e) {
        var i,
        n,
        s,
        r,
        o,
        a,
        d,
        c;
        for (this.timeOffset = e.getAttribute('timeOffset'), this.breakType = e.getAttribute('breakType'), this.breakId = e.getAttribute('breakId'), this.repeatAfter = e.getAttribute('repeatAfter'), this.adSource = null, this.trackingEvents = [
        ], this.extensions = [
        ], d = e.childNodes, s = 0, o = d.length; s < o; s++) switch (i = d[s], i.localName) {
          case 'AdSource':
            this.adSource = new t(i);
            break;
          case 'TrackingEvents':
            for (c = i.childNodes, r = 0, a = c.length; r < a; r++) n = c[r],
            'Tracking' === n.localName && this.trackingEvents.push({
              event: n.getAttribute('event'),
              uri: (n.textContent || n.text || '').trim()
            });
            break;
          case 'Extensions':
            this.extensions = i.childNodes
        }
      },
      track: function (e, t) {
        var i,
        n,
        s,
        r,
        o,
        a;
        for (o = this.trackingEvents, a = [
        ], s = 0, r = o.length; s < r; s++) i = o[s],
        i.event === e && (n = i.uri, 'error' === i.event && (n = n.replace('[ERRORCODE]', t)), a.push(this.tracker(n)));
        return a
      },
      tracker: function (e) {
        var t;
        if ('undefined' != typeof window && null !== window) return t = new Image,
        t.src = e,
        t
      }
    })
  }),
  define('vdk-vast/vmap/Vmap', [
    'xdk-base/class',
    'vdk-vast/vmap/AdBreak'
  ], function (e, t) {
    'use strict';
    var i,
    n;
    return i = e.create({
      singleton: function () {
        return n || (n = new i),
        n
      }
    }, {
      init: function (e) {
        var i,
        n,
        s,
        r;
        if (null === (null !== e ? e.documentElement : void 0) || 'VMAP' !== e.documentElement.localName) throw new Error('[VMAP]: Not a VMAP document');
        for (this.version = e.documentElement.getAttribute('version'), this.adBreaks = [
        ], this.extensions = [
        ], r = e.documentElement.childNodes, n = 0, s = r.length; n < s; n++) switch (i = r[n], i.localName) {
          case 'AdBreak':
            this.adBreaks.push(new t(i));
            break;
          case 'Extensions':
            this.extensions = i.childNodes
        }
      }
    })
  }),
  define('vdk-vast/vastErrors', [
    'xdk-base/ax',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/exception',
    'xdk-base/promise',
    'xdk-base/device/interface/Player',
    'vdk-vast/vast'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    return t.create(a, {
    }, {
      PARSE: 100,
      SCHEMA: 101,
      VERSION: 102,
      TYPE: 200,
      LINEARITY: 201,
      DURATION: 202,
      SIZE: 203,
      WRAPPER: 300,
      TIMEOUT: 301,
      LIMIT: 302,
      NO_ADS: 303,
      LINEAR: 400,
      FILE_NOT_FOUND: 401,
      MEDIA_TIMEOUT: 402,
      MEDIAFILE_TYPE: 403,
      DISPLAY: 405,
      REJECTED: 408,
      UNDEFINED: 900,
      log: function (e) {
        console.error(':: Vast - Error with the recived vast.', e)
      },
      trackError: function (e, t) {
        t = t || this.UNDEFINED,
        e = e.replace('[ERRORCODE]', t),
        this.getRequest(e)
      },
      mediaError: function (e, t) {
        var i = o.PLAYBACK_ERRORS,
        s = - 1,
        r = '';
        switch (n.isObject(e) && (s = e.errorCode), s) {
          case i.NETWORK.FILE.code:
            r = this.FILE_NOT_FOUND;
            break;
          case i.NETWORK.TIMEOUT.code:
          case i.NETWORK.FAILED.code:
            r = this.MEDIA_TIMEOUT;
            break;
          case i.RENDER.UNSUPPORTED.code:
            r = this.TYPE;
            break;
          default:
            r = this.DISPLAY
        }
        if (this.log({
          errorMedia: e,
          errVast: r
        }), t) for (var a = 0; a < t.length; a++) this.trackError(t[a], r)
      }
    })
  }),
  define('vdk-vast/vastParser', [
    'xdk-base/ax',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/exception',
    'xdk-base/promise',
    'xdk-base/device/interface/Player',
    'vdk-vast/vast',
    'vdk-vast/vastErrors'
  ], function (e, t, i, n, s, r, o, a, d) {
    'use strict';
    var c,
    l = {
      'video/mp4': 'mp4',
      'video/x-ms-asf': 'asf',
      'application/vnd.apple.mpegurl': 'hls',
      'application/dash+xml': 'dash'
    },
    u = function (e) {
      var t = {
      },
      i = null,
      n = null;
      if (e.hasAttributes()) {
        i = e.attributes;
        for (var s = 0, r = i.length; s < r; s++) n = i[s],
        t[n.name] = n.value
      }
      return t
    };
    return t.create(a, {
    }, {
      init: function (e) {
        c = e ? e.getElementsByTagName('VAST') [0] : null,
        this.ad = null,
        this.nodeContent = null,
        this.creative = null,
        this.vastErrors = new d
      },
      getVersion: function () {
        return c.attributes.version.nodeValue
      },
      getAd: function (e) {
        var t = e || 0;
        return this.ad = c.getElementsByTagName('Ad') [t],
        this.nodeContent = this.ad.getElementsByTagName('InLine') [0] || this.ad.getElementsByTagName('Wrapper') [0],
        this
      },
      getAdIdAttr: function () {
        return this.ad.attributes.id.nodeValue
      },
      getAdSequence: function () {
        return (this.ad.attributes.sequence || {
        }).nodeValue
      },
      getParsingErrors: function () {
        return this.ad.parsingErrors
      },
      getFallbackIndex: function () {
        var e = this.nodeContent.getElementsByTagName('Extension'),
        t = n.find(e, function (e) {
          return 'waterfall' === e.attributes.type.nodeValue
        });
        return t && t.attributes.fallback_index.nodeValue
      },
      getInLineAdSytem: function () {
        return this.nodeContent.getElementsByTagName('AdSystem') [0].textContent
      },
      getInLineAdTitle: function () {
        var e = this.nodeContent.getElementsByTagName('AdTitle');
        return e[0] ? e[0].textContent : ''
      },
      getInLineAdError: function () {
        return this.nodeContent.getElementsByTagName('Error') [0].textContent.split('#-#')
      },
      getInLineAdImpressions: function () {
        for (var e = [
        ], t = this.nodeContent.getElementsByTagName('Impression'), i = t.length, n = 0; n < i; n++) e.push(t[n].textContent);
        return e
      },
      getCreative: function (e) {
        var t = e || 0;
        return this.creative = this.nodeContent.getElementsByTagName('Creatives') [t].getElementsByTagName('Linear') [0],
        this
      },
      getCreativeId: function () {
        return (this.creative.parentNode.attributes.id || {
        }).nodeValue
      },
      getDuration: function () {
        var e = this.creative.getElementsByTagName('Duration');
        return e && e.length ? e[0].textContent : ''
      },
      getTracking: function () {
        for (var e, t, i = [
        ], n = this.nodeContent.getElementsByTagName('Tracking'), s = n.length, r = 0; r < s; r++) e = n[r].attributes.event.nodeValue,
        t = n[r].attributes.offset ? n[r].attributes.offset.nodeValue : null,
        i[e] || (i[e] = [
        ]),
        i[e].push({
          url: n[r].textContent,
          offset: t
        });
        return i
      },
      getMediaFiles: function (e) {
        var t = null,
        i = null,
        s = [
        ],
        r = this.nodeContent.getElementsByTagName('MediaFile');
        e = e ? n.extend(l, e) : l;
        for (var o = 0, a = r.length; o < a; o++) t = r[o],
        i = u(t),
        i.type = e[i.type] || '',
        'mp4' === i.type && s.push({
          attrs: i,
          url: t.textContent
        });
        return s
      },
      getSkipOffset: function () {
        var e = null,
        t = this.creative.attributes.skipoffset;
        return t && (e = t.nodeValue),
        e
      },
      __joinWrapperTrackingEventsToFinalXML: function (e, t, i) {
        for (var n = t.getElementsByTagName('Linear') [0], s = n.getElementsByTagName('TrackingEvents') [0], r = e.getElementsByTagName('Ad') [i].getElementsByTagName('Linear') [0].getElementsByTagName('Tracking'), o = !0, a = 0; a < r.length; a++) o = r[a].cloneNode(!0),
        s.appendChild(o);
        return t
      },
      __joinWrapperImpressionsToFinalXML: function (e, t, i) {
        for (var n = t.getElementsByTagName('InLine') [0], s = e.getElementsByTagName('Ad') [i].getElementsByTagName('Impression'), r = 0; r < s.length; r++) n.appendChild(s[r]);
        return t
      },
      __joinWrapperErrorsToFinalXML: function (e, t, i) {
        var n = e.getElementsByTagName('Ad') [i],
        s = n.getElementsByTagName('Error') [0] || null,
        r = t.getElementsByTagName('Error') [0] || null;
        return s && r ? r.textContent = s.textContent + '#-#' + r.textContent : s && !r && (r.textContent = s.textContent),
        t
      },
      __joinWrapperExtensionsToFinalXML: function (e, t, i) {
        console.log('__joinWrapperExtensionsToFinalXML', e, t, i);
        var n = e.getElementsByTagName('Ad') [i],
        s = n.getElementsByTagName('Extension') || null,
        r = t.getElementsByTagName('Extensions') [0] || null;
        if (!r) {
          var o = t.getElementsByTagName('InLine') [0] || null;
          o || (o = t.getElementsByTagName('Wrapper') [0] || null);
          var r = document.createElement('Extensions');
          o ? o.appendChild(r) : t.appendChild(r)
        }
        if (s && r) for (var a = 0; a < s.length; a++) r.appendChild(s[a]);
         else console.error('Failed to merge extensions');
        return t
      },
      __joinAdsTrackingEvents: function (e, t) {
        var i = t.getElementsByTagName('Linear') [0],
        n = i ? i.getElementsByTagName('Tracking') : [
        ],
        s = e.getElementsByTagName('Linear') [0],
        r = s ? s.getElementsByTagName('TrackingEvents') [0] : [
        ],
        o = !0;
        if (r) for (var a = 0; a < n.length; a++) o = n[a].cloneNode(!0),
        r.appendChild(o);
         else !r && n && s.appendChild(i.getElementsByTagName('TrackingEvents') [0]);
        return e
      },
      __joinAdsImpressions: function (e, t) {
        for (var i = e.getElementsByTagName('InLine') [0], n = t.getElementsByTagName('Impression'), s = !0, r = 0; r < n.length; r++) s = n[r].cloneNode(!0),
        i.appendChild(s);
        return e
      },
      __joinAdsErrors: function (e, t) {
        var i = t.getElementsByTagName('Error') [0] || null,
        n = e.getElementsByTagName('Error') [0] || null;
        return i && n ? n.textContent = i.textContent + '#-#' + n.textContent : i && !n && e.getElementsByTagName('InLine') [0].appendChild(i),
        e
      },
      extendAdDataWithAdWrapperData: function (e, t) {
        try {
          return e = this.__joinAdsTrackingEvents(e, t),
          e = this.__joinAdsImpressions(e, t),
          e = this.__joinAdsErrors(e, t)
        } catch (e) {
          return console.error(':: Vast - method extendAdDataWithAdWrapperData: Error parsing wrapper ads', e),
          null
        }
      },
      getDataAfterWrapperProcess: function (e, t) {
        try {
          var i,
          s = e.getElementsByTagName('VAST') [0],
          r = s.getElementsByTagName('Ad'),
          o = null,
          a = null,
          d = r.length,
          c = new DOMParser,
          l = c.parseFromString('<VAST></VAST>', 'text/xml'),
          u = l.createAttribute('version'),
          h = null;
          u.nodeValue = s.getAttribute('version'),
          h = l.getElementsByTagName('VAST') [0],
          h.setAttributeNode(u);
          for (var _ = 0; _ < d; _++) o = r[_].getElementsByTagName('Wrapper'),
          t[_] && (i = t[_].parsingErrors || [
          ], o.length > 0 && !i.length ? (t[_] = this.__joinWrapperTrackingEventsToFinalXML(e, t[_], _), t[_] = this.__joinWrapperImpressionsToFinalXML(e, t[_], _), t[_] = this.__joinWrapperErrorsToFinalXML(e, t[_], _), t[_] = this.__joinWrapperExtensionsToFinalXML(e, t[_], _), a = t[_]) : (a = r[_].cloneNode(!0), a.parsingErrors = i), h.appendChild(a), l[_] = h);
          return l && l.getElementsByTagName('Ad').length > 0 ? l : null
        } catch (e) {
          console.error(':: Vast - method getDataAfterWrapperProcess: Error parsing wrapper xml', e);
          for (var _ = 0; _ < r.length; _++) n.isArray(r[_].parsingErrors) || (r[_].parsingErrors = [
          ]),
          r[_].parsingErrors.push({
            code: this.vastErrors.SCHEMA,
            description: 'VAST schema error'
          }),
          h.appendChild(r[_]);
          return l[0] = h,
          l
        }
      }
    })
  }),
  define('vdk-vast/vastCollection.wrapper', [
    'xdk-base/ax',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'require',
    'xdk-base/exception',
    'xdk-base/promise',
    'vdk-vast/vast',
    'vdk-vast/vastParser',
    'vdk-vast/vastErrors'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    var l = new d;
    return t.create(a, {
      singleton: function () {
      }
    }, {
      init: function (e, t) {
        this.rolls = e,
        this.max_wrapper_limit = t.wrapperLimit || 7,
        this.vastError = new c
      },
      wrappperProccesAllData: function () {
        var e = o.defer(),
        t = [
          this.__wraperProccesCollection('pre'),
          this.__wraperProccesCollection('mid'),
          this.__wraperProccesCollection('pos')
        ];
        return o.all(t).complete(n.bind(function () {
          e.resolve({
            pre: t[0],
            mid: t[1],
            pos: t[2]
          })
        }, this)),
        e.promise
      },
      __wraperProccesCollection: function (e, t, i) {
        var s,
        r,
        a,
        d,
        c = [
        ],
        l = o.defer();
        if (this.countWrappers = 0, t) {
          s = t,
          r = s.getElementsByTagName('VAST') [0],
          a = r.getElementsByTagName('Ad'),
          d = a.length,
          0 === d && l.resolve(!1);
          for (var u = 0; u < d; u++) c[u] = this.__wraperProccesRoll(a[u], 0, !i || 1 === d);
          o.all(c).complete(n.bind(function () {
            s = this.__getProccesXML(s, c),
            l.resolve(s)
          }, this))
        } else l.resolve(!1);
        return l.promise
      },
      __trackWrapperError: function (e) {
        var t = e.getElementsByTagName('Error') [0],
        i = [
        ];
        if (t && t.textContent) {
          i = t.textContent.split('#-#');
          for (var n = 0; n < i.length; n++) this.vastError.trackError(i[n], this.vastError.WRAPPER)
        }
      },
      __wraperProccesRoll: function (e, t, i) {
        var s = e.getElementsByTagName('Wrapper'),
        r = '',
        a = o.defer();
        return 0 !== s.length ? (r = s[0].getElementsByTagName('VASTAdTagURI') [0].textContent, this.getRequest(r).then(n.bind(function (s) {
          s = s || {
          };
          var r = s.responseXML ? s.responseXML.getElementsByTagName('Ad') [0] : null;
          r ? (t++, this.__wraperProccesRoll(r, t).then(n.bind(function (n) {
            var s = this.__getAdProccesed(n, e, t, i);
            a.resolve(s)
          }, this))) : a.resolve(null)
        }, this)).fail(n.bind(function () {
          var t = {
            code: this.vastError.REJECTED,
            description: 'The ad returned in the VAST response was rejected.'
          };
          i ? (this.__trackWrapperError(e, t.code), adResult = null) : adResult = {
            parsingErrors: [
              t
            ]
          },
          a.resolve(adResult)
        }, this))) : a.resolve(e),
        a.promise
      },
      __getAdProccesed: function (e, t, i, n) {
        var s,
        r;
        return i > this.max_wrapper_limit ? r = {
          code: this.vastError.LIMIT,
          description: 'To much wrapper recursion, more than the limit of ' + this.max_wrapper_limit
        }
         : e ? (s = l.extendAdDataWithAdWrapperData(e, t)) || (r = {
          code: this.vastError.PARSE,
          description: 'XML parsing error'
        }) : r = {
          code: this.vastError.NO_ADS,
          description: 'Wrapper of final Vast with Empty data'
        },
        r ? n ? void this.__trackWrapperError(t, r.code) : {
          parsingErrors: [
            r
          ]
        }
         : s
      },
      __getProccesXML: function (e, t) {
        return l.getDataAfterWrapperProcess(e, t)
      }
    })
  }),
  define('vdk-vast/vastModel', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ax/mvc/Model',
    'vdk-vast/vastParser'
  ], function (e, t, i, n) {
    'use strict';
    var s = function (e) {
      var t;
      return e = e.split(':'),
      t = Number(e[2]),
      t += 60 * parseInt(e[1], 10),
      t += 60 * parseInt(e[0], 10) * 60
    },
    r = function (e, t) {
      return parseInt(e, 10) / 100 * t
    },
    o = function (e, t) {
      return - 1 !== e.indexOf('%') ? r(e, t) : s(e)
    },
    a = function (e, i) {
      var n = !0,
      s = null;
      for (var r in e) if (s = e[r], t.isArray(s)) {
        if ( - 1 === t.indexOf(s, i[r])) {
          n = !1;
          break
        }
      } else if (s !== i[r]) {
        n = !1;
        break
      }
      return n
    };
    return e.create(i, {
      defaults: {
        idVast: '',
        idAd: '',
        adSequence: '',
        adSystem: '',
        adTitle: '',
        error: '',
        impressions: [
        ],
        creativeId: '',
        creativeDuration: 0,
        creativeDurationInSeconds: 0,
        creativeTrackingEvents: [
        ],
        creativeMediaFiles: [
        ],
        type: 'p',
        skippable: !1,
        skipOffset: null,
        skipOffsetInSeconds: null,
        progressTrackingEvents: [
        ]
      }
    }, {
      setModel: function (e, t, i) {
        var s = new n(e),
        r = s.getVersion(),
        o = s.getAd(t),
        a = o.getAdIdAttr(),
        d = o.getAdSequence(),
        c = o.getInLineAdSytem(),
        l = o.getInLineAdTitle(),
        u = o.getInLineAdError(),
        h = o.getParsingErrors(),
        _ = o.getInLineAdImpressions(),
        f = o.getCreative(0),
        p = f.getCreativeId(),
        g = f.getDuration(),
        v = f.getTracking(),
        m = f.getMediaFiles(i),
        E = o.getFallbackIndex(),
        b = f.getSkipOffset();
        this.setIdVast(r),
        this.setIdAd(a),
        this.setAdSequence(d),
        this.setAdSystem(c),
        this.setAdTitle(l),
        this.setError(u),
        this.setParsingErrors(h),
        this.setImpressions(_),
        this.setCreativeId(p),
        this.setCreativeDuration(g),
        this.setCreativeDurationBySeconds(g),
        this.setCreativeTrackingEvents(v),
        this.setCreativeMediaFiles(m),
        this.setFallbackIndex(E),
        this.setType(r),
        b && (this.setSkipOffset(b), this.setSkipOffsetInSeconds(b), this.setProgressTrackingEvents())
      },
      setCreativeDurationBySeconds: function () {
        var e = s(this.get('creativeDuration'));
        this.set('creativeDurationInSeconds', e)
      },
      setIdVast: function (e) {
        this.set('idVast', e)
      },
      setIdAd: function (e) {
        this.set('idAd', e)
      },
      setAdSequence: function (e) {
        this.set('adSequence', e)
      },
      setAdSystem: function (e) {
        this.set('adSystem', e)
      },
      setAdTitle: function (e) {
        this.set('adTitle', e)
      },
      setError: function (e) {
        this.set('error', e)
      },
      setParsingErrors: function (e) {
        this.set('parsingErrors', e)
      },
      setImpressions: function (e) {
        this.set('impressions', e)
      },
      setCreativeId: function (e) {
        this.set('creativeId', e)
      },
      setCreativeDuration: function (e) {
        this.set('creativeDuration', e)
      },
      setCreativeTrackingEvents: function (e) {
        var t = e || {
        };
        this.set('creativeTrackingEvents', t)
      },
      getCreativeMedia: function (e) {
        var i = null,
        n = null,
        s = null,
        r = this.get('creativeMediaFiles'),
        o = e.type;
        t.isArray(o) || (o = [
          o
        ]);
        for (var d = 0, c = r.length; d < c; d++) {
          if (n = r[d], s = n.attrs, a(e, s)) {
            i = n;
            break
          }
          i || - 1 === t.indexOf(o, s.type) || (i = n)
        }
        return i || (i = r[0]),
        i
      },
      setCreativeMediaFiles: function (e) {
        this.set('creativeMediaFiles', e)
      },
      setFallbackIndex: function (e) {
        this.set('fallbackIndex', Number(e))
      },
      setType: function (e) {
        this.set('type', e)
      },
      setSkipOffset: function (e) {
        this.set('skipOffset', e)
      },
      setSkipOffsetInSeconds: function (e) {
        var t = this.get('creativeDurationInSeconds');
        this.set('skipOffsetInSeconds', o(e, t))
      },
      setProgressTrackingEvents: function () {
        for (var e = this.get('creativeDurationInSeconds'), t = this.get('creativeTrackingEvents').progress || [
        ], i = [
        ], n = null, s = 0; s < t.length; s++) n = t[s],
        i[s] = {
          url: n.url,
          offset: o(n.offset, e)
        };
        this.set('progressTrackingEvents', i)
      }
    })
  }),
  define('vdk-vast/vastCollection', [
    'xdk-base/ax',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/exception',
    'xdk-base/promise',
    'xdk-base/console',
    'xdk-base/ajax',
    'vdk-vast/vast',
    'vdk-vast/vmap/Vmap',
    'vdk-vast/vastCollection.wrapper',
    'vdk-vast/vastModel',
    'vdk-vast/vastErrors'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h) {
    'use strict';
    var _ = null;
    return t.create(d, {
    }, {
      init: function () {
        this.rolls = {
        },
        this.vastError = new h,
        this.allDataRollsCollection = {
        },
        this.__collection = {
        },
        this.__vastConfig = {
        }
      },
      __getVastObject: function (e, t) {
        var i = r.defer();
        switch (this.__vastConfig = t || {
          }, typeof e) {
          case 'string':
            this.__getVMAP(e).then(n.bind(function (e) {
              return this.__getVastObjectFromVMAP(e)
            }, this)).then(n.bind(function (e) {
              this.__continueWithVastBlock(e, t),
              i.resolve()
            }, this)).fail(function (e) {
              i.reject(e)
            });
            break;
          case 'object':
            e.adBreaks && (e = this.__getVastObjectFromVMAP(e)),
            this.__continueWithVastBlock(e, t),
            i.resolve()
        }
        return i.promise
      },
      __continueWithVastBlock: function (e, t) {
        this.rollsParams = e,
        this.collectionWrapper = new l(this.rollsParams, t),
        this.__mimeTypes = t ? t.mimeTypes : null
      },
      __getVMAP: function (e) {
        var t = r.defer();
        return a.request(e).then(n.bind(function (e) {
          var i;
          e.responseXML && (i = new c(e.responseXML)),
          t.resolve(i)
        }, this)).fail(function (e) {
          o.error(':: Vast - Collection: error getting vastObject ' + e.transport.responseText),
          t.reject()
        }),
        t.promise
      },
      __getVastObjectFromVMAP: function (e) {
        for (var t, i, n, s, r = e.adBreaks, o = {
          pre: [
          ],
          mid: [
          ],
          pos: [
          ]
        }, a = 0, d = r.length; a < d; a++) {
          t = r[a].timeOffset,
          i = r[a].adSource.adTagURI.uri,
          n = 'true' === r[a].adSource.allowMultipleAds,
          s = 'true' === r[a].adSource.followRedirects;
          var c = {
            allowMultipleAds: n,
            followRedirects: s,
            adBreak: r[a]
          };
          switch (t) {
            case 'start':
              o.pre.push({
                vmap: c,
                data: i
              });
              break;
            case 'end':
              o.pos.push({
                vmap: c,
                data: i
              });
              break;
            default:
              o.mid.push({
                vmap: c,
                time: this.__getTimeInSeconds(t),
                data: i
              })
          }
        }
        return o
      },
      __getTimeInSeconds: function (e) {
        var t = e.split(':'),
        i = 60 * parseInt(t[0], 10) * 60,
        n = parseInt(60 * t[1], 10),
        s = parseInt(t[2].split('.') [0], 10),
        r = i + n + s;
        if (this.__vastConfig.debugBrowser && this.__vastConfig.contentDuration) {
          var o = r / this.__vastConfig.contentDuration;
          r = Math.floor(596 * o)
        }
        return r
      },
      getModel: function (e, t) {
        var i = this.__collection,
        s = n.has(i, e);
        return 2 === arguments.length && s ? this.__collection[e][t] : this.__collection[e]
      },
      get: function () {
        return this.__collection
      },
      getPreRolls: function () {
        return this.__collection.pre
      },
      getMidRolls: function (e) {
        if (0 === arguments.length) {
          for (var t = this.getMidTimes(), i = [
          ], n = 0; n < t.length; n++) i[n] = this.__collection['mid_' + t[n]];
          return i
        }
        return this.__collection['mid_' + e]
      },
      getPosRolls: function () {
        return this.__collection.pos
      },
      getMidTimes: function () {
        return this.existMidRolls() ? n.pluck(this.rollsParams.mid, 'time') : [
        ]
      },
      __wrappperProccesAllData: function () {
        var e = r.defer(),
        t = [
          this.__wraperProccesCollection('pre'),
          this.__wraperProccesCollection('mid'),
          this.__wraperProccesCollection('pos')
        ];
        return r.all(t).complete(n.bind(function () {
          e.resolve({
            pre: t[0],
            mid: t[1],
            pos: t[2]
          })
        }, this)),
        e.promise
      },
      __getUrlToLoadData: function (e) {
        var t = - 1 !== e.indexOf('mid_'),
        i = [
        ];
        if (t) {
          var s = parseInt(e.split('mid_') [1], 10),
          r = 0,
          a = this.rollsParams.mid,
          d = a.length;
          for (r = 0; r < d; r++) a[r].time === s && (_ = s, o.log('#### util.isArray(midParams[i].data)=' + n.isArray(a[r].data)), i = a[r].data);
          if (0 === i.length) return o.warn(':: Vast - MidTime not found'),
          ''
        } else {
          var c = this.rollsParams[e];
          if (Array.isArray(c)) for (r = 0; r < c.length; r++) i.push(c[r].data ? c[r].data : c[r]);
           else 'string' == typeof c ? i.push(c) : c && c.data && i.push(c.data)
        }
        return i
      },
      load: function (t) {
        var i,
        s = r.defer(),
        a = [
        ];
        if (t = t || 'pre', i = this.__getUrlToLoadData(t), this.rolls[t] = [
        ], this.__collection[t] = [
        ], 0 === i.length) o.log(':: Vast - Fail obtain vast!!!'),
        s.reject(t);
         else {
          for (var d = 0, c = i.length; d < c; d++) a.push(e.ajax.request(i[d]));
          r.allSettled(a).then(n.bind(function (e) {
            for (var i, o = [
            ], a = 0, d = e.length; a < d; a++) e[a].value && (this.rolls[t].push(e[a].value), i = this.__processCollection(t, e[a].value.responseXML), o.push(i));
            return o.length ? r.allSettled(o).then(n.bind(function (e) {
              n.each(e, n.bind(function (e) {
                this.__processAndLoadCollection(t, e.value)
              }, this))
            }, this)) : s.reject(t)
          }, this)).then(n.bind(function () {
            s.resolve(t)
          }, this)).fail(n.bind(function (e) {
            o.log(':: Vast - Fail obtain vast!!!', e),
            s.reject(t)
          }, this))
        }
        return s.promise
      },
      __processCollection: function (e, t) {
        return this.collectionWrapper.__wraperProccesCollection(e, t, this.__vastConfig.fallback).fail(n.bind(function (e) {
          this.vastError.log(this.vastError.WRAPPER),
          deferred.reject(e)
        }, this))
      },
      __processAndLoadCollection: function (e, t) {
        var i = r.defer();
        try {
          'pre' === e ? this.__loadPreCollection(t) : 'pos' === e ? this.__loadPosCollection(t) : this.__loadMidCollection(t),
          this.rolls[e] = t,
          i.resolve(!0)
        } catch (e) {
          this.vastError.log(this.vastError.PARSE),
          i.reject(e)
        }
        return i.promise
      },
      __loadCollection: function (e, t) {
        var i,
        n = e.getElementsByTagName('VAST') [0],
        s = n.getElementsByTagName('Ad'),
        r = s.length,
        o = this.__collection[t],
        a = o;
        if (0 === r) return !0;
        this.__vastConfig.fallback && r > 1 && (o = o || [
        ], i = o.length, o[i] = [
        ], a = o[i]);
        for (var d = 0; d < r; d++) this.__addModelToCollection(e, t, d, a)
      },
      __addModelToCollection: function (e, t, i, n) {
        var s;
        n && (this.__existAtLeastOneAd = !0, s = new u, s.setModel(e, i, this.__mimeTypes), n.push(s))
      },
      __loadPreCollection: function (e) {
        if (!this.existPreRolls() || !e) return !1;
        this.__loadCollection(e, 'pre')
      },
      __loadMidCollection: function (e) {
        if (!this.existMidRolls() || !e) return !1;
        this.__loadCollection(e, 'mid_' + _)
      },
      __loadPosCollection: function (e) {
        if (!this.existPosRolls() || !e) return !1;
        this.__loadCollection(e, 'pos')
      },
      __existRoll: function (e) {
        return !!this.rollsParams[e]
      },
      existPreRolls: function () {
        return !!(this.rollsParams.pre && this.rollsParams.pre.length > 0)
      },
      existMidRolls: function () {
        return !!(this.rollsParams.mid && this.rollsParams.mid.length > 0)
      },
      existPosRolls: function () {
        return !!(this.rollsParams.pos && this.rollsParams.pos.length > 0)
      },
      existPreRollsAndHasData: function () {
        return this.existPreRolls() && this.rolls.pre && this.rolls.pre[0]
      },
      existMidRollsAndHasData: function () {
        return this.existMidRolls() && this.rolls.mid && this.rolls.mid[0]
      },
      existPosRollsAndHasData: function () {
        return this.existPosRolls() && this.rolls.pos && this.rolls.pos[0]
      },
      existAtLeastOneRollAd: function () {
        return this.__existAtLeastOneAd
      },
      getKeyCollectionForInitAds: function () {
        var e = this.getMidTimes(),
        t = e[0];
        return this.existPreRollsAndHasData() ? 'pre' : this.existMidRollsAndHasData() ? 'mid_' + t : this.existPosRollsAndHasData() ? 'pos' : (o.warn(':: Vast - rollKeyForInit (the roll with the vast must init ) is empty'), '')
      },
      existRollAndHasData: function (e) {
        return !!this.__collection[e]
      }
    })
  }),
  define('vdk-vast/vastEvents', [
    'xdk-base/class'
  ], function (e) {
    'use strict';
    var t,
    i;
    return t = e.create({
      singleton: function () {
        return i || (i = new t),
        i
      }
    }, {
      EVT_PRE_START_AD_SLOT: 'vast:pre-start-slot',
      EVT_START_AD_SLOT: 'vast:start-slot',
      EVT_PRE_START_AD: 'vast:pre-start-ad',
      EVT_START_AD: 'vast:start-ad',
      EVT_PRE_END_AD_SLOT: 'vast:pre-end-slot',
      EVT_END_AD_SLOT: 'vast:end-slot',
      EVT_END_AD: 'vast:end-ad',
      EVT_ERR_AD: 'vast:err-ad',
      EVT_LOADED_PLAYER: 'vast:loaded-player',
      EVT_ERROR_LOADING_COLLECTION: 'vast:err-loading-collection',
      EVT_ERROR_ON_MAIN: 'vast:err-main',
      EVT_END_PLAYER: 'vast:end-player',
      EVT_SKIPPABLE_STATE_CHANGED: 'vast:skippable-state-changed',
      EVT_SKIP_AD: 'vast:skip-ad',
      EVT_CLOSE_AD: 'vast:close-ad',
      EVT_MUTE_AD: 'vast:mute-ad',
      EVT_UNMUTE_AD: 'vast:unmute-ad',
      EVT_TIME_UPDATE: 'vast:time-update',
      EVT_FINISHED_BEFORE_POSTROLLS: 'vast:end-main-content',
      EVT_FINISHED_CONTENT: 'vast:finished-content'
    }),
    t.singleton(),
    t
  }),
  define('vdk-vast/vastCtrl', [
    'xdk-base/ax',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/console',
    'xdk-base/config',
    'require',
    'xdk-base/exception',
    'xdk-base/promise',
    'xdk-ax/mvc/AppRoot',
    'xdk-base/device/Media',
    'xdk-base/device/playerRegistry',
    'vdk-vast/vast',
    'vdk-vast/vastCollection',
    'vdk-vast/vastErrors',
    'vdk-vast/vastEvents'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p) {
    'use strict';
    var g,
    v = c.singleton(),
    m = [
      '2.0',
      '3.0'
    ];
    return t.create(h, {
      singleton: function () {
        return g || (g = new h),
        g
      },
      instance: function () {
        return new h
      }
    }, {
      __defineAttrs: function () {
        this.__collection = {
        },
        this.__actualAd = 0,
        this.__adHasAnError = !1,
        this.__actualMidTime = - 1,
        this.__fallbackNo = 0,
        this.__trackingEvents = [
        ],
        this.__duration = 0,
        this.__skipOffset = null,
        this.__startedAd = !1,
        this.__impressionsEmited = !1,
        this.__creativeViewEmited = !1,
        this.__startEventEmited = !1,
        this.__firstQuartileEventEmited = !1,
        this.__midpointEventEmited = !1,
        this.__thirdQuartileEventEmited = !1,
        this.__adIsPlaying = !1,
        this.__existAtLeastOneAd = !1,
        this.__rollPlaying = '',
        this.__currentTime = 0,
        this.__midTimeLoaded = {
        },
        this.__midPreTime = {
        },
        this.__hasPreloadVast = {
        },
        this.__preloadingVast = {
        },
        this.__preloadedVast = {
        },
        this.__failedVast = {
        },
        this.__playLoading = {
        },
        this.__hasPreAdEvent = {
        },
        this.__preAdEventLoading = {
        },
        this.__evtFired = {
        }
      },
      init: function (e, t) {
        s.log('[VastCtrl] init input type :' + typeof e),
        this.input = e || {
        },
        t = t || {
        },
        this.__preAdEventTime = t.preAdEventTime || 0,
        this.__preloadTime = t.preloadTime || 5,
        this.__preloadTime += this.__preAdEventTime,
        this.__extendVastWithEvents(),
        this.vastConfig = t || {
        },
        this.sMedia = t.sMedia ? t.sMedia : l.singleton(),
        this.useMediaDuration = !0 === t.useMediaDuration,
        this.connectionTimeLimit = this.__getTimeOutLimit(t.connectionTimeLimit),
        this.vastError = new f,
        this.__defineAttrs(),
        this.midTimePlayed = [
        ],
        this.collection = new _
      },
      __getTimeOutLimit: function (e) {
        var t;
        return t = e || !1,
        !!(n.isNumber(t) && t > 0) && t
      },
      __extendVastWithEvents: function () {
        var e = p.singleton();
        n.extend(this, e)
      },
      start: function () {
        this.collection.__getVastObject(this.input, this.vastConfig).then(n.bind(function () {
          this.__midTimes = this.collection.getMidTimes(),
          s.log('[VastCtrl] this.__midTimes: ' + this.__midTimes)
        }, this)).then(n.bind(function () {
          this.collection.load('pre').then(n.bind(function () {
            var e = this.collection.get();
            if (s.log('[VastCtrl] :: Vast - collection', e), !e.pre.length) return d.reject('pre');
            this.load('pre')
          }, this)).fail(n.bind(function (e) {
            s.error('[VastCtrl] :: Vast - pre Vast No Ready'),
            this.finishAdSlot(),
            this.__fireEvents().vastErrorLoadingCollection(e)
          }, this)).complete(n.bind(function () {
            this.__getEvents()
          }, this))
        }, this)).fail(n.bind(function (e) {
          this.backToMainContentAfterError(e)
        }, this))
      },
      isAdPlaying: function () {
        return this.__adIsPlaying
      },
      isAdPlayingAPreRoll: function () {
        return this.isAdPlaying() && 'pre' === this.__rollPlaying
      },
      isAdPlayingAMidRoll: function () {
        return this.isAdPlaying() && - 1 !== this.__rollPlaying.indexOf('mid_')
      },
      isAdPlayingAPostRoll: function () {
        return this.isAdPlaying() && 'pos' === this.__rollPlaying
      },
      getTypeAdIsPlaying: function () {
        return this.__rollPlaying
      },
      getCollection: function () {
        return this.collection.get()
      },
      load: function (e) {
        try {
          var t;
          this.__rollPlaying = e || this.rollKeyForInit,
          t = this.collection.getModel(this.__rollPlaying, this.__actualAd),
          this.__modelActualAd = n.isArray(t) ? this.__getAdByFallbackIndex(t) : t,
          this.__modelActualAd ? (this.__trackingEvents = this.__modelActualAd.get('creativeTrackingEvents'), this.__progressTrackingEvents = this.__modelActualAd.get('progressTrackingEvents'), this.__duration = this.__modelActualAd.get('creativeDurationInSeconds'), this.__skipOffset = this.__modelActualAd.get('skipOffsetInSeconds'), this.__callToFirstAd(this.__rollPlaying)) : (s.log('[VastCtrl] load No __modelActualAd isArray:' + n.isArray(t) + ' this.__fallbackNo: ' + this.__fallbackNo), this.__decideNextAdToPlay())
        } catch (e) {
          throw s.error('[VastCtrl] EXCEPTION - loadAd: failure: ' + e.message),
          e
        }
      },
      contentComplete: function () {
        s.log('[VastCtrl] contentComplete triggered'),
        this.__finishedMainHandler()
      },
      __callToFirstAd: function (e) {
        this.__rollPlaying = e,
        this.__cleanMainEvents(),
        this.__adIsPlaying = !0,
        this.__fireEvents().startSlot(),
        this.__loadAd()
      },
      __checkErrors: function () {
        var e;
        if (this.__modelActualAd) {
          var t = this.__modelActualAd.get('error') || [
          ];
          - 1 === m.indexOf(this.__modelActualAd.get('idVast')) && (this.__fireError(this.vastError.VERSION, t), e = !0)
        }
        return e
      },
      __loadAd: function () {
        var e,
        t,
        i;
        this.__reset(),
        setTimeout(n.bind(function () {
          try {
            if (this.__setMediaHandlers(), e = this.collection.getModel(this.__rollPlaying, this.__actualAd), this.__modelActualAd = n.isArray(e) ? this.__getAdByFallbackIndex(e) : e, !this.__modelActualAd && n.isArray(e) && s.error('[VastCtrl] __load No __modelActualAd isArray:' + n.isArray(e) + ' this.__fallbackNo: ' + this.__fallbackNo), t = this.__modelActualAd && this.__modelActualAd.get('parsingErrors'), i = this.__checkErrors(), !this.__modelActualAd || i || t && t.length) return t && t.length && n.each(t, n.bind(function (e) {
              this.vastError.log(e),
              this.__fireError(e.code, this.__modelActualAd.get('error'))
            }, this)),
            void this.__decideNextAdToPlay();
            this.__trackingEvents = this.__modelActualAd && this.__modelActualAd.get('creativeTrackingEvents'),
            this.__resetMediaDuration(),
            this.__startedAd || (this.__fireEvents().startAd(), this.__startedAd = !0),
            this.__setAdMedia(),
            this.__playAd()
          } catch (e) {
            s.error('[VastCtrl] __loadAd: failure: ' + e.message, e)
          }
        }, this), 500)
      },
      __setAdMedia: function () {
        var e = null,
        t = this.vastConfig.mediaOptions || {
        };
        if (t.type || (t.type = this.__getPlayersTypes()), e = this.__modelActualAd && this.__modelActualAd.getCreativeMedia(t), s.log('__setAdMedia: ad returned'), !e) return this.__modelActualAd && this.__fireError(this.vastError.MEDIAFILE_TYPE, this.__modelActualAd.get('error')),
        void this.__decideNextAdToPlay();
        s.log('[VastCtrl] __setAdMedia: width:' + e.attrs.width + ' height:' + e.attrs.height + ' url:' + e.url),
        this.__mediaContent = {
          videoUrl: e.url,
          options: {
            type: e.attrs.type,
            forceReload: !0,
            parentNode: v.getView().getRoot().getHTMLElement()
          }
        }
      },
      __getPlayersTypes: function () {
        for (var e, t, i = null, s = '', r = [
        ], o = u.getPlayers({
        }), a = 0, d = o.length; a < d; a++) for (i = o[a].getCapabilities().type, e = 0, t = i.length; e < t; e++) s = i[e],
        - 1 === n.indexOf(r, s) && r.push(s);
        return r
      },
      __playAd: function () {
        var e = this.__mediaContent || {
        },
        t = e.videoUrl || '';
        t = t.trim();
        try {
          this.sMedia.load(t, e.options),
          this.__fireEvents().loadedPlayer(),
          this.__changeConnectionTimeLimit(),
          this.sMedia.setFullscreen(),
          this.sMedia.play()
        } catch (e) {
          s.error('[VastCtrl] _playAd failed with error ', e.message),
          this.__errorAdHandler({
            errorCode: this.vastError.DISPLAY,
            error: e
          })
        }
      },
      __changeConnectionTimeLimit: function () {
        var e = this.sMedia.__player;
        this.connectionTimeLimit && e && (this.__originalConnectionTimeLimit = e._connectionTimeLimit || e.__connectionTimeLimit, s.log('[VastCtrl] :: Vast - setting ads time limit to: ', this.connectionTimeLimit), e._connectionTimeLimit = this.connectionTimeLimit, e.__connectionTimeLimit = this.connectionTimeLimit)
      },
      __resetConnectionTimeLimit: function () {
        var e = this.sMedia.__player;
        this.connectionTimeLimit && e && (s.log('[VastCtrl] :: Vast -reset player connection time limit to: ', this.__originalConnectionTimeLimit), e._connectionTimeLimit = this.__originalConnectionTimeLimit, e.__connectionTimeLimit = this.__originalConnectionTimeLimit)
      },
      __getSecondWhereTheShowWasInterruptedByAds: function () {
        return 'pre' === this.__rollPlaying ? 0 : 'pos' === this.__rollPlaying ? - 1 : this.__actualMidTime
      },
      __setMediaHandlers: function () {
        this.__cleanEvents(),
        this.__hasHandlers = !0,
        this.__timeHandler = n.bind(this.__onTimeUpdate, this),
        this.__finishedHandler = n.bind(this.__videoAdFinished, this),
        this.__errorAdHandlerRef = n.bind(this.__errorAdHandler, this),
        this.__pauseAndResumeHandler = n.bind(this.__videoPauseAndResume, this),
        this.sMedia.addEventListener(this.sMedia.EVT_TIME_UPDATE, this.__timeHandler),
        this.sMedia.addEventListener(this.sMedia.EVT_FINISHED, this.__finishedHandler),
        this.sMedia.addEventListener(this.sMedia.EVT_ERROR, this.__errorAdHandlerRef),
        this.sMedia.addEventListener(this.sMedia.EVT_STATE_CHANGED, this.__pauseAndResumeHandler)
      },
      __setMediaListenerOfMainContent: function () {
        this.__cleanMainEvents(),
        this.__hasMainHandlers = !0,
        this.__timeMainHandlerRef = n.bind(this.__timeMainHandler, this),
        this.__finishedMainHandlerRef = n.bind(this.__finishedMainHandler, this),
        this.__errorMainHandlerRef = n.bind(this.__errorMainHandler, this),
        this.sMedia.addEventListener(this.sMedia.EVT_TIME_UPDATE, this.__timeMainHandlerRef),
        this.vastConfig.video || this.sMedia.addEventListener(this.sMedia.EVT_FINISHED, this.__finishedMainHandlerRef),
        this.addEventListener(this.EVT_FINISHED_CONTENT, this.__finishedMainHandlerRef),
        this.sMedia.addEventListener(this.sMedia.EVT_ERROR, this.__errorMainHandlerRef)
      },
      __timeMainHandler: function (e) {
        var t,
        i,
        n = this.vastConfig.video;
        this.sMedia.isState(this.sMedia.SKIPPING) || (n ? (t = parseInt(n.currentTime, 10), i = parseInt(n.duration, 10)) : (t = parseInt(e, 10), i = parseInt(this.sMedia.getDuration(), 10)), this.__fireEvents().mainPlayTimeUpdate(e, i), (t = this.__getValidTime(t)) >= i || null === t || (this.__vastPlayTime = 0, this.__currentTime = t, this.__setMidRolls(t), this.__setPostRoll(t, i)))
      },
      __contTimesMainHandler: 0,
      __listTimesMainHandlers: [
      ],
      __getValidTime: function (e) {
        var t,
        e = parseInt(e, 10),
        i = 0 === this.__contTimesMainHandler,
        s = null === e || !n.isNumber(e),
        r = 0 === e,
        o = this.__contTimesMainHandler > 10,
        a = 0 !== e && !o,
        d = n.bind(function () {
          this.__contTimesMainHandler = 0,
          this.__listTimesMainHandlers = [
          ]
        }, this),
        c = n.bind(function () {
          var n = e;
          return this.__listTimesMainHandlers.push(e),
          t = this.__listTimesMainHandlers[this.__contTimesMainHandler - 1],
          this.__contTimesMainHandler++,
          i ? null : Math.abs(t - e) > 1 ? null : e < t ? (d(), e) : e >= t ? (d(), t) : n
        }, this);
        return s ? null : r ? 0 : a ? c() : e
      },
      __fireError: function (e, t) {
        if (t = t || [
        ], e) for (var i = 0; i < t.length; i++) this.vastError.trackError(t[i], e)
      },
      __setMidRolls: function (e) {
        var t = this.__getMidTime(e + this.__preloadTime),
        i = this.__preAdEventTime ? this.__getMidTime(e + this.__preAdEventTime) : null,
        s = this.__getMidTime(e);
        t && !this.__hasPreloadVast['mid_' + t] && this.__preloadVast('mid_' + t).then(n.bind(function (e) {
          e && this.__checkMidLoad(t)
        }, this)),
        i && this.__setPreAdEvent('mid_' + i),
        this.__checkMidLoad(s)
      },
      __getMidTime: function (e) {
        for (var t, i, n = null, s = this.__midTimes, r = s.length, o = 0; o < r; o++) if (i = s[o], e >= i && ((t = o + 1) === r || e < s[t])) {
          n = i;
          break
        }
        return n
      },
      __checkMidLoad: function (e) {
        var t = 'mid_' + e;
        this.vastConfig.video.disableNextAd && (e && (this.midTimePlayed[t] = !0), this.vastConfig.video.disableNextAd = !1),
        e && !this.midTimePlayed[t] && this.__checkLoadStatus(t) && (this.__actualMidTime = e, this.midTimePlayed[t] = !0, this.__preloadedVast[t] && this.load(t))
      },
      __setPostRoll: function (e, t) {
        var i = this.__preAdEventTime,
        s = e >= t - this.__preloadTime,
        r = e >= t - i;
        s && !this.__hasPreloadVast.pos && this.__preloadVast('pos').then(n.bind(function (e) {
          e && this.__checkPostLoad()
        }, this)),
        r && i && this.__setPreAdEvent('pos')
      },
      __preloadVast: function (e) {
        return this.__hasPreloadVast[e] = !0,
        this.__preloadingVast[e] = !0,
        this.collection.load(e).then(n.bind(this.__onPreload, this)).fail(n.bind(this.__onPreloadFail, this))
      },
      __onPreload: function (e) {
        var t = !1;
        return this.__preloadingVast[e] = !1,
        this.__preloadedVast[e] = !0,
        this.__preAdEventLoading[e] ? this.__preAdEvents(e) : this.__playLoading[e] && (t = !0, this.__playLoading[e] = !1),
        t
      },
      __onPreloadFail: function (e) {
        this.__preloadingVast[e] = !1,
        this.__failedVast[e] = !0
      },
      __setPreAdEvent: function (e) {
        this.__hasPreAdEvent[e] || (this.__hasPreAdEvent[e] = !0, this.__preloadingVast[e] ? this.__preAdEventLoading[e] = !0 : this.__preloadedVast[e] && this.__preAdEvents(e))
      },
      __preAdEvents: function (e) {
        this.collection.existRollAndHasData(e) && (this.__vastPlayTime = this.__currentTime, this.__vastPlayTime += this.__preAdEventTime, this.__fireEvents().preStartSlot(), this.__fireEvents().preStartAd())
      },
      __checkLoadStatus: function (e) {
        if (this.__preloadedVast[e] || this.__failedVast[e]) return !0;
        this.__preloadingVast[e] && (this.__playLoading[e] = !0)
      },
      loadMid: function (e) {
        var t = 'mid_' + e;
        return this.collection.load(t).then(n.bind(function () {
          this.load(t),
          this.__actualMidTime = e
        }, this))
      },
      __resetMediaDuration: function () {
        this.useMediaDuration && (this.__duration = 0)
      },
      __useMediaDurationInsteadOfVastInfo: function () {
        this.useMediaDuration && (this.__duration = this.sMedia.getDuration())
      },
      __onTimeUpdate: function (e) {
        var t,
        i = this.__preAdEventTime,
        n = this.sMedia.getDuration(),
        s = this.__modelActualAd && this.__modelActualAd.get('creativeDurationInSeconds'),
        r = e && n && !this.__modelActualAd.get('durationChecked');
        this.__useMediaDurationInsteadOfVastInfo(),
        t = parseInt(this.__duration, 10) > 0,
        t && (this.__callToTrackingEvents(e), this.__setSkippable(e), i && e >= this.__duration - i && this.__setAdEndEvent()),
        !r || s >= Math.floor(n) && s <= Math.ceil(n) || (this.__fireError(this.vastError.DURATION, this.__modelActualAd.get('error')), this.__modelActualAd.set('durationChecked', !0))
      },
      __setAdEndEvent: function () {
        var e,
        t,
        i = this.collection.getModel(this.__rollPlaying);
        this.__actualAd === i.length - 1 ? (t = 'preEndSlot', e = t + this.__rollPlaying) : (t = 'preStartAd', e = t + this.__actualAd + '_' + this.__rollPlaying),
        this.__evtFired[e] || (this.__evtFired[e] = !0, this.__fireEvents() [t]())
      },
      __errorAdHandler: function (e) {
        this.__adHasAnError = !0;
        var t = this.__modelActualAd.get('error') || null;
        this.vastError.mediaError(e, t),
        s.error('[VastCtrl] __errorAdHandler: ' + e, e),
        this.__decideNextAdToPlay(),
        this.__fireEvents().errAd(e)
      },
      __errorMainHandler: function (e) {
        this.backToMainContentAfterError(e),
        s.error('[VastCtrl] :: Vast - error main video player handler ', e)
      },
      __decideNextAdToPlay: function () {
        var e = this.collection.getModel(this.__rollPlaying, this.__actualAd);
        if (n.isArray(e) && ++this.__fallbackNo < e.length) return void this.__loadAd();
        this.__videoAdFinished()
      },
      __getAdByFallbackIndex: function (e) {
        var t = n.find(e, n.bind(function (e) {
          return e.get('fallbackIndex') === this.__fallbackNo
        }, this));
        return t || s.log('[VastCtrl] No fallback ad found with index ' + this.__fallbackNo),
        t
      },
      __getEvents: function () {
        var e = n.bind(function (e) {
          var t = this.__modelActualAd.get('creativeTrackingEvents') [e];
          this.isAdPlaying() && t && this.__sendMultipleTrackingEvents(t, e)
        }, this);
        this.addEventListener(this.EVT_CLOSE_AD, function () {
          e('close')
        }),
        this.addEventListener(this.EVT_MUTE_AD, function () {
          e('mute')
        }),
        this.addEventListener(this.EVT_UNMUTE_AD, function () {
          e('unmute')
        }),
        this.addEventListener(this.EVT_SKIP_AD, function () {
          e('skip'),
          this.__videoAdFinished()
        })
      },
      __fireEvents: function (e) {
        e = e || null;
        var t = n.bind(function () {
          this.dispatchEvent(this.EVT_PRE_START_AD_SLOT, {
            type: this.__rollPlaying,
            collection: this.collection.getModel(this.__rollPlaying)
          })
        }, this),
        i = n.bind(function () {
          this.dispatchEvent(this.EVT_START_AD_SLOT, {
            type: this.__rollPlaying,
            collection: this.collection.getModel(this.__rollPlaying),
            adBreakNo: this.__midTimes.indexOf(this.__actualMidTime) + 1
          })
        }, this),
        s = n.bind(function () {
          this.dispatchEvent(this.EVT_PRE_START_AD, {
            type: this.__rollPlaying,
            model: this.__modelActualAd,
            duration: this.__duration
          })
        }, this),
        r = n.bind(function () {
          this.dispatchEvent(this.EVT_LOADED_PLAYER, {
            type: this.__rollPlaying,
            model: this.__modelActualAd
          })
        }, this),
        o = n.bind(function () {
          this.dispatchEvent(this.EVT_START_AD, {
            type: this.__rollPlaying,
            model: this.__modelActualAd,
            duration: this.__duration
          })
        }, this),
        a = n.bind(function () {
          this.dispatchEvent(this.EVT_PRE_END_AD_SLOT, {
            second: this.__getSecondWhereTheShowWasInterruptedByAds(),
            type: this.__rollPlaying,
            numAdds: this.__actualAd,
            collection: this.collection.getModel(this.__rollPlaying)
          })
        }, this),
        d = n.bind(function () {
          this.dispatchEvent(this.EVT_END_AD_SLOT, {
            second: this.__getSecondWhereTheShowWasInterruptedByAds(),
            type: this.__rollPlaying,
            numAdds: this.__actualAd,
            collection: this.collection.getModel(this.__rollPlaying)
          })
        }, this),
        c = n.bind(function () {
          this.dispatchEvent(this.EVT_END_AD, {
            type: this.__rollPlaying,
            model: this.__modelActualAd
          })
        }, this),
        l = n.bind(function () {
          this.dispatchEvent(this.EVT_END_PLAYER, {
            collection: this.collection.getModel(this.__rollPlaying)
          })
        }, this),
        u = n.bind(function () {
          this.dispatchEvent(this.EVT_ERR_AD, e)
        }, this),
        h = n.bind(function () {
          this.dispatchEvent(this.EVT_SKIPPABLE_STATE_CHANGED, {
            model: this.__modelActualAd
          })
        }, this);
        return {
          preStartSlot: t,
          startSlot: i,
          preStartAd: s,
          loadedPlayer: r,
          startAd: o,
          preEndSlot: a,
          endSlot: d,
          endAd: c,
          errAd: u,
          endPlayer: l,
          endMain: n.bind(function () {
            this.dispatchEvent(this.EVT_FINISHED_BEFORE_POSTROLLS)
          }, this),
          isSkippable: h,
          mainPlayTimeUpdate: n.bind(function (e, t) {
            this.dispatchEvent(this.EVT_TIME_UPDATE, {
              pos: e,
              duration: t
            })
          }, this),
          vastErrorLoadingCollection: n.bind(function () {
            this.dispatchEvent(this.EVT_ERROR_LOADING_COLLECTION, e)
          }, this),
          vastError: n.bind(function () {
            this.dispatchEvent(this.EVT_ERROR_ON_MAIN)
          }, this)
        }
      },
      __resetMedia: function () {
        try {
          this.sMedia.stop(),
          this.sMedia.deinit()
        } catch (e) {
          s.log('[VastCtrl] :: Vast - resetMedia error', e)
        }
      },
      __reset: function () {
        this.__resetMedia(),
        this.__cleanEvents(),
        this.__startedAd = !1,
        this.__impressionsEmited = !1,
        this.__creativeViewEmited = !1,
        this.__startEventEmited = !1,
        this.__firstQuartileEventEmited = !1,
        this.__midpointEventEmited = !1,
        this.__thirdQuartileEventEmited = !1,
        this.__adHasAnError = !1
      },
      __cleanMainEvents: function () {
        this.__hasMainHandlers && (this.__hasMainHandlers = !1, this.sMedia.removeEventListener(this.sMedia.EVT_TIME_UPDATE, this.__timeMainHandlerRef), this.vastConfig.video || this.sMedia.removeEventListener(this.sMedia.EVT_FINISHED, this.__finishedMainHandlerRef), this.sMedia.removeEventListener(this.sMedia.EVT_ERROR, this.__errorMainHandlerRef), this.removeEventListener(this.EVT_FINISHED_CONTENT, this.__finishedMainHandlerRef))
      },
      __cleanEvents: function () {
        this.__hasHandlers && (this.__hasHandlers = !1, this.__timeHandler && this.sMedia.removeEventListener(this.sMedia.EVT_TIME_UPDATE, this.__timeHandler), this.__finishedHandler && this.sMedia.removeEventListener(this.sMedia.EVT_FINISHED, this.__finishedHandler), this.__errorAdHandlerRef && this.sMedia.removeEventListener(this.sMedia.EVT_ERROR, this.__errorAdHandlerRef), this.__pauseAndResumeHandler && this.sMedia.removeEventListener(this.sMedia.EVT_STATE_CHANGED, this.__pauseAndResumeHandler)),
        this.removeEventListener('startAd'),
        this.removeEventListener('endAd'),
        this.removeEventListener('errorAd'),
        this.removeEventListener('startSlot'),
        this.removeEventListener('endSlot')
      },
      __callToImpressions: function () {
        for (var e = this.__modelActualAd.get('impressions'), t = e.length, i = 0; i < t; i++) this.getRequest(e[i], 'Impression')
      },
      __sendMultipleTrackingEvents: function (e, t) {
        var i = 0,
        n = e.length;
        for (i = 0; i < n; i++) this.getRequest(e[i].url, t)
      },
      __callToTrackingEvents: function (e) {
        var t = parseFloat(e, 10),
        i = this.__modelActualAd.get('impressions').length > 0 && !this.__impressionsEmited,
        n = this.__trackingEvents.creativeView && !this.__creativeViewEmited,
        r = t >= 0 && this.__trackingEvents.start && !this.__startEventEmited,
        o = t >= 0.25 * this.__duration && this.__trackingEvents.firstQuartile && !this.__firstQuartileEventEmited,
        a = t >= 0.5 * this.__duration && this.__trackingEvents.midpoint && !this.__midpointEventEmited,
        d = t >= 0.75 * this.__duration && this.__trackingEvents.thirdQuartile && !this.__thirdQuartileEventEmited;
        i && (s.log('[VastCtrl] Vast ad beacon: impressions Event'), this.__callToImpressions(), this.__impressionsEmited = !0),
        n && (s.log('[VastCtrl] Vast ad beacon: creativeView Event'), this.__sendMultipleTrackingEvents(this.__trackingEvents.creativeView, 'creativeView Event'), this.__creativeViewEmited = !0),
        r && (s.log('[VastCtrl] :: Vast ad beacon: start Event'), this.__sendMultipleTrackingEvents(this.__trackingEvents.start, 'start Event'), this.__startEventEmited = !0),
        o && (s.log('[VastCtrl] :: Vast ad beacon: firstQuartile Event'), this.__sendMultipleTrackingEvents(this.__trackingEvents.firstQuartile, 'firstQuartile Event'), this.__firstQuartileEventEmited = !0),
        a && (s.log('[VastCtrl] :: Vast ad beacon: midpoint Event'), this.__sendMultipleTrackingEvents(this.__trackingEvents.midpoint, 'midpoint Event'), this.__midpointEventEmited = !0),
        d && (s.log('[VastCtrl] Vast ad beacon: thirdQuartile Event'), this.__sendMultipleTrackingEvents(this.__trackingEvents.thirdQuartile, 'thirdQuartile Event'), this.__thirdQuartileEventEmited = !0)
      },
      __setSkippable: function (e) {
        null !== this.__skipOffset && e >= this.__skipOffset && (this.__skipOffset = null, this.__modelActualAd.set('skippable', !0), this.__fireEvents().isSkippable()),
        this.__proccessProgressTrackingEvents(e)
      },
      __proccessProgressTrackingEvents: function (e) {
        if (this.__progressTrackingEvents && this.__progressTrackingEvents.length > 0) {
          var t = parseInt(e, 10),
          i = this.__progressTrackingEvents[0].offset,
          n = this.__progressTrackingEvents[0].url;
          i === t && (this.getRequest(n, 'Progress Event in second ' + i), this.__progressTrackingEvents.shift())
        }
      },
      __finishedMainHandler: function () {
        this.__fireEvents().endMain(),
        this.__checkLoadStatus('pos') ? this.__checkPostLoad() : this.__preloadingVast.pos || this.__preloadVast('pos').complete(n.bind(this.__checkPostLoad, this))
      },
      __checkPostLoad: function () {
        this.collection.existPosRollsAndHasData() ? (s.log('[VastCtrl] Triggered post roll logic'), this.load('pos')) : this.__fireEvents().endPlayer()
      },
      __callToFinishedEvent: function () {
        if (!this.__adHasAnError) {
          this.__trackingEvents && this.__trackingEvents.complete && (s.log('[VastCtrl] Vast ad beacon: complete Event'), this.__sendMultipleTrackingEvents(this.__trackingEvents.complete, 'complete Event'))
        }
      },
      __videoAdFinished: function () {
        s.log('[VastCtrl] __videoAdFinished'),
        this.__fallbackNo = 0,
        this.__endAd(),
        this.__wasTheLastAd() ? (s.log('[VastCtrl] __videoAdFinished Last ad, end slot'), this.finishAdSlot()) : (s.log('[VastCtrl] __videoAdFinished not the last ad continue with next'), this.__finishAdAndContinueWithNext())
      },
      __wasTheLastAd: function () {
        return !(this.__rollPlaying && this.collection && this.collection.getModel(this.__rollPlaying) && this.collection.getModel(this.__rollPlaying).length > 0) || this.__actualAd === this.collection.getModel(this.__rollPlaying).length - 1
      },
      __videoPauseAndResume: function (e) {
        2 === e.toState && (s.log('[VastCtrl] Vast ad beacon: pause Event'), this.__sendMultipleTrackingEvents(this.__trackingEvents.pause, 'pause Event')),
        2 === e.fromState && 1 === e.toState && (s.log('[VastCtrl] Vast ad beacon: resume Event'), this.__sendMultipleTrackingEvents(this.__trackingEvents.resume, 'resume Event'))
      },
      __finishAdAndContinueWithNext: function () {
        this.__goToTheNextAd()
      },
      finishAdSlot: function () {
        this.__fireEvents().endSlot(),
        'pos' === this.__rollPlaying && this.__fireEvents().endPlayer(),
        this.resetAdMediaEventsToMainContentEvents()
      },
      __endAd: function () {
        this.__resetConnectionTimeLimit();
        try {
          this.__callToFinishedEvent()
        } catch (e) {
          s.error('[VastCtrl] error in end ad with finished event tracking ', e.message)
        }
        this.__fireEvents().endAd()
      },
      __goToTheNextAd: function () {
        this.__actualAd++,
        this.__loadAd()
      },
      __errorEvent: function (e) {
        s.log('[VastCtrl] Vast ad beacon: error', e)
      },
      resetAdMediaEventsToMainContentEvents: function () {
        s.log('[VastCtrl] resetAdMediaEventsToMainContentEvents'),
        this.__adIsPlaying = !1,
        this.__cleanEvents(),
        this.__setMediaListenerOfMainContent(),
        this.__actualAd = 0,
        this.__actualMidTime = - 1
      },
      backToMainContentAfterError: function (e) {
        s.log('[VastCtrl] backToMainContentAfterError ' + e),
        this.__fireEvents(e).errAd(),
        this.resetAdMediaEventsToMainContentEvents()
      }
    })
  }),
  define('app/helper/ApiUtils', [
    'xdk-base/ajax',
    'xdk-base/config',
    'xdk-base/device',
    'xdk-base/promise',
    'xdk-base/util',
    'xdk-base/console',
    'app/mgr/UserManager'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a = o.singleton();
    return {
      request: function (t) {
        var i,
        s = {
          method: t.method || 'get',
          parameters: t.param,
          postBody: t.postBody,
          requestHeaders: t.requestHeaders || {
          }
        },
        o = a.getUserToken();
        return t.url ? (i = t.url, delete t.url, s.requestHeaders['content-type'] = 'application/json', s.requestHeaders.deviceType = this._getDeviceType(), o && (s.requestHeaders.userToken = o), e.request(i, s).then(this._getJSON).fail(function (e) {
          'failure' === e.type && r.error(e)
        })) : n.reject('No url provided')
      },
      _getJSON: function (e) {
        return e.responseJSON ? e.responseJSON : s.isUndefined(e.responseText) || '' === e.responseText ? void 0 : s.parse(e.responseText)
      },
      _getDeviceType: function () {
        return t.get('deviceType').sagemStb
      }
    }
  }),
  define('app/service/SegmentApiService', [
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/console',
    'app/helper/ApiUtils',
    'xdk-base/util',
    'xdk-base/promise',
    'xdk-base/ajax'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a,
    d,
    c = t.get('remote').segment,
    l = t.get('segment'),
    u = {
    };
    return a = e.create({
      singleton: function () {
        return d || (d = new a),
        d
      },
      URLS: {
        IDENTIFY: c + 'identify',
        TRACK: c + 'track',
        SCREEN: c + 'screen'
      },
      SEGMENT_WRITE_KEY: l.apiKey
    }, {
      _getUrl: function (e) {
        switch (e) {
          case 'identify':
            return this.constructor.URLS.IDENTIFY;
          case 'track':
            return this.constructor.URLS.TRACK;
          case 'screen':
            return this.constructor.URLS.SCREEN;
          default:
            i.error('\'endpoint\' is not found')
        }
      },
      _getHeaders: function () {
        return s.isEmpty(u) ? u = {
          'Content-Type': 'application/json',
          Authorization: 'Basic ' + window.btoa(this.constructor.SEGMENT_WRITE_KEY + ':')
        }
         : u
      },
      _getJSON: function (e) {
        return e.responseJSON ? e.responseJSON : s.isUndefined(e.responseText) || '' === e.responseText ? void 0 : JSON.parse(e.responseText)
      },
      send: function (e, t) {
        if (!s.isString(e) && '' !== e) return r.reject('\'endpoint\' is not valid');
        if (!s.isObject(t) || s.isEmpty(t)) return r.reject('\'payload\' is not valid');
        var i = this._getUrl(e),
        n = this._getHeaders(),
        a = {
          method: 'post',
          requestHeaders: n,
          postBody: s.stringify(t)
        };
        return o.request(i, a).then(this._getJSON).then(function (e) {
          return e && e.success ? {
            url: i,
            headers: n,
            payload: t
          }
           : r.reject({
            error: e,
            request: {
              url: i,
              headers: n,
              payload: t
            }
          })
        })
      }
    })
  }),
  define('app/helper/customOnScreenLogger', [
  ], function () {
    'use strict';
    function e() {
      r || (i(function (e, t) {
        o = e,
        a = t
      }), r = !0)
    }
    function t() {
      var e = new Date;
      return '[' + ('0' + e.getMinutes()).slice( - 2) + ':' + ('0' + e.getSeconds()).slice( - 2) + ']'
    }
    function i(e) {
      var t = document.createElement('div');
      t.setAttribute('id', 'debuggerContainerElem'),
      t.style.position = 'fixed',
      t.style.backgroundColor = 'rgba(96, 125, 139, .5)',
      t.style.top = 0,
      t.style.left = 0,
      t.style.width = '1920px',
      t.style.height = '1080px',
      t.style.zIndex = 9999999;
      var i = document.createElement('pre');
      i.setAttribute('id', 'debuggerElem'),
      i.style.position = 'absolute',
      i.style.backgroundColor = 'rgba(96, 125, 139, .5)',
      i.style.top = '80px',
      i.style.right = '90px',
      i.style.bottom = '90px',
      i.style.left = '90px',
      i.style.margin = 0,
      i.style.padding = '10px',
      i.style.color = '#ffe500';
      var n = document.createElement('div');
      n.setAttribute('id', 'footerElem'),
      n.style.position = 'absolute',
      n.style.backgroundColor = 'rgba(139, 180, 199, 0.75)',
      n.style.top = '630px',
      n.style.right = '90px',
      n.style.bottom = '60px',
      n.style.left = '90px',
      n.style.margin = 0,
      n.style.paddingLeft = '10px',
      n.style.paddingRight = '10px',
      n.style.color = '#ff0057',
      t.appendChild(i),
      t.appendChild(n),
      document.body.appendChild(t),
      e(i, n)
    }
    function n(i) {
      e(),
      d.push(t() + ' - ' + i),
      d.length > c && d.shift(),
      o.innerHTML = d.join('\n')
    }
    function s(t) {
      e(),
      a.innerHTML = t
    }
    var r = !1,
    o = null,
    a = null,
    d = [
    ],
    c = 22;
    return {
      log: n,
      logFooter: s
    }
  }),
  define('app/mgr/SegmentTrackingManager', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/config',
    'xdk-base/device',
    'xdk-base/Env',
    'xdk-base/console',
    'app/service/SegmentApiService',
    'app/helper/customOnScreenLogger',
    'app/mgr/UserManager',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    var l,
    u,
    h = o.singleton(),
    _ = d.singleton();
    return l = e.create({
      IS_SEGMENT_DEBUGGING: !1,
      AD_POD_START: 'ad-pod-start',
      AD_POD_END: 'ad-pod-end',
      AD_START: 'ad-start',
      FIVE_MIN_INTERVAL: 'vod-five-minutes',
      MEDIA_BEGIN: 'media-begin',
      PRELOGIN_LOGIN_SUCCESS: 'prelogin-login-success',
      PRELOGIN_FACEBOOK_FAIL: 'prelogin-facebook-fail',
      VIDEO_PLAY: 'video-play',
      VIDEO_PLAY_ERROR: 'video-play-error',
      VIDEO_STOP: 'video-stop',
      singleton: function () {
        return u || (u = new l),
        u
      }
    }, {
      _basePayload: {
        browser: 'vodafonetv-opera',
        deviceType: 'vodafonetv',
        deviceTypeInfo: 'vodafonetv',
        endpoint: '3Now Vodafone TV',
        appVersion: i.get('version') + '#' + i.get('buildNumber')
      },
      _send: function (e, i) {
        function n(e, t, i) {
          if (e) {
            var n = 'Segment - [' + t + ']',
            s = ' - {' + i.url.split('/').pop() + '}',
            o = i.payload.event ? ' - ' + i.payload.event : '';
            a.log(n + s + o),
            'OK' === t ? r.info(i) : r.error(i)
          }
        }
        if (!t.isString(e) || !t.isObject(i)) throw new Error('Some arguments are missing');
        h.send(e, i).then(t.bind(function (e) {
          n(this.constructor.IS_SEGMENT_DEBUGGING, 'OK', e)
        }, this), t.bind(function (e) {
          n(this.constructor.IS_SEGMENT_DEBUGGING, 'KO', e)
        }, this)).fail(function (e) {
          r.error(e)
        }).done()
      },
      _merge: function (e, i) {
        var n = t.clone(e, !0),
        s = t.clone(i, !0);
        return t.extend(n, s, !0)
      },
      _updateBasePayload: function (e) {
        this._basePayload = t.extend(this._basePayload, e, !0)
      },
      _getUser: function () {
        var e = _.getCurrentUser();
        if (e) {
          var t = e.get('profile');
          return {
            userId: e.get('uid'),
            age: t.age,
            birthYear: t.birthYear,
            gender: t.gender,
            deviceId: n.id.getUniqueID()
          }
        }
      },
      trackPlayer: function (e, t) {
        var i = this._getUser() || {
        },
        n = {
          userId: i.userId || '',
          event: e,
          properties: {
            'user-id': i.userId || '',
            age: i.age || '',
            gender: i.gender || '',
            'birth-year': i.birthYear || '',
            'device-id': i.deviceId || '',
            browser: this._basePayload.browser || '',
            'device-type': this._basePayload.deviceType || '',
            'device-type-info': this._basePayload.deviceTypeInfo || '',
            endpoint: this._basePayload.endpoint || '',
            'app-version': this._basePayload.appVersion || '',
            'brightcove-id': t.brightcoveId || '',
            'show-id': t.videoId || '',
            'ibms-ep-id': t.ibmsEpId || '',
            'ibms-show-id': t.ibmsShowId || '',
            'episode-title': t.name || '',
            'show-title': t.showTitle || ''
          }
        },
        s = c.AD_TYPE,
        r = t.type;
        e !== this.constructor.VIDEO_PLAY && e !== this.constructor.MEDIA_BEGIN || (n.properties['stream-resume'] = t.isResume, 'string' == typeof t.genre && (n.properties['genre-id'] = t.genre.split(',').sort().join()), n.properties['video-type'] = t.type, n.properties['tv-channel'] = t.channel),
        e !== this.constructor.AD_POD_START && e !== this.constructor.AD_START && e !== this.constructor.AD_POD_END || (r === s.PRE ? r = 'preroll' : r !== s.POS && (r = 'midroll' + t.adBreakNo), n.properties['ad-pod'] = r, e === this.constructor.AD_START ? (n.properties['ad-id'] = t.adId, n.properties['creative-id'] = t.creativeId, n.properties['ad-duration'] = t.adDuration, n.properties['ad-title'] = t.adTitle, n.properties['ad-system'] = t.adSystem) : e === this.constructor.AD_POD_END && (n.properties['ad-pod-duration'] = t.adsDuration.toFixed(2), n.properties['num-ads-delivered'] = t.adsServed)),
        e === this.constructor.VIDEO_STOP && (t.duration > 0 && (n.properties['total-video-duration'] = Math.round(t.duration)), t.position > 0 && (n.properties['video-stop-position'] = Math.round(t.position))),
        e === this.constructor.VIDEO_PLAY_ERROR && (n.properties['error-message'] = t.errorMessage),
        e === this.constructor.FIVE_MIN_INTERVAL && (n.properties['vod-stream-duration'] = t.fiveMinIntervalCount.toFixed(2)),
        this._send('track', n)
      },
      trackLogin: function (e, t, i) {
        if ('success' === i) {
          var n = this._getUser() || {
          },
          s = t.get('socialProvider'),
          r = {
            userId: n.userId || '',
            event: e,
            properties: {
              'user-id': n.userId || '',
              age: n.age || '',
              gender: n.gender || '',
              'birth-year': n.birthYear || '',
              'device-id': n.deviceId || '',
              browser: this._basePayload.browser || '',
              'device-type': this._basePayload.deviceType || '',
              'device-type-info': this._basePayload.deviceTypeInfo || '',
              endpoint: this._basePayload.endpoint || '',
              'app-version': this._basePayload.appVersion || '',
              'user-validation-method': s
            }
          };
          this._send('track', r)
        } else if ('invalid loginID or password' === t.details || e === this.constructor.PRELOGIN_FACEBOOK_FAIL) {
          var o = {
            event: 'prelogin-login-failure',
            properties: {
              browser: this._basePayload.browser || '',
              'device-type': this._basePayload.deviceType || '',
              'device-type-info': this._basePayload.deviceTypeInfo || '',
              endpoint: this._basePayload.endpoint || '',
              'app-version': this._basePayload.appVersion || ''
            }
          };
          'invalid loginID or password' === t.details ? o.properties['user-validation-method'] = 'email' : e === this.constructor.PRELOGIN_FACEBOOK_FAIL && (o.properties['user-validation-method'] = 'facebook'),
          this._send('track', o)
        }
      },
      trackScreenView: function (e) {
        var t = this._getUser() || {
        },
        i = {
          userId: t.userId || '',
          properties: {
            page: e || '',
            'user-id': t.userId || '',
            age: t.age || '',
            gender: t.gender || '',
            'birth-year': t.birthYear || '',
            'device-id': t.deviceId || '',
            browser: this._basePayload.browser || '',
            'device-type': this._basePayload.deviceType || '',
            'device-type-info': this._basePayload.deviceTypeInfo || '',
            endpoint: this._basePayload.endpoint || '',
            'app-version': this._basePayload.appVersion || ''
          }
        };
        this._send('track', i)
      },
      logFooter: function (e) {
        var i = [
        ];
        this.constructor.IS_SEGMENT_DEBUGGING && (t.each(e || {
        }, function (e) {
          i.push(e.key + ': ' + e.value)
        }), a.logFooter(i.join('/')))
      }
    })
  }),
  define('app/helper/helpers', [
    'app/utils/Constants',
    'xdk-ax/Container',
    'xdk-ui-basic/Label',
    'xdk-base/util',
    'xdk-base/device/vKey',
    'app/mgr/MessageDisplayHelper',
    'vdk-lib-moment/moment',
    'app/mgr/SegmentTrackingManager'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    var d = r.singleton(),
    c = a.singleton();
    return {
      resizeImage: function (e, t, i) {
        return e && n.isString(e) ? e.replace('[width]', t).replace('[height]', i) : ''
      },
      getProperty: function (e, t, i) {
        return n.isArray(t) || (t = [
          t
        ]),
        n.each(t, function (t) {
          if (!e) return i;
          e = n.isFunction(e.get) ? e.get(t) : n.isFunction(e.getElementsByTagName) ? e.getElementsByTagName(t) : e[t]
        }),
        e || i
      },
      isEmailValid: function (e) {
        return /(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/.test(e)
      },
      positionCarousel: function (e, t, i, n, r) {
        if (n && i === s.DOWN.id) return !1;
        var o = e.getRoot();
        if (i === s.UP.id) t -= 1;
         else if (i === s.DOWN.id) t += 1;
         else if (i) return !1;
        return t < 0 ? o.attr('style', {
          top: '0px'
        }) : o.attr('style', {
          top: - (211 * t + r) + 'px'
        })
      },
      scrollToTop: function (e) {
        e.getRoot().attr('style', {
          top: 0
        })
      },
      formatNumber: function (e, t, i) {
        return isNaN(e) ? '' : (t = t || 2, (Array(t + 1).join(i || '0') + e.toString()).slice( - t))
      },
      navigate: function (e, t, i) {
        var n = require('app/core/RoutableController');
        return i = i || {
        },
        i.pageId = i.pageId || e,
        n.getAppRouter().navigate(e, {
          historySkip: t,
          state: i
        })
      },
      isMovie: function (e) {
        return n.findIndex(e, function (e) {
          return 'movie' === e
        }) > - 1
      },
      calculatePercentage: function (e, t) {
        return this.validateNonZeroNumber(e) && this.validateNonZeroNumber(t) ? Math.floor(e / t * 100) : 0
      },
      validateNonZeroNumber: function (e) {
        return n.isNumber(e) && 0 !== e
      },
      replaceString: function (e, t) {
        var i;
        if (arguments.length > 1) for (t = Array.prototype.slice.call(arguments, 1), i = t.length; i--; ) e = e.replace(new RegExp('%' + (i + 1), 'g'), t[i]);
        return e
      },
      showError: function (e, t) {
        amd.require('app/mgr/ErrorManager').singleton().showError(e, t),
        c.trackScreenView('error-message')
      },
      showLoginToWatchError: function (t) {
        var i = e.Messages.Login;
        d.showMessage({
          title: i.WATCH_LOGIN_TITLE,
          message: i.WATCH_LOGIN_CONTENT,
          subMessage: i.SIGNUP_MESSAGE,
          contentButtons: [
            {
              buttonText: e.Messages.Buttons.LOGIN,
              buttonClickCallback: n.bind(this.openLoginPopup, this, t)
            }
          ],
          css: 'login-to-watch'
        })
      },
      closeLoginPopup: function () {
        this.loginPopup && this.loginPopup.close()
      },
      openLoginPopup: function (e) {
        var t = require('app/wgt/Login');
        return this.loginPopup = d.showMessage({
          type: r.TYPE.POPUP,
          content: new t({
            callback: n.bind(this.closeLoginPopup, this),
            onLoginSuccessCallback: e
          })
        }),
        this.loginPopup
      },
      openLogoutPopup: function (t) {
        var i = e.Messages.Logout;
        d.showMessage({
          type: r.TYPE.ALERT,
          title: i.TITLE,
          message: i.MESSAGE,
          contentButtons: [
            {
              buttonText: i.CONFIRM,
              buttonClickCallback: t
            },
            {
              buttonText: i.CANCEL
            }
          ]
        })
      },
      formatSecondToHHmmss: function (e) {
        var t = o.utc(o.duration(e, 's').asMilliseconds()),
        i = t.hours() > 0 ? 'H:mm:ss' : 'mm:ss';
        return t.isValid() && (e = t.format(i)),
        e
      },
      onContinueButtonClicked: function (e, t) {
        e.set('currentPosition', t || 0),
        this.navigate('FULLSCREENPLAYER', !1, {
          showModel: e
        })
      },
      showContinuePopup: function (t, i) {
        var s = e.Messages.Continue;
        d.showMessage({
          type: r.TYPE.ALERT,
          title: s.TITLE,
          message: s.MESSAGE,
          contentButtons: [
            {
              buttonText: s.YES.replace('%time', this.formatSecondToHHmmss(t)),
              buttonClickCallback: n.bind(this.onContinueButtonClicked, this, i, t)
            },
            {
              buttonText: s.NO,
              buttonClickCallback: n.bind(this.onContinueButtonClicked, this, i)
            }
          ]
        })
      }
    }
  }),
  define('app/ad/Playlist', [
    'xdk-base/ajax',
    'xdk-base/class',
    'xdk-base/console',
    'xdk-base/promise',
    'xdk-base/util',
    'xdk-ax/mvc/Model',
    'app/helper/helpers'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a = {
      hasPre: !0,
      hasMid: !0,
      hasPos: !0
    },
    d = function (e) {
      e || (e = '[Playlist] Error gettin the playlist.'),
      i.error(e)
    },
    c = function (e) {
      e = e || {
      },
      a = {
        hasPre: !1 !== e.hasPre,
        hasMid: !1 !== e.hasMid,
        hasPos: !1 !== e.hasPos
      }
    },
    l = function (e) {
      e = e || [
      ];
      for (var t = [
      ], i = 0; i < e.length; i++) t.push(e[i].textContent.trim());
      return t
    },
    u = function (e, t) {
      return l(o.getProperty(e, [
        t,
        0
      ], {
      }).children)
    },
    h = function (e) {
      var t;
      return e = e.split(':'),
      t = Number(e[2]),
      t += 60 * parseInt(e[1], 10),
      t += 60 * parseInt(e[0], 10) * 60
    },
    _ = function (e) {
      for (var t = e.getElementsByTagName('Midroll') || [
      ], i = [
      ], n = 0; n < t.length; n++) i.push({
        data: l(t[n].children),
        time: h(o.getProperty(t[n].attributes, [
          'timeOffset',
          'nodeValue'
        ], ''))
      });
      return i
    },
    f = function (e) {
      var t = null,
      n = e.responseXML;
      return n && n.getElementsByTagName && (t = {
        pre: a.hasPre ? u(n, 'Preroll') : null,
        mid: a.hasMid ? _(n) : null,
        pos: a.hasPos ? u(n, 'Postroll') : null
      }),
      i.warn(t),
      t
    },
    p = function (t) {
      return e.request(t).then(f).fail(d)
    };
    return t.create(r, {
      defaults: {
        pre: null,
        mid: null,
        pos: null
      }
    }, {
      getVAST: function (e, t) {
        return c(t),
        p(e).then(s.bind(this.set, this))
      }
    })
  }),
  define('app/ad/Ads', [
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/console',
    'xdk-base/EventDispatcher',
    'xdk-base/util',
    'vdk-vast/vastCtrl',
    'app/ad/Playlist',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    return e.create(n, {
      AD_SLOT_PRE_START: 'ad:evt.slotPreStart',
      AD_SLOT_START: 'ad:evt:slotStart',
      AD_PLAYER_LOADED: 'ad:evt:loaded',
      AD_PRE_START: 'ad:evt:preStart',
      AD_START: 'ad:evt:adStart',
      AD_SKIPPABLE: 'ad:evt:skippable',
      AD_END: 'ad:evt:adEnd',
      AD_SLOT_PRE_END: 'ad:evt:slotPreEnd',
      AD_SLOT_END: 'ad:ev:slotEnd',
      ADS_END: 'ad:content:end',
      CONTENT_RESUME: 'ad:content:resume'
    }, {
      init: function (e) {
        this.opts = e,
        this.playlist = new o,
        this.setVideo(e),
        this.totalTimeAds = 0
      },
      isAdPlaying: function () {
        return this.vast && this.vast.isAdPlaying()
      },
      deinit: function () {
        i.debug('[Ads] deinit'),
        this.hasHandlers && this.removeHandlers(),
        this.vast = null
      },
      setVideo: function (e) {
        this.sMedia = e.sMedia,
        this.video = e.video
      },
      setVast: function (e) {
        return this.vast = new r(e.attributes(), {
          useMediaDuration: !0,
          video: this.video,
          sMedia: this.sMedia,
          fallback: !0
        }),
        this.setHandlers(),
        this.vast.start(),
        e.attributes()
      },
      setHandlers: function () {
        var e = this.vast;
        this.onPreStartSlotRef = s.bind(this.onPreStartSlot, this),
        this.onStartSlotRef = s.bind(this.onStartSlot, this),
        this.onPreStartAdRef = s.bind(this.onPreStartAd, this),
        this.onStartAdRef = s.bind(this.onStartAd, this),
        this.onErrorRef = s.bind(this.onError, this),
        this.onPreEndSlotRef = s.bind(this.onPreEndSlot, this),
        this.onEndSlotRef = s.bind(this.onEndSlot, this),
        this.onSkippableRef = s.bind(this.onSkippable, this),
        this.onAdsEndRef = s.bind(this.onAdsEnd, this),
        this.onPlayerLoadedRef = s.bind(this.onPlayerLoaded, this),
        e.addEventListener(e.EVT_PRE_START_AD_SLOT, this.onPreStartSlotRef),
        e.addEventListener(e.EVT_START_AD_SLOT, this.onStartSlotRef),
        e.addEventListener(e.EVT_PRE_START_AD, this.onPreStartAdRef),
        e.addEventListener(e.EVT_START_AD, this.onStartAdRef),
        e.addEventListener(e.EVT_ERR_AD, this.onErrorRef),
        e.addEventListener(e.EVT_PRE_END_AD_SLOT, this.onPreEndSlotRef),
        e.addEventListener(e.EVT_END_AD_SLOT, this.onEndSlotRef),
        e.addEventListener(e.EVT_SKIPPABLE_STATE_CHANGED, this.onSkippableRef),
        e.addEventListener(e.EVT_END_PLAYER, this.onAdsEndRef),
        e.addEventListener(e.EVT_LOADED_PLAYER, this.onPlayerLoadedRef),
        this.hasHandlers = !0
      },
      removeHandlers: function () {
        var e = this.vast;
        e.removeEventListener(e.EVT_PRE_START_AD_SLOT, this.onPreStartSlotRef),
        e.removeEventListener(e.EVT_START_AD_SLOT, this.onStartSlotRef),
        e.removeEventListener(e.EVT_PRE_START_AD, this.onPreStartAdRef),
        e.removeEventListener(e.EVT_START_AD, this.onStartAdRef),
        e.removeEventListener(e.EVT_ERR_AD, this.onErrorRef),
        e.removeEventListener(e.EVT_PRE_END_AD_SLOT, this.onPreEndSlotRef),
        e.removeEventListener(e.EVT_END_AD_SLOT, this.onEndSlotRef),
        e.removeEventListener(e.EVT_SKIPPABLE_STATE_CHANGED, this.onSkippableRef),
        e.removeEventListener(e.EVT_END_PLAYER, this.onAdsEndRef),
        e.removeEventListener(e.EVT_LOADED_PLAYER, this.onPlayerLoadedRef),
        this.hasHandlers = !1
      },
      skip: function () {
        this.vast.finishAdSlot()
      },
      request: function (e, t) {
        var n = s.bind(this.onError, this),
        r = s.bind(this.setVast, this);
        return i.debug('[Ads] request'),
        this.isContent = !1,
        this.isError = !1,
        this.isContentComplete = !1,
        this.adsTimeout = setTimeout(n, 1000 * (t || a.AD_TIMEOUT)),
        this.resumeState = {
          time: 0,
          duration: 0
        },
        this.playlist.getVAST(e, this.opts).then(r).fail(n)
      },
      onPlayerLoaded: function (e) {
        i.debug('[Ads] Ads player loaded'),
        this.dispatchEvent(this.constructor.AD_PLAYER_LOADED, e)
      },
      onPreStartSlot: function (e) {
        i.debug('[Ads] Pre Slot started'),
        this.dispatchEvent(this.constructor.AD_SLOT_PRE_START, e)
      },
      onStartSlot: function (e) {
        i.debug('[Ads] Slot started'),
        this.isContent = !1,
        this.adsTimeout && (clearTimeout(this.adsTimeout), this.adsTimeout = null),
        this.dispatchEvent(this.constructor.AD_SLOT_START, e)
      },
      onPreStartAd: function (e) {
        i.debug('[Ads] Pre Ad started'),
        this.dispatchEvent(this.constructor.AD_PRE_START, e)
      },
      onStartAd: function (e) {
        i.debug('[Ads] Ad started'),
        this.dispatchEvent(this.constructor.AD_START, e),
        this.totalTimeAds += e.model.get('creativeDurationInSeconds')
      },
      onPreEndSlot: function (e) {
        i.debug('[Ads] Pre Slot ended'),
        this.dispatchEvent(this.constructor.AD_SLOT_PRE_END, e)
      },
      onEndSlot: function (e) {
        i.debug('[Ads] Slot ended'),
        s.extend(e, {
          adsDuration: this.totalTimeAds
        }),
        this.dispatchEvent(this.constructor.AD_SLOT_END, e),
        this.contentResume(),
        this.totalTimeAds = 0
      },
      onAdsEnd: function () {
        i.debug('[Ads] ads end'),
        this.dispatchEvent(this.constructor.ADS_END)
      },
      onSkippable: function (e) {
        var t;
        this.isError || (t = e.model, i.debug('[Ads] skippable: ' + t.get('skippable')), this.dispatchEvent(this.constructor.AD_SKIPPABLE, t))
      },
      onError: function () {
        this.isError || this.isContent || (this.isError = !0)
      },
      contentResume: function () {
        this.isContent || (this.isContent = !0, this.adsTimeout && (clearTimeout(this.adsTimeout), this.adsTimeout = null), i.debug('[Ads] Content resume'), this.isContentComplete || this.dispatchEvent(this.constructor.CONTENT_RESUME))
      },
      contentComplete: function () {
        this.isContentComplete = !0,
        this.vast ? this.vast.contentComplete() : this.onAdsEnd()
      },
      resetMediaEvents: function () {
        this.vast && this.vast.resetAdMediaEvents()
      },
      updateCurrentTime: function (e) {
        this.video.currentTime = e
      },
      disableNextAd: function () {
        this.video.disableNextAd = !0
      },
      updateDuration: function (e) {
        this.video.duration = e
      }
    })
  }),
  define('xdk-ax/iterator/DFSCtrlIt', [
    'xdk-base/class',
    'xdk-ax/iterator/interface/Iterator',
    'xdk-base/core'
  ], function (e, t, i) {
    'use strict';
    return e.create([t], {
    }, {
      __ctrlArr: [
      ],
      init: function (e) {
        this._include(e)
      },
      _include: function (e) {
        var t,
        i = e.getSubControllers();
        this.__ctrlArr.unshift(e);
        for (t in i) this._include(i[t])
      },
      next: function () {
        return this.__ctrlArr.length || i.createException('NoSuchElement', 'No more element is available for current iteraion!'),
        this.__ctrlArr.pop()
      },
      hasNext: function () {
        return !!this.__ctrlArr.length
      }
    })
  }),
  define('xdk-history/HistoryManager', [
    'xdk-base/core',
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/EventDispatcher',
    'xdk-ax/mvc/Controller',
    'xdk-ax/mvc/ControllerManager',
    'xdk-ax/mvc/AppRoot',
    'xdk-ax/iterator/DFSCtrlIt',
    'xdk-base/device/vKey',
    'xdk-base/console',
    'xdk-base/exception',
    'xdk-base/promise',
    'xdk-ax/focusManager'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h) {
    'use strict';
    var _,
    f,
    p = o.singleton(),
    g = r.singleton();
    return _ = t.create(n, {
      DEFAULT_BACK_KEYS: [
        d.BACK.id
      ],
      EVT_HISTORY_BACK: 'ui:history:back',
      EVT_HISTORY_PUSH: 'ui:history:push',
      singleton: function () {
        return f || (f = new _),
        f
      }
    }, {
      _backKeys: null,
      _history: [
      ],
      init: function () {
        this._super(),
        this.setBackKeys(this.constructor.DEFAULT_BACK_KEYS)
      },
      activate: function () {
        var e = this;
        p.setDefaultKeyAction(this._backKeys, function (t) {
          e.back()
        }),
        g.addEventListener(g.constructor.EVT_REPLACED, function (t) {
          t.options.__doHistoryBack || e._push({
            front: t.exist,
            frontContext: t.exist.getContextTree(),
            controller: t.replacement,
            options: t.options
          })
        }),
        g.addEventListener(g.constructor.EVT_OPENED, function (t) {
          t.options.__doHistoryBack || t.options.appRootFirstController || e._push({
            front: null,
            controller: t.controller,
            options: t.options
          })
        }),
        g.addEventListener(g.constructor.EVT_CLOSED, function (t) {
          t.options.__doHistoryBack || e._push({
            front: t.controller,
            frontContext: t.controller.getContextTree(),
            controller: null,
            container: t.container,
            options: t.options
          })
        })
      },
      _setCtrlNav: function (e, t) {
        e.__navigation = t
      },
      _getCtrlNav: function (e) {
        return e.__navigation
      },
      _clearCtrlNav: function (e) {
        e && (e.__navigation = null, delete e.__navigation)
      },
      _removeSkippedHistory: function (e, t) {
        for (var n, s, r = new a(e), o = [
        ], d = this._getCtrlNav(e); r.hasNext(); ) s = r.next(),
        this._getCtrlNav(s) && o.push(this._getCtrlNav(s));
        return i.each(o, function (s) {
          this._clearCtrlNav(s.controller),
          - 1 !== (n = i.indexOf(this._history, s)) && (i.remove(this._history, n), (t || s.controller !== e) && s.front && this._removeSkippedHistory(s.front, !0))
        }, this),
        d
      },
      _doHistoryBack: function (e, t) {
        t = t || {
        },
        t.historyBack = !0;
        var n = function (e) {
          i.each(e, function (e) {
            e.value.historyBack = !0,
            e.value.subContexts && n(e.value.subContexts)
          })
        };
        return e.front && (i.isPlainObject(e.frontContext) && (t = i.extend(e.frontContext, t)), t.subContexts && n(t.subContexts)),
        this._changeController(e, t).complete(function () {
          var t;
          t = e.options.historyFocus ? e.options.historyFocus : null,
          !function (e) {
            return e && e.getRoot() && e.getRoot().isInDOMTree()
          }(t) ? h.focus(h.getLastActiveFocus()) : h.focus(t)
        })
      },
      _changeController: function (t, i) {
        return t.front && t.controller ? g.replace(t.controller, t.front, {
          context: i,
          __doHistoryBack: !0
        }) : t.front ? t.container ? g.open(t.front, t.container, {
          context: i,
          __doHistoryBack: !0
        }) : u.reject(e.createException(l.INTERNAL, 'When doing History back to the previous controller, it fails to find the container to open')) : g.close(t.controller, {
          __doHistoryBack: !0
        })
      },
      _push: function (e) {
        var t,
        i;
        if (e.options && e.options.historySkip) {
          if (!e.front || !e.controller) return void c.warn('cannot skip history on open and close controller');
          if (!(i = this._removeSkippedHistory(e.front)) || !i.front) return;
          e.front = i.front
        }
        e.controller && this._setCtrlNav(e.controller, e),
        !1 === e.options.controllerCache && e.front && (e.front = e.front.constructor, this._history.length > 0 && (t = this._history[this._history.length - 1], t.controller.constructor.prototype instanceof s && (t.controller = t.controller.constructor))),
        this._history.push(e),
        this.dispatchEvent(this.constructor.EVT_HISTORY_PUSH, e)
      },
      back: function (t) {
        t = t || {
        };
        var n,
        r,
        o,
        a,
        d,
        l;
        if (i.isUndefined(t.ctrl)) n = 1;
         else {
          if (d = t.ctrl, !d.prototype instanceof s) throw e.createException('IncorrectParam', 'first arugment should be either a Number or a Controller Subclass.');
          for (a = this._history.length - 1; a >= 0; a--) {
            if (this._history[a].front instanceof d) {
              n = this._history.length - a;
              break
            }
            if (0 === a) return u.reject(!1)
          }
        }
        if ( - 1 === n && (n = this._history.length), !this._history.length || n > this._history.length) return u.reject(!1);
        if (n > 1) {
          for (o = this._history.splice(this._history.length - n + 1, n - 1), a = o.length - 1; a >= 0; a--) c.info('history manager multiback from ' + a),
          l = l ? l.then(i.bind(this._doHistoryBack, this, o[a])) : this._doHistoryBack(o[a]);
          o.splice(0, o.length),
          c.info(this._history)
        }
        return r = this._history.pop(),
        l = l ? l.then(i.bind(this._doHistoryBack, this, r, t.context)) : this._doHistoryBack(r, t.context),
        l.then(i.bind(this.dispatchEvent, this, this.constructor.EVT_HISTORY_BACK, r))
      },
      setBackKeys: function (e) {
        this._backKeys = e
      },
      clear: function () {
        i.each(this._history, function (e) {
          this._clearCtrlNav(e.controller)
        }, this),
        i.clear(this._history)
      },
      getHistoryStack: function () {
        return i.clone(this._history)
      }
    }),
    _.singleton(),
    _
  }),
  define('app/core/History', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ax/mvc/AppRoot',
    'xdk-ax/mvc/ControllerManager',
    'xdk-history/HistoryManager'
  ], function (e, t, i, n, s) {
    'use strict';
    function r() {
      d = require('app/core/appRouter'),
      i.singleton().setDefaultKeyAction(this._backKeys, t.bind(function () {
        d.cancelCurrentNavigation(),
        this.back()
      }, this));
      var e = n.singleton();
      e.addEventListener(n.EVT_REPLACED, t.bind(function (e) {
        e.options.__doHistoryBack || this._push({
          front: e.exist,
          frontContext: e.exist.getContextTree(),
          controller: e.replacement,
          options: e.options
        })
      }, this)),
      e.addEventListener(n.EVT_OPENED, t.bind(function (e) {
        e.options.__doHistoryBack || e.options.appRootFirstController || this._push({
          front: null,
          controller: e.controller,
          options: e.options
        })
      }, this)),
      e.addEventListener(n.EVT_CLOSED, t.bind(function (e) {
        e.options.__doHistoryBack || this._push({
          front: e.controller,
          frontContext: e.controller.getContextTree(),
          controller: null,
          container: e.container,
          options: e.options
        })
      }, this))
    }
    function o(e) {
      return c.call(this, e).then(t.bind(d.setToLastDestination, d))
    }
    var a = null,
    d = null,
    c = null;
    return e.create({
      singleton: function () {
        return a || (a = s.singleton(), a.activate = r, c = a.back, a.back = o),
        a
      }
    }, {
    })
  }),
  define('app/core/videoPlaybackService/evt/VideoControlsStatusEvent', {
    DismissSelected: 'VideoControlsStatusEvent:DismissSelected',
    PlaySelected: 'VideoControlsStatusEvent:PlaySelected',
    PauseSelected: 'VideoControlsStatusEvent:PauseSelected',
    PlayheadMoved: 'VideoControlsStatusEvent:PlayheadMoved',
    NextPlaylistItemSelected: 'VideoControlsStatusEvent:NextPlaylistItemSelected',
    PreviousPlaylistItemSelected: 'VideoControlsStatusEvent:PreviousPlaylistItemSelected',
    RewindSelected: 'VideoControlsStatusEvent:RewindSelected',
    FastForwardSelected: 'VideoControlsStatusEvent:FastForwardSelected',
    QualityChanged: 'VideoControlsStatusEvent:QualityChanged'
  }),
  define('app/core/videoPlaybackService/evt/VideoPlaybackControlsEvent', {
    SetControlsInPlayState: 'VideoPlaybackControlsEvent:SetControlsInPlayState',
    SetControlsInPauseState: 'VideoPlaybackControlsEvent:SetControlsInPauseState',
    SetControlsInBufferingState: 'VideoPlaybackControlsEvent:SetControlsInBufferingState',
    UpdatePlayheadState: 'VideoPlaybackControlsEvent:UpdatePlayheadState',
    DismissControls: 'VideoPlaybackControlsEvent:DismissControls',
    NextPlaylistItem: 'VideoPlaybackControlsEvent:NextPlaylistItem',
    PreviousPlaylistItem: 'VideoPlaybackControlsEvent:PreviousPlaylistItem',
    NotifyError: 'VideoPlaybackControlsEvent:NotifyError',
    SuspendUI: 'VideoPlaybackControlsEvent:SuspendUI'
  }),
  define('app/core/videoPlaybackService/model/VideoItem', [
    'xdk-base/class'
  ], function (e) {
    'use strict';
    return e.create({
    }, {
      id: null,
      url: null,
      urls: null,
      metadata: {
      },
      drmAttributes: {
      },
      init: function (e) {
        e = e || {
        },
        this.id = e.id || null,
        this.url = e.url || null,
        this.urls = e.urls || null,
        this.metadata = e.metadata || {
        },
        this.drmAttributes = e.drmAttributes || null
      }
    })
  }),
  define('app/core/videoPlaybackService/model/Playlist', [
    'xdk-base/class'
  ], function (e) {
    return e.create({
    }, {
      items: [
      ],
      currentItemIdx: 0,
      currentPlaybackInfo: null,
      metadata: {
      },
      init: function (e) {
        e = e || {
        },
        this.items = e.items || [
        ],
        this.currentItemIdx = e.currentItemIdx || 0,
        this.metadata = e.metadata || {
        }
      }
    })
  }),
  define('app/core/videoPlaybackService/VideoManager', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ax/mediator',
    'app/core/videoPlaybackService/evt/VideoPlaybackControlsEvent',
    'app/core/videoPlaybackService/model/Playlist',
    'vdk/errors/VIAError',
    'app/core/videoPlaybackService/evt/VideoControlsStatusEvent',
    'app/service/ServiceHolder',
    'xdk-base/console',
    'app/core/videoPlaybackService/model/VideoItem',
    'xdk-base/device/Media'
  ], function (e, t, i, n, s, r, o, a, d, c, l) {
    'use strict';
    return e.create({
      STATUS: {
        PLAYING: 'PLAYING',
        PAUSED: 'PAUSED',
        STOPPED: 'STOPPED',
        BUFFERING: 'BUFFERING'
      }
    }, {
      init: function () {
        this._sMedia = l.singleton(),
        this._registerPlaybackEventHandlers(),
        this._registerPlaybackControlsStatusEventHandlers()
      },
      setPlaylist: function (e) {
        this._playlist = e,
        this._playlist.currentItemIdx = - 1
      },
      getPlaylist: function () {
        return this._playlist
      },
      clearPlaylist: function () {
        this._playlist && (this._playlist.items = [
        ], this._playlist.currentItemIdx = - 1)
      },
      playVideoItem: function (e, i) {
        var s,
        o = {
        };
        if (this._playlist) {
          if ((s = t.indexOf(this._playlist.items, e)) < 0) throw new r(r.FACILITY.PLAYBACK_SERVICE, r.ERROR.INVALID, 'There is a playlist, but the item is not in playlist');
          this._playlist.currentItemIdx = s
        }
        t.isNumber(i) ? o.pos = i : o.pos = 0,
        t.extend(o, this._packEventInfo(e)),
        this._play(e, i),
        this.__dispatchEvent(n.SetControlsInPlayState, o)
      },
      nextItem: function () {
        var e;
        this._playNextPlaylistItem() && (e = this._packEventInfo(this._currentItem), this.__dispatchEvent(n.NextPlaylistItem, e))
      },
      prevItem: function () {
        var e;
        this._playPrevPlaylistItem() && (e = this._packEventInfo(this._currentItem), this.__dispatchEvent(n.PreviousPlaylistItem, e))
      },
      pause: function () {
        this._sMedia.pause(),
        this.__dispatchEvent(n.SetControlsInPauseState, {
        })
      },
      playResume: function () {
        if (this._playlist) {
          if (0 === this._playlist.items.length) throw new r(r.FACILITY.PLAYBACK_SERVICE, r.ERROR.INVALID, 'The playlist is empty');
          if (this._playlist.currentItemIdx < 0) throw new r(r.FACILITY.PLAYBACK_SERVICE, r.ERROR.INVALID, 'No playing item in the playlist')
        }
        var e = this._packEventInfo(this._currentItem);
        this._sMedia.resume(),
        this.__dispatchEvent(n.SetControlsInPlayState, e)
      },
      fastForward: function () {
        this.__dispatchEvent(n.UpdatePlayheadState, {
          pos: this._currentPlaybackTime + 10
        }),
        this._sMedia.skip({
          sec: 10,
          progressive: !0,
          delaySec: 0.5
        })
      },
      rewind: function () {
        var e = this._currentPlaybackTime - 10;
        e = e > 0 ? e : 0,
        this.__dispatchEvent(n.UpdatePlayheadState, {
          pos: e
        }),
        this._sMedia.skip({
          sec: - 10,
          progressive: !0,
          delaySec: 0.5
        })
      },
      seek: function (e) {
        this._seek(e),
        this.__dispatchEvent(n.UpdatePlayheadState, {
          pos: e
        })
      },
      dismiss: function () {
        this._sMedia.stop(),
        this.__dispatchEvent(n.DismissControls, {
        })
      },
      __dispatchEvent: function (e, t) {
        i.publish(e, t)
      },
      _registerPlaybackEventHandlers: function () {
        this.__bindedPlaybackFinished = t.bind(this._playbackFinished, this),
        this._sMedia.addEventListener(this._sMedia.EVT_FINISHED, this.__bindedPlaybackFinished),
        this.__bindedTimeUpdated = t.bind(this._timeUpdated, this),
        this._sMedia.addEventListener(this._sMedia.EVT_TIME_UPDATE, this.__bindedTimeUpdated),
        this.__bindedPlaybackErrorOccurred = t.bind(this._playbackErrorOccurred, this),
        this._sMedia.addEventListener(this._sMedia.EVT_ERROR, this.__bindedPlaybackErrorOccurred),
        this.__bindedPlaybackStateChanged = t.bind(this._playbackStateChanged, this),
        this._sMedia.addEventListener(this._sMedia.EVT_STATE_CHANGED, this.__bindedPlaybackStateChanged)
      },
      _registerPlaybackControlsStatusEventHandlers: function () {
        this.__bindedDismissSelected = t.bind(this._dismissSelected, this),
        i.subscribe(o.DismissSelected, this.__bindedDismissSelected),
        this.__bindedPlaySelected = t.bind(this._playSelected, this),
        i.subscribe(o.PlaySelected, this.__bindedPlaySelected),
        this.__bindedPauseSelected = t.bind(this._pauseSelected, this),
        i.subscribe(o.PauseSelected, this.__bindedPauseSelected),
        this.__bindedRewindSelected = t.bind(this._rewindSelected, this),
        i.subscribe(o.RewindSelected, this.__bindedRewindSelected),
        this.__bindedFastForwardSelected = t.bind(this._fastForwardSelected, this),
        i.subscribe(o.FastForwardSelected, this.__bindedFastForwardSelected),
        this.__bindedPlayheadMoved = t.bind(this._playheadMoved, this),
        i.subscribe(o.PlayheadMoved, this.__bindedPlayheadMoved),
        this.__bindedNextPlaylistItemSelected = t.bind(this._nextPlaylistItemSelected, this),
        i.subscribe(o.NextPlaylistItemSelected, this.__bindedNextPlaylistItemSelected),
        this.__bindedPreviousPlaylistItemSelected = t.bind(this._previousPlaylistItemSelected, this),
        i.subscribe(o.PreviousPlaylistItemSelected, this.__bindedPreviousPlaylistItemSelected),
        this.__bindedQualityChanged = t.bind(this._qualityChanged, this),
        i.subscribe(o.QualityChanged, this.__bindedQualityChanged)
      },
      _playbackFinished: function () {
        this.__dispatchEvent(n.DismissControls, {
        })
      },
      _timeUpdated: function (e) {
        this._currentPlaybackTime = e,
        this._playbackDuration = this._sMedia.getDuration(),
        this.__dispatchEvent(n.UpdatePlayheadState, {
          pos: e,
          duration: this._playbackDuration
        })
      },
      _playbackErrorOccurred: function (e) {
        this.__dispatchEvent(n.NotifyError, {
          error: e
        })
      },
      _playbackStateChanged: function (e) {
        switch (e.toState) {
          case this._sMedia.PLAYING:
            this._currentPlaybackState = this.constructor.STATUS.PLAYING,
            this.__dispatchEvent(n.SetControlsInPlayState),
            this.__wasPausedBeforeQualityChanged && (this.pause(), this.__wasPausedBeforeQualityChanged = !1);
            break;
          case this._sMedia.PAUSED:
            this._currentPlaybackState = this.constructor.STATUS.PAUSED,
            this.__dispatchEvent(n.SetControlsInPauseState);
            break;
          case this._sMedia.STOPPED:
            this._currentPlaybackState = this.constructor.STATUS.STOPPED;
            break;
          case this._sMedia.BUFFERING:
            this._currentPlaybackState = this.constructor.STATUS.BUFFERING,
            this.__dispatchEvent(n.SetControlsInBufferingState);
            break;
          default:
            return
        }
      },
      _playSelected: function () {
        this._sMedia.resume()
      },
      _pauseSelected: function () {
        this._sMedia.pause()
      },
      _rewindSelected: function () {
        this.rewind()
      },
      _fastForwardSelected: function () {
        this.fastForward()
      },
      _playheadMoved: function (e) {
        this._seek(e.pos)
      },
      _nextPlaylistItemSelected: function () {
        this._playNextPlaylistItem()
      },
      _previousPlaylistItemSelected: function () {
        this._playPrevPlaylistItem()
      },
      _qualityChanged: function (e) {
        this._currentItem.metadata.videoUrlIndex !== e && (this._currentItem.metadata.videoUrlIndex = e, this._sMedia.isState(this._sMedia.PAUSED) && (this.__wasPausedBeforeQualityChanged = !0), this._play(this._currentItem, this._currentPlaybackTime))
      },
      _dismissSelected: function () {
        this._sMedia.stop()
      },
      _play: function (e, i) {
        var n,
        s = t.extend({
        }, e.metadata);
        s = t.extend(s, e.drmAttributes),
        s.forceReload = !0,
        this._currentItem = e,
        this._currentPlaybackTime = i || 0,
        this._playbackDuration = e.metadata.duration || 0,
        this._currentItem.url ? this._sMedia.load(this._currentItem.url, s) : (this._currentItem.metadata = this._currentItem.metadata || {
        }, n = this._currentItem.metadata.videoUrlIndex || 0, this._sMedia.load(this._currentItem.urls[n].url, s)),
        this._sMedia.setFullscreen(),
        this._sMedia.play(i)
      },
      _seek: function (e) {
        this._sMedia.seek(e)
      },
      _playNextPlaylistItem: function () {
        if (!this._playlist) throw new r(r.FACILITY.PLAYBACK_SERVICE, r.ERROR.INVALID, 'Playlist is not set');
        var e = this._playlist.items.length;
        if (e < 1) throw new r(r.FACILITY.PLAYBACK_SERVICE, r.ERROR.INVALID, 'Playlist is empty');
        return !(this._playlist.currentItemIdx >= e - 1) && (this._playlist.currentItemIdx++, this._currentItem = this._playlist.items[this._playlist.currentItemIdx], this._play(this._currentItem), !0)
      },
      _playPrevPlaylistItem: function () {
        if (!this._playlist) throw new r(r.FACILITY.PLAYBACK_SERVICE, r.ERROR.INVALID, 'Playlist is not set');
        var e,
        t = this._playlist.items.length - 1;
        if (t < 0) throw new r(r.FACILITY.PLAYBACK_SERVICE, r.ERROR.INVALID, 'Playlist is empty');
        return !(this._playlist.currentItemIdx <= 0) && (this._playlist.currentItemIdx--, e = this._playlist.items[this._playlist.currentItemIdx], this._play(e), !0)
      },
      _packEventInfo: function (e) {
        var t = {
          id: e.id,
          url: e.url,
          urls: e.urls,
          metadata: e.metadata
        };
        return e.drmAttributes && (t.drmAttributes = e.drmAttributes),
        t
      },
      _unregisterPlaybackEventHandlers: function () {
        this._sMedia.removeEventListener(this._sMedia.EVT_FINISHED, this.__bindedPlaybackFinished),
        this._sMedia.removeEventListener(this._sMedia.EVT_TIME_UPDATE, this.__bindedTimeUpdated),
        this._sMedia.removeEventListener(this._sMedia.EVT_ERROR, this.__bindedPlaybackErrorOccurred),
        this._sMedia.removeEventListener(this._sMedia.EVT_STATE_CHANGED, this.__bindedPlaybackStateChanged)
      },
      _unregisterPlaybackControlsStatusEventHandlers: function () {
        i.unsubscribe(o.DismissSelected, this.__bindedDismissSelected),
        i.unsubscribe(o.PlaySelected, this.__bindedPlaySelected),
        i.unsubscribe(o.PauseSelected, this.__bindedPauseSelected),
        i.unsubscribe(o.RewindSelected, this.__bindedRewindSelected),
        i.unsubscribe(o.FastForwardSelected, this.__bindedFastForwardSelected),
        i.unsubscribe(o.PlayheadMoved, this.__bindedPlayheadMoved),
        i.unsubscribe(o.NextPlaylistItemSelected, this.__bindedNextPlaylistItemSelected),
        i.unsubscribe(o.PreviousPlaylistItemSelected, this.__bindedPreviousPlaylistItemSelected),
        i.unsubscribe(o.QualityChanged, this.__bindedQualityChanged)
      },
      deinit: function () {
        this._unregisterPlaybackEventHandlers(),
        this._unregisterPlaybackControlsStatusEventHandlers()
      }
    })
  }),
  define('app/mgr/VideoManager', [
    'xdk-base/class',
    'xdk-base/device/Media',
    'app/core/videoPlaybackService/VideoManager'
  ], function (e, t, i) {
    return e.create(i, {
      PLAYBACK_FINISHED: 'videoManager:playback-finished'
    }, {
      init: function () {
        this._sMedia = t.singleton(),
        this._registerPlaybackControlsStatusEventHandlers()
      },
      addMediaEvents: function () {
        this._registerPlaybackEventHandlers()
      },
      clearMediaEvents: function () {
        this._unregisterPlaybackEventHandlers()
      },
      getMedia: function () {
        return this._sMedia
      },
      _playbackFinished: function () {
        this.__dispatchEvent(this.constructor.PLAYBACK_FINISHED)
      }
    })
  }),
  define('app/mgr/AnalyticsManager', [
    'xdk-base/class',
    'xdk-base/console',
    'app/mgr/SegmentTrackingManager'
  ], function (e, t, i) {
    'use strict';
    var n,
    s,
    r = i.singleton();
    return n = e.create({
      singleton: function () {
        return s || (s = new n),
        s
      }
    }, {
      trackMediaBegin: function (e) {
        r.trackPlayer(i.MEDIA_BEGIN, e)
      },
      trackVideoPlay: function (e) {
        r.trackPlayer(i.VIDEO_PLAY, e)
      },
      trackVideoStop: function (e) {
        r.trackPlayer(i.VIDEO_STOP, e)
      },
      trackVideoPause: function () {
        t.info('pause')
      },
      trackVideoError: function (e) {
        r.trackPlayer(i.VIDEO_PLAY_ERROR, e)
      },
      trackAdPodStart: function (e) {
        r.trackPlayer(i.AD_POD_START, e)
      },
      trackAdPodEnd: function (e) {
        r.trackPlayer(i.AD_POD_END, e)
      },
      trackAdStart: function (e) {
        r.trackPlayer(i.AD_START, e)
      },
      trackVideoTimeUpdate: function (e) {
        r.logFooter({
          videoId: e.videoId,
          duration: Math.round(e.duration),
          position: Math.round(e.position),
          percentage: Math.round(e.position / e.duration * 100) + '%'
        })
      },
      trackLogin: function (e, t) {
        r.trackLogin(i.PRELOGIN_LOGIN_SUCCESS, t, e)
      },
      trackFacebookFailLogin: function (e, t) {
        r.trackLogin(i.PRELOGIN_FACEBOOK_FAIL, t, e)
      },
      trackFiveMinInterval: function (e) {
        r.trackPlayer(i.FIVE_MIN_INTERVAL, e)
      }
    })
  }),
  define('app/model/ShowModel', [
    'xdk-base/class',
    'xdk-ax/mvc/Model',
    'xdk-base/util',
    'app/helper/helpers'
  ], function (e, t, i, n) {
    'use strict';
    return e.create(t, {
      defaults: {
        id: '',
        extId: '',
        channel: '',
        name: '',
        showTitle: '',
        overlayTitle: '',
        synopsis: '',
        images: {
          dashboardHero: '',
          showHero: '',
          showHeroSecondary: '',
          showTile: '',
          showImage: ''
        },
        genres: [
        ],
        isResume: !1,
        callToAction: null,
        duration: 0,
        currentPosition: 0,
        availableDate: '',
        expiryDate: '',
        index: 0,
        videoId: '',
        isVideo: !1,
        isMovie: !1,
        playbackUrl: '',
        videoAdKeys: null,
        brightcoveId: '',
        type: null,
        vodClassification: '',
        classificationWarnings: '',
        isLastWatched: !1
      }
    }, {
      init: function (e) {
        this._super(this._getAttrs(e))
      },
      _getAttrs: function (e) {
        e = e || {
        };
        var t = e.images || {
        },
        s = n.getProperty(e, [
          'videoRenditions',
          'videoCloud'
        ], {
        }),
        r = n.getProperty(e, [
          'videoRenditions',
          'once'
        ], {
        }),
        o = i.isArray(e.genres) ? e.genres : [
        ];
        return {
          id: e.showId,
          extId: e.extId,
          brightcoveId: s.brightcoveId || '',
          channel: e.channel || '',
          name: e.name || '',
          showTitle: e.showTitle || '',
          overlayTitle: e.overlayTitle || '',
          synopsis: e.synopsis || '',
          images: {
            dashboardHero: t.dashboardHero || '',
            showHero: t.showHero || '',
            showHeroSecondary: t.showHeroSecondary || '',
            showTile: t.showTile || '',
            showImage: t.showImage || t.videoTile || ''
          },
          genres: o,
          isResume: e.isResume,
          callToAction: e.callToAction,
          duration: e.duration || 0,
          availableDate: e.availableDate,
          expiryDate: e.expiryDate,
          currentPosition: e.currentPosition || 0,
          index: e.index || 0,
          videoId: e.videoId || '',
          isVideo: !!e.videoId,
          isMovie: !!e.videoId && n.isMovie(o),
          playbackUrl: r.url || '',
          videoAdKeys: s.videoAdKeys,
          type: e.type,
          vodClassification: e.vodClassification,
          classificationWarnings: e.classificationWarnings,
          isLastWatched: e.isLastWatched || !1
        }
      }
    })
  }),
  define('app/service/MwApiService', [
    'xdk-base/class',
    'xdk-base/config',
    'xdk-base/console',
    'xdk-base/device',
    'xdk-base/promise',
    'xdk-base/util',
    'app/helper/ApiUtils'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a,
    d;
    return a = e.create({
      singleton: function () {
        return d || (d = new a),
        d
      },
      API_ORIGIN: t.get('remote').mediaworks,
      ENDPOINTS: {
        dashboard: 'dashboard',
        shows: 'shows',
        show: 'show',
        watching: 'user/history/watching',
        history: 'user/history',
        help: 'content/help',
        kb: 'content/kb',
        advertising: 'user/advertising'
      }
    }, {
      init: function () {
        this._deviceId = ''
      },
      getDashboard: function () {
        return o.request({
          method: 'get',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.dashboard
        }).fail(function (e) {
          i.error(e)
        })
      },
      getAdvertising: function () {
        return o.request({
          method: 'get',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.advertising
        }).fail(function (e) {
          i.error(e)
        })
      },
      getShows: function () {
        return o.request({
          method: 'get',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.shows
        }).fail(function (e) {
          i.error(e)
        })
      },
      getShow: function (e) {
        var t = {
          format: 'seasons'
        };
        return o.request({
          method: 'get',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.show + '/' + e,
          requestHeaders: t
        }).fail(function (e) {
          i.error(e)
        })
      },
      getPlaybackUrl: function (e) {
        return o.request({
          method: 'get',
          url: e.get('playbackUrl')
        }).fail(function (e) {
          i.error(e)
        })
        },
        getBrightCove: function (e) {
            var t = {
                Accept: 'application/json;pk=BCpkADawqM2-Pw-g3-psbmh7mEsKhBVp1QRsKxK5tBOpF72ud6VrAndDsRbs2jlmlgSRJiPdNjJOJESytpUUmyb-Muz41HVYcPcoEdG2E8xmHgcwy7frHjTwbJqTXo2Sxmhjgw2Nynprcv7c'
            };
            console.log(e.get('brightcoveId'));
            return o.request({
                method: 'get',
                url: 'https://edge.api.brightcove.com/playback/v1/accounts/3812193411001/videos/' + e.get('brightcoveId'),
                requestHeaders: t
            }).fail(function (e) {
                i.error(e)
            })
        },
      getWatchingList: function () {
        return o.request({
          method: 'get',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.watching
        }).fail(function (e) {
          i.error(e)
        })
      },
      getHistory: function () {
        return o.request({
          method: 'get',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.history
        }).fail(function (e) {
          i.error(e)
        })
      },
      setHistory: function (e) {
        var t = {
          deviceId: this._getDeviceId()
        };
        return o.request({
          method: 'post',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.history,
          postBody: r.stringify([e]),
          requestHeaders: t
        }).fail(function (e) {
          i.error(e)
        })
      },
      getHelpContent: function () {
        return o.request({
          method: 'get',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.help
        }).fail(function (e) {
          i.error(e)
        })
      },
      getKbErrors: function () {
        return o.request({
          method: 'get',
          url: this.constructor.API_ORIGIN + this.constructor.ENDPOINTS.kb
        }).fail(function (e) {
          i.error(e)
        })
      },
      _getDeviceId: function () {
        return this._deviceId || (this._deviceId = n.id.getUniqueID()),
        this._deviceId
      }
    })
  }),
  define('app/template/fullscreenPlayer/FullscreenPlayerModel', [
    'xdk-base/class',
    'xdk-ax/mvc/Model'
  ], function (e, t) {
    'use strict';
    var i = new t({
      showTitle: '',
      name: ''
    });
    return e.create(t, {
      defaults: {
        show: i
      }
    }, {
      _parseAttrs: function (e, t) {
        return 'show' === e ? this._parseShow(t) : t
      },
      _parseShow: function (e) {
        return i.set('showTitle', e.get('showTitle')),
        i.set('name', e.get('name')),
        i
      },
      set: function (e, t) {
        this._super(e, this._parseAttrs(e, t))
      },
      init: function () {
        this._super(this.constructor.defaults)
      }
    })
  }),
  define('xdk-ui-basic/interface/Scrollable', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('Scrollable', {
      registerMediator: [
        'mediator'
      ],
      unregisterMediator: [
        'mediator'
      ],
      unregisterAllMediator: [
      ]
    })
  }),
  define('xdk-ui-basic/AbstractScrollable', [
    'xdk-ui-basic/interface/Scrollable',
    'xdk-base/class',
    'xdk-ax/Container',
    'xdk-ax/evt/type',
    'xdk-base/console',
    'xdk-base/util',
    'xdk-base/core'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    return t.createAbstract(i, [
      e
    ], {
    }, {
      __mediator: [
      ],
      registerMediator: function (e) {
        if (!e.setScrollable) throw o.createException('IncorrectParam', 'Incorrect mediator implementation or not a proper mediator!');
        e.setScrollable(this)
      },
      unregisterMediator: function (e) {
        if (!e.setScrollable) throw o.createException('IncorrectParam', 'Incorrect mediator implementation or not a proper mediator!');
        var t = r.indexOf(this.__mediator, e);
        t > - 1 && (this.__mediator.splice(t, 1), e.unsetScrollable(this))
      },
      unregisterAllMediator: function () {
        r.each(this.__mediator, r.bind(function (e) {
          this.unregisterMediator(e)
        }, this))
      },
      dispatchScrolledInfo: function (e, t, i) {
        var r = {
          start: e || 0,
          length: t || 1,
          total: i || 1
        };
        s.info(r),
        this.dispatchEvent(n.SCROLLED_INDICATOR, r)
      },
      dispatchScrolledUpdate: function (e) {
        this.dispatchEvent(n.SCROLLED_PERCENTAGE, e)
      },
      update: function (e, t) {
        s.warn('update is not implemented in Scrollable Object')
      }
    })
  }),
  define('xdk-ui-grid/gridStgy', [
    'xdk-base/console',
    'xdk-ax/Component',
    'xdk-ax/Container',
    'xdk-base/device/vKey',
    'xdk-base/util',
    'xdk-base/promise'
  ], function (e, t, i, n, s, r) {
    'use strict';
    var o = function (e, t) {
      return 0 === t ? NaN : (e % t + t) % t
    },
    a = {
    };
    return a.BASIC_PREREADY_STGY = function (e) {
      e.selectedDsIndex = 0,
      e.selectedGridRow = 0
    },
    a.BASIC_CHECK_SCROLLABLE_STGY = function (e, t) {
      var i = e.ds.getTotalCount();
      return !(t.firstSlotDsIndex < - e.cols || t.firstSlotDsIndex >= i + e.cols) && (t.selectedDsIndex >= i && (t.selectedDsIndex = i - 1, t.selectedGridCol = (i - 1) % e.cols), !0)
    },
    a.BASIC_CHECK_SELECTABLE_STGY = function (e, t) {
      var i,
      n,
      s = t.selectedDsIndex,
      r = e.ds.getTotalCount();
      return !(s < 0) && ( - 2 === r || (s < r || (i = Math.floor(s / e.cols), n = Math.floor((r - 1) / e.cols), i <= n && (t.selectedDsIndex = r - 1, t.selectedGridCol = o(r - 1, this._cols), !0))))
    },
    a.BASIC_DATA_MAPPING_STGY = function (e, t, i, n, s) {
      return s < 0 || s >= e.ds.getTotalCount() ? null : t[i * e.cols + n]
    },
    a.BASIC_SCROLL_ENTRANCE_STGY = function (e, n, s, r, o) {
      var a,
      d,
      c,
      l,
      u,
      h,
      _,
      f = o.gridComponents.slice(o.newRowsStart, o.newRowsStart + o.newRowsCount),
      p = o.newRowsCount,
      g = n.getChildren();
      if (g.length > 0) if (s > g.length || - s > g.length) for (a = 0; a < g.length && g[a]; a++) g[a].deinit();
       else if (s > 0) for (a = 0; a < s && g[a]; a++) g[a].deinit();
       else for (_ = g.length, a = _ + s; a < _ && g[a]; a++) g[a].deinit();
      for (g = n.getChildren(), a = 0; a < p; a++) {
        for (l = [
        ], d = 0; d < r.cols && (f[a] && f[a][d] && f[a][d].getRoot()); d++) l.push(f[a][d]);
        c = new i({
          css: e ? 'wgt-grid-row-v' : 'wgt-grid-row-h',
          children: l
        }),
        g.length > 0 && s < 0 && r.gridComponents && r.gridComponents[0] ? (u = t.PLACE_BEFORE, h = r.gridComponents[0][0].getParent()) : (u = t.PLACE_APPEND, h = null),
        n.attach(c, u, h)
      }
    },
    a.BASIC_SCROLL_SHIFT_STGY = function (t, i, n, s) {
      var o = 'grid shifting...... do nothing for basic grid.';
      return e.info(o),
      r.resolve(o)
    },
    a.BASIC_SCROLL_EXIT_STGY = function (t, i, n, s) {
      var o = 'grid exiting shift, remove items is already done in entrance function...... do nothing for basic grid.';
      return e.info(o),
      r.resolve(o)
    },
    a.BASIC_HORIZONTAL_KEY_NAVIGATION_STGY = function (e, t) {
      switch (e) {
        case n.UP.id:
          return {
            rowChange: - 1
          };
        case n.DOWN.id:
          return {
            rowChange: 1
          };
        case n.LEFT.id:
          return {
            colChange: - 1
          };
        case n.RIGHT.id:
          return {
            colChange: 1
          };
        default:
          return
      }
    },
    a.BASIC_VERTICAL_KEY_NAVIGATION_STGY = function (e, t) {
      switch (e) {
        case n.UP.id:
          return {
            colChange: - 1
          };
        case n.DOWN.id:
          return {
            colChange: 1
          };
        case n.LEFT.id:
          return {
            rowChange: - 1
          };
        case n.RIGHT.id:
          return {
            rowChange: 1
          };
        default:
          return
      }
    },
    a.BASIC_ONUPDATE_STGY = function (e, t, i) {
      if ('reset' === e.action) return !0;
      var n,
      s,
      r = i.getTotalCount(),
      a = e.index,
      d = a + e.length,
      c = t.firstSlotDsIndex,
      l = t.firstSlotDsIndex + t.rows * t.cols - 1;
      if (l < 0 && c >= - r && o(c, r) >= d) return !1;
      if (c > 0 && l < r && l < a) return !1;
      if ('fetch' === e.action && (d < c || a > l)) return !1;
      for (; r <= t.selectedDsIndex; ) t.selectedDsIndex--;
      return n = Math.floor((r - 1) / t.cols),
      s = Math.floor(r - c) / t.cols,
      'remove' === e.action && n >= t.rows - 1 && t.selectedGridRow < t.rows - 1 && s <= t.rows - 1 && (t.selectedDsIndex = t.selectedDsIndex - t.cols),
      t.selectedGridRow > n && n < t.rows && (t.selectedGridRow = n),
      !0
    },
    a.BASIC_DS_RANGE_CALCULATION_STGY = function (e, t, i) {
      var n = {
      },
      s = o(e, i.cols),
      r = i.ds.getTotalCount();
      return n.from = e - t * i.cols - s,
      n.to = n.from + i.rows * i.cols,
      - 1 === r ? (n.actualFrom = n.from, n.actualTo = n.to, n) : (n.actualFrom = o(n.from, r), n.actualTo = o(n.actualFrom + i.rows * i.cols, r), n)
    },
    a
  }),
  define('xdk-ui-grid/Grid', [
    'xdk-base/class',
    'xdk-ax/Container',
    'xdk-ui-basic/AbstractScrollable',
    'xdk-base/console',
    'xdk-ax/data/Datasource',
    'xdk-ax/evt/type',
    'xdk-base/device/vKey',
    'xdk-base/util',
    'xdk-base/core',
    'xdk-ax/focusManager',
    'xdk-base/promise',
    'xdk-ui-grid/gridStgy'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u) {
    'use strict';
    var h = function (e, t) {
      return 0 === t ? NaN : (e % t + t) % t
    },
    _ = function () {
      throw d.createException('IncorrectState', 'This Grid"s strategy has not been specified yet!')
    },
    f = function (e) {
      n.info(e)
    },
    p = function (e) {
      throw n.info(e),
      e
    },
    g = function (e) {
      return n.info(e),
      l.resolve(e)
    },
    v = function (e) {
      return n.info(e),
      l.reject(e)
    };
    return e.create(i, {
      VERTICAL: 1,
      HORIZONTAL: 2,
      SCROLL_BASE_ON_ITEM: 1,
      SCROLL_BASE_ON_ROW: 2,
      SCROLL_BASE_ON_PAGE: 3
    }, {
      _ready: !1,
      _cols: 5,
      _rows: 5,
      _scrollbarBehavior: 3,
      _selectedDsIndex: 0,
      _selectedGridRow: 0,
      _selectedGridCol: 0,
      _firstSlotDsIndex: 0,
      _lastSlotDsIndex: 0,
      _data: null,
      _ds: null,
      _gridComponents: null,
      _container: null,
      _prereadyStgy: _,
      _checkScrollableStgy: _,
      _checkSelectableStgy: _,
      _dataMappingStgy: _,
      _displayStgy: _,
      _scrollEntranceStgy: _,
      _scrollShiftStgy: _,
      _scrollExitStgy: _,
      _keyNavigationStgy: _,
      _onUpdateStgy: _,
      _dsRangeCalculationStgy: _,
      setPrereadyStgy: function (e) {
        this._prereadyStgy = e
      },
      setCheckScrollableStgy: function (e) {
        this._checkScrollableStgy = e
      },
      setCheckSelectableStgy: function (e) {
        this._checkSelectableStgy = e
      },
      setDataMappingStgy: function (e) {
        this._dataMappingStgy = e
      },
      setDisplayStgy: function (e) {
        this._displayStgy = e
      },
      setScrollEntranceStgy: function (e) {
        this._scrollEntranceStgy = e
      },
      setScrollShiftStgy: function (e) {
        this._scrollShiftStgy = e
      },
      setScrollExitStgy: function (e) {
        this._scrollExitStgy = e
      },
      setKeyNavigationStgy: function (e) {
        this._keyNavigationStgy = e
      },
      setOnUpdateStgy: function (e) {
        this._onUpdateStgy = e
      },
      setDsRangeCalculationStgy: function (e) {
        this._dsRangeCalculationStgy = e
      },
      init: function (e) {
        e = e || {
        },
        e.rows && (this._rows = e.rows),
        e.cols && (this._cols = e.cols),
        e.scrollbarBehavior && (this._scrollbarBehavior = e.scrollbarBehavior),
        this._super(e),
        this._root.addClass('wgt-grid'),
        this._container = new t({
          css: 'wgt-grid-scroll',
          parent: this
        }),
        this.addEventListener(r.KEY, this._keyHandler),
        this.addEventListener(r.FOCUS, a.bind(this._onFocusHandler, this)),
        this.setDsRangeCalculationStgy(u.BASIC_DS_RANGE_CALCULATION_STGY)
      },
      setDatasource: function (e) {
        if (!(e instanceof s)) return v('Cannot set an invalid datasource');
        if (this._ds === e) return v('Unable to set set the same datasource');
        this._ds && this.__datasourceListener && this._ds.removeEventListener(s.EVT_UPDATED, this.__datasourceListener),
        this.reset(),
        this._ready = !1,
        this._ds = e;
        var t,
        i;
        return i = {
          selectedDsIndex: this._selectedDsIndex,
          selectedGridRow: this._selectedGridRow,
          cols: this._cols,
          rows: this._rows,
          ds: e
        },
        this._prereadyStgy(i),
        this._selectedDsIndex = i.selectedDsIndex,
        this._selectedGridRow = i.selectedGridRow,
        t = this._dsRangeCalculationStgy(this._selectedDsIndex, this._selectedGridRow, i),
        this._selectedGridCol = h(this._selectedDsIndex, this._cols),
        this._firstSlotDsIndex = t.from,
        this.__datasourceListener || (this.__datasourceListener = a.bind(this._onDatasourceUpdated, this)),
        this._ds.addEventListener(s.EVT_UPDATED, this.__datasourceListener),
        this.__validateDs(t.actualFrom, t.actualTo).then(a.bind(this.select, this, this._selectedDsIndex, this._selectedGridRow))
      },
      getDatasource: function () {
        return this._ds
      },
      getDatasouce: function () {
        return this.getDatasource()
      },
      scroll: function (e, t) {
        if (!this._ready) return v('Grid is not ready yet');
        var i,
        n,
        s = e * this._cols,
        r = this._selectedGridRow - e,
        o = this._selectedDsIndex,
        a = this._firstSlotDsIndex + s,
        d = a + this._rows * this._cols - 1;
        if (r < 0 ? r = 0 : r >= this._rows && (r = this._rows - 1), o < a) do {
          o += this._cols
        } while (o < a);
         else if (o > d) do {
          o -= this._cols
        } while (o > d);
        return n = {
          selectedDsIndex: o,
          selectedGridRow: r,
          selectedGridCol: this._selectedGridCol,
          firstSlotDsIndex: a,
          lastSlotDsIndex: d
        },
        i = {
          selectedDsIndex: this._selectedDsIndex,
          selectedGridRow: this._selectedGridRow,
          selectedGridCol: this._selectedGridCol,
          firstSlotDsIndex: this._firstSlotDsIndex,
          lastSlotDsIndex: this._firstSlotDsIndex + this._rows * this._cols - 1,
          rows: this._rows,
          cols: this._cols,
          ds: this._ds
        },
        this._checkScrollableStgy(i, n) ? this.select(n.selectedDsIndex, n.selectedGridRow, t).fail(p) : v('Check scrollable strategy indicates scrolling bound has reached.')
      },
      select: function (e, t, i) {
        this._ready = !1,
        i = i || {
        };
        var s,
        o,
        d,
        l,
        u,
        _,
        f,
        p,
        g = {
          selectedDsIndex: this._selectedDsIndex,
          selectedGridRow: this._selectedGridRow,
          selectedGridCol: this._selectedGridCol,
          firstSlotDsIndex: this._firstSlotDsIndex,
          lastSlotDsIndex: this._firstSlotDsIndex + this._rows * this._cols - 1,
          data: this._data,
          gridComponents: this._gridComponents,
          ds: this._ds,
          rows: this._rows,
          cols: this._cols
        },
        m = this._dsRangeCalculationStgy(this._selectedDsIndex, this._selectedGridRow, g),
        E = {
          selectedDsIndex: e,
          selectedGridRow: t,
          selectedGridCol: h(e, this._cols),
          firstSlotDsIndex: - 1,
          lastSlotDsIndex: - 1,
          data: null,
          gridComponents: null
        },
        b = this,
        y = [
        ],
        k = this._ds.getTotalCount();
        if (a.isNumber(t) || (t = e >= m.from && e < m.to ? this._selectedGridRow : e < m.from ? 0 : this._rows - 1, E.selectedGridRow = t), d = this._dsRangeCalculationStgy(e, t, g), E.firstSlotDsIndex = d.from, E.lastSlotDsIndex = d.to - 1, s = this._checkSelectableStgy(g, E), i.forceRender && !s) n.info('Grid: forced render.');
         else if (!s) return this._ready = !0,
        v('Putting item at datasource index ' + e + ', to row ' + t + ', is not posible.');
        return o = (E.firstSlotDsIndex - g.firstSlotDsIndex) / this._cols,
        _ = function () {
          n.info('Grid: updating selection...');
          var e = E.gridComponents,
          t = E.selectedGridRow,
          i = E.selectedGridCol;
          try {
            g.gridComponents[g.selectedGridRow][g.selectedGridCol].removeClass('wgt-grid-selected')
          } catch (e) {
          }
          e[t][i].addClass('wgt-grid-selected'),
          b._ready = !0,
          c.isCompChildFocused(b) && c.focus(e[t][i]),
          s ? b.setOption('forwardFocus', e[t][i]) : b.setOption('forwardFocus', void 0),
          b.dispatchEvent(r.SELECTION_CHANGED, E)
        },
        l = d.actualFrom,
        u = d.actualTo,
        p = a.wrap(v, function (e, t) {
          return b._ready = !0,
          n.info('fail to selection changed'),
          b.dispatchEvent(r.SELECTION_CHANGED, E),
          e(t)
        }),
        f = function (e) {
          return y = y.concat(e),
          E.data = y,
          b._scroll(y, o, g, E, i)
        },
        l >= u || this._rows * this._cols > k ? this._ds.getRange(l, k).then(function (e) {
          if (0 === l) return e;
          if (g.rows * g.cols > k) u = l;
           else if (0 === u) return e;
          return y = y.concat(e),
          b._ds.getRange(0, u)
        }).then(f).then(_).fail(p) : this._ds.getRange(l, u).then(f).then(_).fail(p)
      },
      _scroll: function (e, t, i, n, s) {
        var r,
        o,
        a,
        d,
        c,
        u = Math.min(Math.abs(t), this._rows),
        _ = t > 0 ? this._rows - u : 0,
        f = this._ds.getTotalCount(),
        p = !i.gridComponents,
        v = [
        ],
        m = i.gridComponents,
        E = this,
        b = h(n.selectedDsIndex, f);
        for (c = function () {
          E._selectedDsIndex = n.selectedDsIndex,
          E._selectedGridRow = n.selectedGridRow,
          E._selectedGridCol = n.selectedGridCol,
          E._firstSlotDsIndex = n.firstSlotDsIndex,
          E._lastSlotDsIndex = n.lastSlotDsIndex,
          E._data = n.data,
          E._gridComponents = n.gridComponents
        }, p && (u = this._rows, _ = 0, m = [
        ]), r = _; r < _ + u; r++) for (o = 0; o < this._cols; o++) (d = this._dataMappingStgy(i, e, r, o, n.firstSlotDsIndex + r * this._cols + o)) && (a = this._displayStgy(d), a.getRoot().addClass('wgt-grid-item'), v[r - _] = v[r - _] || [
        ], v[r - _].push(a));
        switch (m = 0 === _ ? v.concat(m).slice(0, this._rows) : m.concat(v).slice(u, this._rows + u), n.newRowsStart = _, n.newRowsCount = u, n.gridComponents = m, this._scrollbarBehavior) {
          case this.constructor.SCROLL_BASE_ON_ITEM:
            this.dispatchScrolledInfo(b, 1, f);
            break;
          case this.constructor.SCROLL_BASE_ON_ROW:
            this.dispatchScrolledInfo(b - h(b, this._cols), this._cols, f);
            break;
          case this.constructor.SCROLL_BASE_ON_PAGE:
            this.dispatchScrolledInfo(h(n.firstSlotDsIndex, f), this._cols * this._rows, f)
        }
        return p || 0 !== t ? l.when(this._scrollEntranceStgy(this._container, t, i, n), function () {
          return p ? (c(), g('Currently initializing grid, no shift animation will be performed.')) : !0 === s.noAnimation ? l.when(E._scrollExitStgy(E._container, t, i, n), function () {
            return c(),
            g('Animation is turned off, no shift animation will be performed.')
          }) : E._scrollShiftStgy(E._container, t, i, n).then(function () {
            return E._scrollExitStgy(E._container, t, i, n),
            c(),
            !0
          })
        }) : (c(), g('No scroll needed.'))
      },
      reset: function () {
        this._gridComponents = null,
        a.each(this._container.getChildren(), function (e) {
          e.detach()
        }),
        this.setOption('forwardFocus', void 0),
        this._selectedDsIndex = 0,
        this._selectedGridRow = 0,
        this._selectedGridCol = 0,
        this._firstSlotDsIndex = 0,
        this._lastSlotDsIndex = 0,
        this._data = null
      },
      isReady: function () {
        return this._ready
      },
      _keyHandler: function (e) {
        if (!this._ready) return !1;
        var t,
        i,
        n,
        s,
        r,
        d,
        u,
        h,
        _,
        p,
        g,
        v,
        m,
        E = e.id;
        switch (E) {
          case o.UP.id:
          case o.DOWN.id:
          case o.LEFT.id:
          case o.RIGHT.id:
            t = c.directionalFocusChangeByKey(e, this);
            break;
          default:
            return !0
        }
        if (t) return !1;
        for (i = c.getCurFocus(), s = i, n = s.getParent(); n && n !== this && !s.getRoot().hasClass('wgt-grid-item'); ) s = n,
        n = s.getParent();
        return !n || n === this || (p = {
          selectedDsIndex: this._selectedDsIndex,
          selectedGridRow: this._selectedGridRow,
          selectedGridCol: this._selectedGridCol,
          firstSlotDsIndex: this._firstSlotDsIndex,
          lastSlotDsIndex: this._firstSlotDsIndex + this._rows * this._cols - 1,
          data: this._data,
          gridComponents: this._gridComponents,
          ds: this._ds,
          rows: this._rows,
          cols: this._cols
        }, _ = this._keyNavigationStgy(e.id, p), _ = a.extend({
          rowChange: 0,
          colChange: 0,
          scroll: 0,
          forceRender: !1
        }, _), d = this._selectedGridRow + _.rowChange, r = this._selectedGridCol + _.colChange, h = _.scroll, v = this._rows, m = h < 0 ? this._cols : this._gridComponents[this._selectedGridRow].length < this._cols ? this._gridComponents[this._selectedGridRow].length : this._cols, d < 0 ? (d = 0, h += d) : d >= v && (h += d - (v - 1), d = v - 1), r < 0 ? r = 0 : r >= m && (r = m - 1), u = this._selectedDsIndex + _.rowChange * this._cols + _.scroll * this._cols + (r - this._selectedGridCol), this._selectedDsIndex === u && this._selectedGridRow === d && this._selectedGridCol === r || (g = this.select(u, d, {
          forceRender: _.forceRender
        }), g.fail(f).done(), l.isRejected(g)))
      },
      _onFocusHandler: function (e) {
        if (this._ready) {
          var t,
          i,
          n,
          s,
          o,
          a = 0,
          d = 0;
          if (e.target === this) return void c.focus(this._gridComponents[this._selectedGridRow][this._selectedGridCol]);
          for (t = this._gridComponents.length, a = 0; a < t && this._gridComponents[a]; a++) for (n = this._gridComponents[a], i = n.length, d = 0; d < i && n[d]; d++) if (s = this._gridComponents[a][d], c.isCompFocused(s) || c.isCompChildFocused(s)) {
            if (this._gridComponents[this._selectedGridRow][this._selectedGridCol].removeClass('wgt-grid-selected'), s.addClass('wgt-grid-selected'), o = this._firstSlotDsIndex + a * this._cols + d, a === this._selectedGridRow && d === this._selectedGridCol && this._selectedDsIndex === o) return;
            return this._selectedGridRow = a,
            this._selectedGridCol = d,
            this._selectedDsIndex = o,
            this.setOption('forwardFocus', s),
            void this.dispatchEvent(r.SELECTION_CHANGED, {
              selectedDsIndex: this._selectedDsIndex,
              selectedGridRow: this._selectedGridRow,
              selectedGridCol: this._selectedGridCol,
              firstSlotDsIndex: this._firstSlotDsIndex,
              lastSlotDsIndex: this._lastSlotDsIndex,
              data: this._data,
              gridComponents: this._gridComponents
            })
          }
        }
      },
      _onDatasourceUpdated: function (e) {
        if (n.info('Grid: datasource updated!'), !this._ready) return void n.info('Grid: not yet ready to react to datasource update!');
        var t,
        i,
        s,
        r,
        o,
        d = !0;
        t = {
          selectedDsIndex: this._selectedDsIndex,
          selectedGridRow: this._selectedGridRow,
          selectedGridCol: this._selectedGridCol,
          firstSlotDsIndex: this._firstSlotDsIndex,
          cols: this._cols,
          rows: this._rows,
          ds: this._ds
        },
        (i = this._onUpdateStgy(e, t, this._ds)) && (s = t.selectedDsIndex, r = t.selectedGridRow, o = this._dsRangeCalculationStgy(s, r, t), this.reset(), 'reset' === e.action && (d = !1), this.__validateDs(o.actualFrom, o.actualTo).then(a.bind(this.select, this, s, r, {
          forceRender: d
        })).fail(function () {
          n.info('fail to update grid')
        }).done())
      },
      __validateDs: function (e, t) {
        return - 1 === this._ds.getTotalCount() ? this._ds.getRange(e, t).then(a.bind(function () {
          if ( - 1 === this._ds.getTotalCount()) return v('Unable to initialize the datasource, totalCount still equals -1')
        }, this)) : (0 === this._ds.getTotalCount() && n.warn('tried to set an datasource 0 total count, grid can will only be updated if it\'s notified by EVT_UPDATED from datasource with new total count'), l.resolve())
      },
      getSelectedDsIndex: function () {
        var e;
        return this._ds && (e = this._ds.getTotalCount()) > 0 ? h(this._selectedDsIndex, e) : - 1
      },
      getSelectedComp: function () {
        return this._gridComponents[this._selectedGridRow][this._selectedGridCol]
      },
      getSelectedData: function () {
        var e = this.getDatasource(),
        t = this.getSelectedDsIndex();
        return e && e.getFetchedData && t > - 1 ? e.getFetchedData(t) : null
      },
      getSelectedPosition: function () {
        return {
          row: this._selectedGridRow,
          col: this._selectedGridCol
        }
      },
      getCompByCoor: function (e, t) {
        if (!(e < 0 || t < 0 || e >= this._gridComponents.length || t >= this._gridComponents[e].length)) return this._gridComponents[e][t]
      }
    })
  }),
  define('xdk-ui-grid/boundedGridStgy', [
    'xdk-base/device/vKey',
    'xdk-ui-grid/gridStgy'
  ], function (e, t) {
    'use strict';
    var i = function (e, t) {
      return (e % t + t) % t
    },
    n = {
    };
    return n.SCROLL_BOUNDARY_CHECK_SELECTABLE_STGY = function (e, t, n, s) {
      var r,
      o,
      a = s.selectedDsIndex,
      d = s.selectedGridRow,
      c = n.ds.getTotalCount();
      return !(a < 0) && (r = Math.floor(a / n.cols), o = Math.floor((c - 1) / n.cols), !((d < e || d >= n.rows - t) && r > e && r < o - t) && (a < c || r <= o && (s.selectedDsIndex = c - 1, s.selectedGridCol = i(c - 1, this._cols), !0)))
    },
    n.SCROLL_BOUNDARY_KEY_NAVIGATION_STGY = function (t, i, n, s, r) {
      var o,
      a,
      d,
      c,
      l = r.selectedDsIndex,
      u = r.ds.getTotalCount(),
      h = r.selectedGridRow;
      if (t) switch (s) {
        case e.UP.id:
          return {
            colChange: - 1
          };
        case e.DOWN.id:
          return {
            colChange: 1
          };
        case e.LEFT.id:
          o = - 1;
          break;
        case e.RIGHT.id:
          o = 1
      } else switch (s) {
        case e.UP.id:
          o = - 1;
          break;
        case e.DOWN.id:
          o = 1;
          break;
        case e.LEFT.id:
          return {
            colChange: - 1
          };
        case e.RIGHT.id:
          return {
            colChange: 1
          }
      }
      return i <= 0 && n <= 0 ? {
        rowChange: o
      }
       : (a = h + o, c = Math.floor(l / r.cols) + o, d = Math.floor((u - 1) / r.cols), a < i || a >= r.rows - n ? c < i || c > d - n ? {
        rowChange: o
      }
       : {
        scroll: o
      }
       : {
        rowChange: o
      })
    },
    n.ONUPDATE_STGY = function (e, i, n, s, r) {
      var o = t.BASIC_ONUPDATE_STGY(n, s, r),
      a = r.getTotalCount(),
      d = s.firstSlotDsIndex;
      if (s.firstSlotDsIndex + s.rows * s.cols - 1 < a - 1) {
        var c = s.selectedGridRow - (s.rows - 1 - i);
        if (c >= 0) return s.selectedDsIndex = s.selectedDsIndex - c * s.cols,
        s.selectedGridRow -= c,
        !0
      }
      if (0 !== d) {
        var l = e - s.selectedGridRow;
        if (l >= 0) return s.selectedDsIndex = s.selectedDsIndex + l * s.cols,
        s.selectedGridRow += l,
        !0
      }
      return o
    },
    n
  }),
  define('css!xdk-ui-grid/css/Grid', [
  ], function () {
  }),
  define('xdk-ui-grid/BoundedGrid', [
    'xdk-base/class',
    'xdk-ui-grid/Grid',
    'xdk-ui-grid/gridStgy',
    'xdk-ui-grid/boundedGridStgy',
    'xdk-base/util',
    'css!./css/Grid'
  ], function (e, t, i, n, s) {
    'use strict';
    return e.create(t, {
    }, {
      init: function (e) {
        this._super(e);
        var r = e.alignment === t.VERTICAL,
        o = e.scrollFrontBoundary || 0,
        a = e.scrollEndBoundary || 0;
        this.setPrereadyStgy(i.BASIC_PREREADY_STGY),
        this.setCheckScrollableStgy(i.BASIC_CHECK_SCROLLABLE_STGY),
        this.setCheckSelectableStgy(s.bind(n.SCROLL_BOUNDARY_CHECK_SELECTABLE_STGY, this, o, a)),
        this.setDataMappingStgy(i.BASIC_DATA_MAPPING_STGY),
        this.setScrollEntranceStgy(s.bind(i.BASIC_SCROLL_ENTRANCE_STGY, this, r)),
        this.setScrollShiftStgy(i.BASIC_SCROLL_SHIFT_STGY),
        this.setScrollExitStgy(i.BASIC_SCROLL_EXIT_STGY),
        this.setOnUpdateStgy(s.bind(n.ONUPDATE_STGY, this, o, a)),
        this.setKeyNavigationStgy(s.bind(n.SCROLL_BOUNDARY_KEY_NAVIGATION_STGY, this, r, o, a)),
        this.setDsRangeCalculationStgy(i.BASIC_DS_RANGE_CALCULATION_STGY)
      }
    })
  }),
  define('app/wgt/AdOnPauseWgt', [
    'xdk-ax/Container',
    'xdk-base/class',
    'xdk-base/device',
    'xdk-base/util',
    'xdk-ui-basic/Label',
    'xdk-base/console',
    'xdk-base/promise'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    return t.create(e, {
    }, {
      advertisingData: {
      },
      analyticsData: {
      },
      isMediaPlaying: !1,
      visible: !1,
      init: function (t) {
        t = t || {
        },
        this._super(t),
        this.addClass('wgt-adonpause'),
        this.adOnPauseGradientTop = new e({
          parent: this,
          css: 'wgt-adonpause__gradient-top'
        }),
        this.adOnPauseGradientBottom = new e({
          parent: this,
          css: 'wgt-adonpause__gradient-bottom'
        }),
        this.adOnPauseLabel = new s({
          parent: this,
          css: 'wgt-adonpause__label',
          text: 'Sponsored content'
        })
      },
      setAdvertising: function (e) {
        var t = e ? n.clone(e, !0) : {
        };
        this.advertisingData = t
      },
      destroyAd: function () {
        window.googletag && window.googletag.apiReady && window.googletag.destroySlots()
      },
      buildAd: function () {
        //var e = this,
        //t = this.advertisingData.slotname,
        //s = decodeURIComponent(decodeURIComponent(this.advertisingData.cust_params)).split('&'),
        //o = i.id.getUniqueID();
        //s.msg = 'msg=' + this.advertisingData.segments,
        //s.ppid = 'PPID=' + o,
        //encodeURIComponent(this.targeting),
        //r.info('### buildAd targeting', s, '| adUnitPath', t);
        //var a = 'gptIframeContainer',
        //d = this.getRoot().getHTMLElement();
        //d.insertBefore(window.GPT_IFRAME_CONTAINER_ELEMENT, d.firstChild),
        //n.isArray(s) && s.length > 0 && t && window.googletag && window.googletag.apiReady && window.googletag.cmd.push(function () {
        //  window.googletag.destroySlots(),
        //  window.googletag.defineSlot(t, [
        //    1280,
        //    720
        //  ], a).addService(window.googletag.pubads());
        //  for (var i = 0; i < s.length; i++) {
        //    var n = s[i].split('=');
        //    window.googletag.pubads().setTargeting(n[0], n[1])
        //  }
        //  window.googletag.pubads().enableSingleRequest(),
        //  r.info('### self.isListenersSet', e.isListenersSet),
        //  e.isListenersSet || (e.isListenersSet = !0, r.info('### slotRenderEnded EVENT LISTENER INITED!'), window.googletag.pubads().addEventListener('slotRenderEnded', function (t) {
        //    r.info('### slotRenderEnded event.isEmpty', t.isEmpty, '| event', t),
        //    t.isEmpty || e.show()
        //  })),
        //  window.googletag.enableServices(),
        //  window.googletag.display(a)
        //})
      },
      hide: function () {
        this.destroyAd(),
        this.removeClass('wgt-adonpause--fadein'),
        this.visible = !1,
        this.getController().getView().find('closeAdOnPauseButton').disable()
      },
      show: function () {
        if (this.isVisible()) return o.resolve(!1);
        this.isMediaPlaying || (this.addClass('wgt-adonpause--fadein'), this.visible = !0, this.getController().getView().find('closeAdOnPauseButton').enable())
      },
      setMediaState: function (e) {
        this.isMediaPlaying = e
      },
      isVisible: function () {
        return this.visible
      }
    })
  }),
  define('app/template/fullscreenPlayer/fullscreenPlayerView', [
    'xdk-ax/Container',
    'xdk-ui-basic/Button',
    'xdk-ui-grid/BoundedGrid',
    'xdk-ui-basic/Label',
    'xdk-ui-basic/Layout',
    'app/wgt/AdOnPauseWgt',
    'xdk-ax/mvc/ModelRef'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    return function (i) {
      var a = i.get('show');
      return {
        klass: e,
        id: '#fullscreenPlayerView',
        forwardFocus: 'playerButtonContainer',
        children: [
          {
            klass: e,
            id: 'playerBackground',
            css: 'player-background'
          },
          {
            klass: e,
            id: 'playerDetails',
            css: 'player-detail',
            children: [
              {
                klass: n,
                css: 'player-detail__title',
                text: new o(a, 'showTitle')
              },
              {
                klass: n,
                css: 'player-detail__season',
                text: new o(a, 'name')
              }
            ]
          },
          {
            klass: r,
            id: '#adOnPauseWgt'
          },
          {
            klass: e,
            id: 'playerControllerContainer',
            css: 'player-controller-container',
            children: [
              {
                klass: n,
                id: 'currentTime',
                css: 'current-time noselect'
              },
              {
                klass: e,
                id: 'progressBarContainer',
                css: 'progress-bar-container',
                clickable: !0,
                children: [
                  {
                    klass: e,
                    id: 'progressBar',
                    css: 'progress-bar'
                  },
                  {
                    klass: e,
                    id: 'adsMarker',
                    css: 'adsMarker'
                  },
                  {
                    klass: e,
                    id: 'progressPoint',
                    css: 'progress-point'
                  },
                  {
                    klass: e,
                    id: 'pointerTimeContainer',
                    css: 'point-time-container',
                    children: [
                      {
                        klass: n,
                        id: 'pointerTime',
                        css: 'pointer-time  noselect'
                      }
                    ]
                  }
                ]
              },
              {
                klass: n,
                id: 'duration',
                css: 'duration noselect'
              },
              {
                klass: e,
                id: 'playerButtonContainer',
                css: 'player-button-container',
                alignment: s.HORIZONTAL,
                forwardFocus: 'playOrPause',
                children: [
                  {
                    klass: t,
                    id: 'rewind',
                    css: 'icon icon-scrub',
                    nextRight: 'playOrPause',
                    nextUp: 'closeAdOnPauseButton'
                  },
                  {
                    klass: t,
                    id: 'playOrPause',
                    css: 'icon icon-play',
                    nextLeft: 'rewind',
                    nextRight: 'fastForward',
                    nextUp: 'closeAdOnPauseButton'
                  },
                  {
                    klass: t,
                    id: 'fastForward',
                    css: 'icon icon-scrub icon--revert',
                    nextLeft: 'playOrPause',
                    nextUp: 'closeAdOnPauseButton'
                  }
                ]
              }
            ]
          },
          {
            klass: t,
            id: 'closeAdOnPauseButton',
            css: 'button-close-ad',
            nextDown: 'playOrPause',
            text: 'Close Ad'
          },
          {
            klass: t,
            id: 'fullscreenFocus',
            focusable: !0
          }
        ]
      }
    }
  }),
  define('app/wgt/LoadingWgt', [
    'xdk-ax/Container',
    'xdk-ax/mvc/AppRoot',
    'xdk-base/class',
    'xdk-base/device/vKey',
    'xdk-base/Env'
  ], function (e, t, i, n, s) {
    'use strict';
    var r;
    return r = i.create(e, {
      _shared: null,
      getShared: function () {
        return this._shared || (this._shared = new r),
        this._shared
      },
      open: function () {
        return this.getShared().open()
      },
      close: function () {
        return this.getShared().close()
      }
    }, {
      init: function (i) {
        i = i || {
        },
        i.css = i.css || '',
        i.css += 'wgt-loading',
        i.parent = t.singleton().getView(),
        this._super(i),
        this._overlay = new e({
          parent: this,
          css: 'wgt-loading__logo-container spinner'
        })
      },
      open: function () {
        this.show(),
        s.singleton().addNotBlockedKey(n.BACK.id),
        s.singleton().blockKeys()
      },
      close: function () {
        s.singleton().unblockKeys(),
        s.singleton().removeWhitelistedKey(n.BACK.id),
        this.hide()
      }
    })
  }),
  define('app/template/fullscreenPlayer/FullscreenPlayerCtrl', [
    'xdk-ax/Container',
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-ax/mediator',
    'xdk-ax/mvc/AppRoot',
    'xdk-ax/mvc/ModelRef',
    'xdk-ax/mvc/view',
    'xdk-base/class',
    'xdk-base/device/vKey',
    'xdk-ui-basic/Button',
    'xdk-base/console',
    'xdk-base/device',
    'xdk-base/device/Media',
    'xdk-base/promise',
    'xdk-base/util',
    'app/ad/Ads',
    'app/core/History',
    'app/core/RoutableController',
    'app/core/videoPlaybackService/evt/VideoControlsStatusEvent',
    'app/core/videoPlaybackService/evt/VideoPlaybackControlsEvent',
    'app/core/videoPlaybackService/model/VideoItem',
    'app/mgr/MessageDisplayHelper',
    'app/mgr/UserManager',
    'app/mgr/VideoManager',
    'app/helper/helpers',
    'app/mgr/AnalyticsManager',
    'app/model/ShowModel',
    'app/service/MwApiService',
    'app/template/fullscreenPlayer/FullscreenPlayerModel',
    'app/template/fullscreenPlayer/fullscreenPlayerView',
    'app/wgt/LoadingWgt',
    'app/wgt/AlertWgt',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p, g, v, m, E, b, y, k, S, x, T, C, A, w, I, L, R, P) {
    'use strict';
    var D,
    O = A.singleton(),
    M = k.singleton(),
    N = T.singleton(),
    F = y.singleton(),
    B = h.singleton();
    return a.create(v, {
    }, {
      init: function () {
        this.fullscreenPlayerModel = new w,
        this.setView(o.render(I, this.fullscreenPlayerModel))
      },
      setup: function (e) {
        this.__context = e,
        this._mediaData = {
        },
        this.secondsOfContinuousPlayback = 0,
        this._super(e);
        var t = this.getView();
        this._videoManager = new S,
        this._rewindButton = t.find('rewind'),
        this._playOrPauseButton = t.find('playOrPause'),
        this._fastForwardButton = t.find('fastForward'),
        this._playerButtonContainer = t.find('playerButtonContainer'),
        this._qualityList = t.find('qualityList'),
        this._progressBar = t.find('progressBar'),
        this._adsMarker = t.find('adsMarker'),
        this._progressPoint = t.find('progressPoint'),
        this._durationLabel = t.find('duration'),
        this._currentTimeLabel = t.find('currentTime'),
        this._pointerTimeLable = t.find('pointerTime'),
        this._pointerTimeContainer = t.find('pointerTimeContainer'),
        this._progressBarContainer = t.find('progressBarContainer'),
        this._fullscreenFocus = t.find('fullscreenFocus'),
        this._playerBackground = t.find('playerBackground'),
        this._playerControllerContainer = t.find('playerControllerContainer'),
        this._playerDetails = t.find('playerDetails'),
        this.__closeAdOnPauseButton = t.find('closeAdOnPauseButton').disable(),
        this.__adOnPauseWgt = t.find('adOnPauseWgt'),
        this._initTime(),
        s.singleton().getView().addClass('fullscreen-video-mode'),
        i.focus(this._playerButtonContainer)
      },
      postSetup: function (e) {
        console.log("TEST ", e);
        e = e || {
        };
        var t,
        i;
        this._currentContent = {
        },
        e.showModel instanceof C && (t = e.showModel, i = this._getVast(t.get('videoAdKeys')), this._startTime = t.get('currentPosition'), this._currentContent = {
          brightcoveId: t.get('brightcoveId') || '',
          videoId: t.get('videoId') || '',
          genre: t.get('genres').join(','),
          showTitle: t.get('showTitle') || '',
          name: t.get('name') || '',
          duration: t.get('duration') || '',
          channel: t.get('channel'),
          position: 0,
          type: t.get('type'),
          ibmsEpId: t.get('extId'),
          ibmsShowId: '',
          isResume: !!this._startTime,
          fiveMinIntervalCount: 0
        }, this._initializeVast(i, t.get('duration')), this._setplayerDetails(t)),
        this._addEventListeners(),
        this.__setUpdateHistoryTimer(),
        this.__prepareSetPlayback(e);
        var n = [
          O.getShow(t.get('id')),
          O.getAdvertising()
        ];
        _.all(n).then(f.bind(function (e) {
          var t = e[0],
          i = e[1];
          console.log("Here1");
          this._currentContent.ibmsShowId = t.show.extId,
          this.staticAdParams = t.configuration.staticAdParams,
          this.staticAdParams.segments = i.segments,
          N.trackVideoPlay(this._currentContent),
          this._ads || (this._addMediaEvents(), this._playVideo()),
          this.__adOnPauseWgt.setAdvertising(this.staticAdParams),
          setTimeout(f.bind(function () {
            this.canExit = !0
          }, this), 2000)
        }, this))
      },
      _adStart: function (e) {
        l.log(e),
        this._currentContent.adId = e.model.get('idAd'),
        this._currentContent.creativeId = e.model.get('creativeId'),
        this._currentContent.adDuration = e.model.get('creativeDurationInSeconds').toFixed(2),
        this._currentContent.adTitle = e.model.get('adTitle'),
        this._currentContent.adSystem = e.model.get('adSystem'),
        N.trackAdStart(this._currentContent)
      },
      _adSlotEnd: function (e) {
        this._isAdsPlaying = !1,
        this._currentContent.adsServed = e.numAdds + 1,
        this._currentContent.adsDuration = e.adsDuration,
        N.trackAdPodEnd(this._currentContent),
        this._videoManager.addMediaEvents(),
        this._addMediaEvents(),
        this._updateControls(!0)
      },
      _adSlotStart: function (e) {
        this._isAdsPlaying = !0,
        this._currentContent.type = e.type,
        this._currentContent.adBreakNo = e.adBreakNo,
        N.trackAdPodStart(this._currentContent),
        this._videoManager.clearMediaEvents(),
        this._removeMediaEvents(),
        this._setControlsInPlayState(),
        this._updateControls(!1)
      },
      _contentResume: function () {
        var e = this._ads && this._ads.video || {
        };
        console.log("THISIS");
        this._currentContent.isResume && this._startTime <= e.currentTime + 1 && this._ads.disableNextAd(),
        this._startTime = e.currentTime || 0,
        this._startTime || N.trackMediaBegin(this._currentContent),
        this._playVideo()
      },
      _initializeVast: function (e, t) {
        e && (this._ads = new p({
          video: {
            currentTime: this._startTime,
            duration: 0
          },
          sMedia: this._videoManager.getMedia()
        }), this._ads.request(e, 10).then(f.bind(function (e) {
          this._setupAdsMarker(e, t)
        }, this)).done())
      },
      _insertAdBreakOnProgressBar: function (t, i) {
        var n = new e({
          css: 'ad-break'
        });
        this._adsMarker.attach(n),
        n.getRoot().css(i, t + '%')
      },
      _playVideo: function () {
        if (this._currentVideoItem != undefined) {
        this._checkPosition = !0,
        this._videoManager.playVideoItem(this._currentVideoItem, this._startTime)
        }
      },
      _setupAdsMarker: function (e, t) {
        e && (e.pre && e.pre.length > 0 && this._insertAdBreakOnProgressBar(0, 'left'), e.mid && e.mid.length > 0 && f.each(e.mid, f.bind(function (e) {
          var i,
          n = e.time;
          n <= t && (i = n / t * 100, this._insertAdBreakOnProgressBar(i, 'left'))
        }, this)), e.pos && e.pos.length > 0 && this._insertAdBreakOnProgressBar(0, 'right'))
      },
      _addEventListeners: function () {
        this._onKeyRef = f.bind(this._onKey, this),
        this._setControlsInPlayStateRef = f.bind(this._setControlsInPlayState, this),
        this._setControlsInPauseStateRef = f.bind(this._setControlsInPauseState, this),
        this._setControlsInBufferingStateRef = f.bind(this._setControlsInBufferingState, this),
        this._updatePlayheadStateRef = f.bind(this._updatePlayheadState, this),
        this._dismissControlsRef = f.bind(this._dismissControls, this),
        this._notifyErrorRef = f.bind(this._notifyError, this),
        this._onPlaybackCompleteRef = f.bind(this._onPlaybackComplete, this),
        this._rewindButtonPressedRef = f.bind(this._rewindButtonPressed, this),
        this._playOrPauseButtonPressedRef = f.bind(this._playOrPauseButtonPressed, this),
        this._fastForwardButtonPressedRef = f.bind(this._fastForwardButtonPressed, this),
        this._adStartRef = f.bind(this._adStart, this),
        this._adSlotStartHandlerRef = f.bind(this._adSlotStart, this),
        this._adSlotEndHandlerRef = f.bind(this._adSlotEnd, this),
        this._contentResumeRef = f.bind(this._contentResume, this),
        this.__closeAdOnPauseButtonPressedRef = f.bind(this.__closeAdOnPauseButtonPressed, this),
        this.getView().addEventListener(t.KEY, this._onKeyRef),
        n.subscribe(E.SetControlsInPlayState, this._setControlsInPlayStateRef),
        n.subscribe(E.SetControlsInPauseState, this._setControlsInPauseStateRef),
        n.subscribe(E.SetControlsInBufferingState, this._setControlsInBufferingStateRef),
        n.subscribe(E.UpdatePlayheadState, this._updatePlayheadStateRef),
        n.subscribe(E.DismissControls, this._dismissControlsRef),
        n.subscribe(E.NotifyError, this._notifyErrorRef),
        n.subscribe(S.PLAYBACK_FINISHED, this._onPlaybackCompleteRef),
        this._rewindButton.addEventListener(t.CLICK, this._rewindButtonPressedRef),
        this._playOrPauseButton.addEventListener(t.CLICK, this._playOrPauseButtonPressedRef),
        this._fastForwardButton.addEventListener(t.CLICK, this._fastForwardButtonPressedRef),
        this.__closeAdOnPauseButton.addEventListener(t.CLICK, this.__closeAdOnPauseButtonPressedRef),
        this._ads && (this._ads.addEventListener(p.AD_START, this._adStartRef), this._ads.addEventListener(p.AD_SLOT_START, this._adSlotStartHandlerRef), this._ads.addEventListener(p.AD_SLOT_END, this._adSlotEndHandlerRef), this._ads.addEventListener(p.CONTENT_RESUME, this._contentResumeRef), this._ads.addEventListener(p.ADS_END, this._dismissControlsRef))
      },
      _addMediaEvents: function () {
        this._onTimeUpdateRef = f.bind(this._onTimeUpdate, this),
        this._onStateChangedRef = f.bind(this._onStateChanged, this),
        this._onErrorRef = f.bind(this._onError, this),
        B.addEventListener(B.EVT_TIME_UPDATE, this._onTimeUpdateRef),
        B.addEventListener(B.EVT_STATE_CHANGED, this._onStateChangedRef),
        B.addEventListener(B.EVT_ERROR, this._onErrorRef)
      },
      _removeEventListeners: function () {
        this.getView().removeEventListener(t.KEY, this._onKeyRef),
        n.unsubscribe(E.SetControlsInPlayState, this._setControlsInPlayStateRef),
        n.unsubscribe(E.SetControlsInPauseState, this._setControlsInPauseStateRef),
        n.unsubscribe(E.SetControlsInBufferingState, this._setControlsInBufferingStateRef),
        n.unsubscribe(E.UpdatePlayheadState, this._updatePlayheadStateRef),
        n.unsubscribe(E.DismissControls, this._dismissControlsRef),
        n.unsubscribe(E.NotifyError, this._notifyErrorRef),
        n.unsubscribe(S.PLAYBACK_FINISHED, this._onPlaybackCompleteRef),
        this._rewindButton.removeEventListener(t.CLICK, this._rewindButtonPressedRef),
        this._playOrPauseButton.removeEventListener(t.CLICK, this._playOrPauseButtonPressedRef),
        this._fastForwardButton.removeEventListener(t.CLICK, this._fastForwardButtonPressedRef),
        this.__closeAdOnPauseButton.removeEventListener(t.CLICK, this.__closeAdOnPauseButtonPressedRef),
        this._ads && (this._ads.removeEventListener(p.AD_START, this._adStartRef), this._ads.removeEventListener(p.AD_SLOT_START, this._adSlotStartHandlerRef), this._ads.removeEventListener(p.AD_SLOT_END, this._adSlotEndHandlerRef), this._ads.removeEventListener(p.CONTENT_RESUME, this._contentResumeRef), this._ads.removeEventListener(p.ADS_END, this._dismissControlsRef)),
        this._onKeyRef = null,
        this._setControlsInPlayStateRef = null,
        this._setControlsInPauseStateRef = null,
        this._setControlsInBufferingStateRef = null,
        this._updatePlayheadStateRef = null,
        this._dismissControlsRef = null,
        this._notifyErrorRef = null,
        this._onPlaybackCompleteRef = null,
        this._rewindButtonPressedRef = null,
        this._playOrPauseButtonPressedRef = null,
        this._fastForwardButtonPressedRef = null,
        this._adStartRef = null,
        this._adSlotStartHandlerRef = null,
        this._adSlotEndHandlerRef = null,
        this._contentResumeRef = null,
        this._removeMediaEvents()
      },
      _removeMediaEvents: function () {
        B.removeEventListener(B.EVT_TIME_UPDATE, this._onTimeUpdateRef),
        B.removeEventListener(B.EVT_STATE_CHANGED, this._onStateChangedRef),
        B.removeEventListener(B.EVT_ERROR, this._onErrorRef),
        this._onTimeUpdateRef = null,
        this._onStateChangedRef = null,
        this._onErrorRef = null
      },
      _initTime: function () {
        this._currentTimeLabel.setText('00:00:00'),
        this._durationLabel.setText('--:--:--')
      },
      _canPlayContent: function () {
        return true
      },
      _getVast: function (e) {
        if (!f.isObject(e)) return '';
        var t = e.ppid;
        '[PPID]' === t && (t = u.id.getUniqueID().replace(/-/g, '').toUpperCase());
        var i = 'http://pubads.g.doubleclick.net/gampad/ads?' + f.toQueryString({
          cmsid: e.cmsid || '',
          iu: e.slotname || '',
          vid: e.vid || '',
          sz: e.sz || '',
          ppid: t || '',
          unviewed_position_start: 1,
          url: 'http://mobileapp.tv3.co.nz/',
          ad_rule: 1,
          gdfp_req: 1,
          env: 'vp',
          output: 'xml_vast3',
          correlator: (new Date).getTime()
        });
        return e.cust_params && (i += '&cust_params=' + encodeURIComponent(e.cust_params)),
        i
      },
      __prepareSetPlayback: function (e) {
        console.log(e);
        this.showModel = e.showModel,
            this._canPlayContent() ? O.getPlaybackUrl(this.showModel).then(f.bind(function (e) {
                O.getBrightCove(this.showModel).then(f.bind(function (e) {
                    console.log(e.sources, e.sources.filter(s => s.type == "application/dash+xml")[0].src);
                    this._setPlayback({
                        url: e.sources.filter(s => s.type == "application/dash+xml")[0].src
                    })
                }, this))
          
        }, this)) : this._setPlayback({
          url: 'http://d2bqeap5aduv6p.cloudfront.net/elephant_dreams_640x352_1171kbs_11min.mp4'
        }, !0)
      },
      _setplayerDetails: function (e) {
        this.fullscreenPlayerModel.set('show', e)
      },
      _setPlayback: function (e, t) {
        t = t || !1,
        this._currentVideoItem = new b(t ? {
          url: e.url
        }
         : {
          url: e.url,
          drmAttributes: {
            drm: 'playready'
          }
        })
      },
      _onPlaybackComplete: function () {
        this._ads ? this._ads.contentComplete() : this._exit(!0)
      },
      _setControlsInPlayState: function () {
        this._transitionToPlayingStateNotFiringEvent(),
        this._buffering = !1,
        L.close(),
        this.playbackCounterInterval || (this.playbackCounterInterval = setInterval(f.bind(this.playbackAnalyticsHearbeat, this), 1000))
      },
      _setControlsInPauseState: function () {
        this._transitionToPausedStateNotFiringEvent(),
        this._buffering = !1,
        L.close()
      },
      _setControlsInBufferingState: function () {
        this._buffering = !0,
        f.delay(1).then(f.bind(function () {
          this._buffering && L.open()
        }, this))
      },
      _updateControls: function (e) {
        e ? (this._rewindButton.enable(), this._fastForwardButton.enable()) : (this._rewindButton.disable(), this._fastForwardButton.disable()),
        i.focus(this._playOrPauseButton)
      },
      playbackAnalyticsHearbeat: function () {
        !this._isAdsPlaying && this._videoIsPlaying && ++this.secondsOfContinuousPlayback % 300 == 0 && (this._currentContent.fiveMinIntervalCount = this.secondsOfContinuousPlayback, N.trackFiveMinInterval(this._currentContent))
      },
      _updatePlayheadState: function (e) {
        this._mediaData = f.isObject(e) ? e : {
        };
        var t = e.pos;
        this._checkPosition && t < this._startTime || (this._checkPosition = !1, this.updateTime(t), this._isAdsPlaying || e.duration === this._duration || (this._duration = e.duration, this._ads.updateDuration(this._duration)), this._isAdsPlaying || this._ads.updateCurrentTime(t))
      },
      _dismissControls: function () {
        this.setUIForStoppedState(),
        this.updateTime(0)
      },
      _notifyError: function () {
        var e = f.bind(function () {
          this._exit(!1)
        }, this),
        t = {
          closeCallback: e
        };
        this._showUI(),
        D && clearTimeout(D),
        x.showError(P.ErrorMessage.PLAYBACK_GENERAL, t)
      },
      _rewindButtonPressed: function () {
        this._status && 'hidden' === this._status || this._isAdsPlaying || (this.__adOnPauseWgt && this.__adOnPauseWgt.hide(), i.focus(this._rewindButton), n.publish(m.RewindSelected))
      },
      _playOrPauseButtonPressed: function () {
        if (!this._status || 'hidden' !== this._status) {
          if (this._videoIsPlaying) return this._transitionToPausedState(),
          void (this._isAdsPlaying || (this.__adOnPauseWgt && !this.__adOnPauseWgt.isVisible() && this.__adOnPauseWgt.buildAd(), this.__adOnPauseWgt && this.__adOnPauseWgt.setMediaState(!1)));
          this._isAdsPlaying || this.__adOnPauseWgt && this.__adOnPauseWgt.setMediaState(!0),
          this._transitionToPlayingState()
        }
      },
      _fastForwardButtonPressed: function () {
        this._status && 'hidden' === this._status || this._isAdsPlaying || (this.__adOnPauseWgt && this.__adOnPauseWgt.hide(), i.focus(this._fastForwardButton), n.publish(m.FastForwardSelected))
      },
      __closeAdOnPauseButtonPressed: function () {
        this.__adOnPauseWgt && this.__adOnPauseWgt.hide(),
        i.focus(this._playOrPauseButton)
      },
      _transitionToPlayingStoppedEvent: function () {
        n.publish(m.DismissSelected),
        this.setUIForStoppedState(),
        this.updateTime(0)
      },
      _transitionToPlayingState: function () {
        this.__adOnPauseWgt && this.__adOnPauseWgt.hide(),
        n.publish(m.PlaySelected),
        this._transitionToPlayingStateNotFiringEvent()
      },
      _transitionToPlayingStateNotFiringEvent: function () {
        this._videoIsPlaying = !0,
        this.setUIForPlayingState()
      },
      _transitionToPausedState: function () {
        n.publish(m.PauseSelected),
        this._transitionToPausedStateNotFiringEvent()
      },
      _transitionToPausedStateNotFiringEvent: function () {
        this._videoIsPlaying = !1,
        this.setUIForPausedState()
      },
      _exit: function (e) {
        this.__clearUpdateTimer(),
        this.updateHistory(e),
        g.singleton().back(),
        L.open()
      },
      _setProgressBar: function (e) {
        e >= 0 && e <= 1 && this._duration && e * this._duration >= 0 && (this._progressBar.getRoot().getHTMLElement().style.width = 100 * e + '%')
      },
      _setTime: function (e) {
        this._currentTime = e,
        this._duration && (this._currentTimeLabel.setText(this._formatTime(e)), this._durationLabel.setText(this._formatTime(this._duration)))
      },
      _formatTime: function (e) {
        e = Math.floor(e);
        var t = Math.floor(e / 3600),
        i = Math.floor(e % 3600 / 60),
        n = e % 60;
        return x.formatNumber(t, 2, 0) + ':' + x.formatNumber(i, 2, 0) + ':' + x.formatNumber(n, 2, 0)
      },
      _showUIWithoutFocus: function () {
        'hidden' === this._status && (this._playerControllerContainer.removeClass('hidden'), this._playerDetails.removeClass('hidden'), this._playerBackground.removeClass('hidden'), this._status = 'show'),
        D && clearTimeout(D),
        D = setTimeout(f.bind(this._hideUI, this), 3000)
      },
      _showUI: function () {
        if (this._showUIWithoutFocus(), i.getCurFocus() === this._fullscreenFocus) return void i.focus(this._playerButtonContainer);
        i.focus(i.getLastActiveFocus())
      },
      _hideUI: function () {
        this._status && 'show' !== this._status || (this._playerControllerContainer.addClass('hidden'), this._playerBackground.addClass('hidden'), this._playerDetails.addClass('hidden'), this._status = 'hidden', i.focus(this._fullscreenFocus))
      },
      __setUpdateHistoryTimer: function () {
        this.__clearUpdateTimer(),
        this.__setUpdateInterval = setInterval(f.bind(this.updateHistory, this), 10000)
      },
      __clearUpdateTimer: function () {
        this.__setUpdateInterval && (clearInterval(this.__setUpdateInterval), this.__setUpdateInterval = null)
      },
      updateTime: function (e) {
        e = e > 0 ? e : 0,
        this.__videoIsPlaying && this.__adOnPauseWgt && this.__adOnPauseWgt.isVisible() && this.__adOnPauseWgt.hide(),
        this._setTime(e),
        this._setProgressBar(this._duration ? e / this._duration : 0)
      },
      updateHistory: function (e) {
        var t = this._mediaData || {
        },
        i = t.pos,
        n = M.getUserToken();
        if (!this._ads.isAdPlaying() && i && n && this.showModel) {
          var s = {
            brightcoveId: this.showModel.get('brightcoveId'),
            videoId: this.showModel.get('videoId'),
            currentPosition: Math.round(i)
          };
          e && (s.currentPosition = Math.ceil(this.showModel.get('duration')), s.isComplete = !0),
          O.setHistory(s).done()
        }
      },
      setUIForPlayingState: function () {
        this._showUI(),
        this._playOrPauseButton.addClass('icon-pause'),
        this._playOrPauseButton.removeClass('icon-play')
      },
      setUIForPausedState: function () {
        this._playOrPauseButton.addClass('icon-play'),
        this._playOrPauseButton.removeClass('icon-pause')
      },
      setUIForStoppedState: function () {
        this._exit(!1)
      },
      _onKey: function (e) {
        if (e.id !== d.BACK.id) {
          var t;
          if (this._status && 'hidden' === this._status && (t = !0), this._showUI(), t) return !1
        }
        switch (e.id) {
          case d.PLAY.id:
            this._videoIsPlaying || this._transitionToPlayingState();
            break;
          case d.PAUSE.id:
            this._videoIsPlaying && this._transitionToPausedState();
            break;
          case d.PLAY_PAUSE.id:
            this._videoIsPlaying ? this._transitionToPausedState() : this._transitionToPlayingState();
            break;
          case d.STOP.id:
            this._transitionToPlayingStoppedEvent();
            break;
          case d.RW.id:
            this._rewindButtonPressed();
            break;
          case d.FF.id:
            this._fastForwardButtonPressed();
            break;
          case d.BACK.id:
            if (!this.canExit) break;
            if (this._showUI(), D && clearTimeout(D), this._videoIsPlaying && this._transitionToPausedState(), this.alert) {
              this.alert.close();
              break
            }
            this.alert = F.showMessage({
              type: y.TYPE.ALERT,
              message: 'Are you sure you want to leave?',
              contentButtons: [
                {
                  buttonText: 'Yes',
                  buttonClickCallback: f.bind(function () {
                    this._isAdsPlaying && this._ads.skip(),
                    this._transitionToPlayingStoppedEvent()
                  }, this)
                },
                {
                  buttonText: 'No'
                }
              ],
              closeCallback: f.bind(function () {
                this._transitionToPlayingState(),
                this.alert = void 0
              }, this)
            });
            break;
          default:
            return !0
        }
        return !1
      },
      _onTimeUpdate: function (e) {
        this._currentContent && (e && (this._currentContent.position = e), N.trackVideoTimeUpdate(this._currentContent))
      },
      _onStateChanged: function (e) {
        switch (e.toState) {
          case u.media.STOPPED:
            l.info('[Player] State has changed to STOPPED'),
            N.trackVideoStop(this._currentContent);
            break;
          case u.media.PLAYING:
            l.info('[Player] State has changed to PLAYING');
            break;
          case u.media.PAUSED:
            l.info('[Player] State has changed to PAUSED'),
            N.trackVideoPause(this._currentContent);
            break;
          case u.media.SKIPPING:
            l.info('[Player] State has changed to SKIPPING');
            break;
          case u.media.SPEEDING:
            l.info('[Player] State has changed to SPEEDING');
            break;
          case u.media.BUFFERING:
            l.info('[Player] State has changed to BUFFERING');
            break;
          case u.media.CONNECTING:
            l.info('[Player] State has changed to CONNECTING');
            break;
          default:
            l.error('This media state is not handled')
        }
      },
      _onError: function (e) {
        this._currentContent.errorMessage = e.errorMessage,
        N.trackVideoError(this._currentContent),
        l.error(e)
      },
      reset: function () {
        D && clearTimeout(D),
        this._removeEventListeners(),
        L.close(),
        this._ads && this._ads.deinit(),
        this._videoManager.deinit(),
        this.__clearUpdateTimer(),
        this._currentContent = null,
        this._buffering = !1,
        this._videoManager = null,
        this._isAdsPlaying = null,
        this._ads = null,
        this._mediaData = null,
        this.fiveMinIntervalCount = 0,
        clearInterval(this.playbackCounterInterval),
        s.singleton().getView().removeClass('fullscreen-video-mode')
      }
    })
  }),
  define('xdk-ui-basic/Image', [
    'xdk-base/class',
    'xdk-ax/Component',
    'xdk-base/Element',
    'xdk-base/util',
    'xdk-ax/mvc/ModelRef',
    'xdk-base/promise'
  ], function (e, t, i, n, s, r) {
    'use strict';
    return e.create(t, {
    }, {
      __setSrcDeferred: null,
      __imageNode: null,
      __loadHandlerRef: null,
      __errorHandlerRef: null,
      __url: null,
      __alt: null,
      __errorImg: null,
      __errorCallback: null,
      __counter: 0,
      __lastModelRef: {
        src: null,
        alt: null,
        errorImg: null
      },
      __modelListener: {
        src: null,
        alt: null,
        errorImg: null
      },
      init: function (e) {
        e = e || {
        },
        e.src = e.src || 'data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==',
        e.alt = e.alt || '',
        e.errorImg = e.errorImg || '',
        e.root = new i('img'),
        this._super(e),
        this.__imageNode = this.getRoot().getHTMLElement(),
        this.__loadHandlerRef = n.bind(this.__loadHandler, this),
        this.__errorHandlerRef = n.bind(this.__errorHandler, this),
        this.setSrc(e.src),
        this.setAlt(e.alt),
        this.setErrorImg(e.errorImg),
        this.__addEvents()
      },
      setSrc: function (e) {
        return this.__setSrcDeferred && (this.__setSrcDeferred.promise.cancel('Set another source and cancel the previous image.'), this.__setSrcDeferred = null),
        this.__setSrcDeferred = r.defer(),
        this.__modelHandling('src', n.bind(this.__setSrcFunc, this), e),
        this.__setSrcDeferred.promise
      },
      __addEvents: function () {
        this.__imageNode.addEventListener('error', this.__errorHandlerRef),
        this.__imageNode.addEventListener('load', this.__loadHandlerRef)
      },
      __removeEvents: function () {
        this.__imageNode.removeEventListener('error', this.__errorHandlerRef),
        this.__imageNode.removeEventListener('load', this.__loadHandlerRef)
      },
      __errorHandler: function (e) {
        this.__setSrcDeferred.reject({
          message: 'Error in image loading',
          evt: e
        })
      },
      __loadHandler: function (e) {
        this.__setSrcDeferred.resolve({
          message: 'image loaded',
          evt: e
        })
      },
      __setSrcFunc: function (e) {
        this.__url = e,
        this.getRoot().attr('src', e),
        this.__counter = 0
      },
      getSrc: function () {
        return this.__url
      },
      setAlt: function (e) {
        this.__modelHandling('alt', n.bind(this.__setAltFunc, this), e)
      },
      __setAltFunc: function (e) {
        this.__alt = e,
        this.getRoot().attr('alt', e)
      },
      getAlt: function () {
        return this.__alt
      },
      setErrorCallback: function (e) {
        e && n.isFunction(e) && (this.__errorCallback = e, this.getRoot().getHTMLElement().onerror = this.__errorCallback, this.__errorImg = null, this.__counter = 0)
      },
      resetErrorCallback: function () {
        this.__counter = 0,
        this.__errorCallback = null,
        this.__errorImg ? this.getRoot().getHTMLElement().onerror = n.bind(function () {
          this.__counter || (this.getRoot().attr('src', this.__errorImg), this.__counter++)
        }, this) : this.getRoot().getHTMLElement().onerror = null
      },
      setErrorImg: function (e) {
        this.__modelHandling('errorImg', n.bind(this.__setErrorImgFunc, this), e)
      },
      __setErrorImgFunc: function (e) {
        e && (this.__errorImg = e),
        this.resetErrorCallback()
      },
      __modelHandling: function (e, t, i) {
        this.__lastModelRef[e] && this.__modelListener[e] && (this.__lastModelRef[e].getModel().off('change:' + this.__lastModelRef[e].getAttr(), this.__modelListener[e]), this.__lastModelRef[e] = null),
        !n.isString(i) && i instanceof s && (this.__lastModelRef[e] = i, this.__modelListener[e] || (this.__modelListener[e] = function (e) {
          t(e.newVal)
        }), i.getModel().on('change:' + i.getAttr(), this.__modelListener[e]), i = i.getVal()),
        t(i)
      },
      deinit: function () {
        this.getRoot().getHTMLElement().onerror = null,
        this.__removeEvents(),
        this.getRoot().attr('src', ''),
        this.__setSrcDeferred && (this.__setSrcDeferred.promise.cancel('Deinit the image'), this.__setSrcDeferred = null),
        this.__imageNode = null,
        this.__loadHandlerRef = null,
        this.__errorHandlerRef = null,
        this._super()
      }
    })
  }),
  define('xdk-ui-input/interface/InputImpl', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('InputImpl', {
      insertChar: [
        'char',
        'insertPos'
      ],
      backspace: [
      ],
      del: [
      ],
      setMaxLength: [
        'length'
      ],
      getMaxLength: [
      ],
      getText: [
      ],
      setText: [
        'text'
      ],
      clearText: [
      ],
      moveCursor: [
        'direction'
      ],
      setCursorPos: [
        'pos'
      ],
      startInput: [
      ],
      stopInput: [
      ],
      isCapturing: [
      ]
    })
  }),
  define('css!xdk-ui-input/css/InputDivImpl', [
  ], function () {
  }),
  define('xdk-ui-input/InputDivImpl', [
    'xdk-base/class',
    'xdk-base/Element',
    'xdk-base/util',
    'xdk-base/device',
    'xdk-ax/evt/type',
    'xdk-base/core',
    './interface/InputImpl',
    'css!./css/InputDivImpl'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    return e.create([o], {
    }, {
      __oldSamsung: 'samsung' === n.platform && n.id.getFirmwareYear() <= 2011,
      __inputFieldWidth: null,
      __wrapper: null,
      __wrapperCopy: null,
      __cursor: null,
      __cursorPosition: null,
      __cursorLeftPosition: null,
      __labelText: null,
      __labelTextCopy: null,
      __wrapperLeft: null,
      __inputState: !1,
      __passwordTimer: null,
      __initEnvOnKey: !1,
      __maxLength: 20,
      __isPassword: !1,
      __passwordChar: null,
      __hideTimeout: 0,
      __widgetInstance: null,
      __placeHolder: null,
      __placeHolderDiv: null,
      init: function (e) {
        e = e || {
        },
        e.root.addClass('wgt-input-div'),
        this.setMaxLength(i.isNumber(e.maxLength) ? e.maxLength : 20),
        this.__isPassword = e.isPassword || !1,
        this.__passwordChar = e.passwordChar || '*',
        this.__hideTimeout = e.hideTimeout || 0,
        this.__placeHolder = e.placeHolder || '',
        this.__labelText = e.text || '',
        this.__cursorPosition = this.__labelText.length,
        this.__widgetInstance = e.widgetInstance,
        this.container = new t('div'),
        this.container.addClass('container'),
        this.__wrapper = new t('pre'),
        this.__wrapper.addClass('wrapper'),
        this.__wrapperCopy = new t('pre'),
        this.__wrapperCopy.addClass('wrapperCopy'),
        this.__cursor = new t('div'),
        this.__cursor.addClass('cursor'),
        this.__cursor.css({
          visibility: 'hidden'
        }),
        e.root.append(this.container),
        this.container.append(this.__wrapper),
        this.container.append(this.__wrapperCopy),
        this.container.append(this.__cursor),
        '' !== this.__placeHolder && (this.__placeHolderDiv = new t('div'), this.__placeHolderDiv.addClass('placeholder'), this.__placeHolderDiv.setInnerText(this.__placeHolder), this.__labelText.length > 0 && this.__placeHolderDiv.hide(), this.container.append(this.__placeHolderDiv)),
        this.setText(e.text, !0)
      },
      insertChar: function (e, t) {
        if (this.__inputState && e && !(this.__labelText.length >= this.getMaxLength())) {
          t = i.isUndefined(t) ? this.__cursorPosition : t;
          var n = this.getText();
          n = i.insert(n, t, e),
          this.__cursorPosition = this.__cursorPosition + e.length,
          this.setText(n, void 0, !0),
          this.updateLeft('add'),
          this.updateCursorPosition()
        }
      },
      backspace: function () {
        if (this.__inputState && !(this.__cursorPosition <= 0)) {
          var e = this.getText(),
          t = '';
          1 === this.__cursorPosition ? e.length > 1 && (t = e.slice(this.__cursorPosition, e.length)) : e.length > 1 && (t = e.slice(0, this.__cursorPosition - 1) + e.slice(this.__cursorPosition, e.length)),
          this.__cursorPosition--,
          this.setText(t, void 0, !0),
          this.updateLeft('del'),
          this.updateCursorPosition()
        }
      },
      del: function () {
        if (this.__inputState) {
          var e = this.getText(),
          t = '';
          this.__cursorPosition >= e.length || (t = this.__cursorPosition === e.length - 1 ? e.slice(0, e.length - 1) : e.slice(0, this.__cursorPosition) + e.slice(this.__cursorPosition + 1, e.length), this.setText(t, void 0, !0))
        }
      },
      setMaxLength: function (e) {
        this.__maxLength = e
      },
      getMaxLength: function () {
        return this.__maxLength
      },
      getText: function () {
        return this.__labelText
      },
      setText: function (e, t, n) {
        if (!i.isUndefined(e)) {
          e || (e = '');
          var o,
          a,
          d,
          c,
          l,
          u,
          h = e !== this.__labelText,
          _ = '',
          f = '';
          if (e.length > this.getMaxLength() ? this.__cursorPosition = this.getMaxLength() : n || (this.__cursorPosition = e.length), e = i.truncate(e, this.getMaxLength(), ''), this.__isPassword) {
            for (c = e.length > this.__labelText.length, l = this.__hideTimeout > 0 && c && !t, this.__labelText = e, o = this.__labelText.length, this.__passwordTimer && (i.clearDelay(this.__passwordTimer), this.__passwordTimer = null), a = 0; a < this.__cursorPosition - 1; a++) _ += this.__passwordChar,
            f += this.__passwordChar;
            for (!l && this.__cursorPosition > 0 ? (_ += this.__passwordChar, f += this.__passwordChar) : (_ += e[this.__cursorPosition - 1], f += e[this.__cursorPosition - 1]), a = 0; a < o - this.__cursorPosition; a++) _ += this.__passwordChar;
            this.__setElementText(this.__wrapper, _),
            this.__setElementText(this.__wrapperCopy, f),
            u = i.bind(function () {
              for (_ = '', f = '', a = 0; a < o; a++) _ += this.__passwordChar;
              for (a = 0; a < this.__cursorPosition; a++) f += this.__passwordChar;
              this.__setElementText(this.__wrapper, _),
              this.__setElementText(this.__wrapperCopy, f),
              this.updateCursorPosition(),
              this.__passwordTimer = null
            }, this),
            l ? (this.__passwordTimer = r.getGuid(), i.delay(this.__hideTimeout, this.__passwordTimer).then(u)) : u()
          } else this.__setElementText(this.__wrapper, e),
          0 === this.__cursorPosition ? this.__setElementText(this.__wrapperCopy, '') : (d = i.truncate(e, this.__cursorPosition, ''), this.__setElementText(this.__wrapperCopy, d));
          this.__labelText = e,
          this.__labelTextCopy = i.truncate(this.__labelText, this.__cursorPosition, ''),
          n || this.updateCursorPosition(),
          h && (this.__placeHolderDiv && (this.__labelText.length > 0 ? this.__placeHolderDiv.hide() : this.__placeHolderDiv.show()), this.__widgetInstance && this.__widgetInstance.dispatchEvent(s.TEXT_CHANGED, this.__labelText))
        }
      },
      __setElementText: function (e, i) {
        var n;
        e.setInnerText(i),
        i.length > 0 && e === this.__wrapperCopy && this.__oldSamsung && (n = new t('span'), n.setInnerText('t'), e.append(n))
      },
      clearText: function () {
        this.setText('')
      },
      updateLeft: function (e) {
        this.wrapperWidth = this.__wrapper.getHTMLElement().clientWidth,
        this.__wrapperLeft = this.__wrapper.getHTMLElement().offsetLeft,
        this.wrapperCopyWidth = this.__wrapperCopy.getHTMLElement().clientWidth,
        this.wrapperCopyLeft = this.__wrapperCopy.getHTMLElement().offsetLeft;
        var t,
        n,
        s;
        this.__oldSamsung && this.__cursorPosition > 0 && (n = this.__wrapperCopy.getHTMLElement(), s = n.lastChild, this.wrapperCopyWidth -= s.clientWidth),
        this.__inputFieldWidth || (this.__inputFieldWidth = this.container.getHTMLElement().clientWidth),
        this.wrapperWidth >= this.__inputFieldWidth && this.__cursorPosition === this.__labelText.length ? t = this.__inputFieldWidth - this.wrapperWidth : this.wrapperWidth >= this.__inputFieldWidth ? 'del' === e && this.wrapperWidth + this.__wrapperLeft <= this.__inputFieldWidth && (t = this.__inputFieldWidth - this.wrapperWidth) : t = 0,
        i.isUndefined(t) || this.updateLeftByCursor(t)
      },
      updateLeftByCursor: function (e) {
        this.__wrapper.css({
          left: e + 'px'
        }),
        this.__wrapperCopy.css({
          left: e + 'px'
        }),
        this.__wrapperLeft = e
      },
      updateCursorPosition: function () {
        var e,
        t,
        i,
        n,
        s;
        if (0 === this.__cursorPosition) return this.__cursor.css({
          left: '0px'
        }),
        void this.updateLeftByCursor(0);
        s = this.__wrapperCopy.getHTMLElement().offsetLeft,
        t = 0,
        this.wrapperCopyWidth = this.__wrapperCopy.getHTMLElement().offsetWidth,
        this.__oldSamsung && this.__cursorPosition > 0 && (i = this.__wrapperCopy.getHTMLElement(), n = i.lastChild, this.wrapperCopyWidth -= n.clientWidth),
        e = this.wrapperCopyWidth + s,
        e > this.__inputFieldWidth - 1 ? (t = this.__inputFieldWidth - 1, this.updateLeftByCursor(this.__inputFieldWidth - this.wrapperCopyWidth)) : e > 0 ? t = e : (t = 0, this.updateLeftByCursor( - this.wrapperCopyWidth)),
        this.__cursor.css({
          left: t + 'px'
        }),
        this.__cursorLeftPosition = t
      },
      moveCursor: function (e) {
        this.__inputState && ('left' === e.toLowerCase() ? this.setCursorPos(this.__cursorPosition - 1) : 'right' === e.toLowerCase() && this.setCursorPos(this.__cursorPosition + 1))
      },
      setCursorPos: function (e) {
        e > this.getText().length ? e = this.getText().length : e < 0 && (e = 0),
        this.__cursorPosition !== e && (this.__cursorPosition = e, 0 === this.__cursorPosition ? this.__labelTextCopy = '' : this.__isPassword ? this.__labelTextCopy = i.truncate(this.__wrapper.getInnerText(), this.__cursorPosition, '') : this.__labelTextCopy = i.truncate(this.__labelText, this.__cursorPosition, ''), this.__setElementText(this.__wrapperCopy, this.__labelTextCopy), this.updateCursorPosition())
      },
      startInput: function () {
        this.__inputState = !0,
        this.__inputFieldWidth || (this.__inputFieldWidth = this.container.getHTMLElement().clientWidth, this.updateLeft('add'), this.updateCursorPosition()),
        this.__cursor.css({
          visibility: 'visible'
        })
      },
      stopInput: function () {
        this.__inputState = !1,
        this.__cursor.css({
          visibility: 'hidden'
        })
      },
      isCapturing: function () {
        return this.__inputState
      },
      deinit: function () {
        this.container.deinit(),
        this.__wrapper.deinit(),
        this.__wrapperCopy.deinit(),
        this.__cursor.deinit()
      }
    })
  }),
  define('xdk-base/device/shared/keyboardVKey', [
    'xdk-base/device/vKey'
  ], function (e) {
    'use strict';
    return {
      A: {
        id: 'device:kb-vkey:A',
        text: 'A'
      },
      B: {
        id: 'device:kb-vkey:B',
        text: 'B'
      },
      C: {
        id: 'device:kb-vkey:C',
        text: 'C'
      },
      D: {
        id: 'device:kb-vkey:D',
        text: 'D'
      },
      E: {
        id: 'device:kb-vkey:E',
        text: 'E'
      },
      F: {
        id: 'device:kb-vkey:F',
        text: 'F'
      },
      G: {
        id: 'device:kb-vkey:G',
        text: 'G'
      },
      H: {
        id: 'device:kb-vkey:H',
        text: 'H'
      },
      I: {
        id: 'device:kb-vkey:I',
        text: 'I'
      },
      J: {
        id: 'device:kb-vkey:J',
        text: 'J'
      },
      K: {
        id: 'device:kb-vkey:K',
        text: 'K'
      },
      L: {
        id: 'device:kb-vkey:L',
        text: 'L'
      },
      M: {
        id: 'device:kb-vkey:M',
        text: 'M'
      },
      N: {
        id: 'device:kb-vkey:N',
        text: 'N'
      },
      O: {
        id: 'device:kb-vkey:O',
        text: 'O'
      },
      P: {
        id: 'device:kb-vkey:P',
        text: 'P'
      },
      Q: {
        id: 'device:kb-vkey:Q',
        text: 'Q'
      },
      R: {
        id: 'device:kb-vkey:R',
        text: 'R'
      },
      S: {
        id: 'device:kb-vkey:S',
        text: 'S'
      },
      T: {
        id: 'device:kb-vkey:T',
        text: 'T'
      },
      U: {
        id: 'device:kb-vkey:U',
        text: 'U'
      },
      V: {
        id: 'device:kb-vkey:V',
        text: 'V'
      },
      W: {
        id: 'device:kb-vkey:W',
        text: 'W'
      },
      X: {
        id: 'device:kb-vkey:X',
        text: 'X'
      },
      Y: {
        id: 'device:kb-vkey:Y',
        text: 'Y'
      },
      Z: {
        id: 'device:kb-vkey:Z',
        text: 'Z'
      },
      A_LOWER: {
        id: 'device:kb-vkey:a',
        text: 'a'
      },
      B_LOWER: {
        id: 'device:kb-vkey:b',
        text: 'b'
      },
      C_LOWER: {
        id: 'device:kb-vkey:c',
        text: 'c'
      },
      D_LOWER: {
        id: 'device:kb-vkey:d',
        text: 'd'
      },
      E_LOWER: {
        id: 'device:kb-vkey:e',
        text: 'e'
      },
      F_LOWER: {
        id: 'device:kb-vkey:f',
        text: 'f'
      },
      G_LOWER: {
        id: 'device:kb-vkey:g',
        text: 'g'
      },
      H_LOWER: {
        id: 'device:kb-vkey:h',
        text: 'h'
      },
      I_LOWER: {
        id: 'device:kb-vkey:i',
        text: 'i'
      },
      J_LOWER: {
        id: 'device:kb-vkey:j',
        text: 'j'
      },
      K_LOWER: {
        id: 'device:kb-vkey:k',
        text: 'k'
      },
      L_LOWER: {
        id: 'device:kb-vkey:l',
        text: 'l'
      },
      M_LOWER: {
        id: 'device:kb-vkey:m',
        text: 'm'
      },
      N_LOWER: {
        id: 'device:kb-vkey:n',
        text: 'n'
      },
      O_LOWER: {
        id: 'device:kb-vkey:o',
        text: 'o'
      },
      P_LOWER: {
        id: 'device:kb-vkey:p',
        text: 'p'
      },
      Q_LOWER: {
        id: 'device:kb-vkey:q',
        text: 'q'
      },
      R_LOWER: {
        id: 'device:kb-vkey:r',
        text: 'r'
      },
      S_LOWER: {
        id: 'device:kb-vkey:s',
        text: 's'
      },
      T_LOWER: {
        id: 'device:kb-vkey:t',
        text: 't'
      },
      U_LOWER: {
        id: 'device:kb-vkey:u',
        text: 'u'
      },
      V_LOWER: {
        id: 'device:kb-vkey:v',
        text: 'v'
      },
      W_LOWER: {
        id: 'device:kb-vkey:w',
        text: 'w'
      },
      X_LOWER: {
        id: 'device:kb-vkey:x',
        text: 'x'
      },
      Y_LOWER: {
        id: 'device:kb-vkey:y',
        text: 'y'
      },
      Z_LOWER: {
        id: 'device:kb-vkey:z',
        text: 'z'
      },
      SPACE: {
        id: 'device:kb-vkey:space',
        text: ' '
      },
      TILDE: {
        id: 'device:kb-vkey:~',
        text: '~'
      },
      BACK_QUOTE: {
        id: 'device:kb-vkey:`',
        text: '`'
      },
      EXC: {
        id: 'device:kb-vkey:!',
        text: '!'
      },
      AT: {
        id: 'device:kb-vkey:@',
        text: '@'
      },
      HASH: {
        id: 'device:kb-vkey:#',
        text: '#'
      },
      DOLLAR: {
        id: 'device:kb-vkey:$',
        text: '$'
      },
      PERCENT: {
        id: 'device:kb-vkey:%',
        text: '%'
      },
      CARET: {
        id: 'device:kb-vkey:^',
        text: '^'
      },
      AMP: {
        id: 'device:kb-vkey:&',
        text: '&'
      },
      STAR: {
        id: 'device:kb-vkey:*',
        text: '*'
      },
      OPEN_PAREN: {
        id: 'device:kb-vkey:(',
        text: '('
      },
      CLOSE_PAREN: {
        id: 'device:kb-vkey:)',
        text: ')'
      },
      MINUS: {
        id: 'device:kb-vkey:-',
        text: '-'
      },
      UNDERSCORE: {
        id: 'device:kb-vkey:_',
        text: '_'
      },
      EQUALS: {
        id: 'device:kb-vkey:=',
        text: '='
      },
      PLUS: {
        id: 'device:kb-vkey:+',
        text: '+'
      },
      OPEN_BRACKET: {
        id: 'device:kb-vkey:[',
        text: '['
      },
      OPEN_BRACE: {
        id: 'device:kb-vkey:{',
        text: '{'
      },
      CLOSE_BRACKET: {
        id: 'device:kb-vkey:]',
        text: ']'
      },
      CLOSE_BRACE: {
        id: 'device:kb-vkey:}',
        text: '}'
      },
      BACK_SLASH: {
        id: 'device:kb-vkey:\\',
        text: '\\'
      },
      PIPE: {
        id: 'device:kb-vkey:|',
        text: '|'
      },
      SEMICOLON: {
        id: 'device:kb-vkey:;',
        text: ';'
      },
      COLON: {
        id: 'device:kb-vkey::',
        text: ':'
      },
      SINGLE_QUOTE: {
        id: 'device:kb-vkey:\'',
        text: '\''
      },
      QUOTE: {
        id: 'device:kb-vkey:"',
        text: '"'
      },
      COMMA: {
        id: 'device:kb-vkey:,',
        text: ','
      },
      LESS: {
        id: 'device:kb-vkey:<',
        text: '<'
      },
      PERIOD: {
        id: 'device:kb-vkey:.',
        text: '.'
      },
      GREATER: {
        id: 'device:kb-vkey:>',
        text: '>'
      },
      SLASH: {
        id: 'device:kb-vkey:/',
        text: '/'
      },
      QUESTION: {
        id: 'device:kb-vkey:?',
        text: '?'
      },
      BACKSPACE: {
        id: 'device:kb-vkey:backspace'
      },
      TAB: {
        id: 'device:kb-vkey:tab'
      },
      INSERT: {
        id: 'device:kb-vkey:insert'
      },
      DELETE: {
        id: 'device:kb-vkey:delete'
      },
      HOME: {
        id: 'device:kb-vkey:home'
      },
      END: {
        id: 'device:kb-vkey:end'
      },
      PAGE_UP: {
        id: 'device:kb-vkey:page-up'
      },
      PAGE_DOWN: {
        id: 'device:kb-vkey:page-down'
      },
      ESCAPE: {
        id: 'device:kb-vkey:escape'
      },
      UP: e.UP,
      DOWN: e.DOWN,
      LEFT: e.LEFT,
      RIGHT: e.RIGHT,
      PAUSE: e.PAUSE,
      OK: e.OK,
      KEY_0: e.KEY_0,
      KEY_1: e.KEY_1,
      KEY_2: e.KEY_2,
      KEY_3: e.KEY_3,
      KEY_4: e.KEY_4,
      KEY_5: e.KEY_5,
      KEY_6: e.KEY_6,
      KEY_7: e.KEY_7,
      KEY_8: e.KEY_8,
      KEY_9: e.KEY_9
    }
  }),
  define('xdk-base/device/shared/browser/keyMap', [
    'xdk-base/device/shared/keyboardVKey',
    'xdk-base/util'
  ], function (e, t) {
    'use strict';
    var i,
    n,
    s,
    r,
    o;
    for (i = {
      VKey: {
      },
      keyCode: {
        UP: 38,
        DOWN: 40,
        LEFT: 37,
        RIGHT: 39,
        OK: 13
      }
    }, s = {
      VKey: {
      },
      keyCode: {
        UP: 38,
        DOWN: 40,
        LEFT: 37,
        RIGHT: 39,
        OK: 13,
        PAGE_UP: 33,
        PAGE_DOWN: 34,
        END: 35,
        HOME: 36,
        PAUSE: 19,
        TAB: 9,
        INSERT: 45,
        DELETE: 46,
        BACKSPACE: 8,
        ESCAPE: 27
      }
    }, n = {
      VKey: {
      },
      keyCode: {
        SPACE: 32,
        EXC: 33,
        HASH: 35,
        DOLLAR: 36,
        PERCENT: 37,
        AMP: 38,
        SINGLE_QUOTE: 39,
        OPEN_PAREN: 40,
        CLOSE_PAREN: 41,
        STAR: 42,
        PLUS: 43,
        COMMA: 44,
        MINUS: 45,
        PERIOD: 46,
        SLASH: 47,
        COLON: 58,
        SEMICOLON: 59,
        LESS: 60,
        EQUALS: 61,
        GREATER: 62,
        QUESTION: 63,
        AT: 64,
        OPEN_BRACKET: 91,
        BACK_SLASH: 92,
        CLOSE_BRACKET: 93,
        CARET: 94,
        UNDERSCORE: 95,
        BACK_QUOTE: 96,
        OPEN_BRACE: 123,
        PIPE: 124,
        CLOSE_BRACE: 125,
        TILDE: 126
      }
    }, t.each(i.keyCode, function (t) {
      i.VKey[t.value] = e[t.key]
    }), t.each(n.keyCode, function (t) {
      n.VKey[t.value] = e[t.key]
    }), t.each(s.keyCode, function (t) {
      s.VKey[t.value] = e[t.key]
    }), r = 65; r <= 90; r++) n.VKey[r] = e[String.fromCharCode(r)],
    n.keyCode[String.fromCharCode(r)] = r;
    for (r = 97; r <= 122; r++) n.VKey[r] = e[String.fromCharCode(r).toUpperCase() + '_LOWER'],
    n.keyCode[String.fromCharCode(r).toUpperCase() + '_LOWER'] = r;
    for (r = 48; r <= 57; r++) o = 'KEY_' + (r - 48),
    n.VKey[r] = e[o],
    n.keyCode[o] = r,
    i.keyCode[o] = r,
    i.VKey[r] = e[o];
    return {
      REMOTE: i,
      KEYBOARD_KEY: s,
      KEYBOARD_CHAR: n
    }
  }),
  define('css!xdk-ui-input/css/InputNativeImpl', [
  ], function () {
  }),
  define('xdk-ui-input/InputNativeImpl', [
    'xdk-base/class',
    'xdk-base/Element',
    'xdk-base/util',
    'xdk-base/device',
    'xdk-base/console',
    'xdk-ax/evt/type',
    'xdk-base/device/shared/browser/keyMap',
    'xdk-base/core',
    './interface/InputImpl',
    'css!./css/InputNativeImpl'
  ], function (e, t, i, n, s, r, o, a, d) {
    'use strict';
    return e.create([d], {
    }, {
      __oldSamsung: 'samsung' === n.platform && n.id.getFirmwareYear() <= 2011,
      __cursorPosition: null,
      __labelText: null,
      __inputState: !1,
      __passwordTimer: null,
      __initEnvOnKey: !1,
      __maxLength: 20,
      __isPassword: !1,
      __passwordChar: null,
      __hideTimeout: 0,
      __widgetInstance: null,
      __input: null,
      __element: null,
      __placeHolder: null,
      __isSetPlaceHolder: !1,
      init: function (e) {
        var r,
        a,
        d,
        c,
        l,
        u,
        h = this,
        _ = o.KEYBOARD_KEY.keyCode.UP,
        f = o.KEYBOARD_KEY.keyCode.DOWN,
        p = o.KEYBOARD_KEY.keyCode.LEFT,
        g = o.KEYBOARD_KEY.keyCode.RIGHT,
        v = o.KEYBOARD_KEY.keyCode.INSERT,
        m = o.KEYBOARD_KEY.keyCode.DELETE,
        E = o.KEYBOARD_KEY.keyCode.HOME,
        b = o.KEYBOARD_KEY.keyCode.END,
        y = o.KEYBOARD_KEY.keyCode.PAGE_UP,
        k = o.KEYBOARD_KEY.keyCode.PAGE_DOWN,
        S = o.KEYBOARD_KEY.keyCode.TAB,
        x = o.KEYBOARD_KEY.keyCode.BACKSPACE;
        switch (e = e || {
          }, e.root.addClass('wgt-input-native'), this.setMaxLength(i.isNumber(e.maxLength) ? e.maxLength : 20), this.__isPassword = e.isPassword || !1, this.__passwordChar = e.passwordChar || '*', this.__hideTimeout = e.hideTimeout || 0, this.__placeHolder = e.placeHolder || '', this.__labelText = e.text || '', this.__cursorPosition = this.__labelText.length, this.__widgetInstance = e.widgetInstance, this.container = new t('div'), this.container.addClass('container'), this.__input = new t('input'), this.__input.addClass('wgt-input-native-ele'), e.root.append(this.container), this.container.append(this.__input), this.__element = this.__input.getHTMLElement(), this.setText(e.text, !0), u = function (e) {
            switch (e.keyCode) {
              case _:
              case f:
              case p:
              case g:
              case v:
              case m:
              case E:
              case b:
              case y:
              case k:
              case S:
              case x:
                return !0;
              default:
                return !1
            }
          }, r = function (e) {
            return s.info('inputNativeImpl: mouse click; inputState: ' + h.__inputState),
            i.defer().then(function () {
              h.__isSetPlaceHolder ? h.setCursorPos(0) : h.__updateCursorPosition(),
              h.startInput()
            }).done(),
            !0
          }, a = function (e) {
            return s.info('inputNativeImpl: mouse out; inputState: ' + h.__inputState),
            h.stopInput(),
            !0
          }, d = function (e) {
            try {
              e.preventDefault()
            } catch (e) {
              e.returnValue = !1
            }
            return !0
          }, l = function (e) {
            if (u(e)) {
              s.info('inputNativeImpl: blocking text edit key:' + e.keyCode);
              try {
                e.preventDefault()
              } catch (e) {
                e.returnValue = !1
              }
            }
            return !0
          }, n.platform) {
          case 'samsung':
            if (2010 === n.id.getFirmwareYear()) {
              s.debug('inputNativeImpl: samsung 2010 device detected, using special handler'),
              c = function (e) {
                s.debug('inputNativeImpl: samsung workaround handler in action...');
                try {
                  e.preventDefault()
                } catch (e) {
                  e.returnValue = !1
                }
                return h.setText(h.__value, h.__cursorPosition),
                !0
              },
              this.__input.addEventListener('keydown', c);
              break
            }
          default:
            this.container.addEventListener('mousedown', r),
            this.container.addEventListener('mouseout', a),
            this.__input.addEventListener('keydown', l),
            this.__input.addEventListener('keypress', d)
        }
      },
      __addPlaceHolder: function () {
        this.__isSetPlaceHolder = !0,
        this.__element.value = this.__placeHolder,
        this.__input.addClass('placeholder'),
        this.__setRealCursorPos()
      },
      __removePlaceHolder: function () {
        this.__isSetPlaceHolder = !1,
        this.__element.value = '',
        this.__input.removeClass('placeholder')
      },
      insertChar: function (e, t) {
        if (this.__inputState && e && !(this.__labelText.length >= this.__maxLength)) {
          t = i.isUndefined(t) ? this.__cursorPosition : t;
          var s = this.getText();
          s = i.insert(s, t, e),
          this.__cursorPosition = this.__cursorPosition + e.length,
          this.setText(s, void 0, !0),
          'windows' === n.platform ? (this.setCursorPos(this.__cursorPosition - 1), this.setCursorPos(this.__cursorPosition + 1)) : this.__updateCursorPosition(),
          this.__element.blur(),
          this.__element.focus()
        }
      },
      backspace: function () {
        if (this.__inputState && !(this.__cursorPosition <= 0)) {
          var e = this.getText(),
          t = '';
          1 === this.__cursorPosition ? e.length > 1 && (t = e.slice(this.__cursorPosition, e.length)) : e.length > 1 && (t = e.slice(0, this.__cursorPosition - 1) + e.slice(this.__cursorPosition, e.length)),
          this.__cursorPosition--,
          this.setText(t, void 0, !0),
          this.__updateCursorPosition(),
          this.__setRealCursorPos()
        }
      },
      del: function () {
        if (this.__inputState) {
          var e = this.getText(),
          t = ''
          ;
          this.__cursorPosition >= e.length || (t = this.__cursorPosition === e.length - 1 ? e.slice(0, e.length - 1) : e.slice(0, this.__cursorPosition) + e.slice(this.__cursorPosition + 1, e.length), this.setText(t, void 0, !0), this.__setRealCursorPos())
        }
      },
      setMaxLength: function (e) {
        this.__maxLength = e
      },
      getMaxLength: function () {
        return this.__maxLength
      },
      getText: function () {
        return this.__labelText
      },
      setText: function (e, t, n) {
        if (!i.isUndefined(e)) {
          e || (e = ''),
          null !== this.__placeHolder && '' === this.getText() && '' !== e && this.__removePlaceHolder();
          var s,
          o,
          d,
          c,
          l,
          u = e !== this.__labelText,
          h = '';
          if (e.length > this.__maxLength ? this.__cursorPosition = this.__maxLength : n || (this.__cursorPosition = e.length), e = i.truncate(e, this.__maxLength, ''), this.__isPassword) {
            for (d = e.length > this.__labelText.length, c = this.__hideTimeout > 0 && d && !t, this.__labelText = e, s = this.__labelText.length, this.__passwordTimer && (i.clearDelay(this.__passwordTimer), this.__passwordTimer = null), o = 0; o < this.__cursorPosition - 1; o++) h += this.__passwordChar;
            for (!c && this.__cursorPosition > 0 ? h += this.__passwordChar : e.length > 0 && this.__cursorPosition - 1 < e.length && (h += e[this.__cursorPosition - 1]), o = 0; o < s - this.__cursorPosition; o++) h += this.__passwordChar;
            this.__setElementText(h),
            l = i.bind(function () {
              for (h = '', o = 0; o < this.__labelText.length; o++) h += this.__passwordChar;
              this.__setElementText(h),
              this.__updateCursorPosition(),
              this.__passwordTimer = null
            }, this),
            c ? (this.__passwordTimer = a.getGuid(), i.delay(this.__hideTimeout, this.__passwordTimer).then(l).done()) : l()
          } else this.__setElementText(e);
          this.__labelText = e,
          this.__labelTextCopy = i.truncate(this.__labelText, this.__cursorPosition, ''),
          n || this.__updateCursorPosition(),
          u && this.__widgetInstance && this.__widgetInstance.dispatchEvent(r.TEXT_CHANGED, this.__labelText),
          null !== this.__placeHolder && '' === e && this.__addPlaceHolder()
        }
      },
      __setElementText: function (e) {
        e = i.truncate(e, this.__maxLength, ''),
        this.__isPassword || (this.__labelText = e),
        this.__element.value = e,
        this.__inputState && (this.__element.blur(), this.__element.focus()),
        this.__setRealCursorPos()
      },
      clearText: function () {
        this.setText('')
      },
      __updateCursorPosition: function () {
        if (!this.__isSetPlaceHolder) {
          var e,
          t = this.__element,
          i = 0;
          return t.selectionStart || '0' === String(t.selectionStart) ? (s.debug('InputNativeImpl: element has selectionStart'), i = t.selectionStart) : document.getSelection && (s.debug('InputNativeImpl: document has getSelection()'), t.focus(), e = document.getSelection().createRange(), e.moveStart('character', - t.value.length), i = e.text.length),
          this.__cursorPosition = i,
          s.debug('InputNativeImpl: __updateCursorPos() reports cursor position is ' + i),
          i
        }
      },
      moveCursor: function (e) {
        this.__inputState && ('left' === e.toLowerCase() ? this.setCursorPos(this.__cursorPosition - 1) : 'right' === e.toLowerCase() && this.setCursorPos(this.__cursorPosition + 1))
      },
      setCursorPos: function (e) {
        e > this.getText().length ? e = this.getText().length : e < 0 && (e = 0),
        this.__cursorPosition !== e && (this.__cursorPosition = e, this.__setRealCursorPos())
      },
      startInput: function () {
        this.__element.focus(),
        this.__inputState = !0,
        this.__inputStateFirstOn && (this.__inputStateFirstOn = !1, this.setCursorPos(this.__cursorPosition)),
        i.defer().then(i.bind(this.__setRealCursorPos, this)).done()
      },
      __setRealCursorPos: function () {
        var e,
        t = this.__cursorPosition,
        i = this.__element;
        if (this.__oldSamsung) s.debug('InputNativeImpl: samsung 2011 or 2010 device detected'),
        i.focus(),
        i.selectionStart = t;
         else if (i.setSelectionRange) {
          try {
            i.setSelectionRange(t + 0, t + 0)
          } catch (e) {
            s.debug('inputNativeImpl: setSelectionRange() error:' + e.message)
          }
          i.blur(),
          i.focus()
        } else i.createTextRange && (s.debug('inputNativeImpl: element has createTextRange()'), e = i.createTextRange(), e.collapse(!0), e.moveEnd('character', t), e.moveStart('character', t), e.select())
      },
      stopInput: function () {
        this.__element.blur(),
        this.__inputState = !1
      },
      isCapturing: function () {
        return this.__inputState
      },
      deinit: function () {
        this.container.deinit(),
        this.__input.deinit()
      }
    })
  }),
  define('xdk-ui-input/interface/InputDisplay', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('InputDisplay', {
      insertChar: [
        'char',
        'insertPos'
      ],
      backspace: [
      ],
      del: [
      ],
      setMaxLength: [
        'length'
      ],
      getMaxLength: [
      ],
      getText: [
      ],
      setText: [
        'text'
      ],
      clearText: [
      ],
      moveCursor: [
        'direction'
      ],
      setCursorPos: [
        'pos'
      ],
      startInput: [
      ],
      stopInput: [
      ],
      isCapturing: [
      ]
    })
  }),
  define('xdk-ui-input/InputBase', [
    'xdk-base/class',
    './interface/InputDisplay',
    'xdk-base/Element',
    'xdk-base/device',
    'xdk-base/util',
    './InputDivImpl',
    './InputNativeImpl',
    'xdk-base/Env',
    'xdk-ax/evt/type',
    'xdk-ax/Component'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    return e.create(c, [
      t
    ], {
    }, {
      __impl: null,
      __initEnvOnKey: !1,
      __bindedOnKey: null,
      __blockedKeyList: [
      ],
      init: function (e) {
        switch (e = e || {
          }, e.text = e.text || '', e.isPassword = e.isPassword || !1, e.focusable = e.focusable || !1, e.placeHolder = e.placeHolder || '', s.isUndefined(e.clickable) && (e.clickable = !0), e.passwordChar = e.passwordChar || '*', e.hideTimeout = e.hideTimeout || 0, e.root = new i('div'), e.widgetInstance = this, s.isUndefined(e.useNative) && (e.useNative = !0), n.platform) {
          case 'tizen':
          case 'toshiba':
          case 'ps3':
          case 'playstation':
          case 'sony':
          case 'panasonic':
          case 'humax':
          case 'wiiu':
          case 'tcl':
          case 'hisense':
          case 'amazon':
          case 'android':
          case 'sharp':
          case 'opera':
          case 'webos':
            e.useNative = !1;
            break;
          case 'samsung':
            if (n.id.getFirmwareYear() <= 2011) {
              e.useNative = !1;
              break
            }
        }
        this.__bindedOnKey = s.bind(function (e) {
          return this.__blockedKeyList.indexOf(e.id) > - 1 || (this.isCapturing() && e.text && this.insertChar(e.text), !0)
        }, this),
        this._super(e)
      },
      addBlockedKey: function (e) {
        var t = [
        ];
        s.isString(e) ? t.push(e) : s.isArray(e) && (t = e),
        s.each(t, s.bind(function (e) {
          - 1 === this.__blockedKeyList.indexOf(e) && this.__blockedKeyList.push(e)
        }, this))
      },
      removeBlockedKey: function (e) {
        var t = [
        ];
        s.isString(e) ? t.push(e) : s.isArray(e) && (t = e),
        s.each(t, s.bind(function (e) {
          var t = this.__blockedKeyList.indexOf(e);
          t > - 1 && this.__blockedKeyList.splice(t, 1)
        }, this))
      },
      setBlockedKey: function (e) {
        this.__blockedKeyList = [
        ],
        this.addBlockedKey(e)
      },
      insertChar: function (e, t) {
        this.__impl.insertChar(e, t)
      },
      backspace: function () {
        this.__impl.backspace()
      },
      del: function () {
        this.__impl.del()
      },
      setMaxLength: function (e) {
        this.__impl.setMaxLength(e)
      },
      getMaxLength: function () {
        return this.__impl.getMaxLength()
      },
      getText: function () {
        return this.__impl.getText()
      },
      setText: function (e) {
        this.__impl.setText(e)
      },
      clearText: function () {
        this.__impl.clearText()
      },
      setSelection: function () {
        this.getRoot().addClass('selected')
      },
      removeSelection: function () {
        this.getRoot().removeClass('selected')
      },
      isSelected: function () {
        return this.getRoot().hasClass('selected')
      },
      moveCursor: function (e) {
        this.__impl.moveCursor(e)
      },
      setCursorPos: function (e) {
        var t = this.getText().length;
        e > t ? e = t : e < 0 && (e = 0),
        this.__impl.setCursorPos(e)
      },
      startInput: function () {
        if (this.getRoot().addClass('input'), this.__impl.startInput(), !this.__initEnvOnKey) {
          var e = a.singleton();
          e.addEventListener(e.EVT_ONKEY, this.__bindedOnKey),
          this.__initEnvOnKey = !0
        }
      },
      stopInput: function () {
        this.getRoot().removeClass('input'),
        this.__impl.stopInput();
        var e = a.singleton();
        e.removeEventListener(e.EVT_ONKEY, this.__bindedOnKey),
        this.__initEnvOnKey = !1
      },
      isInput: function () {
        return this.isCapturing()
      },
      isCapturing: function () {
        return this.__impl.isCapturing()
      },
      deinit: function () {
        this.stopInput(),
        this._super(),
        this.__impl.deinit()
      }
    })
  }),
  define('xdk-ui-input/Input', [
    'xdk-base/class',
    'xdk-base/Element',
    'xdk-base/device',
    'xdk-base/util',
    './InputDivImpl',
    './InputNativeImpl',
    'xdk-base/Env',
    'xdk-ax/evt/type',
    'xdk-ui-input/InputBase'
  ], function (e, t, i, n, s, r, o, a, d) {
    'use strict';
    return e.create(d, {
    }, {
      init: function (e) {
        e = e || {
        },
        e.maxLength = n.isNumber(e.maxLength) ? e.maxLength : 20,
        e.css = e.css ? e.css + ' wgt-input' : 'wgt-input',
        this._super(e),
        e.root.addClass('wgt-input'),
        e.useNative ? this.__impl = new r(e) : this.__impl = new s(e)
      }
    })
  }),
  define('app/wgt/Button', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ax/Container',
    'xdk-ui-basic/Label'
  ], function (e, t, i, n) {
    'use strict';
    return e.create(i, {
    }, {
      _selected: !1,
      init: function (e) {
        e = e || {
        },
        this._super(e),
        this.getRoot().addClass('wgt-button'),
        this._label = new n({
          text: e.text,
          isPureText: !!e.isPureText,
          parent: this
        }),
        this._loading = new i({
          css: 'loading'
        })
      },
      setEnabled: function (e) {
        this[e ? 'enable' : 'disable']()
      },
      setLoading: function () {
        this.detach(this._label),
        this.attach(this._loading)
      },
      stopLoading: function () {
        this.detach(this._loading),
        this.attach(this._label)
      }
    })
  }),
  define('css!xdk-ui-input/css/Keyboard', [
  ], function () {
  }),
  define('xdk-ui-input/Keyboard', [
    'xdk-base/class',
    'xdk-base/console',
    'xdk-base/util',
    'xdk-base/Element',
    'xdk-ui-basic/Button',
    'xdk-ax/evt/type',
    'xdk-ax/Container',
    'xdk-ax/focusManager',
    'xdk-base/device',
    'xdk-base/Env',
    'xdk-ax/Component',
    'css!./css/Keyboard'
  ], function (e, t, i, n, s, r, o, a, d, c, l) {
    'use strict';
    var u = c.singleton();
    return e.create(o, {
      DEFAULT: 'default'
    }, {
      __keyMaps: {
      },
      __containers: {
      },
      __navMaps: {
      },
      __mapId: null,
      __focusPosition: {
      },
      onEdge: null,
      onHandler: null,
      __curRow: 0,
      __curCol: 0,
      init: function (e) {
        e.focusPosition = e.focusPosition || [
          0,
          0
        ],
        e.keyMaps = e.keyMaps || {
        },
        e.forwardFocus = e.useLastFocus || void 0,
        e.root = new n('div', {
          class : 'wgt-keyboard'
        }),
        this._super(e),
        this.__curRow = e.focusPosition[0],
        this.__curCol = e.focusPosition[1],
        i.each(e.keyMaps, i.bind(function (e) {
          this.addKeyMap(e.key, e.value)
        }, this)),
        this.addEventListener(r.KEY, i.bind(this._keyHandler, this), !0),
        this.addEventListener(r.CLICK, i.bind(this._keyHandler, this)),
        e.defaultMap ? this.switchKeyMap(e.defaultMap) : this.__keyMaps.default ? this.switchKeyMap('default') : t.warn('no default maps')
      },
      getFocusPosition: function (e) {
        return i.isUndefined(e) ? this.__focusPosition[this.getMapId()] : this.__focusPosition[e]
      },
      getFocusedKey: function (e) {
        return this.getKey(this.getFocusPosition(e))
      },
      setFocusPosition: function (e, t) {
        var i = t[0] || 0,
        n = t[1] || 0;
        this.__focusPosition[e] = [
          i,
          n
        ]
      },
      addKeyMap: function (e, i) {
        var n = this.__initKeyMap(i);
        this.__keyMaps[e] && t.warn('Specific key map ' + e + ' is already exist.'),
        this.__keyMaps[e] = n.map,
        this.__containers[e] = n.container,
        this.__focusPosition[e] = n.defaultFocus,
        n.container.addClass('wgt-keyboard-container-' + e),
        this.__navMaps[e] = this.__initNavMap(i, n.map),
        this.setFocusPosition(e, this.__focusPosition[e])
      },
      removeKeyMap: function (e) {
        if (this.getMapId() === e) return void t.warn('unable to remove the current displayMap');
        delete this.__keyMaps[e],
        delete this.__containers[e],
        delete this.__navMaps[e],
        delete this.__focusPosition[e]
      },
      switchKeyMap: function (e) {
        return this.__keyMaps[e] && this.__containers[e] && this.__navMaps[e] ? (this.detach(this.__containers[this.__mapId]), this.__mapId = e, this.attach(this.__containers[this.__mapId]), t.info('Switch successfully' + e), this.setOption('forwardFocus', this.getKey(this.getFocusPosition(e))), a.isCompChildFocused(this) && a.focus(this), !0) : (t.warn('Unable to load the id ' + e + ' as it is not exist'), !1)
      },
      __initKeyMap: function (e) {
        var t,
        n,
        s,
        r = [
        ],
        a = [
          0,
          0
        ],
        d = new o;
        return i.each(e, function (o, c) {
          r[c] = [
          ],
          i.each(o, function (l, u) {
            l.defaultFocus && (a = [
              c,
              u
            ]),
            t = this.__initKey(l),
            0 === u && t.addClass('row-begin'),
            u === o.length - 1 && t.addClass('row-end'),
            r[c][u] = t,
            n = e[c][u],
            i.isString(n) && (s = n, n = {
            }, e[c][u] = n, n.display = s),
            n.colSpan = n.colSpan || 1,
            n.rowSpan = n.rowSpan || 1,
            d.attach(t, null, null)
          }, this)
        }, this),
        {
          map: r,
          container: d,
          defaultFocus: a
        }
      },
      __initKey: function (e) {
        var n;
        if (i.isString(e) || e && !(e.display instanceof l)) n = this.__createButton(e);
         else {
          if (!(e.display instanceof l)) return void t.warn('unable to construct or assign the key into the keyboad');
          n = e.display,
          e.css && n.addClass(e.css)
        }
        return n.addClass('wgt-keyboard-comp'),
        i.isUndefined(e.rowSpan) || n.addClass('rowSpan-' + e.rowSpan),
        i.isUndefined(e.colSpan) || n.addClass('colSpan-' + e.colSpan),
        n
      },
      __createButton: function (e) {
        var n,
        r;
        return e ? (i.isString(e) ? (n = new s({
          text: e,
          isPureText: !0
        }), n.getRoot().setClass('')) : e && (r = e.display, n = new s({
          text: r,
          isPureText: !0
        }), e.css && n.getRoot().setClass(e.css), e.disable && n.disable()), n || (t.warn('unable to create the obj' + e), null)) : (t.warn('unable to create the button without any setting'), null)
      },
      __initNavMap: function (e, t) {
        var n,
        s,
        r,
        o,
        a,
        d = [
        ];
        return i.each(e, function (c, l) {
          d[l] || (d[l] = [
          ]),
          i.each(c, function (i, c) {
            for (r = i.rowSpan || 1, o = i.colSpan || 1, a = !1, e[l][c].__y = l, t[l][c].__keyboard_config = e[l][c], n = 0; n < d[l].length; n++) if (!d[l][n]) {
              d[l][n] = t[l][c],
              e[l][c].__x = n,
              a = !0;
              break
            }
            if (a || (d[l].push(t[l][c]), e[l][c].__x = d[l].length - 1, a = !0), s = e[l][c].__x, r > 1) if (o > 1) for (n = 1; n < r; n++) for (d[l + n] || (d[l + n] = [
            ]), n = s; n < o; n++) d[l][n] = t[l][c];
             else for (n = 1; n < r; n++) d[l + n] || (d[l + n] = [
            ]),
            d[l + n][s] = t[l][c];
             else if (o > 1) for (n = 1; n < o; n++) d[l][s + n] || (d[l][s + n] = t[l][c])
          })
        }),
        d
      },
      _keyHandler: function (e) {
        var i,
        n,
        s,
        o,
        c,
        l,
        h,
        _ = d.vKey,
        f = e.id,
        p = null;
        if (i = a.getCurFocus()) {
          if (n = this.__curRow, s = this.__curCol, (s > i.__keyboard_config.__x + i.__keyboard_config.colSpan - 1 || s < i.__keyboard_config.__x) && (s = i.__keyboard_config.__x), (n > i.__keyboard_config.__y + i.__keyboard_config.rowSpan - 1 || n < i.__keyboard_config.__y) && (n = i.__keyboard_config.__y), this.setFocusPosition(this.getMapId(), [
            n,
            s
          ]), e.type === r.KEY && f === _.OK.id || e.type === r.CLICK) return this.__focusPosition[this.getMapId()] = [
            n,
            s
          ],
          h = this.getKeyInfo([n,
          s]),
          h.keyId && this.onHandler ? !1 !== (l = this.onHandler(h.keyId, this.getKey([n,
          s]))) && (u.dispatchEvent(u.EVT_ONKEY, {
            id: h.keyId,
            text: l || void 0,
            source: 'soft-keyboard'
          }), !1) : (u.dispatchEvent(u.EVT_ONKEY, {
            id: h.display,
            text: h.input || h.display,
            source: 'soft-keyboard'
          }), !1);
          if (f !== _.DOWN.id && f !== _.UP.id && f !== _.LEFT.id && f !== _.RIGHT.id);
           else {
            for (; ; ) {
              switch (f) {
                case _.DOWN.id:
                  p = p || 'nextDown',
                  n++;
                  break;
                case _.UP.id:
                  n--,
                  p = p || 'nextUp';
                  break;
                case _.LEFT.id:
                  s--,
                  p = p || 'nextLeft';
                  break;
                case _.RIGHT.id:
                  s++,
                  p = p || 'nextRight'
              }
              if (!(o = this.getKey([n,
              s])) || s < 0 || n < 0) break;
              if (o && o !== i && a.isCompFocusable(o)) {
                c = o;
                break
              }
            }
            if (c) return this.__curRow = n,
            this.__curCol = s,
            this.__focusPosition[this.getMapId()] = [
              n,
              s
            ],
            a.focus(c),
            e.preventDefault(),
            !1;
            if (t.info('reach edge of the keyboard and dedicate to developer to handle'), this.onEdge && !1 === (l = this.onEdge(p, this.getFocusPosition()))) return e.preventDefault(),
            !1
          }
        }
      },
      getKeyInfo: function (e) {
        return this.getKey(e).__keyboard_config
      },
      getKey: function (e) {
        return this.__getChildByNaviMap(e)
      },
      __getChildByNaviMap: function (e) {
        return this.__getChildByMap(this.__navMaps, e)
      },
      __getChildByKeyMap: function (e) {
        return this.__getChildByMap(this.__keyMaps, e)
      },
      __getChildByMap: function (e, t) {
        var i,
        n = t[0],
        s = t[1];
        return n < 0 || s < - 1 ? null : (i = e[this.getMapId()]) && i.length <= n ? null : (i = e[this.getMapId()][n], - 1 === s && (s = e[this.getMapId()][n].length - 1), i && i.length <= s ? null : (i = e[this.getMapId()][n][s]) || null)
      },
      getMapId: function () {
        return this.__mapId
      }
    })
  }),
  define('app/wgt/Keyboard', [
    'xdk-ax/Container',
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ui-input/Keyboard'
  ], function (e, t, i, n) {
    'use strict';
    return t.create(n, {
      KEY_ID_DELETE: 'keyboard:delete',
      KEY_ID_SMALL_TO_BIG: 'keyboard:FromabcToABC',
      KEY_ID_BIG_TO_SMALL: 'keyboard:FromABCToabc',
      KEY_ID_SMALL_TO_SYMBOL: 'keyboard:FromabcToSymbol',
      KEY_ID_BIG_TO_SYMBOL: 'keyboard:FromABCToSymbol',
      KEY_ID_SYMBOL_TO_SMALL: 'keyboard:FromSymbolToabc',
      KEY_ID_SYMBOL_TO_BIG: 'keyboard:FromSymbolToABC'
    }, {
      init: function (e) {
        e = e || {
        },
        this._hideLastRow = !!e.hideLastRow,
        e.useLastFocus = e.useLastFocus || !0,
        e.keyMaps = this.getKeyMaps(),
        this._super(e),
        this.addClass('vdk-keyboard')
      },
      getKeyMaps: function () {
        var e = [
          {
            display: '=/#',
            keyId: this.constructor.KEY_ID_SMALL_TO_SYMBOL,
            css: 'symbol'
          },
          {
            input: ' ',
            css: 'icon-space',
            colSpan: 2
          },
          {
            keyId: this.constructor.KEY_ID_SMALL_TO_BIG,
            css: 'icon-uppercase',
            colSpan: 2
          },
          {
            keyId: this.constructor.KEY_ID_DELETE,
            css: 'icon-backspace'
          }
        ],
        t = i.extend([], e, !0);
        t[2].keyId = this.constructor.KEY_ID_BIG_TO_SMALL;
        var n = i.extend([], e, !0);
        n[0] = {
          keyId: this.constructor.KEY_ID_SYMBOL_TO_SMALL,
          css: 'symbol',
          display: 'abc'
        };
        var s = [
          '@',
          {
            input: '.',
            css: 'icon-fullstop'
          },
          {
            input: '-',
            css: 'icon-dash'
          },
          {
            input: '_',
            css: 'icon-underscore'
          },
          {
            display: '.com',
            input: '.com',
            css: 'small'
          },
          {
            display: '.co.nz',
            input: '.co.nz',
            css: 'small'
          }
        ],
        r = {
        default:
          [
            ['a',
            'b',
            'c',
            'd',
            'e',
            'f'],
            [
              'g',
              'h',
              'i',
              'j',
              'k',
              'l'
            ],
            [
              'm',
              'n',
              'o',
              'p',
              'q',
              'r'
            ],
            [
              's',
              't',
              'u',
              'v',
              'w',
              'x'
            ],
            [
              'y',
              'z',
              '1',
              '2',
              '3',
              '4'
            ],
            [
              '5',
              '6',
              '7',
              '8',
              '9',
              '0'
            ],
            e
          ],
          capital: [
            ['A',
            'B',
            'C',
            'D',
            'E',
            'F'],
            [
              'G',
              'H',
              'I',
              'J',
              'K',
              'L'
            ],
            [
              'M',
              'N',
              'O',
              'P',
              'Q',
              'R'
            ],
            [
              'S',
              'T',
              'U',
              'V',
              'W',
              'X'
            ],
            [
              'Y',
              'Z',
              '1',
              '2',
              '3',
              '4'
            ],
            [
              '5',
              '6',
              '7',
              '8',
              '9',
              '0'
            ],
            t
          ],
          symbol: [
            ['\\',
            '/',
            ':',
            ';',
            '(',
            ')'],
            [
              '$',
              '%',
              '^',
              '&',
              '*',
              '='
            ],
            [
              '[',
              ']',
              '#',
              '|',
              '~',
              '?'
            ],
            [
              '!',
              '-',
              '+',
              '<',
              '>',
              ','
            ],
            [
              '"',
              '`',
              '1',
              '2',
              '3',
              '4'
            ],
            [
              '5',
              '6',
              '7',
              '8',
              '9',
              '0'
            ],
            n
          ]
        };
        return this._hideLastRow || i.each(r, function (e) {
          e.value.push(s)
        }),
        r
      },
      onHandler: function (e) {
        switch (e) {
          case this.constructor.KEY_ID_BIG_TO_SMALL:
            this.setFocusPosition('default', [
              6,
              3
            ]),
            this.switchKeyMap('default');
            break;
          case this.constructor.KEY_ID_SMALL_TO_BIG:
          case this.constructor.KEY_ID_SYMBOL_TO_BIG:
            this.setFocusPosition('capital', [
              6,
              3
            ]),
            this.switchKeyMap('capital');
            break;
          case this.constructor.KEY_ID_SYMBOL_TO_SMALL:
            this.setFocusPosition('default', [
              6,
              0
            ]),
            this.switchKeyMap('default');
            break;
          case this.constructor.KEY_ID_BIG_TO_SYMBOL:
          case this.constructor.KEY_ID_SMALL_TO_SYMBOL:
            this.setFocusPosition('symbol', [
              6,
              0
            ]),
            this.switchKeyMap('symbol');
            break;
          default:
            return
        }
        return !1
      }
    })
  }),
  define('app/wgt/Login', [
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/device',
    'xdk-ax/Container',
    'xdk-ui-basic/Label',
    'xdk-ui-input/Input',
    'xdk-ax/focusManager',
    'xdk-ax/evt/type',
    'xdk-ax/mvc/view',
    'xdk-ax/mediator',
    'app/helper/helpers',
    'app/mgr/MessageDisplayHelper',
    'app/mgr/UserManager',
    'app/utils/Constants',
    'app/wgt/Button',
    'app/wgt/Keyboard',
    'app/mgr/AnalyticsManager'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p, g, v) {
    'use strict';
    var m = h.singleton(),
    E = _.singleton(),
    b = v.singleton(),
    y = f.Messages.Login;
    return e.create(s, {
    }, {
      _loginForm: null,
      _keyboard: null,
      _emailInput: null,
      _pwdInput: null,
      _activeInput: null,
      _loginBtn: null,
      _forgotPwdBtn: null,
      _loginWithFacebook: null,
      _callback: null,
      _facebookStatusCheckerTimer: null,
      _loginSuccess: !1,
      init: function (e) {
        e = e || {
        },
        e.forwardFocus = !0,
        this._callback = e.callback,
        this._onLoginSuccessCallback = e.onLoginSuccessCallback,
        this._super(e),
        this.addClass('login'),
        this._setupComponents(),
        this._addEventListeners(),
        this._updateButtons()
      },
      _setupComponents: function () {
        this._loginForm = this._initLoginFormComponent(),
        this._keyboard = this._initKeyboardComponent(),
        this._emailInput = this._loginForm.find('emailAddress'),
        this._pwdInput = this._loginForm.find('password'),
        this._loginBtn = this._loginForm.find('loginButton'),
        this._forgotPwdBtn = this._loginForm.find('forgotPasswordButton'),
        this._loginWithFacebookBtn = this._loginForm.find('loginWithFacebookButton'),
        this._attachComponents()
      },
      _attachComponents: function () {
        this.attach(this._loginForm),
        this.attach(this._keyboard)
      },
      _initKeyboardComponent: function () {
        var e = new g({
          id: '#keyboard',
          css: 'keyboard'
        });
        return e.onEdge = i.bind(function (e) {
          if ('nextLeft' === e) return a.focus(this._loginForm),
          !1
        }, this),
        e
      },
      _initLoginFormComponent: function () {
        var e = f.Messages.Buttons,
        t = {
          klass: s,
          id: '#login-form',
          css: 'login-form',
          forwardFocus: !0,
          children: [
            {
              klass: r,
              css: 'login-form__header',
              text: y.HEADER
            },
            {
              klass: s,
              css: 'login-form__fields',
              forwardFocus: 'emailAddress',
              children: [
                {
                  klass: s,
                  css: 'email',
                  forwardFocus: !0,
                  children: [
                    {
                      klass: o,
                      id: '#emailAddress',
                      css: 'input-element input-element--email',
                      maxLength: 50,
                      placeHolder: y.EMAIL,
                      focusable: !0,
                      clickable: !0,
                      useNative: !1,
                      nextRight: 'keyboard',
                      nextDown: 'password'
                    }
                  ]
                },
                {
                  klass: s,
                  css: 'password',
                  forwardFocus: !0,
                  children: [
                    {
                      klass: o,
                      id: '#password',
                      css: 'input-element input-element--password',
                      maxLength: 50,
                      placeHolder: y.PASSWORD,
                      focusable: !0,
                      clickable: !0,
                      isPassword: !0,
                      useNative: !1,
                      hideTimeout: 1,
                      nextRight: 'keyboard',
                      nextUp: 'emailAddress'
                    }
                  ]
                },
                {
                  klass: s,
                  css: 'buttons-container',
                  children: [
                    {
                      klass: p,
                      id: '#loginButton',
                      css: 'button button--primary button--fixed-170',
                      text: e.LOGIN,
                      focusable: !0,
                      clickable: !0,
                      nextRight: 'forgotPasswordButton',
                      nextDown: 'loginWithFacebookButton',
                      nextUp: 'password'
                    }
                  ]
                },
                {
                  klass: s,
                  css: 'buttons-container right-button',
                  children: [
                    {
                      klass: p,
                      id: '#forgotPasswordButton',
                      css: 'button button--primary button--fixed-170 button--forgotPassword',
                      text: e.FORGOT_PASSWORD,
                      focusable: !0,
                      clickable: !0,
                      nextUp: 'password',
                      nextDown: 'loginWithFacebookButton'
                    }
                  ]
                },
                {
                  klass: r,
                  css: 'or',
                  text: 'or'
                },
                {
                  klass: p,
                  id: '#loginWithFacebookButton',
                  css: 'button button--facebook  button--full',
                  text: e.LOGIN_WITH_FACEBOOK,
                  focusable: !0,
                  clickable: !0,
                  nextUp: 'forgotPasswordButton'
                }
              ]
            },
            {
              klass: r,
              css: 'message',
              text: y.SIGNUP_MESSAGE
            }
          ]
        };
        return c.render(t)
      },
      _addEventListeners: function () {
        this._startInputRef = i.bind(this._startInput, this),
        this._endInputRef = i.bind(this._endInput, this),
        this._keyboardOnKeyPressRef = i.bind(this._keyboardOnKeyPress, this),
        this._onLoginButtonClickedRef = i.bind(this._onLoginBtnClicked, this),
        this._onLoginWithFacebookClickedRef = i.bind(this._onLoginWithFacebookClicked, this),
        this._onForgotPwdBtnClickedRef = i.bind(this._onForgotPwdBtnClicked, this),
        this._updateButtonsRef = i.bind(this._updateButtons, this),
        this._emailInput.addEventListener(d.TEXT_CHANGED, this._updateButtonsRef),
        this._emailInput.addEventListener(d.BLUR, this._endInputRef),
        this._emailInput.addEventListener(d.KEY, this._startInputRef),
        this._pwdInput.addEventListener(d.BLUR, this._endInputRef),
        this._pwdInput.addEventListener(d.KEY, this._startInputRef),
        this._keyboard.addEventListener(d.KEY, this._keyboardOnKeyPressRef),
        this._loginBtn.addEventListener(d.CLICK, this._onLoginButtonClickedRef),
        this._loginWithFacebookBtn.addEventListener(d.CLICK, this._onLoginWithFacebookClickedRef),
        this._forgotPwdBtn.addEventListener(d.CLICK, this._onForgotPwdBtnClickedRef),
        this._emailInput.addEventListener(d.FOCUS, this._startInputRef),
        this._pwdInput.addEventListener(d.FOCUS, this._startInputRef)
      },
      _checkFacebookStatus: function (e) {
        return e = e || {
        },
        E.fbStatus(e.code).then(i.bind(this._onFacebookStatusSuccessful, this)).fail(i.bind(this._onFacebookStatusFail, this, e))
      },
      _getFacebookAlertMessage: function (e) {
        return new s({
          focusable: !0,
          children: [
            new s({
              css: 'facebook-message-container',
              children: [
                new r({
                  css: 'facebook-message',
                  text: y.GO_TO
                }),
                new r({
                  css: 'facebook-message facebook-message--link',
                  text: y.FACEBOOK_URL
                }),
                new r({
                  css: 'facebook-message',
                  text: y.LOGIN_WITH_FACEBOOK_MESSAGE
                })
              ]
            }),
            new r({
              css: 'facebook-message--code',
              text: e
            }),
            new s({
              css: 'loading'
            })
          ]
        })
      },
      _executeCallback: function () {
        i.isFunction(this._callback) && this._callback()
      },
      _getFacebookCode: function () {
        return E.fbLogin().then(i.bind(function (e) {
          this._executeCallback(),
          this._loginFacebookAlert = m.showMessage({
            title: y.LOGIN_WITH_FACEBOOK,
            content: this._getFacebookAlertMessage(e.user_code),
            closeCallback: i.bind(this.onFacebookCloseHandler, this)
          }),
          this._setFacebookStatusChecker(e)
        }, this))
      },
      _onFacebookStatusFail: function (e, t) {
        if (t = t || {
        }, t.code === f.ErrorCode.FACEBOOK_PENDING_ACTION) return void this._setFacebookStatusChecker(e);
        this._loginFacebookAlert && (this._loginFacebookAlert.close(), this._loginFacebookAlert = null),
        t.code === f.ErrorCode.FACEBOOK_SESSION_EXPIRED ? m.showMessage({
          type: h.TYPE.ALERT,
          title: y.CODE_EXPIRED,
          message: y.FACEBOOK_CODE_EXPIRED,
          contentButtons: [
            {
              buttonText: f.Messages.Buttons.GET_NEW_CODE,
              buttonClickCallback: i.bind(this._getFacebookCode, this)
            }
          ]
        }) : u.showError(f.ErrorMessage.AUTH_GENERAL)
      },
      _onFacebookStatusSuccessful: function (e) {
        return e = e || {
        },
        i.clearDelay(this._facebookStatusCheckerTimer),
        this._loginFacebookAlert && (this._loginSuccess = !0, this._loginFacebookAlert.close(), this._loginFacebookAlert = null),
        E.getProfileFromFb(e.access_token).then(i.bind(this._onLoginSuccess, this)).fail(i.bind(function (e) {
          if (this._executeCallback(), e.errorCode === f.ErrorCode.FACEBOOK_PENDING_ERROR_CODE) return void u.showError(f.ErrorMessage.FB_PENDING);
          m.showMessage({
            type: h.TYPE.ALERT,
            message: e.statusReason
          })
        }, this))
      },
      _onLoginBtnClicked: function () {
        var e = this._emailInput.getText(),
        t = this._pwdInput.getText();
        return this._loginBtn.setLoading(),
        E.login(e, t).then(i.bind(this._onLoginSuccess, this)).fail(i.bind(this._onLoginFailed, this)).complete(i.bind(function () {
          this._loginBtn.stopLoading()
        }, this))
      },
      _onLoginSuccess: function () {
        var e = E.getCurrentUser().get('profile');
        this._executeCallback(),
        m.showMessage({
          type: h.TYPE.ALERT,
          title: y.SUCCESS,
          message: y.SUCCESS_MESSAGE + e.firstName + ' ' + (e.lastName || ''),
          contentButtons: [
            {
              buttonText: f.Messages.Buttons.CONTINUE,
              buttonClickCallback: i.bind(function () {
                l.publish(f.Events.USER_SESSION_UPDATED),
                i.isFunction(this._onLoginSuccessCallback) && this._onLoginSuccessCallback()
              }, this)
            }
          ],
          footerContent: f.Messages.Buttons.CONTINUE
        })
      },
      _onLoginFailed: function () {
        u.showError(f.ErrorMessage.AUTH_GENERAL)
      },
      _onLoginWithFacebookClicked: function () {
        this._loginWithFacebookBtn.setLoading(),
        this._getFacebookCode().complete(i.bind(function () {
          this._loginWithFacebookBtn.setLoading()
        }, this))
      },
      _onForgotPwdBtnClicked: function () {
        this._forgotPwdBtn.setLoading(),
        m.showMessage({
          title: y.RESET_PASSWORD,
          message: y.RESET_PASSWORD_MESSAGE
        }),
        this._forgotPwdBtn.stopLoading()
      },
      _removeEventListeners: function () {
        this._emailInput.removeEventListener(d.TEXT_CHANGED, this._updateButtonsRef),
        this._emailInput.removeEventListener(d.BLUR, this._endInputRef),
        this._emailInput.removeEventListener(d.KEY, this._startInputRef),
        this._pwdInput.removeEventListener(d.BLUR, this._endInputRef),
        this._pwdInput.removeEventListener(d.KEY, this._startInputRef),
        this._keyboard.removeEventListener(d.KEY, this._keyboardOnKeyPressRef),
        this._loginBtn.removeEventListener(d.CLICK, this._onLoginButtonClickedRef),
        this._loginWithFacebookBtn.removeEventListener(d.CLICK, this._onLoginWithFacebookClickedRef),
        this._forgotPwdBtn.removeEventListener(d.CLICK, this._onForgotPwdBtnClickedRef),
        this._emailInput.removeEventListener(d.FOCUS, this._startInputRef),
        this._pwdInput.removeEventListener(d.FOCUS, this._startInputRef),
        this._startInputRef = null,
        this._endInputRef = null,
        this._keyboardOnKeyPressRef = null,
        this._onLoginButtonClickedRef = null,
        this._onLoginWithFacebookClickedRef = null,
        this._onForgotPwdBtnClickedRef = null,
        this._updateButtonsRef = null
      },
      _startInput: function (e) {
        e = e || {
        },
        e.id !== n.vKey.RIGHT.id && e.id !== n.vKey.OK.id || a.focus(this._keyboard);
        var t = e.target;
        this._activeInput && this._activeInput.stopInput(),
        this._activeInput = t,
        this._activeInput.startInput()
      },
      _setFacebookStatusChecker: function (e) {
        e = e || {
        };
        var n = e.interval || f.FACEBOOK_CHECKER_INTERVAL;
        return i.clearDelay(this._facebookStatusCheckerTimer),
        this._facebookStatusCheckerTimer = t.getGuid(),
        i.delay(n, this._facebookStatusCheckerTimer).then(i.bind(this._checkFacebookStatus, this, e))
      },
      _endInput: function () {
        this._activeInput.stopInput()
      },
      _keyboardOnKeyPress: function (e) {
        switch (e.id) {
          case n.vKey.BACK.id:
          case n.vKey.EXIT.id:
            i.clearDelay(this._facebookStatusCheckerTimer),
            this._endInput(),
            this._executeCallback();
            break;
          case this._keyboard.constructor.KEY_ID_DELETE:
            this._activeInput.backspace()
        }
        return !1
      },
      onFacebookCloseHandler: function () {
        i.clearDelay(this._facebookStatusCheckerTimer),
        this._loginSuccess || b.trackFacebookFailLogin('login-fail', {
        })
      },
      _updateButtons: function () {
        var e = this._emailInput.getText(),
        t = u.isEmailValid(e);
        this._loginBtn.setEnabled(t),
        t ? (this._pwdInput.setOption('nextDown', this._loginBtn), this._loginWithFacebookBtn.setOption('nextUp', this._loginBtn), this._forgotPwdBtn.setOption('nextLeft', this._loginBtn)) : (this._pwdInput.setOption('nextDown', this._forgotPwdBtn), this._loginWithFacebookBtn.setOption('nextUp', this._forgotPwdBtn), this._forgotPwdBtn.setOption('nextLeft', null))
      },
      deinit: function () {
        this._removeEventListeners(),
        this._super(),
        this._loginForm = null,
        this._emailInput = null,
        this._pwdInput = null,
        this._activeInput = null,
        this._loginBtn = null,
        this._forgotPwdBtn = null,
        this._loginWithFacebook = null,
        this._callback = null,
        this._loginFacebookAlert = null
      }
    })
  }),
  define('app/wgt/LoginButton', [
    'xdk-base/class',
    'xdk-ui-basic/Button',
    'xdk-ax/evt/type',
    'xdk-ax/mediator',
    'xdk-base/util',
    'app/helper/helpers',
    'app/mgr/UserManager',
    'app/wgt/Login',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a, d) {
    'use strict';
    var c = o.singleton();
    return e.create(t, {
    }, {
      init: function (e) {
        e.text = this._getText(),
        e.css = 'login__button',
        this._super(e),
        this._addEventListener()
      },
      _addEventListener: function () {
        this.addEventListener(i.CLICK, this._onClick),
        n.subscribe(d.Events.USER_SESSION_UPDATED, s.bind(this._finishedAction, this))
      },
      _removeEventListener: function () {
        this.removeEventListener(i.CLICK, this._onClick)
      },
      _onClick: function () {
        if (c.getLoginStatus()) return void r.openLogoutPopup(s.bind(this._logoutAction, this));
        r.openLoginPopup()
      },
      _finishedAction: function () {
        this.setText(this._getText())
      },
      _logoutAction: function () {
        return s.delay(1).then(function () {
          return c.logout()
        }).then(s.bind(this._finishedAction, this))
      },
      _getText: function () {
        var e = c.getLoginStatus(),
        t = e ? 'Logout' : 'Login';
        return e && (t = 'Hi ' + c.getCurrentUser().get('profile').firstName + ' | ' + t),
        t
      },
      deinit: function () {
        this._closeLoginPopup(),
        this._removeEventListener(),
        this._super()
      }
    })
  }),
  define('app/wgt/MainMenuButton', [
    'xdk-ax/Container',
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-base/class',
    'xdk-base/console',
    'xdk-base/device',
    'xdk-base/Element',
    'xdk-base/util',
    'xdk-ui-basic/Image',
    'xdk-ui-basic/Label'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    return n.create(e, {
    }, {
      _label: null,
      _icon: null,
      _selectedIcon: null,
      _isSelected: !1,
      init: function (t) {
        t.focusable = !0,
        t.clickable = !0,
        t.root = t.root || new o('div'),
        this._super(t),
        this.getRoot().addClass('main-menu-button'),
        this.getRoot().addClass('menu__button'),
        t.icon && (this._icon = new e({
          css: 'icon',
          src: t.icon,
          parent: this
        }), this._icon.getRoot().getHTMLElement().style.webkitMaskImage = 'url(' + t.icon + ')'),
        t.text && (this._label = new c({
          text: t.text,
          isPureText: t.isPureText || !1,
          parent: this
        }))
      },
      select: function () {
        s.info('select'),
        this.addClass('selected'),
        this._isSelected = !0
      },
      unselect: function () {
        s.info('unselect'),
        this.removeClass('selected'),
        this._isSelected = !1
      }
    })
  }),
  define('xdk-ui-grid/ScrollingGrid', [
    'xdk-base/class',
    'xdk-ui-grid/Grid',
    'xdk-ui-grid/gridStgy',
    'xdk-base/util',
    'css!./css/Grid'
  ], function (e, t, i, n) {
    'use strict';
    return e.create(t, {
    }, {
      init: function (e) {
        this._super(e);
        var s = e.alignment === t.VERTICAL;
        this.setPrereadyStgy(i.BASIC_PREREADY_STGY),
        this.setCheckScrollableStgy(i.BASIC_CHECK_SCROLLABLE_STGY),
        this.setCheckSelectableStgy(i.BASIC_CHECK_SELECTABLE_STGY),
        this.setDataMappingStgy(i.BASIC_DATA_MAPPING_STGY),
        this.setScrollEntranceStgy(n.bind(i.BASIC_SCROLL_ENTRANCE_STGY, this, s)),
        this.setScrollShiftStgy(i.BASIC_SCROLL_SHIFT_STGY),
        this.setScrollExitStgy(i.BASIC_SCROLL_EXIT_STGY),
        this.setOnUpdateStgy(i.BASIC_ONUPDATE_STGY),
        this.setKeyNavigationStgy(s ? i.BASIC_VERTICAL_KEY_NAVIGATION_STGY : i.BASIC_HORIZONTAL_KEY_NAVIGATION_STGY),
        this.setDsRangeCalculationStgy(i.BASIC_DS_RANGE_CALCULATION_STGY)
      }
    })
  }),
  define('app/wgt/MenuList', [
    'app/core/RoutableController',
    'app/mgr/MenuManager',
    'app/mgr/MessageDisplayHelper',
    'app/wgt/MainMenuButton',
    'vdk/errors/VIAError',
    'xdk-ax/evt/type',
    'xdk-ax/mediator',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/exception',
    'xdk-base/util',
    'xdk-ui-grid/ScrollingGrid'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u) {
    'use strict';
    return a.create(u, {
    }, {
      init: function (a) {
        this._super(a);
        var d = e.getAppRouter();
        this.setDisplayStgy(l.bind(function (e) {
          var a = new n({
            text: e.title
          });
          return a.addEventListener(r.CLICK, function () {
            e.navigationDestination && (o.publish(t.Event.MenuItemUpdated, e.navigationDestination), d.navigate(e.navigationDestination.destination, {
              state: e.navigationDestination.newState || null
            }).fail(function (e) {
              var t = new s(s.FACILITY.GENERAL, s.ERROR.INVALID, 'Failed to navigate.');
              throw i.singleton().showError(t),
              e
            }).done())
          }),
          a.data = e,
          this.__addButton(a),
          this.__lastSelection && this.__lastSelection.data === e && (a.select(), this.__lastSelection = a),
          a
        }, this))
      },
      selectItem: function (e) {
        if (!e) throw d.createException(c.ILLEGAL_ARGUMENT, 'No route provided.');
        var t = this.__getButton(e.destination, e.newState);
        this.__lastSelection && this.__lastSelection !== t && this.__lastSelection.unselect(),
        t && t.select(),
        this.__lastSelection = t
      },
      __addButton: function (t) {
        var i,
        n,
        s,
        r = e.getAppRouter();
        this.__buttons = this.__buttons || [
        ];
        for (var o = 0, a = this.__buttons.length; o < a; o++) if (i = this.__buttons[o], n = i.data, s = t.data, n.navigationDestination && s.navigationDestination && r.destinationEquals(n.navigationDestination, s.navigationDestination)) return void (this.__buttons[o] = t);
        this.__buttons.push(t)
      },
      __getButton: function (e, t) {
        for (var i, n = {
          destination: e,
          newState: t
        }, s = 0, r = this.__buttons.length; s < r; s++) if (i = this.__buttons[s], i.data.navigationDestination && i.data.navigationDestination.newState.pageId === n.newState.pageId) return i
      }
    })
  }),
  define('app/template/main/mainView', [
    'xdk-ax/Container',
    'xdk-ui-grid/Grid',
    'xdk-ui-basic/Layout',
    'xdk-ui-basic/Image',
    'app/wgt/LoginButton',
    'app/wgt/MenuList'
  ], function (e, t, i, n, s, r) {
    'use strict';
    return function (n) {
      return {
        klass: i,
        alignment: i.VERTICAL,
        id: '#mainView',
        children: [
          {
            klass: e,
            id: 'header',
            css: 'header',
            forwardFocus: !0,
            nextDown: 'subCtrlContainer',
            children: [
              {
                klass: e,
                css: 'header__left-container',
                children: [
                  {
                    klass: e,
                    id: '#logo-container',
                    css: 'header__logo',
                    children: [
                      {
                        klass: e,
                        css: 'icon-3now'
                      }
                    ]
                  },
                  {
                    klass: e,
                    css: 'header__menus',
                    children: [
                      {
                        klass: r,
                        id: '#mainMenu',
                        css: 'menu menu--main',
                        rows: 9,
                        cols: 1,
                        alignment: t.VERTICAL,
                        nextDown: 'subCtrlContainer'
                      }
                    ],
                    nextRight: 'login-button'
                  }
                ]
              },
              {
                klass: e,
                css: 'header__login',
                children: [
                  {
                    klass: s,
                    id: 'login-button'
                  }
                ],
                nextLeft: 'mainMenu'
              }
            ]
          },
          {
            klass: e,
            id: '#subCtrlContainer',
            forwardFocus: !0,
            css: 'sub-ctrl-container',
            nextUp: 'header',
            children: [
              {
                controller: n
              }
            ]
          }
        ]
      }
    }
  }),
  define('app/template/main/MainCtrl', [
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-ax/mediator',
    'xdk-ax/mvc/view',
    'xdk-base/class',
    'xdk-base/config',
    'xdk-ui-basic/Layout',
    'xdk-base/promise',
    'xdk-base/util',
    'app/core/RoutableController',
    'app/mgr/AppConfigManager',
    'app/mgr/MenuManager',
    'app/helper/helpers',
    './mainView'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _) {
    'use strict';
    return s.create(c, {
    }, {
      init: function () {
        var e = s.create(c, {
        }, {
          init: function () {
            this.setView(n.render({
              klass: o
            }))
          }
        });
        this.setView(n.render(_, e)),
        this._super()
      },
      setup: function (e) {
        var i = this.getView(),
        n = u.singleton(),
        s = i.find('mainMenu'),
        r = h.getProperty(e, [
          'pageData',
          'id'
        ], '');
        e.setupPending = l.singleton().getMainMenuEntryId().then(function (e) {
          var i = {
            pageId: r,
            menuId: e
          };
          return n.setMainMenu(s, i).then(function () {
            t.focus(s)
          })
        })
      },
      focusOnMainMenu: function () {
        t.focus(this.getView().find('mainMenu'))
      },
      retainView: function () {
        return !0
      }
    })
  }),
  define('app/template/maintenance/maintenanceView', [
    'xdk-ui-basic/Button',
    'xdk-ui-basic/Image',
    'xdk-ui-basic/Layout',
    'xdk-ui-basic/Label'
  ], function (e, t, i, n) {
    return function () {
      return {
        klass: i,
        id: '.maintenance-view',
        children: [
          {
            klass: t,
            css: 'bar',
            src: 'img/maintenance/bar.png'
          },
          {
            klass: n,
            id: 'maintenanceMessageTitle',
            css: 'maintenance-message-title'
          },
          {
            klass: n,
            id: 'maintenanceMessageContent',
            css: 'maintenance-message-content'
          },
          {
            klass: e,
            id: 'restartAppButton',
            text: 'Start Application'
          },
          {
            klass: n,
            id: 'maintenanceNotificationContent',
            css: 'maintenance-notification-content'
          }
        ]
      }
    }
  }),
  define('app/template/maintenance/MaintenanceCtrl', [
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-ax/mediator',
    'xdk-ax/mvc/view',
    'xdk-base/class',
    'xdk-base/util',
    'app/core/RoutableController',
    'app/mgr/AppConfigManager',
    './maintenanceView'
  ], function (e, t, i, n, s, r, o, a, d) {
    'use strict';
    var c = {
      DEFAULT: {
        TITLE: 'We\'ll be back soon!',
        MESSAGE: 'We are currently undergoing maintenance. <br> We apologize for any inconvenience and thank you for your patience.'
      },
      MAINTENANCE_END: {
        TITLE: 'We are back!',
        MESSAGE: 'The maintenance is finished. You can click the button below to start the application.'
      }
    };
    return s.create(o, {
    }, {
      init: function () {
        this.setView(n.render(d))
      },
      setup: function (i) {
        this._super(i);
        var n = this.getView();
        this.__maintenanceMessageTitle = n.find('maintenanceMessageTitle'),
        this.__maintenanceMessageContent = n.find('maintenanceMessageContent'),
        this.__maintenanceNotificationContent = n.find('maintenanceNotificationContent'),
        this.__restartAppButton = n.find('restartAppButton'),
        this.__restartAppRef = r.bind(this.__restartApp, this),
        this.__restartAppButton.addEventListener(e.CLICK, this.__restartAppRef),
        this.__restartAppButton.hide(),
        this.__addMessage(),
        t.focus(n),
        this._super(i)
      },
      __addMessage: function () {
        this.__maintenanceMessageTitle.setText(c.DEFAULT.TITLE),
        a.singleton().getStatusMessage().then(r.bind(function (e) {
          this.__maintenanceMessageContent.setText(e)
        }, this), r.bind(this.__maintenanceMessageContent.setText, this, c.DEFAULT.MESSAGE)).done()
      },
      __restartApp: function () {
        window.location.reload(!1)
      }
    })
  }),
  define('app/wgt/BrowseFilter', [
    'xdk-ax/Container',
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-ax/mvc/ModelRef',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-ui-basic/Button',
    'xdk-ui-basic/Image',
    'xdk-base/device',
    'app/helper/helpers'
  ], function (e, t, i, n, s, r, o, a, d, c, l) {
    'use strict';
    return s.create(e, {
      EVENT_FILTER_FOCUSED: 'evt:filter-selected'
    }, {
      _buttons: [
      ],
      _selectedFilterElem: null,
      _addEventListeners: function () {
        this.modelChangeRef = o.bind(function (e) {
          this._setFilters(e.newVal),
          this._setNavigation()
        }, this),
        this.model.off('change:' + this.attrsRef, this.modelChangeRef),
        this.model.on('change:' + this.attrsRef, this.modelChangeRef)
      },
      _prepareFiltersList: function (e, t) {
        var i = [
        ];
        return i.push({
          slug: 'all',
          displayName: 'All',
          filterType: '*'
        }),
        o.each(t, function (e) {
          i.push({
            slug: e.slug,
            displayName: e.displayName,
            filterType: 'channel',
            logo: e.logo || ''
          })
        }),
        o.each(e, function (e) {
          i.push({
            slug: e.slug,
            displayName: e.displayName,
            filterType: 'genre'
          })
        }),
        i
      },
      _setFilters: function (e) {
        e = e || {
        };
        var i = e.genres ? e.genres.slice() : [
        ],
        n = e.channels ? e.channels.slice() : [
        ],
        s = this._prepareFiltersList(i, n);
        o.each(s, o.bind(function (e, i) {
          var n = ' browse-filter__button--' + e.slug,
          s = e.logo ? ' browse-filter__button--has-image' : '',
          r = new a({
            text: e.displayName,
            parent: this,
            css: 'browse-filter__button' + n + s,
            id: e.slug
          });
          e.logo && new d({
            css: 'browse-filter__image',
            parent: r,
            src: l.resizeImage(e.logo, '', 54)
          }),
          this.viewportWidth = this.getViewportWidth(),
          r.index = i,
          r.addEventListener(t.FOCUS, o.bind(this._onFocusFilter, this, {
            filter: e,
            filterElem: r
          })),
          this._buttons[i] = r
        }, this))
      },
      _setNavigation: function () {
        for (var e = 0; e < this._buttons.length; e++) e > 0 ? (this._buttons[e - 1].setOption('nextRight', this._buttons[e]), this._buttons[e].setOption('nextLeft', this._buttons[e - 1])) : this._buttons[e].setOption('nextRight', this._buttons[e + 1])
      },
      _onFocusFilter: function (e) {
        var t = e.filterElem,
        i = e.filter;
        t && this._selectedFilterElem !== t && (this._selectedFilterElem && this._selectedFilterElem.removeClass('selected'), t.addClass('selected'), this._selectedFilterElem = t, this.alignTo(t), this.dispatchEvent(this.constructor.EVENT_FILTER_FOCUSED, i))
      },
      alignTo: function (e) {
        var t = e.getRoot().getHTMLElement().offsetLeft,
        i = e.getRoot().getHTMLElement().offsetWidth,
        n = t + i;
        n - this.viewportWidth > this.currentOffset ? (this.currentOffset = n - this.viewportWidth, this.getRoot().getHTMLElement().style.marginLeft = - this.currentOffset + 'px') : t < this.currentOffset && (this.currentOffset = t, this.getRoot().getHTMLElement().style.marginLeft = - this.currentOffset + 'px')
      },
      getViewportWidth: function () {
        return 0.9 * c.system.getDisplayResolution().width
      },
      findButtonFromGenre: function (e) {
        return o.find(this._buttons, function (t) {
          return t.getOption('id') === e
        })
      },
      init: function (e) {
        e = e || {
        },
        e.forwardFocus = !0,
        this.currentOffset = 0,
        this._super(e),
        e.data instanceof n && (this.model = e.data.getModel(), this.attrsRef = e.data.getAttr(), this._addEventListeners())
      }
    })
  }),
  define('xdk-ui-basic/interface/Indicator', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('Indicator', {
      update: [
        'percent'
      ],
      set: [
        'start',
        'length',
        'total'
      ]
    })
  }),
  define('xdk-ui-basic/AbstractIndicator', [
    'xdk-ui-basic/interface/Indicator',
    'xdk-base/class',
    'xdk-ax/Component',
    'xdk-ax/evt/type',
    'xdk-base/console'
  ], function (e, t, i, n, s) {
    'use strict';
    return t.createAbstract(i, [
      e
    ], {
    }, {
      update: function (e) {
        s.warn('update is not implemented in Indicator Object')
      },
      set: function (e, t, i) {
        s.warn('set is not implemented in Indicator Object')
      },
      dispatchIndicatorUpdate: function (e, t) {
        var i = {
        };
        i.reverse = e || !1,
        i.percent = t || 0,
        this.dispatchEvent(n.INDICATOR_UPDATED, i)
      }
    })
  }),
  define('css!xdk-ui-basic/css/ProgressBar', [
  ], function () {
  }),
  define('xdk-ui-basic/ProgressBar', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ui-basic/AbstractIndicator',
    'xdk-base/Element',
    'xdk-ax/evt/type',
    'css!./css/ProgressBar'
  ], function (e, t, i, n, s) {
    'use strict';
    return e.create(i, {
    }, {
      _pointer: null,
      _frontWidth: 0,
      _endWidth: 0,
      _pointerWidth: 0,
      _init: !1,
      init: function (e) {
        t.isUndefined(e) && (e = {
        }),
        e.focusable = !1,
        e.root = new n('div'),
        e.progressBarCSS = e.progressBarCSS || 'wgt-progressBar',
        e.bgCSS = e.bgCSS || 'wgt-progressBar-background',
        e.frontCSS = e.frontCSS || 'wgt-progressBar-playBar-front',
        e.playBarCSS = e.playBarCSS || 'wgt-progressBar-playBar-middle',
        e.endCSS = e.endCSS || 'wgt-progressBar-playBar-end',
        this._super(e),
        this.progressBar = this.getRoot(),
        this.progressBar.addClass(e.progressBarCSS),
        this.progressBg = new n('div'),
        this.progressBg.addClass(e.bgCSS),
        this.progressBar.append(this.progressBg),
        this.playBarDiv = new n('div'),
        this.playBarDiv.addClass('wgt-progressBar-playBarDiv'),
        this.progressBar.append(this.playBarDiv),
        this.playBar = new n('table', {
          cellpadding: '0',
          cellspacing: '0',
          border: '0'
        }),
        this.playBar.addClass('wgt-progressBar-playBar'),
        this.playBarDiv.append(this.playBar),
        this.playBartr = new n('tr'),
        this.playBar.append(this.playBartr),
        this.frontBar = new n('td'),
        this.frontBar.addClass(e.frontCSS),
        this.playBartr.append(this.frontBar),
        this.currentPlay = new n('td'),
        this.currentPlay.addClass(e.playBarCSS),
        this.playBartr.append(this.currentPlay),
        this.currentPlay.css('display', 'none'),
        this.endBar = new n('td'),
        this.endBar.addClass(e.endCSS),
        this.playBartr.append(this.endBar),
        e.pointer && (e.pointerCSS = e.pointerCSS || 'wgt-progressBar-pointer', this._pointer = new n('div'), this._pointer.addClass(e.pointerCSS), this.playBarDiv.append(this._pointer)),
        this.addEventListener(s.ATTACHED_TO_DOM, t.bind(this._onAttachedDOM, this))
      },
      _onAttachedDOM: function () {
        this._init || (this.frontBar.css('width', null), this.endBar.css('width', null), this.progressLength = this.getRoot().getHTMLElement().scrollWidth, this._frontWidth = this.frontBar.getHTMLElement().scrollWidth, this._endWidth = this.endBar.getHTMLElement().scrollWidth, this.getOption('pointer') ? (this._pointerWidth = this._pointer.getHTMLElement().scrollWidth, this.progressLength = this.progressLength - this._pointerWidth, this.frontBar.getHTMLElement().style.width = this._pointerWidth / 2 + 'px', this.endBar.getHTMLElement().style.width = this._pointerWidth / 2 + 'px') : (this._pointerWidth = 0, this.frontBar.getHTMLElement().style.width = '0px', this.endBar.getHTMLElement().style.width = '0px'), this._init = !0)
      },
      update: function (e) {
        var t = this.progressLength * e / 100,
        i = this._frontWidth + this._endWidth,
        n = 0,
        s = 0;
        this.getOption('pointer') && (t += this._pointerWidth, i -= this._pointerWidth),
        this.playBar.css('width', t + 'px'),
        this.progressLength * e / 100 < i ? (n = this.progressLength * e / 200, this.getOption('pointer') && (n += this._pointerWidth / 2), this.frontBar.css('width', n + 1 + 'px'), this.endBar.css('width', n + 'px'), this.currentPlay.css({
          width: '0px',
          visibility: 'hidden'
        })) : (n = this._frontWidth + this._endWidth, this.frontBar.css('width', this._frontWidth + 'px'), this.endBar.css('width', this._endWidth + 'px'), s = t - n, this.currentPlay.css({
          width: s + 'px',
          visibility: 'visible',
          display: ''
        }))
      },
      getProgressBg: function () {
        return this.progressBg
      }
    })
  }),
  define('app/wgt/ProgressContainer', [
    'xdk-base/class',
    'xdk-ax/Container',
    'xdk-ui-basic/ProgressBar',
    'xdk-base/util',
    'xdk-ax/evt/type'
  ], function (e, t, i, n, s) {
    'use strict';
    return e.create(t, {
    }, {
      init: function (e) {
        this._super(e),
        this.addClass('progress-container'),
        this._progress = new i({
          css: 'progress-container__progress-bar',
          playBarCSS: 'progress-container__play-bar',
          parent: this
        }),
        this._addEventListener(e)
      },
      update: function (e) {
        e = e || {
        },
        this._progress.update(e.percent || 0)
      },
      _addEventListener: function (e) {
        this._attachedEventRef = n.bind(this.update, this, e),
        this.addEventListener(s.ATTACHED_TO_DOM, this._attachedEventRef)
      },
      _removeEventListener: function () {
        this.removeEventListener(s.ATTACHED_TO_DOM, this._attachedEventRef),
        this._attachedEventRef = null
      },
      reset: function () {
        this._removeEventListener(),
        this._super()
      }
    })
  }),
  define('app/wgt/AssetItem', [
    'xdk-base/class',
    'xdk-ax/Container',
    'xdk-ui-basic/Button',
    'xdk-ui-basic/Image',
    'xdk-ui-basic/Label',
    'app/wgt/ProgressContainer',
    'xdk-base/util',
    'xdk-ax/evt/type',
    'app/model/ShowModel',
    'app/helper/helpers',
    'app/mgr/UserManager'
  ], function (e, t, i, n, s, r, o, a, d, c, l) {
    'use strict';
    var u = l.singleton();
    return e.create(i, {
      STYLE: {
        BELT: {
          WIDTH: 247,
          HEIGHT: 139
        },
        GRID: {
          WIDTH: 200,
          HEIGHT: 150
        }
      },
      DEFAULT_IMAGE: 'img/default_thumbnail.png'
    }, {
      _clickHandler: null,
      init: function (e) {
        e = e || {
        },
        e.data = e.data || {
        };
        var t = e.data;
        this.showModel = t instanceof d ? t : new d(t),
        this._style = e.style || 'belt',
        this._showThumbnail(e),
        this._showTitle(e),
        this._showProgressBar(e),
        this._showPlayButton(e),
        this._super(e),
        this.addClass('asset-item asset-item--' + this._style),
        this._addEventListener()
      },
      _showThumbnail: function (e) {
        var t,
        i,
        s,
        r = this.showModel.get('images');
        if (e.children = [
        ], !e.isBrowseAll) {
          'grid' === this._style ? (t = this.constructor.STYLE.GRID.WIDTH, i = this.constructor.STYLE.GRID.HEIGHT, s = r.showTile) : (t = this.constructor.STYLE.BELT.WIDTH, i = this.constructor.STYLE.BELT.HEIGHT, s = r.showImage),
          s = s ? c.resizeImage(s, t, i) : this.constructor.DEFAULT_IMAGE;
          var o = new n({
            css: 'asset-item__thumbnail',
            errorImg: this.constructor.DEFAULT_IMAGE,
            src: s
          });
          o.getRoot().css({
            height: i + 'px',
            width: t + 'px'
          }),
          e.children.push(o)
        }
      },
      _showTitle: function (e) {
        e = e || {
        };
        var i = e.showTitle;
        if (i || e.isBrowseAll) {
          var n = i ? 'asset-item__details' : 'asset-item__browse-all-tile',
          r = i ? 'asset-item__title' : 'asset-item__browse-all-text',
          o = [
            new s({
              css: r,
              text: this.showModel.get('showTitle') || ''
            })
          ];
          this.showModel.get('isMovie') || o.push(new s({
            css: 'asset-item__subtitle',
            text: this.showModel.get('name') || ''
          }));
          var a = new t({
            css: n,
            children: o
          });
          e.children.push(a)
        }
      },
      _showProgressBar: function (e) {
        var t = this.showModel;
        if (t.get('isResume')) {
          var i = c.calculatePercentage(t.get('currentPosition'), t.get('duration')),
          n = new r({
            css: 'asset-item__progress-bar',
            percent: i
          });
          e.children.push(n)
        }
      },
      _showPlayButton: function (e) {
        if (this.showModel.get('isVideo')) {
          var i = new t({
            css: 'asset-item__play-icon',
            children: [
              new t({
                css: 'icon icon-arrow'
              })
            ]
          });
          e.children.push(i)
        }
      },
      _addEventListener: function () {
        this._clickHandler = o.bind(this._onClick, this),
        this.addEventListener(a.CLICK, this._clickHandler)
      },
      _removeEventListener: function () {
        this.removeEventListener(a.CLICK, this._clickHandler),
        this._clickHandler = null
      },
      _onClick: function () {
        var e = this.showModel,
        t = e.get('callToAction'),
        i = e.get('isVideo');
        if (i && !u.getLoginStatus()) return void c.showLoginToWatchError(o.bind(this._onClick, this));
        if (i && e.get('isResume')) {
          var n = e.get('currentPosition');
          return void c.showContinuePopup(n, e)
        }
        if (t) {
          var s = c.getProperty(t, [
            'parameters',
            'genreSlug'
          ], '');
          return void c.navigate('BROWSE', !1, {
            genre: s
          })
        }
        var r = i ? 'FULLSCREENPLAYER' : 'DETAILS',
        a = {
          showModel: e,
          pageId: r + '-' + e.get('id')
        };
        c.navigate(r, !1, a)
      },
      deinit: function () {
        this._removeEventListener(),
        this._super()
      }
    })
  }),
  define('app/wgt/AssetGrid', [
    'xdk-base/class',
    'xdk-base/promise',
    'xdk-base/util',
    'xdk-base/device/vKey',
    'xdk-ax/data/Datasource',
    'xdk-ui-grid/ScrollingGrid',
    'xdk-ax/Container',
    'app/wgt/AssetItem',
    'xdk-ax/mediator',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    var l = c.Events;
    return e.create(o, {
    }, {
      grid: null,
      _addEventListener: function () {
        this.modelChangeRef = i.bind(function (e) {
          this._setGridContent(e.newVal)
        }, this),
        this.model.on('change:' + this.attrsRef, this.modelChangeRef)
      },
      _setGridContent: function (e) {
        var i = new s;
        return i.setDataLoader(function (i, n) {
          for (var s = [
          ], r = t.defer(), o = i; o < e.length && o < i + n; o++) s.push(e[o]);
          return r.resolve({
            data: s,
            total: e.length
          }),
          r.promise
        }),
        this.grid.setDatasource(i).then(function () {
          d.publish(l.ASSET_GRID_LOADED)
        })
      },
      _createGrid: function (e, t) {
        this.grid = new r({
          id: 'assetGrid',
          css: 'asset-grid',
          rows: e || 3,
          cols: t || 5,
          alignment: r.HORIZONTAL,
          forwardFocus: !0,
          parent: this
        }),
        this.grid.setDisplayStgy(i.bind(this._getDisplayStrategy, this)),
        this.grid.setKeyNavigationStgy(i.bind(this._keyNavigationStrategy, this))
      },
      _getDisplayStrategy: function (e) {
        return new a({
          data: e,
          style: 'grid',
          showTitle: !0
        })
      },
      _keyNavigationStrategy: function (e, t) {
        var i,
        s = t.selectedGridRow;
        switch (e) {
          case n.UP.id:
            i = s > 0 ? {
              rowChange: - 1
            }
             : {
              scroll: - 1
            };
            break;
          case n.DOWN.id:
            i = s < this.grid.getOption('rows') - 2 ? {
              rowChange: 1
            }
             : {
              scroll: 1
            };
            break;
          case n.LEFT.id:
            i = {
              colChange: - 1
            };
            break;
          case n.RIGHT.id:
            i = {
              colChange: 1
            }
        }
        return i
      },
      init: function (e) {
        e = e || {
        },
        e.data = e.data || {
        },
        this.model = e.data.getModel(),
        this.attrsRef = e.data.getAttr(),
        e.forwardFocus = !0,
        this._super(e),
        this._createGrid(e.rows, e.cols),
        this._addEventListener()
      },
      deinit: function () {
        this.grid = null,
        this._super()
      }
    })
  }),
  define('app/template/browse/browseView', [
    'xdk-ui-basic/Label',
    'xdk-ax/Container',
    'app/wgt/BrowseFilter',
    'app/wgt/AssetGrid',
    'xdk-ax/mvc/ModelRef'
  ], function (e, t, i, n, s) {
    'use strict';
    return function (e) {
      return {
        klass: t,
        id: 'browseView',
        css: 't-browse',
        forwardFocus: !0,
        children: [
          {
            klass: i,
            id: 'browseFilter',
            css: 'browse-filter',
            data: new s(e, 'filters'),
            nextDown: 'browseViewCollection'
          },
          {
            klass: n,
            id: 'browseViewCollection',
            css: 'browse-view__collection',
            forwardFocus: !0,
            data: new s(e, 'shows'),
            nextUp: 'browseFilter',
            rows: 3,
            cols: 5
          }
        ]
      }
    }
  }),
  define('app/template/browse/BrowseModel', [
    'xdk-base/class',
    'xdk-ax/mvc/Model',
    'xdk-base/util',
    'app/model/ShowModel'
  ], function (e, t, i, n) {
    'use strict';
    return e.create(t, {
      defaults: {
        filters: {
          channels: [
          ],
          genres: [
          ]
        },
        shows: [
        ]
      }
    }, {
      _parseAttrs: function (e, t) {
        switch (e) {
          case 'shows':
            return this._parseShows(t);
          default:
            return t
        }
      },
      _parseShows: function (e) {
        return e = i.isArray(e) ? e : [
        ],
        i.map(e, i.bind(function (e) {
          return new n(e)
        }, this))
      },
      set: function (e, t) {
        this._super(e, this._parseAttrs(e, t))
      }
    })
  }),
  define('app/template/browse/BrowseCtrl', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/console',
    'xdk-base/promise',
    'xdk-ax/mvc/view',
    'xdk-ax/evt/type',
    'xdk-ax/mediator',
    'xdk-ax/focusManager',
    'app/core/RoutableController',
    'xdk-ax/Container',
    'app/service/MwApiService',
    'app/wgt/BrowseFilter',
    'app/wgt/LoadingWgt',
    'app/template/browse/browseView',
    'app/template/browse/BrowseModel',
    'app/helper/helpers',
    'app/utils/Constants',
    'app/mgr/SegmentTrackingManager'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p, g, v) {
    'use strict';
    var m = l.singleton(),
    E = v.singleton(),
    b = g.Events;
    return e.create(d, {
    }, {
      _addEventListeners: function () {
        this._filterSelectionref = t.bind(this._filterSelection, this),
        this._browseFilter.addEventListener(u.EVENT_FILTER_FOCUSED, this._filterSelectionref),
        this._selectDefaultFilterRef = t.bind(this._selectDefaultFilter, this),
        o.subscribe(b.ASSET_GRID_LOADED, this._selectDefaultFilterRef)
      },
      _removeEventListeners: function () {
        this._browseFilter.removeEventListener(u.EVENT_FILTER_FOCUSED, this._filterSelectionref),
        this._filterSelectionref = null,
        o.unsubscribe(b.ASSET_GRID_LOADED, this._selectDefaultFilterRef),
        this._selectDefaultFilterRef = null
      },
      _filterSelection: function (e) {
        if (t.isObject(e)) {
          var i;
          '*' === e.filterType ? i = this._shows : 'genre' === e.filterType ? i = t.filter(this._shows, function (i) {
            return t.indexOf(i.genres, e.slug) >= 0
          }) : 'channel' === e.filterType && (i = t.filter(this._shows, function (t) {
            return t.channel === e.slug
          })),
          E.trackScreenView('browse-genre'),
          this.browseModel.set('shows', i)
        }
      },
      _loadData: function () {
        return m.getShows().then(t.bind(function (e) {
          e = e || {
          },
          this._shows = e.shows,
          this.browseModel.set('filters', {
            genres: e.genres,
            channels: e.channels
          }),
          this.browseModel.set('shows', e.shows)
        }, this)).fail(function (e) {
          p.showError(g.ErrorMessage.APP_GENERAL),
          i.error(e)
        }).done()
      },
      _selectDefaultFilter: function () {
        if (this._contextGenre) {
          var e = this._browseFilter.findButtonFromGenre(this._contextGenre);
          e && a.focus(e),
          this._contextGenre = null
        }
      },
      init: function () {
        this._super(),
        this.browseModel = new f,
        this._shows = [
        ],
        this.setView(s.render(_, this.browseModel))
      },
      setup: function (e) {
        E.trackScreenView('shows'),
        e.historyBack || (this._super(e), this._contextGenre = e.genre, this._collectionContainer = this._view.find('browseViewCollection'), this._browseFilter = this._view.find('browseFilter'))
      },
      postSetup: function (e) {
        return this._addEventListeners(),
        e.historyBack ? n.resolve() : this._loadData()
      },
      reset: function () {
        this._removeEventListeners(),
        this._super()
      }
    })
  }),
  define('app/model/BeltModel', [
    'xdk-base/class',
    'xdk-ax/mvc/Model',
    'app/model/ShowModel',
    'xdk-base/util'
  ], function (e, t, i, n) {
    'use strict';
    return e.create(t, {
      defaults: {
        title: '',
        items: [
        ],
        index: 0,
        totalBelts: 1,
        callToAction: null,
        showItemsTitle: !1,
        episodeOrder: null
      }
    }, {
      _getAttrs: function (e) {
        e = e || {
        };
        var t = e.items || [
        ];
        return {
          items: this._parseItems(t),
          index: e.index || 0,
          title: e.title || '',
          totalBelts: e.totalBelts,
          callToAction: e.callToAction,
          showItemsTitle: !!e.showItemsTitle,
          episodeOrder: e.episodeOrder
        }
      },
      _parseItems: function (e) {
        return n.map(e, function (e, t) {
          return e.index = t,
          new i(e)
        })
      },
      isValid: function () {
        return !!this.get('title') && this.get('items').length > 0
      },
      init: function (e) {
        this._super(this._getAttrs(e))
      }
    })
  }),
  define('app/wgt/AssetBelt', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ax/Container',
    'xdk-ui-basic/Label',
    'xdk-ax/evt/type',
    'xdk-ax/data/LocalDatasource',
    'xdk-base/promise',
    'xdk-ui-grid/BoundedGrid',
    'app/model/ShowModel',
    'app/wgt/AssetItem',
    'app/model/BeltModel',
    'xdk-ax/mediator',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h) {
    'use strict';
    var _ = h.Events;
    return e.create(i, {
      SHARED_CONFIG: {
      }
    }, {
      beltModel: null,
      title: null,
      beltTitle: null,
      belt: null,
      model: null,
      isLastWatchedSet: !1,
      itemIndex: 0,
      init: function (e) {
        this.beltModel = e.data instanceof l ? e.data : new l({
        }),
        this.idx = e.idx,
        this.row = e.rows || 6,
        this._super(e),
        this.beltTitle = new n({
          id: '#asset-belt-title-' + e.idx,
          css: 'asset-belt__title',
          text: this.beltModel.get('title') || '',
          parent: this
        }),
        this.__prepareGridData(),
        this.__createGrid(e),
        this.__setGrid()
      },
      __prepareGridData: function () {
        var e = this.beltModel.get('items') || [
        ],
        t = this.beltModel.get('callToAction');
        t && e.push(new d({
          index: e.length,
          name: t.title,
          callToAction: t
        }))
      },
      __createGrid: function (e) {
        var t = {
          alignment: a.VERTICAL,
          id: '#asset-belt-' + e.idx,
          css: 'asset-belt__grid',
          rows: this.row,
          cols: e.cols || 1,
          scrollFrontBoundary: e.scrollFrontBoundary || 1,
          scrollEndBoundary: e.scrollEndBoundary || 1,
          parent: this
        };
        this.belt = new a(t)
      },
      __setGrid: function () {
        var e = new r,
        i = this.beltModel.get('items') || [
        ],
        n = this.beltModel.get('index') || 0,
        s = this.beltModel.get('totalBelts') || 1,
        a = this.beltModel.get('showItemsTitle') || !1;
        a && this.belt.addClass('asset-belt__grid--showTitle');
        var d = i.length || 0,
        l = t.bind(function () {
          return o.resolve({
            from: 0,
            data: i,
            total: d
          })
        }, this);
        return e.setDataLoader(l),
        this.belt.setDisplayStgy(function (e) {
          var i = e.get('callToAction'),
          n = t.isObject(i);
          return new c({
            data: e,
            showTitle: a,
            isBrowseAll: n
          })
        }),
        this.__setDatasource(e, n, s)
      },
      __setDatasource: function (e, i, n) {
        return this.belt.setDatasource(e).then(t.bind(function () {
          i + 1 === n && u.publish(_.LAST_BELT_LOADED),
          this.__addGridEventListeners(),
          this._checkForLastWatchedEpisodeFocus()
        }, this))
      },
      _checkForLastWatchedEpisodeFocus: function () {
        if (!this.getController() || !this.getController().isHistoryBack) {
          var e = this.belt.getDatasouce()._data;
          if (e.length > 0) {
            var i = e.length;
            e.forEach(t.bind(function (e) {
              if (e.get('isLastWatched')) {
                e.set('isLastWatched', !1);
                var t = e.get('index');
                t > 0 && this.selectLastWatchedItemIndex(i, t)
              }
            }, this))
          }
        }
      },
      selectLastWatchedItemIndex: function (e, t) {
        this.belt.removeClass('shift-end'),
        this.belt.removeClass('shift-start');
        var i = 0,
        n = 0,
        s = e - t - 1,
        r = Math.min(e, 6);
        switch (this.beltModel.get('episodeOrder')) {
          case 'newest-first':
            e <= 4 || t <= 3 ? i = t : t === e - 1 && e >= 6 ? (this.belt.addClass('shift-start'), this.belt.addClass('shift-end'), i = 5, n = 2) : (this.belt.addClass('shift-start'), i = 4, n = 1);
            break;
          case 'oldest-first':
            e <= 4 || 0 === t ? i = t : t === e - 1 && e >= 6 ? (this.belt.addClass('shift-start'), this.belt.addClass('shift-end'), i = 5, n = 2) : (this.belt.addClass('shift-start'), i = 1, s <= 3 && (i = r - s - 1), n = 1)
        }
        var o = i - n;
        this.belt.select(t - o, i - o)
      },
      __onSelectionChange: function (e) {
        e.selectedGridRow > this.row - 3 ? this.belt.addClass('shift-start') : 0 === e.selectedGridRow && this.belt.removeClass('shift-start'),
        e.selectedGridRow === this.row - 1 ? this.belt.addClass('shift-end') : e.selectedGridRow < 2 && this.belt.removeClass('shift-end')
      },
      __addGridEventListeners: function () {
        this.belt.addEventListener(s.SELECTION_CHANGED, t.bind(this.__onSelectionChange, this))
      },
      __removeAllListeners: function () {
        this.belt.removeAllListeners()
      },
      deinit: function () {
        this.__removeAllListeners(),
        this._super(),
        this.beltTitle = null,
        this.belt.reset(),
        this.isLastWatchedSet = !1,
        this.belt = null,
        this.title = null,
        this.idx = null,
        this.beltModel = null
      }
    })
  }),
  define('vdk-banner/cssAnimatiedGridStgy', [
    'xdk-ax/Component',
    'xdk-ax/Container',
    'xdk-base/console',
    'xdk-base/device/vKey',
    'xdk-base/promise',
    'xdk-base/util'
  ], function (e, t, i, n, s, r) {
    var o,
    a,
    d = {
    };
    return 'ontransitionend' in window ? (o = 'transition', a = 'transitionend') : 'onwebkittransitionend' in window ? (o = 'webkitTransition', a = 'webkitTransitionEnd') : (o = !1, a = !1),
    d.CSS_SCROLL_ENTRANCE_STGY = function (i, n, s, r, o) {
      var a,
      d,
      c,
      l,
      u,
      h,
      _ = n.getChildren(),
      f = o.newRowsCount,
      p = o.gridComponents.slice(o.newRowsStart, o.newRowsStart + o.newRowsCount);
      for (a = 0; a < f; a++) {
        for (u = [
        ], d = 0; d < r.cols && (p[a] && p[a][d] && p[a][d].getRoot()); d++) u.push(p[a][d]);
        h = new t({
          css: i ? 'wgt-grid-row-v' : 'wgt-grid-row-h',
          children: u
        }),
        _.length || h.addClass('row-' + a),
        _.length > 0 && s < 0 && r.gridComponents && r.gridComponents[0] ? (l = e.PLACE_BEFORE, c = r.gridComponents[0][0].getParent()) : (l = e.PLACE_APPEND, c = null),
        n.attach(h, l, c)
      }
    },
    d.CSS_SCROLL_SHIFT_STGY = function (e, t, n, d) {
      var c,
      l,
      u = e.getChildren(),
      h = u.length,
      _ = s.defer();
      if (!t || u.length < 1) {
        var f = 'grid shifting...... do nothing for basic grid.';
        return i.info(f),
        s.resolve(f)
      }
      if (t > 0 ? u[h - 1].addClass('row-' + (h - 1)) : t < 0 && u[0].addClass('row--1'), !1 === o) {
        if (t < 0) for (c = u.length - 1; c > - 1; c--) u[c].getRoot().removeClass('row-' + (c - 1)).addClass('row-' + c);
         else for (c = 0; c < u.length; c++) u[c].getRoot().removeClass('row-' + c).addClass('row-' + (c - 1));
        _.resolve()
      } else l = t < 0 ? u[h - 1] : u[0],
      l.getRoot().addEventListener(a, function () {
        for (c = 0; c < h; c++) u[c].getRoot().removeClass('animation');
        return !1
      }, !0),
      r.defer().then(function () {
        if (t < 0) for (c = u.length - 1; c > - 1; c--) u[c].getRoot().removeClass('row-' + (c - 1)).addClass('animation').addClass('row-' + c);
         else for (c = 0; c < u.length; c++) u[c].getRoot().removeClass('row-' + c).addClass('animation').addClass('row-' + (c - 1));
        _.resolve()
      });
      return _.promise
    },
    d.CSS_SCROLL_EXIT_STGY = function (e, t, i, n) {
      var r,
      o = e.getChildren(),
      a = 0;
      if (o.length) for (t > o.length || - t > o.length ? (a = 0, r = o.length) : t > 0 ? (a = 0, r = t) : (r = o.length, a = r + t); a < r && o[a]; a++) o[a].deinit();
      return s.resolve()
    },
    d
  }),
  define('vdk-banner/CSSAnimatedGrid', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ui-grid/BoundedGrid',
    './cssAnimatiedGridStgy'
  ], function (e, t, i, n) {
    return e.create(i, {
    }, {
      init: function (e) {
        this._super(e);
        var s = e.alignment === i.VERTICAL;
        this.setScrollEntranceStgy(t.bind(this.CSS_SCROLL_ENTRANCE_STGY, this, s)),
        this.setScrollShiftStgy(n.CSS_SCROLL_SHIFT_STGY)
      },
      CSS_SCROLL_ENTRANCE_STGY: function (e, t, i, s, r) {
        i && s.data || n.CSS_SCROLL_ENTRANCE_STGY(e, t, i, s, r)
      }
    })
  }),
  define('xdk-ui-grid/loopedGridStgy', [
    'xdk-base/device/vKey',
    'xdk-ax/data/interface/Datasource'
  ], function (e, t) {
    'use strict';
    var i = function (e, t) {
      return (e % t + t) % t
    },
    n = {
    };
    return n.LOOPED_PREREADY_STGY = function (e, t) {
      t.selectedDsIndex = e * t.cols,
      t.selectedGridRow = e
    },
    n.LOOPED_CHECK_SCROLLABLE_STGY = function (e, t) {
      return !0
    },
    n.LOOPED_ONUPDATE_STGY = function (e, t, n) {
      if ('reset' === e.action) return !0;
      var s = n.getTotalCount(),
      r = t.firstSlotDsIndex,
      o = r + t.cols * t.rows - 1,
      a = e.index,
      d = e.index + e.length;
      return !('fetch' === e.action && s > t.cols * t.rows && (d < i(r, s) && d < i(o, s) || a > i(r, s) && a > i(o, s))) && (t.selectedDsIndex = r + t.selectedGridRow * t.cols + t.selectedGridCol, 0 === s && (t.selectedGridRow = - 1, t.selectedDsIndex = - 1), 'insert' === e.action && s === e.newData.length && this._prereadyStgy(t), !0)
    },
    n.LOOPED_FINITEDS_ONUPDATE_STGY = function (e, n, s) {
      if (e.action === t.ACTION.RESET) return !0;
      var r,
      o,
      a,
      d,
      c,
      l = s.getTotalCount(),
      u = n.firstSlotDsIndex,
      h = u + n.cols * n.rows - 1,
      _ = [
      ];
      if (e.action === t.ACTION.FETCH && l > n.cols * n.rows) for (_ = e.segments, a = 0; a < _.length; a++) if (r = _[a].index, o = r + _[a].length, d = i(u, l), c = i(h, l), d > c && r < d && r > c && o > c && o < d || d < c && r > d && r > c && o > d && o > c) return !1;
      return n.selectedDsIndex = u + n.selectedGridRow * n.cols + n.selectedGridCol,
      0 === l && (n.selectedGridRow = - 1, n.selectedDsIndex = - 1),
      e.action === t.ACTION.INSERT && l === e.newData.length && this._prereadyStgy(n),
      !0
    },
    n.LOOPED_CHECK_SELECTABLE_STGY = function (e, t, i, n) {
      return !(i.ds.getTotalCount() <= 0)
    },
    n.LOOPED_DATA_MAPPING_STGY = function (e, t, n, s, r) {
      return t[i(n * e.cols + s, t.length)]
    },
    n.LOOPED_BOUNDARY_KEY_NAVIGATION_STGY = function (t, i, n, s, r) {
      var o,
      a,
      d = r.selectedDsIndex,
      c = r.ds.getTotalCount(),
      l = r.selectedGridRow;
      if (t) switch (s) {
        case e.UP.id:
          return {
            colChange: - 1
          };
        case e.DOWN.id:
          return {
            colChange: 1
          };
        case e.LEFT.id:
          o = - 1;
          break;
        case e.RIGHT.id:
          o = 1
      } else switch (s) {
        case e.UP.id:
          o = - 1;
          break;
        case e.DOWN.id:
          o = 1;
          break;
        case e.LEFT.id:
          return {
            colChange: - 1
          };
        case e.RIGHT.id:
          return {
            colChange: 1
          }
      }
      return i <= 0 && n <= 0 ? {
        rowChange: o
      }
       : (a = l + o, Math.floor(d / r.cols) + o, Math.floor((c - 1) / r.cols), a < i || a >= r.rows - n ? {
        scroll: o
      }
       : {
        rowChange: o
      })
    },
    n
  }),
  define('xdk-ax/data/FiniteDatasource', [
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/util',
    'xdk-base/promise',
    'xdk-base/console',
    'xdk-base/exception',
    'xdk-ax/data/Datasource',
    'xdk-ax/data/interface/Datasource'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    function d(e, t) {
      return 0 === t ? NaN : (e % t + t) % t
    }
    return e.create(o, {
      EVT_UPDATED: o.EVT_UPDATED,
      EVT_FINITEDS_UPDATED: 'ui:finiteds:updated'
    }, {
      _load: function (e, s) {
        return i.isFunction(this._dataLoader) ? (e = e || 0, s = s || 0, this._dataLoader(e, s)) : n.reject(t.createException(r.ILLEGAL_STATE, 'Datasource: invalid data loader function.'))
      },
      getRange: function (e, t) {
        var s,
        r,
        o = this.getTotalCount(),
        a = this,
        d = [
        ],
        c = [
        ],
        l = [
        ];
        i.isUndefined(t) && (t = o);
        try {
          d = this.__updateRange(e, t)
        } catch (e) {
          return n.reject(e)
        }
        for (i.each(d, function (e) {
          c = c.concat(a.__checkFetchedData(e.from, e.to))
        }), r = n.resolve(), s = 0; s < c.length; s++) r = r.then(i.bind(function (e, t) {
          var s,
          r;
          return a.hasData(e, t) ? n.resolve() : (s = e, r = t - s, a._load(s, r).then(i.bind(function (e, t, i) {
            l.push({
              fetchOpts: {
                from: e,
                size: t
              },
              loadedObj: i
            })
          }, this, s, r)))
        }, null, c[s].from, c[s].to));
        return r.then(function () {
          i.each(l, function (e) {
            a._processFetchedData(e.fetchOpts, e.loadedObj)
          })
        }).then(i.bind(this.__getOverflowFetchedData, this, e, t))
      },
      __getOverflowFetchedData: function (e, t) {
        var i = this.getTotalCount(),
        n = [
        ],
        s = e,
        r = t,
        o = d(s, i),
        a = d(r, i);
        if (s > r && (r = i + r), r < i) return n = n.concat(this.__getFetchedData(o, r));
        for (n = n.concat(this.__getFetchedData(o, i)), s = s + i - o; r - s >= i; ) o = d(s, i),
        n = n.concat(this.__getFetchedData(0, i)),
        s += i;
        return r > s && (o = d(s, i), n = n.concat(this.__getFetchedData(o, a))),
        n
      },
      hasData: function (e, t) {
        var n = !0,
        s = [
        ];
        if (!this.__checkRange(e, t)) return !1;
        try {
          s = this.__updateRange(e, t)
        } catch (e) {
          return !1
        }
        return i.each(s, i.bind(function (e) {
          if (!(n = this.__hasFetchedData(e.from, e.to))) return i.breaker
        }, this)),
        n
      },
      fetch: function (e, s) {
        var o,
        d,
        c,
        l,
        u = [
        ],
        h = [
        ],
        _ = [
        ],
        f = [
        ],
        p = this,
        g = this.getTotalCount();
        if ( - 1 === g) return n.reject(t.createException(r.ILLEGAL_STATE, 'Datasource: Total count is not set.'));
        if (i.isNumber(s) || (s = 1), e >= g || s > g || e < 0) return n.reject(t.createException(r.ILLEGAL_ARGUMENT, 'Datasource: invalid range.'));
        o = e + s;
        try {
          h = this.__updateRange(e, o, !0)
        } catch (e) {
          return n.reject(e)
        }
        for (d = 0; d < h.length; d++) c = h[d].from,
        l = h[d].to - c,
        u.push(this._load(c, l).then(i.bind(function (e, t, i) {
          _.push({
            fetchOpts: {
              from: e,
              size: t
            },
            loadedObj: i
          }),
          f.push({
            index: e,
            newData: i.data,
            length: i.data.length
          })
        }, this, c, l)));
        return n.all(u).then(function () {
          i.each(_, function (e) {
            p._processFetchedData(e.fetchOpts, e.loadedObj)
          }),
          f.length > 0 && f[0] && p.dispatchEvent(p.constructor.EVT_UPDATED, i.extend({
            action: a.ACTION.FETCH
          }, f[0])),
          p.dispatchEvent(p.constructor.EVT_FINITEDS_UPDATED, {
            action: a.ACTION.FETCH,
            segments: f
          })
        })
      },
      remove: function (e, s) {
        var o,
        d,
        c,
        l = [
        ],
        u = [
        ],
        h = [
        ],
        _ = this;
        if (!i.isFunction(this._dataUpdater)) return n.reject(t.createException(r.ILLEGAL_STATE, 'Datasource: invalid data updater function.'));
        if (!i.isNumber(e)) return n.reject(t.createException(r.ILLEGAL_ARGUMENT, 'Datasource: invalid from index'));
        i.isNumber(s) || (s = e + 1);
        try {
          c = this.__checkRange(e, s)
        } catch (e) {
          return n.reject(e)
        }
        if (!c) return n.reject(t.createException(r.ILLEGAL_ARGUMENT, 'Datasource: invalid range.'));
        try {
          l = this.__updateRange(e, s)
        } catch (e) {
          return n.reject(e)
        }
        for (o = n.resolve(), d = l.length - 1; d > - 1; d--) o = o.then(i.bind(this._dataUpdater, this, a.ACTION.REMOVE, {
          from: l[d].from,
          to: l[d].to
        })).then(function (e) {
          if (!e) throw t.createException('Datasource: invalid data update via remove: no removed data received');
          var n = e.from,
          s = e.to;
          i.isNumber(n) && (u = _.__removeFetchedData(n, s)),
          h.push({
            index: n,
            removedData: u,
            length: u.length
          })
        });
        return l.length > 0 ? o.then(function () {
          _.dispatchEvent(_.constructor.EVT_UPDATED, i.extend({
            action: a.ACTION.REMOVE
          }, h[0])),
          _.dispatchEvent(_.constructor.EVT_FINITEDS_UPDATED, {
            action: a.ACTION.REMOVE,
            segments: h
          })
        }) : n.resolve()
      },
      insert: function (e, s) {
        var o = this.getTotalCount();
        return i.isFunction(this._dataUpdater) ? - 1 === o ? n.reject(t.createException(r.ILLEGAL_STATE, 'Datasource: Total count is not set.')) : s > o || s < 0 ? n.reject(t.createException(r.ILLEGAL_ARGUMENT, 'Datasource: invalid index.')) : (i.isArray(e) || (e = [
          e
        ]), i.isNumber(s) || (s = o), this._dataUpdater(a.ACTION.INSERT, {
          newData: e,
          from: s
        }).then(i.bind(function (e) {
          if (!e) throw t.createException('Datasource: invalid data update via insert: no new data received');
          var n = e.newData,
          s = e.index;
          i.isArray(n) && this.__insertFetchedData(s, n),
          this.dispatchEvent(this.constructor.EVT_UPDATED, {
            action: a.ACTION.INSERT,
            index: s,
            length: n.length,
            newData: n
          }),
          this.dispatchEvent(this.constructor.EVT_FINITEDS_UPDATED, {
            action: a.ACTION.INSERT,
            index: s,
            length: n.length,
            newData: n
          })
        }, this))) : n.reject(t.createException(r.ILLEGAL_STATE, 'Datasource: invalid data updater function.'))
      },
      reset: function () {
        this._super(),
        this.dispatchEvent(this.constructor.EVT_FINITEDS_UPDATED, {
          action: a.ACTION.RESET
        })
      },
      __updateRange: function (e, i, n) {
        var s,
        o = this.getTotalCount(),
        a = [
        ];
        if ( - 1 === o) throw t.createException(r.ILLEGAL_STATE, 'Datasource: Total count is not set.');
        if (0 === o) throw t.createException(r.ILLEGAL_STATE, 'Datasource: No more data.');
        return i < e && (i += o),
        i - e >= o ? (a.push({
          from: 0,
          to: o
        }), a) : (d(e, o), s = d(i, o), i > o ? n ? (a.push({
          from: e,
          to: o
        }), a.push({
          from: 0,
          to: s
        }), a) : (a.push({
          from: 0,
          to: s
        }), a.push({
          from: e,
          to: o
        }), a) : (a.push({
          from: e,
          to: i
        }), a))
      },
      __checkRange: function (e, i) {
        if ( - 1 === this.getTotalCount()) throw t.createException(r.ILLEGAL_STATE, 'Datasource: Total count is not set.');
        return !(!this.__checkIndex(e) || !this.__checkIndex(i - 1))
      },
      __checkIndex: function (e) {
        var t = this.getTotalCount();
        return - 1 !== t && !(e < 0 || e >= t)
      },
      getFetchedData: function (e) {
        var t = this.getTotalCount();
        return e < 0 || t < 1 ? null : (e = d(e, t), this._data[e])
      }
    })
  });
  define('xdk-ui-grid/LoopedGrid', [
    'xdk-base/class',
    'xdk-ui-grid/Grid',
    'xdk-ui-grid/gridStgy',
    'xdk-ui-grid/loopedGridStgy',
    'xdk-base/util',
    'xdk-ax/data/Datasource',
    'xdk-ax/data/FiniteDatasource',
    'xdk-base/promise',
    'xdk-base/core',
    'xdk-base/exception',
    'xdk-base/console',
    'css!./css/Grid'
  ], function (e, t, i, n, s, r, o, a, d, c, l) {
    'use strict';
    var u = function (e, t) {
      return 0 === t ? NaN : (e % t + t) % t
    },
    h = function (e) {
      return l.info(e),
      a.reject(e)
    };
    return e.create(t, {
    }, {
      __isFiniteDatasource: !1,
      init: function (e) {
        this._super(e);
        var r = e.alignment === t.VERTICAL,
        o = e.scrollFrontBoundary || 0,
        a = e.scrollEndBoundary || 0;
        this.setPrereadyStgy(s.bind(n.LOOPED_PREREADY_STGY, this, o)),
        this.setCheckScrollableStgy(n.LOOPED_CHECK_SCROLLABLE_STGY),
        this.setCheckSelectableStgy(s.bind(n.LOOPED_CHECK_SELECTABLE_STGY, this, o, a)),
        this.setDataMappingStgy(n.LOOPED_DATA_MAPPING_STGY),
        this.setScrollEntranceStgy(s.bind(i.BASIC_SCROLL_ENTRANCE_STGY, this, r)),
        this.setScrollShiftStgy(i.BASIC_SCROLL_SHIFT_STGY),
        this.setScrollExitStgy(i.BASIC_SCROLL_EXIT_STGY),
        this.setOnUpdateStgy(this.__onUpdateStgy),
        this.setKeyNavigationStgy(s.bind(n.LOOPED_BOUNDARY_KEY_NAVIGATION_STGY, this, r, o, a)),
        this.setDsRangeCalculationStgy(i.BASIC_DS_RANGE_CALCULATION_STGY)
      },
      __onUpdateStgy: function () {
        return this.__isFiniteDatasource ? n.LOOPED_FINITEDS_ONUPDATE_STGY.apply(this, arguments) : n.LOOPED_ONUPDATE_STGY.apply(this, arguments)
      },
      setDatasource: function (e) {
        if (!(e instanceof r)) return h('Cannot set an invalid datasource');
        if (this._ds === e) return h('Unable to set set the same datasource');
        this.__isFiniteDatasource ? this._ds && this.__datasourceListener && this._ds.removeEventListener(o.EVT_FINITEDS_UPDATED, this.__datasourceListener) : this._ds && this.__datasourceListener && this._ds.removeEventListener(r.EVT_UPDATED, this.__datasourceListener),
        this.reset(),
        this._ready = !1,
        this._ds = e,
        this.__isFiniteDatasource = e instanceof o;
        var t,
        i;
        return i = {
          selectedDsIndex: this._selectedDsIndex,
          selectedGridRow: this._selectedGridRow,
          cols: this._cols,
          rows: this._rows,
          ds: this._ds
        },
        this._prereadyStgy(i),
        this._selectedDsIndex = i.selectedDsIndex,
        this._selectedGridRow = i.selectedGridRow,
        t = this._dsRangeCalculationStgy(this._selectedDsIndex, this._selectedGridRow, i),
        this._selectedGridCol = u(this._selectedDsIndex, this._cols),
        this._firstSlotDsIndex = t.from,
        this.__datasourceListener || (this.__datasourceListener = s.bind(this._onDatasourceUpdated, this)),
        this.__isFiniteDatasource ? (this._ds.addEventListener(o.EVT_FINITEDS_UPDATED, this.__datasourceListener), - 1 === this._ds.getTotalCount() ? a.reject(d.createException(c.ILLEGAL_STATE, 'Datasource Total count is not set.')) : this.select(this._selectedDsIndex, this._selectedGridRow)) : (this._ds.addEventListener(r.EVT_UPDATED, this.__datasourceListener), - 1 === this._ds.getTotalCount() ? this._ds.getRange(t.from, t.to).then(s.bind(function () {
          return - 1 === this._ds.getTotalCount() ? h('Unable to initialize the datasource, totalCount still equals -1') : this.select(this._selectedDsIndex, this._selectedGridRow)
        }, this)) : (0 === this._ds.getTotalCount() && l.warn('tried to set an datasource 0 total count, grid can will only be updated if it\'s notified by EVT_UPDATED from datasource with new total count'), this.select(this._selectedDsIndex, this._selectedGridRow)))
      }
    })
  }),
  define('vdk-banner/CSSAnimatedLoopedGrid', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ui-grid/LoopedGrid',
    './cssAnimatiedGridStgy'
  ], function (e, t, i, n) {
    return e.create(i, {
    }, {
      init: function (e) {
        this._super(e);
        var s = e.alignment === i.VERTICAL;
        this.setScrollEntranceStgy(t.bind(n.CSS_SCROLL_ENTRANCE_STGY, this, s)),
        this.setScrollShiftStgy(n.CSS_SCROLL_SHIFT_STGY),
        this.setScrollExitStgy(n.CSS_SCROLL_EXIT_STGY)
      }
    })
  }),
  define('vdk-banner/ImageButton', [
    'xdk-ax/Container',
    'xdk-base/class',
    'xdk-base/Element',
    'xdk-base/util',
    'xdk-ui-basic/Image',
    'xdk-ui-basic/Label'
  ], function (e, t, i, n, s, r) {
    return t.create(e, {
    }, {
      __image: null,
      __text: null,
      init: function (e) {
        e.focusable = !0,
        e.clickable = !0,
        e.root = e.root || new i('div'),
        e.src = e.src || '',
        e.isPureText = e.isPureText || !1,
        this._super(e),
        this.getRoot().addClass('wgt-imageButton'),
        this.__image = new s({
          css: 'image',
          src: e.src,
          parent: this
        }),
        e.placeHolder && this.__image.setErrorCallback(n.bind(function () {
          this.__image.setSrc(e.placeHolder)
        }, this)),
        e.text && (this.__label = this.__createLabel(e.text, e.isPureText))
      },
      __createLabel: function (e, t) {
        return new r({
          text: e,
          css: 'text',
          isPureText: t,
          parent: this
        })
      },
      setText: function (e, t) {
        this.__text || (this.__text = this.__createLabel(e, t)),
        this.__text.setText(e, t)
      },
      getText: function () {
        return this.__text ? this.__text.getText() : null
      },
      setSrc: function (e) {
        this.__image.setSrc(e)
      },
      getSrc: function () {
        return this.__image.getSrc()
      }
    })
  }),
  define('css!vdk-banner/style', [
  ], function () {
  }),
  define('vdk-banner/Banner', [
    'xdk-ax/Container',
    'xdk-ax/data/LocalDatasource',
    'xdk-ax/evt/type',
    'xdk-ax/focusManager',
    'xdk-base/class',
    'xdk-base/console',
    'xdk-base/promise',
    'xdk-base/util',
    'xdk-ui-basic/Label',
    'xdk-ui-grid/BoundedGrid',
    'xdk-ui-grid/gridStgy',
    './CSSAnimatedGrid',
    './CSSAnimatedLoopedGrid',
    './ImageButton',
    'css!./style'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _) {
    return s.create(e, {
    }, {
      __currentBannerGridIndex: 0,
      __dotGridIndex: 0,
      init: function (t) {
        this._super(t),
        this.addClass('banner-container'),
        this.bannerGridContainer = new e({
          css: 'banner-grid-container',
          parent: this
        }),
        this.dotGridContainer = new e({
          id: 'dotGridContainer',
          css: 'dot-grid-container',
          parent: this
        })
      },
      setController: function (e) {
        this.__controller = e,
        this.__parentView = this.__controller.getView().getParent()
      },
      setData: function (e) {
        for (var t = 0, i = e.length; t < i; t++) e[t].index = t;
        return this.__setupBannerGrid(e).then(a.bind(function () {
          return this.__setupDotGrid(e)
        }, this))
      },
      setOnClick: function (e) {
        this.onClick = e
      },
      setBannerAutoScrolling: function () {
        this.__bannerAutoScrollingInterval && clearInterval(this.__bannerAutoScrollingInterval),
        this.__bannerAutoScrollingInterval = setInterval(a.bind(function () {
          var e = n.getCurFocus();
          e && e.isDescendantOf(this.dotGrid) || (this.__moveBannerGrid(), this.__dotGridIndex = this.__currentBannerGridIndex % this.bannerGrid.getDatasouce().getTotalCount(), this.dotGrid.select(this.__dotGridIndex).then(a.bind(function () {
            this.__controller && this.__parentView && n.getCurFocus() && !n.getCurFocus().isDescendantOf(this.__controller.getView()) && this.__parentView.setOption('forwardFocus', this.dotGrid)
          }, this)).fail(function () {
            r.info('fail to select on dot grid.')
          }).done())
        }, this), 5000)
      },
      __setupBannerGrid: function (n) {
        var s,
        r = new t,
        c = n.length;
        return c < 3 ? this.bannerGrid = new u({
          css: 2 === c ? 'banner-grid-two-items' : 'banner-grid-one-item',
          id: 'bannerGrid',
          rows: c,
          cols: 1,
          alignment: u.VERTICAL,
          focusable: !1,
          parent: this.bannerGridContainer
        }) : (this.bannerGrid = new h({
          css: 'banner-grid',
          id: 'bannerGrid',
          rows: 5,
          cols: 1,
          alignment: h.VERTICAL,
          scrollFrontBoundary: 2,
          scrollEndBoundary: 2,
          focusable: !1,
          parent: this.bannerGridContainer
        }), this.bannerGrid.setPrereadyStgy(function (e) {
          e.selectedDsIndex = 0,
          e.selectedGridRow = 2
        })),
        this.bannerGrid.setDisplayStgy(function (t) {
          var i = new _({
          }),
          n = new e({
            css: 'banner-metadata',
            parent: i
          });
          return new d({
            css: 'banner-title',
            text: t.title,
            parent: n
          }),
          new d({
            css: 'banner-description',
            text: t.description,
            parent: n
          }),
          i.metadataContainer = n,
          i.setSrc(t.asset),
          i
        }),
        this.__bannerGridOnSelectionChangedRef = a.bind(this.__bannerGridOnSelectionChanged, this),
        this.bannerGrid.addEventListener(i.SELECTION_CHANGED, this.__bannerGridOnSelectionChangedRef),
        s = function (e, t) {
          return o.resolve({
            from: 0,
            data: n,
            total: c
          })
        },
        r.setDataLoader(s),
        r.setTotalCount(c),
        this.bannerGrid.setDatasource(r)
      },
      __setupDotGrid: function (e) {
        var n,
        s,
        r = new t,
        d = e.length;
        return this.dotGrid = new c({
          css: 'dotGrid',
          id: 'dotGrid',
          rows: 1,
          cols: d,
          parent: this.dotGridContainer
        }),
        this.dotGrid.setScrollEntranceStgy(a.wrap(a.bind(l.BASIC_SCROLL_ENTRANCE_STGY, this.dotGrid, !0), function (e, t, i, n, r) {
          e(t, i, n, r),
          s = r.gridComponents[r.newRowsStart]
        })),
        this.dotGrid.setDisplayStgy(a.bind(function (e) {
          var t = new _({
            css: 'dot-button'
          });
          return t.addEventListener(i.FOCUS, a.bind(function () {
            var i = e.index - this.__dotGridIndex;
            if (0 !== i && 1 !== d) {
              if (2 === d) return this.__dotGridIndex = e.index,
              void this.bannerGrid.select(e.index, 0);
              1 === i || - 1 === i ? this.__moveBannerGrid(i) : i > 1 ? this.__moveBannerGrid( - 1) : i < - 1 && this.__moveBannerGrid(1),
              this.__parentView && this.__parentView.setOption('forwardFocus', t),
              this.__dotGridIndex = e.index
            }
          }, this)),
          t.addEventListener(i.CLICK, a.bind(this.onClick, this, e)),
          t
        }, this)),
        n = function (t, i) {
          return o.resolve({
            data: e,
            total: d
          })
        },
        r.setDataLoader(n),
        this.dotGrid.setDatasource(r).then(a.bind(function () {
          this.setOption('forwardFocus', this.dotGrid),
          this.dotGrid.setOption('nextLeft', s[s.length - 1]),
          this.dotGrid.setOption('nextRight', s[0]),
          this.__parentView && this.__parentView.setOption('forwardFocus', this.dotGrid.getSelectedComp()),
          this.setBannerAutoScrolling()
        }, this))
      },
      __moveBannerGrid: function (e) {
        var t = this.bannerGrid.getDatasouce().getTotalCount();
        if (1 !== t) {
          if (e = e || 1, 2 === t) return 0 === this.__dotGridIndex ? this.__dotGridIndex = 1 : this.__dotGridIndex = 0,
          this.__currentBannerGridIndex += e,
          void this.bannerGrid.select(this.__dotGridIndex, 0);
          this.__currentBannerGridIndex += e,
          this.bannerGrid.scroll(e)
        }
      },
      __bannerGridOnSelectionChanged: function () {
        var e,
        t = this.bannerGrid.getDatasouce().getTotalCount(),
        i = this.bannerGrid.getChildren() [0];
        if (!(t < 2)) {
          if (this.__lastMiddleBannerMetadata && (this.__lastMiddleBannerMetadata.hide(), this.__lastMiddleBannerMetadata.removeClass('display')), 2 === t) return e = i.getChildren() [this.__dotGridIndex].getChildren() [0],
          this.__lastMiddleBannerMetadata = e.metadataContainer,
          this.__lastMiddleBannerMetadata.show(),
          void a.defer().then(a.bind(function () {
            this.__lastMiddleBannerMetadata.addClass('display')
          }, this)).done();
          e = i.getChildren() [2].getChildren() [0],
          this.__lastMiddleBannerMetadata = e.metadataContainer,
          this.__lastMiddleBannerMetadata.show(),
          a.defer().then(a.bind(function () {
            this.__lastMiddleBannerMetadata.addClass('display')
          }, this)).done()
        }
      },
      reset: function () {
        this.__parentView && this.__parentView.setOption('forwardFocus', !0),
        clearInterval(this.__bannerAutoScrollingInterval),
        this.bannerGrid.addEventListener(i.SELECTION_CHANGED, this.__bannerGridOnSelectionChangedRef)
      }
    })
  }),
  define('app/wgt/BannerWgt', [
    'xdk-base/class',
    'xdk-ax/Container',
    'xdk-ui-basic/Label',
    'vdk-banner/Banner',
    'xdk-base/util',
    'xdk-ax/focusManager',
    'vdk-banner/ImageButton',
    'xdk-ax/data/LocalDatasource',
    'vdk-banner/CSSAnimatedGrid',
    'xdk-ax/evt/type',
    'xdk-base/promise',
    'xdk-base/console',
    'app/helper/helpers',
    'xdk-ax/mediator',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f) {
    'use strict';
    var p = f.Events;
    return e.create(n, {
    }, {
      init: function (e) {
        this.model = e.data.getModel(),
        this.attrsRef = e.data.getAttr(),
        e.data = e.data || {
        },
        this._super(e),
        this._addEventListener()
      },
      setData: function (e) {
        if (s.each(e, function (e, t) {
          e.index = t
        }), this.bannerGrid) {
          var t = this._prepareDs(e);
          return this._setDatasource(t)
        }
        return this.__setupBannerGrid(e)
      },
      __setupBannerGrid: function (e) {
        var i = this._prepareDs(e);
        return this.bannerGrid = new d({
          css: 'banner-grid-one-item',
          id: 'bannerGrid',
          rows: 1,
          cols: 1,
          alignment: d.VERTICAL,
          parent: this.bannerGridContainer
        }),
        this.bannerGrid.setDisplayStgy(s.bind(function (e) {
          var i = new o({
          }),
          n = h.resizeImage(e.get('images').dashboardHero, 1152),
          r = new t({
            css: 'banner-metadata',
            parent: i
          });
          return i.metadataContainer = r,
          i.setSrc(n),
          i.addEventListener(c.CLICK, s.bind(this.onClick, this, e)),
          i
        }, this)),
        this._setDatasource(i)
      },
      _setDatasource: function (e) {
        return this.bannerGrid.setDatasource(e).then(function () {
          _.publish(p.BANNER_LOADED)
        })
      },
      _prepareDs: function (e) {
        var t = new a,
        i = e.length;
        return t.setDataLoader(function () {
          return l.resolve({
            from: 0,
            data: e,
            total: i
          })
        }),
        t.setTotalCount(i),
        t
      },
      _addEventListener: function () {
        this.modelChangeRef = s.bind(function (e) {
          this.setData(e.newVal)
        }, this),
        this.model.on('change:' + this.attrsRef, this.modelChangeRef),
        this.setOnClick(function (e) {
          var t = {
            showModel: e
          };
          h.navigate('DETAILS', !1, t)
        }),
        this.bannerGridContainer.addEventListener(c.KEY, s.bind(function (e) {
          this.getController().positionCarousel( - 1, e.id, !1, 180)
        }, this))
      },
      _removeEventListener: function () {
        this.model.off('change:' + this.attrsRef, this.modelChangeRef),
        this.modelChangeRef = null
      },
      deinit: function () {
        this._removeEventListener(),
        this._super()
      }
    })
  }),
  define('app/wgt/MultiBelts', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-ax/Container',
    'xdk-ax/evt/type',
    'xdk-ax/data/LocalDatasource',
    'xdk-ax/focusManager',
    'xdk-base/promise',
    'xdk-ui-grid/BoundedGrid',
    'xdk-ax/mediator',
    'app/helper/helpers',
    'app/utils/Constants',
    './AssetBelt'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u) {
    'use strict';
    return e.create(i, {
    }, {
      _verticalGrid: null,
      model: null,
      attrsRef: null,
      _lastBeltType: null,
      _lastFocusRow: 0,
      isHistoryBackFocusReset: !1,
      init: function (e) {
        this.model = e.data.getModel(),
        this.attrsRef = e.data.getAttr(),
        this.data = e.data || [
        ],
        this._super(e),
        this.__addModelListeners()
      },
      setData: function (e) {
        if (this._verticalGrid) {
          var i = this._prepareDs(e);
          return this._setDatasource(i).then(t.defer).then(t.bind(function () {
            if (this.storedTileInfo) {
              var e = this.storedTileInfo;
              this.storedTileInfo = null;
              var i = e.beltTitle,
              n = t.findIndex(this._verticalGrid.getDatasource().getAllFetchedData(), function (e) {
                return e.get('title') === i
              }),
              s = this._verticalGrid.getDatasource().getAllFetchedData() [n];
              if (s) {
                var r = t.findIndex(s.get('items'), function (t) {
                  return t.get('id') === e.showId && t.get('videoId') === e.videoId
                });
                r >= 0 && this._verticalGrid.select(n, n).then(t.bind(function () {
                  var t = this.getSelectedComp(),
                  i = Math.min(e.row, r);
                  t.belt.select(r, i),
                  this.getController().positionCarousel(n, null, n === this._verticalGrid.getDatasource().getTotalCount() - 1)
                }, this))
              }
            }
          }, this))
        }
        return this.__initGrid(e)
      },
      selectCompByDsIndex: function (e, t) {
        return this._verticalGrid.select(e, t)
      },
      getSelectedPosition: function () {
        return this._verticalGrid.getSelectedPosition()
      },
      getSelectedDsIndex: function () {
        return this._verticalGrid.getSelectedDsIndex()
      },
      getSelectedComp: function () {
        return this._verticalGrid.getSelectedComp()
      },
      __initGrid: function (e) {
        var i = this._prepareDs(e);
        return this._verticalGrid = new a({
          id: 'multiBelts',
          css: 'multi-belts',
          rows: e.length + 10,
          cols: 1,
          forwardFocus: !0,
          alignment: a.HORIZONTAL,
          scrollFrontBoundary: 1,
          scrollEndBoundary: 1,
          parent: this
        }),
        this._verticalGrid.setDisplayStgy(t.bind(function (e) {
          var t = e.get('index');
          return new u({
            id: '#belt-' + t,
            idx: t,
            css: 'asset-belt',
            forwardFocus: !0,
            data: e
          })
        }, this)),
        this._setDatasource(i).then(t.bind(function () {
          this.__addGridListener()
        }, this))
      },
      _setDatasource: function (e) {
        return this._verticalGrid.setDatasource(e)
      },
      _prepareDs: function (e) {
        var t = new s,
        i = e.length;
        return t.setDataLoader(function () {
          return o.resolve({
            from: 0,
            data: e,
            total: i
          })
        }),
        t.setTotalCount(i),
        t
      },
      __addGridListener: function () {
        this.__onKeyRef = t.bind(this.__onKey, this),
        this.__onFocusRef = t.bind(this.__onFocus, this),
        this._verticalGrid.addEventListener(n.KEY, this.__onKeyRef),
        this._verticalGrid.addEventListener(n.SELECTION_CHANGED, this.__onFocusRef),
        this._lastEpisodeFocusRef = t.bind(this.__onFocus, this),
        d.subscribe(l.Events.LAST_WATCHED_ITEM_FOCUS, this._lastEpisodeFocusRef)
      },
      __onKey: function (e) {
        var t = this._verticalGrid.getSelectedDsIndex(),
        i = t + 1 === this._verticalGrid.getDatasource().getTotalCount(),
        n = this._verticalGrid.getSelectedComp().belt;
        this._lastBeltType = n.isLongBelt,
        this.getController() && this.getController().isHistoryBack && (this.getController().isHistoryBack = !1),
        this._lastFocusRow = n.getSelectedPosition().row,
        n.getRoot().hasClass('shift-end') ? this._lastFocusRow -= 2 : n.getRoot().hasClass('shift-start') && (this._lastFocusRow -= 1),
        this.getController().positionCarousel(this._verticalGrid.getSelectedDsIndex(), e.id, i)
      },
      __onFocus: function () {
        var e;
        if ((!this.getController() || !this.getController().isHistoryBack || this.isHistoryBackFocusReset) && (this._verticalGrid && this._verticalGrid.getSelectedData() && (e = this._verticalGrid.getSelectedComp().belt), e && e.isReady())) {
          e.getRoot().hasClass('shift-end') ? this._lastFocusRow += 2 : e.getRoot().hasClass('shift-start') && (this._lastFocusRow += 1);
          var t = e.getCompByCoor(this._lastFocusRow, 0);
          t && r.focus(t)
        }
      },
      storeClickedTileInfo: function () {
        if (this._verticalGrid && this._verticalGrid.getSelectedData()) {
          var e = this._verticalGrid.getSelectedComp();
          if (e) {
            var t = e.belt.getSelectedComp();
            if (t) {
              var i = t.showModel.get('id'),
              n = e.beltModel.get('title'),
              s = t.showModel.get('videoId');
              this.storedTileInfo = {
                showId: i,
                beltTitle: n,
                videoId: s,
                row: e.belt.getSelectedPosition().row
              }
            }
          }
        }
      },
      __addModelListeners: function () {
        this.modelChangeRef = t.bind(function (e) {
          this.setData(e.newVal)
        }, this),
        this.model.on('change:' + this.attrsRef, this.modelChangeRef)
      },
      __removeAllListeners: function () {
        this.model.off('change:' + this.attrsRef, this.modelChangeRef),
        this.modelChangeRef = null,
        this._verticalGrid.removeEventListener(n.KEY, this.__onKeyRef),
        this._verticalGrid.removeEventListener(n.SELECTION_CHANGED, this.__onFocusRef),
        d.unsubscribe(l.Events.LAST_WATCHED_ITEM_FOCUS, this._lastEpisodeFocusRef),
        this._lastEpisodeFocusRef = null
      },
      deinit: function () {
        this.__removeAllListeners(),
        this._super(),
        this._verticalGrid.reset(),
        this._lastBeltType = null,
        this._lastFocusRow = 1,
        this.model = null,
        this.isHistoryBackFocusReset = !1
      }
    })
  }),
  define('app/template/home/homeView', [
    'xdk-ax/Container',
    'xdk-ax/mvc/ModelRef',
    'app/wgt/AssetBelt',
    'app/wgt/BannerWgt',
    'app/wgt/MultiBelts'
  ], function (e, t, i, n, s) {
    'use strict';
    return function (i) {
      return {
        klass: e,
        id: 'homeContainer',
        css: 'home__container',
        children: [
          {
            klass: n,
            id: 'heroBanner',
            data: new t(i, 'bannerItem'),
            nextDown: 'multiBelts'
          },
          {
            klass: s,
            id: 'multiBelts',
            data: new t(i, 'sections'),
            nextUp: 'heroBanner'
          }
        ]
      }
    }
  }),
  define('app/template/home/HomeModel', [
    'xdk-base/class',
    'xdk-ax/mvc/Model',
    'xdk-base/util',
    'app/model/ShowModel',
    'app/model/BeltModel'
  ], function (e, t, i, n, s) {
    'use strict';
    return e.create(t, {
      defaults: {
        bannerItem: [
        ],
        sections: [
        ]
      }
    }, {
      _parseAttrs: function (e, t) {
        switch (e) {
          case 'bannerItem':
            return this._parseBanner(t);
          case 'sections':
            return this._parseSections(t);
          default:
            return t
        }
      },
      _parseBanner: function (e) {
        return e.map(function (e) {
          return new n(e)
        })
      },
      _parseSections: function (e) {
        return i.map(e, function (t, i) {
          return t.index = i,
          t.totalBelts = e.length,
          new s(t)
        })
      },
      set: function (e, t) {
        this._super(e, this._parseAttrs(e, t))
      },
      init: function () {
        this._super(this.constructor.defaults)
      }
    })
  }),
  define('app/template/home/HomeCtrl', [
    'app/core/RoutableController',
    'app/mgr/UserManager',
    'xdk-ax/focusManager',
    'vdk/errors/LocalErrorConfig',
    'vdk/errors/VIAError',
    'xdk-ax/mvc/view',
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/promise',
    'app/template/home/homeView',
    'app/template/home/HomeModel',
    'app/service/MwApiService',
    'xdk-ax/mediator',
    'xdk-base/console',
    'app/utils/Constants',
    'app/helper/helpers',
    'app/wgt/LoadingWgt',
    'app/mgr/SegmentTrackingManager'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p, g, v) {
    'use strict';
    var m = u.singleton(),
    E = t.singleton(),
    b = v.singleton(),
    y = f.Home.CONTINUE_WATCHLIST_TITLE,
    k = f.Events;
    return o.create(e, {
    }, {
      init: function () {
        this._super(),
        this.model = new l,
        this.setView(r.render(c, this.model))
      },
      setup: function (e) {
        if (this._isLoaded = !1, b.trackScreenView('dashboard'), e.historyBack) return void this._resetView();
        this._super(e);
        var t = this.getView();
        this.container = t.find('homeContainer'),
        this.banner = t.find('heroBanner'),
        this.multiBelts = t.find('multiBelts')
      },
      postSetup: function (e) {
        if (this._isLoaded) return d.resolve();
        this._isLoaded = !0;
        var t = e.historyBack,
        i = E.getLoginStatus() || !t ? this._loadData(t) : d.resolve();
        return this._addEventListeners(t),
        i.then(a.bind(this._postLoadData, this, t)).done()
      },
      positionCarousel: function (e, t, i) {
        p.positionCarousel(this.container, e, t, i, 180)
      },
      _loadData: function (e) {
        var t = E.getLoginStatus(),
        i = [
        ];
        return e && this.dashboardResponse ? i.push(d.resolve(this.dashboardResponse)) : i.push(m.getDashboard()),
        t && (i.push(m.getWatchingList()), i.push(m.getHistory())),
        d.all(i).spread(a.bind(function (e, t, i) {
          e = e || {
          },
          this.dashboardResponse = a.clone(e, !0);
          var n = p.getProperty(t, 'history', [
          ]),
          s = p.getProperty(i, 'history', [
          ]);
          if (n.length > 0 && s.length > 0) {
            var r,
            o = [
            ];
            a.each(n, function (e) {
              (r = a.find(s, function (t) {
                return t.videoId === e.videoId
              })) && !r.isComplete && (e.isResume = !0, e.currentPosition = r.currentPosition, o.push(e))
            });
            var d = {
              title: y,
              items: o,
              showItemsTitle: !0
            };
            e.sections.splice(1, 0, d)
          }
          this.sections = a.clone(e.sections, !0)
        }, this)).fail(function (e) {
          p.showError(f.ErrorMessage.APP_GENERAL),
          _.error(e)
        })
      },
      _postLoadData: function () {
        this._setDetailsModel()
      },
      _setDetailsModel: function () {
        this.model.set('bannerItem', [
          this.dashboardResponse.heroItem
        ]),
        this.model.set('sections', this.sections)
      },
      _resetView: function () {
        g.open(),
        p.scrollToTop(this.container)
      },
      _ensureHistoryFocus: function () {
        i.focus(this.banner)
      },
      _onSessionUpdate: function () {
        return this._resetView(),
        this._loadData().then(a.bind(this._postLoadData, this)).done()
      },
      _onLastBeltLoaded: function () {
        g.close()
      },
      _addEventListeners: function (e) {
        this._onSessionUpdateRef = a.bind(this._onSessionUpdate, this),
        h.subscribe(k.USER_SESSION_UPDATED, this._onSessionUpdateRef),
        this._onLastBeltLoadedRef = a.bind(this._onLastBeltLoaded, this),
        h.subscribe(k.LAST_BELT_LOADED, this._onLastBeltLoadedRef),
        e && (this.__ensureHistoryFocusRef = a.bind(this._ensureHistoryFocus, this), h.subscribe(k.BANNER_LOADED, this.__ensureHistoryFocusRef))
      },
      _removeEventListeners: function () {
        h.unsubscribe(k.USER_SESSION_UPDATED, this._onSessionUpdateRef),
        h.unsubscribe(k.BANNER_LOADED, this.__ensureHistoryFocusRef),
        h.unsubscribe(k.LAST_BELT_LOADED, this._onLastBeltLoadedRef),
        this._onSessionUpdateRef = null,
        this._ensureHistoryFocusRef = null,
        this._onLastBeltLoadedRef = null
      },
      reset: function () {
        this.multiBelts.storeClickedTileInfo(),
        this._isLoaded = !1,
        this._super(),
        this._removeEventListeners()
      }
    })
  }),
  define('app/template/search/searchView', [
    'xdk-ax/Container',
    'xdk-ax/mvc/ModelRef',
    'xdk-ui-basic/Label',
    'xdk-ui-input/Input',
    'app/utils/Constants',
    'app/wgt/AssetGrid',
    'app/wgt/Keyboard'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    return function (a) {
      return {
        klass: e,
        id: 'searchView',
        css: 'search-view-container',
        forwardFocus: !0,
        children: [
          {
            klass: e,
            id: 'searchMenu',
            css: 'search-menu',
            forwardFocus: !0,
            nextRight: 'resultsContainer',
            children: [
              {
                klass: n,
                id: '#searchInput',
                css: 'input-element input-element--search search-input',
                maxLength: 50,
                useNative: !1,
                clickable: !0,
                placeHolder: s.Messages.Search.SEARCH_FOR
              },
              {
                klass: o,
                id: 'searchKeyboard',
                css: 'search-keyboard',
                hideLastRow: !0
              }
            ]
          },
          {
            klass: e,
            id: 'resultsContainer',
            css: 'result-container',
            nextUp: '#mainMenu',
            forwardFocus: !0,
            children: [
              {
                klass: e,
                id: 'searchIcon',
                css: 'search-icon icon icon-search'
              },
              {
                klass: i,
                id: 'message',
                css: 'message'
              },
              {
                klass: i,
                id: 'searchGridTitle',
                css: 'search-grid-title'
              },
              {
                klass: r,
                id: 'searchResultGrid',
                css: 'search-result-grid',
                forwardFocus: !0,
                data: new t(a, 'shows'),
                nextUp: '#mainMenu',
                nextLeft: 'searchMenu',
                rows: 3,
                cols: 3
              }
            ]
          }
        ]
      }
    }
  }),
  function (e, t) {
    'object' == typeof exports && 'object' == typeof module ? module.exports = t() : 'function' == typeof define && define.amd ? define('Fuse', [
    ], t) : 'object' == typeof exports ? exports.Fuse = t() : e.Fuse = t()
  }(this, function () {
    return function (e) {
      function t(n) {
        if (i[n]) return i[n].exports;
        var s = i[n] = {
          i: n,
          l: !1,
          exports: {
          }
        };
        return e[n].call(s.exports, s, s.exports, t),
        s.l = !0,
        s.exports
      }
      var i = {
      };
      return t.m = e,
      t.c = i,
      t.i = function (e) {
        return e
      },
      t.d = function (e, i, n) {
        t.o(e, i) || Object.defineProperty(e, i, {
          configurable: !1,
          enumerable: !0,
          get: n
        })
      },
      t.n = function (e) {
        var i = e && e.__esModule ? function () {
          return e.default
        }
         : function () {
          return e
        };
        return t.d(i, 'a', i),
        i
      },
      t.o = function (e, t) {
        return Object.prototype.hasOwnProperty.call(e, t)
      },
      t.p = '',
      t(t.s = 8)
    }([function (e, t, i) {
      'use strict';
      e.exports = function (e) {
        return '[object Array]' === Object.prototype.toString.call(e)
      }
    },
    function (e, t, i) {
      'use strict';
      function n(e, t) {
        if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function')
      }
      var s = function () {
        function e(e, t) {
          for (var i = 0; i < t.length; i++) {
            var n = t[i];
            n.enumerable = n.enumerable || !1,
            n.configurable = !0,
            'value' in n && (n.writable = !0),
            Object.defineProperty(e, n.key, n)
          }
        }
        return function (t, i, n) {
          return i && e(t.prototype, i),
          n && e(t, n),
          t
        }
      }(),
      r = i(5),
      o = i(7),
      a = i(4),
      d = function () {
        function e(t, i) {
          var s = i.location,
          r = void 0 === s ? 0 : s,
          o = i.distance,
          d = void 0 === o ? 100 : o,
          c = i.threshold,
          l = void 0 === c ? 0.6 : c,
          u = i.maxPatternLength,
          h = void 0 === u ? 32 : u,
          _ = i.isCaseSensitive,
          f = void 0 !== _ && _,
          p = i.tokenSeparator,
          g = void 0 === p ? / +/g : p,
          v = i.findAllMatches,
          m = void 0 !== v && v,
          E = i.minMatchCharLength,
          b = void 0 === E ? 1 : E;
          n(this, e),
          this.options = {
            location: r,
            distance: d,
            threshold: l,
            maxPatternLength: h,
            isCaseSensitive: f,
            tokenSeparator: g,
            findAllMatches: m,
            minMatchCharLength: b
          },
          this.pattern = this.options.isCaseSensitive ? t : t.toLowerCase(),
          this.pattern.length <= h && (this.patternAlphabet = a(this.pattern))
        }
        return s(e, [
          {
            key: 'search',
            value: function (e) {
              if (this.options.isCaseSensitive || (e = e.toLowerCase()), this.pattern === e) return {
                isMatch: !0,
                score: 0,
                matchedIndices: [
                  [0,
                  e.length - 1]
                ]
              };
              var t = this.options,
              i = t.maxPatternLength,
              n = t.tokenSeparator;
              if (this.pattern.length > i) return r(e, this.pattern, n);
              var s = this.options,
              a = s.location,
              d = s.distance,
              c = s.threshold,
              l = s.findAllMatches,
              u = s.minMatchCharLength;
              return o(e, this.pattern, this.patternAlphabet, {
                location: a,
                distance: d,
                threshold: c,
                findAllMatches: l,
                minMatchCharLength: u
              })
            }
          }
        ]),
        e
      }();
      e.exports = d
    },
    function (e, t, i) {
      'use strict';
      var n = i(0),
      s = function e(t, i, s) {
        if (i) {
          var r = i.indexOf('.'),
          o = i,
          a = null;
          - 1 !== r && (o = i.slice(0, r), a = i.slice(r + 1));
          var d = t[o];
          if (null !== d && void 0 !== d) if (a || 'string' != typeof d && 'number' != typeof d) if (n(d)) for (var c = 0, l = d.length; c < l; c += 1) e(d[c], a, s);
           else a && e(d, a, s);
           else s.push(d.toString())
        } else s.push(t);
        return s
      };
      e.exports = function (e, t) {
        return s(e, t, [
        ])
      }
    },
    function (e, t, i) {
      'use strict';
      e.exports = function () {
        for (var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [
        ], t = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1, i = [
        ], n = - 1, s = - 1, r = 0, o = e.length; r < o; r += 1) {
          var a = e[r];
          a && - 1 === n ? n = r : a || - 1 === n || (s = r - 1, s - n + 1 >= t && i.push([n,
          s]), n = - 1)
        }
        return e[r - 1] && r - n >= t && i.push([n,
        r - 1]),
        i
      }
    },
    function (e, t, i) {
      'use strict';
      e.exports = function (e) {
        for (var t = {
        }, i = e.length, n = 0; n < i; n += 1) t[e.charAt(n)] = 0;
        for (var s = 0; s < i; s += 1) t[e.charAt(s)] |= 1 << i - s - 1;
        return t
      }
    },
    function (e, t, i) {
      'use strict';
      e.exports = function (e, t) {
        var i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : / +/g,
        n = new RegExp(t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, '\\$&').replace(i, '|')),
        s = e.match(n),
        r = !!s,
        o = [
        ];
        if (r) for (var a = 0, d = s.length; a < d; a += 1) {
          var c = s[a];
          o.push([e.indexOf(c),
          c.length - 1])
        }
        return {
          score: r ? 0.5 : 1,
          isMatch: r,
          matchedIndices: o
        }
      }
    },
    function (e, t, i) {
      'use strict';
      e.exports = function (e, t) {
        var i = t.errors,
        n = void 0 === i ? 0 : i,
        s = t.currentLocation,
        r = void 0 === s ? 0 : s,
        o = t.expectedLocation,
        a = void 0 === o ? 0 : o,
        d = t.distance,
        c = void 0 === d ? 100 : d,
        l = n / e.length,
        u = Math.abs(a - r);
        return c ? l + u / c : u ? 1 : l
      }
    },
    function (e, t, i) {
      'use strict';
      var n = i(6),
      s = i(3);
      e.exports = function (e, t, i, r) {
        for (var o = r.location, a = void 0 === o ? 0 : o, d = r.distance, c = void 0 === d ? 100 : d, l = r.threshold, u = void 0 === l ? 0.6 : l, h = r.findAllMatches, _ = void 0 !== h && h, f = r.minMatchCharLength, p = void 0 === f ? 1 : f, g = a, v = e.length, m = u, E = e.indexOf(t, g), b = t.length, y = [
        ], k = 0; k < v; k += 1) y[k] = 0;
        if ( - 1 !== E) {
          var S = n(t, {
            errors: 0,
            currentLocation: E,
            expectedLocation: g,
            distance: c
          });
          if (m = Math.min(S, m), - 1 !== (E = e.lastIndexOf(t, g + b))) {
            var x = n(t, {
              errors: 0,
              currentLocation: E,
              expectedLocation: g,
              distance: c
            });
            m = Math.min(x, m)
          }
        }
        E = - 1;
        for (var T = [
        ], C = 1, A = b + v, w = 1 << b - 1, I = 0; I < b; I += 1) {
          for (var L = 0, R = A; L < R; ) n(t, {
            errors: I,
            currentLocation: g + R,
            expectedLocation: g,
            distance: c
          }) <= m ? L = R : A = R,
          R = Math.floor((A - L) / 2 + L);
          A = R;
          var P = Math.max(1, g - R + 1),
          D = _ ? v : Math.min(g + R, v) + b,
          O = Array(D + 2);
          O[D + 1] = (1 << I) - 1;
          for (var M = D; M >= P; M -= 1) {
            var N = M - 1,
            F = i[e.charAt(N)];
            if (F && (y[N] = 1), O[M] = (O[M + 1] << 1 | 1) & F, 0 !== I && (O[M] |= (T[M + 1] | T[M]) << 1 | 1 | T[M + 1]), O[M] & w && (C = n(t, {
              errors: I,
              currentLocation: N,
              expectedLocation: g,
              distance: c
            })) <= m) {
              if (m = C, (E = N) <= g) break;
              P = Math.max(1, 2 * g - E)
            }
          }
          if (n(t, {
            errors: I + 1,
            currentLocation: g,
            expectedLocation: g,
            distance: c
          }) > m) break;
          T = O
        }
        return {
          isMatch: E >= 0,
          score: 0 === C ? 0.001 : C,
          matchedIndices: s(y, p)
        }
      }
    },
    function (e, t, i) {
      'use strict';
      function n(e, t) {
        if (!(e instanceof t)) throw new TypeError('Cannot call a class as a function')
      }
      var s = function () {
        function e(e, t) {
          for (var i = 0; i < t.length; i++) {
            var n = t[i];
            n.enumerable = n.enumerable || !1,
            n.configurable = !0,
            'value' in n && (n.writable = !0),
            Object.defineProperty(e, n.key, n)
          }
        }
        return function (t, i, n) {
          return i && e(t.prototype, i),
          n && e(t, n),
          t
        }
      }(),
      r = i(1),
      o = i(2),
      a = i(0),
      d = function () {
        function e(t, i) {
          var s = i.location,
          r = void 0 === s ? 0 : s,
          a = i.distance,
          d = void 0 === a ? 100 : a,
          c = i.threshold,
          l = void 0 === c ? 0.6 : c,
          u = i.maxPatternLength,
          h = void 0 === u ? 32 : u,
          _ = i.caseSensitive,
          f = void 0 !== _ && _,
          p = i.tokenSeparator,
          g = void 0 === p ? / +/g : p,
          v = i.findAllMatches,
          m = void 0 !== v && v,
          E = i.minMatchCharLength,
          b = void 0 === E ? 1 : E,
          y = i.id,
          k = void 0 === y ? null : y,
          S = i.keys,
          x = void 0 === S ? [
          ] : S,
          T = i.shouldSort,
          C = void 0 === T || T,
          A = i.getFn,
          w = void 0 === A ? o : A,
          I = i.sortFn,
          L = void 0 === I ? function (e, t) {
            return e.score - t.score
          }
           : I,
          R = i.tokenize,
          P = void 0 !== R && R,
          D = i.matchAllTokens,
          O = void 0 !== D && D,
          M = i.includeMatches,
          N = void 0 !== M && M,
          F = i.includeScore,
          B = void 0 !== F && F,
          G = i.verbose,
          U = void 0 !== G && G;
          n(this, e),
          this.options = {
            location: r,
            distance: d,
            threshold: l,
            maxPatternLength: h,
            isCaseSensitive: f,
            tokenSeparator: g,
            findAllMatches: m,
            minMatchCharLength: b,
            id: k,
            keys: x,
            includeMatches: N,
            includeScore: B,
            shouldSort: C,
            getFn: w,
            sortFn: L,
            verbose: U,
            tokenize: P,
            matchAllTokens: O
          },
          this.setCollection(t)
        }
        return s(e, [
          {
            key: 'setCollection',
            value: function (e) {
              return this.list = e,
              e
            }
          },
          {
            key: 'search',
            value: function (e) {
              this._log('---------\nSearch pattern: "' + e + '"');
              var t = this._prepareSearchers(e),
              i = t.tokenSearchers,
              n = t.fullSearcher,
              s = this._search(i, n),
              r = s.weights,
              o = s.results;
              return this._computeScore(r, o),
              this.options.shouldSort && this._sort(o),
              this._format(o)
            }
          },
          {
            key: '_prepareSearchers',
            value: function () {
              var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : '',
              t = [
              ];
              if (this.options.tokenize) for (var i = e.split(this.options.tokenSeparator), n = 0, s = i.length; n < s; n += 1) t.push(new r(i[n], this.options));
              return {
                tokenSearchers: t,
                fullSearcher: new r(e, this.options)
              }
            }
          },
          {
            key: '_search',
            value: function () {
              var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [
              ],
              t = arguments[1],
              i = this.list,
              n = {
              },
              s = [
              ];
              if ('string' == typeof i[0]) {
                for (var r = 0, o = i.length; r < o; r += 1) this._analyze({
                  key: '',
                  value: i[r],
                  record: r,
                  index: r
                }, {
                  resultMap: n,
                  results: s,
                  tokenSearchers: e,
                  fullSearcher: t
                });
                return {
                  weights: null,
                  results: s
                }
              }
              for (var a = {
              }, d = 0, c = i.length; d < c; d += 1) for (var l = i[d], u = 0, h = this.options.keys.length; u < h; u += 1) {
                var _ = this.options.keys[u];
                if ('string' != typeof _) {
                  if (a[_.name] = {
                    weight: 1 - _.weight || 1
                  }, _.weight <= 0 || _.weight > 1) throw new Error('Key weight has to be > 0 and <= 1');
                  _ = _.name
                } else a[_] = {
                  weight: 1
                };
                this._analyze({
                  key: _,
                  value: this.options.getFn(l, _),
                  record: l,
                  index: d
                }, {
                  resultMap: n,
                  results: s,
                  tokenSearchers: e,
                  fullSearcher: t
                })
              }
              return {
                weights: a,
                results: s
              }
            }
          },
          {
            key: '_analyze',
            value: function (e, t) {
              var i = e.key,
              n = e.arrayIndex,
              s = void 0 === n ? - 1 : n,
              r = e.value,
              o = e.record,
              d = e.index,
              c = t.tokenSearchers,
              l = void 0 === c ? [
              ] : c,
              u = t.fullSearcher,
              h = void 0 === u ? [
              ] : u,
              _ = t.resultMap,
              f = void 0 === _ ? {
              }
               : _,
              p = t.results,
              g = void 0 === p ? [
              ] : p;
              if (void 0 !== r && null !== r) {
                var v = !1,
                m = - 1,
                E = 0;
                if ('string' == typeof r) {
                  this._log('\nKey: ' + ('' === i ? '-' : i));
                  var b = h.search(r);
                  if (this._log('Full text: "' + r + '", score: ' + b.score), this.options.tokenize) {
                    for (var y = r.split(this.options.tokenSeparator), k = [
                    ], S = 0; S < l.length; S += 1) {
                      var x = l[S];
                      this._log('\nPattern: "' + x.pattern + '"');
                      for (var T = !1, C = 0; C < y.length; C += 1) {
                        var A = y[C],
                        w = x.search(A),
                        I = {
                        };
                        w.isMatch ? (I[A] = w.score, v = !0, T = !0, k.push(w.score)) : (I[A] = 1, this.options.matchAllTokens || k.push(1)),
                        this._log('Token: "' + A + '", score: ' + I[A])
                      }
                      T && (E += 1)
                    }
                    m = k[0];
                    for (var L = k.length, R = 1; R < L; R += 1) m += k[R];
                    m /= L,
                    this._log('Token score average:', m)
                  }
                  var P = b.score;
                  m > - 1 && (P = (P + m) / 2),
                  this._log('Score average:', P);
                  var D = !this.options.tokenize || !this.options.matchAllTokens || E >= l.length;
                  if (this._log('\nCheck Matches: ' + D), (v || b.isMatch) && D) {
                    var O = f[d];
                    O ? O.output.push({
                      key: i,
                      arrayIndex: s,
                      value: r,
                      score: P,
                      matchedIndices: b.matchedIndices
                    }) : (f[d] = {
                      item: o,
                      output: [
                        {
                          key: i,
                          arrayIndex: s,
                          value: r,
                          score: P,
                          matchedIndices: b.matchedIndices
                        }
                      ]
                    }, g.push(f[d]))
                  }
                } else if (a(r)) for (var M = 0, N = r.length; M < N; M += 1) this._analyze({
                  key: i,
                  arrayIndex: M,
                  value: r[M],
                  record: o,
                  index: d
                }, {
                  resultMap: f,
                  results: g,
                  tokenSearchers: l,
                  fullSearcher: h
                })
              }
            }
          },
          {
            key: '_computeScore',
            value: function (e, t) {
              this._log('\n\nComputing score:\n');
              for (var i = 0, n = t.length; i < n; i += 1) {
                for (var s = t[i].output, r = s.length, o = 0, a = 1, d = 0; d < r; d += 1) {
                  var c = s[d].score,
                  l = e ? e[s[d].key].weight : 1,
                  u = c * l;
                  1 !== l ? a = Math.min(a, u) : (s[d].nScore = u, o += u)
                }
                t[i].score = 1 === a ? o / r : a,
                this._log(t[i])
              }
            }
          },
          {
            key: '_sort',
            value: function (e) {
              this._log('\n\nSorting....'),
              e.sort(this.options.sortFn)
            }
          },
          {
            key: '_format',
            value: function (e) {
              var t = [
              ];
              this._log('\n\nOutput:\n\n', JSON.stringify(e));
              var i = [
              ];
              this.options.includeMatches && i.push(function (e, t) {
                var i = e.output;
                t.matches = [
                ];
                for (var n = 0, s = i.length; n < s; n += 1) {
                  var r = i[n];
                  if (0 !== r.matchedIndices.length) {
                    var o = {
                      indices: r.matchedIndices,
                      value: r.value
                    };
                    r.key && (o.key = r.key),
                    r.hasOwnProperty('arrayIndex') && r.arrayIndex > - 1 && (o.arrayIndex = r.arrayIndex),
                    t.matches.push(o)
                  }
                }
              }),
              this.options.includeScore && i.push(function (e, t) {
                t.score = e.score
              });
              for (var n = 0, s = e.length; n < s; n += 1) {
                var r = e[n];
                if (this.options.id && (r.item = this.options.getFn(r.item, this.options.id) [0]), i.length) {
                  for (var o = {
                    item: r.item
                  }, a = 0, d = i.length; a < d; a += 1) i[a](r, o);
                  t.push(o)
                } else t.push(r.item)
              }
              return t
            }
          },
          {
            key: '_log',
            value: function () {
              if (this.options.verbose) {
                var e;
                (e = console).log.apply(e, arguments)
              }
            }
          }
        ]),
        e
      }();
      e.exports = d
    }
    ])
  }),
  define('app/template/search/SearchCtrl', [
    'xdk-ax/focusManager',
    'xdk-ax/evt/type',
    'xdk-ax/mvc/AppRoot',
    'xdk-ax/mvc/Model',
    'xdk-ax/mvc/view',
    'xdk-base/class',
    'xdk-base/console',
    'xdk-base/device',
    'xdk-base/util',
    'app/core/RoutableController',
    'app/helper/helpers',
    'app/service/MwApiService',
    'app/template/search/searchView',
    'app/utils/Constants',
    'Fuse',
    'app/mgr/SegmentTrackingManager'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p) {
    'use strict';
    var g = i.singleton(),
    v = u.singleton(),
    m = p.singleton();
    return r.create(c, {
      VISIBILITY: {
        START: 'start',
        MORE_CHARACTER: 'more_character',
        EMPTY: 'no_result',
        RESULT: 'show_result'
      }
    }, {
      _shows: [
      ],
      init: function () {
        this._super(),
        this.model = new n,
        this.setView(s.render(h, this.model))
      },
      setup: function (e) {
        var t;
        this._super(e),
        this.view || (t = this.getView(), this._keyboard = t.find('searchKeyboard'), this._searchInput = t.find('searchInput'), this._searchMessage = t.find('message'), this._searchIcon = t.find('searchIcon'), this._searchResultGrid = t.find('searchResultGrid'), this._searchGridTitle = t.find('searchGridTitle'), this._searchMessage.setText(_.Messages.Search.INITIAL_MESSAGE), this._keyboard.onEdge = d.bind(this._keyboardOnEdge, this), this._setVisibility(this.constructor.VISIBILITY.START), this.view = t),
        this._addEventListeners(),
        m.trackScreenView('search')
      },
      postSetup: function () {
        return v.getShows().then(d.bind(function (e) {
          this._shows = e.shows,
          this._initializeFuzzySearch()
        }, this)).fail(function (e) {
          l.showError(_.ErrorMessage.APP_GENERAL),
          o.error(e)
        }).done()
      },
      _addEventListeners: function () {
        this._startInputRef = d.bind(this._startInput, this, this._searchInput),
        this._getSearchResultRef = d.bind(this._getSearchResult, this),
        this._endInputRef = d.bind(this._endInput, this),
        this._keyboardPressRef = d.bind(this._keyboardOnKeyPress, this),
        this._searchInput.addEventListener(t.TEXT_CHANGED, this._getSearchResultRef),
        this._searchResultGrid.addEventListener(t.FOCUS, this._endInputRef),
        this._keyboard.addEventListener(t.FOCUS, this._startInputRef),
        this._keyboard.addEventListener(t.KEY, this._keyboardPressRef)
      },
      _endInput: function () {
        this._searchInput.stopInput()
      },
      _getSearchResult: function () {
        var e,
        t = this._searchInput.getText();
        0 === t.length ? this._setVisibility(this.constructor.VISIBILITY.START) : 1 === t.length ? this._setVisibility(this.constructor.VISIBILITY.MORE_CHARACTER) : (e = this._fuse.search(t), e.length ? (this.model.set('shows', e), this._setVisibility(this.constructor.VISIBILITY.RESULT), this._searchGridTitle.setText(l.replaceString(_.Messages.Search.SEARCH_RESULT, t))) : this._setVisibility(this.constructor.VISIBILITY.EMPTY))
      },
      _initializeFuzzySearch: function () {
        var e = {
          shouldSort: !0,
          threshold: 0.2,
          location: 0,
          distance: 100,
          maxPatternLength: 32,
          minMatchCharLength: 2,
          keys: [
            'name',
            'channel',
            'genres'
          ]
        };
        this._fuse = new f(this._shows, e)
      },
      _keyboardOnEdge: function (t) {
        var i = g.getView(),
        n = i.find('mainMenu') || i;
        if ('nextRight' === t) return void e.focus(this._searchResultGrid);
        'nextUp' === t && (this._endInput(), e.focus(n))
      },
      _keyboardOnKeyPress: function (e) {
        switch (e.id) {
          case a.vKey.BACK.id:
          case a.vKey.EXIT.id:
            return this._endInput(),
            !0;
          case this._keyboard.constructor.KEY_ID_DELETE:
            this._searchInput.backspace()
        }
        return !1
      },
      _removeEventListeners: function () {
        this._searchInput.removeEventListener(t.FOCUS, this._startInputRef),
        this._searchInput.removeEventListener(t.TEXT_CHANGED, this._getSearchResultRef),
        this._searchResultGrid.removeEventListener(t.FOCUS, this._endInputRef),
        this._keyboard.removeEventListener(t.FOCUS, this._startInputRef),
        this._keyboard.removeEventListener(t.KEY, this._keyboardPressRef),
        this._startInputRef = null,
        this._getSearchResultRef = null,
        this._endInputRef = null,
        this._keyboardPressRef = null
      },
      _startInput: function () {
        this._searchInput.startInput()
      },
      _setVisibility: function (e) {
        var t = !1,
        i = _.Messages.Search;
        switch (e) {
          case this.constructor.VISIBILITY.MORE_CHARACTER:
            this._searchMessage.setText(i.MORE_CHARACTER);
            break;
          case this.constructor.VISIBILITY.EMPTY:
            this._searchMessage.setText(i.NO_RESULT);
            break;
          case this.constructor.VISIBILITY.RESULT:
            t = !0;
            break;
          default:
            this._searchMessage.setText(i.INITIAL_MESSAGE)
        }
        this._searchIcon.setVisibility(!t),
        this._searchMessage.setVisibility(!t),
        this._searchGridTitle.setVisibility(t),
        this._searchResultGrid.setVisibility(t)
      },
      reset: function () {
        this._removeEventListeners(),
        this._super()
      }
    })
  }),
  define('app/template/help/HelpModel', [
    'xdk-base/class',
    'xdk-ax/mvc/Model'
  ], function (e, t) {
    'use strict';
    return e.create(t, {
      defaults: {
        appVersion: '',
        header: ''
      }
    }, {
      init: function () {
        this._super(this.constructor.defaults)
      }
    })
  }),
  define('app/template/help/helpView', [
    'xdk-ax/mvc/ModelRef',
    'xdk-ui-basic/Button',
    'xdk-ui-basic/Label',
    'xdk-ax/Container'
  ], function (e, t, i, n) {
    'use strict';
    return function (t) {
      return {
        klass: n,
        css: 't-help',
        children: [
          {
            klass: n,
            id: 'helpContent',
            css: 't-help__content',
            focusable: !0
          },
          {
            klass: n,
            id: 'container2',
            css: 'button-container',
            children: [
              {
                klass: i,
                id: 'appVersion',
                text: new e(t, 'appVersion')
              }
            ]
          }
        ]
      }
    }
  }),
  define('app/template/help/HelpCtrl', [
    'app/core/RoutableController',
    'xdk-ax/mvc/view',
    'xdk-base/class',
    'xdk-base/console',
    'app/template/help/HelpModel',
    'app/template/help/helpView',
    'xdk-base/config',
    'app/service/MwApiService',
    'xdk-base/util',
    'app/helper/helpers',
    'app/utils/Constants',
    'xdk-ax/evt/type',
    'xdk-ax/Container',
    'xdk-ui-basic/Label',
    'app/mgr/SegmentTrackingManager'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f) {
    'use strict';
    var p = a.singleton(),
    g = f.singleton();
    return i.create(e, {
    }, {
      init: function () {
        this.helpModel = new s,
        this.setView(t.render(r, this.helpModel))
      },
      setup: function () {
        var e = this.getView();
        this.helpContent = e.find('helpContent'),
        this.helpContent.setOption('nextUp', d.bind(function () {
          var e = this.helpContent.getRoot().getHTMLElement();
          return 0 !== e.scrollTop && (e.scrollTop = Math.max(e.scrollTop - 100, 0), !0)
        }, this)),
        this.helpContent.setOption('nextDown', d.bind(function () {
          var e = this.helpContent.getRoot().getHTMLElement(),
          t = e.scrollHeight - e.clientHeight;
          return e.scrollTop < t && (e.scrollTop = Math.min(e.scrollTop + 100, t)),
          !1
        }, this)),
        g.trackScreenView('help')
      },
      postSetup: function () {
        var e = o.get('environment') + '-' + o.get('version') + '#' + o.get('buildNumber');
        return this.helpModel.set('appVersion', 'v: ' + e),
        p.getHelpContent().then(d.bind(function (e) {
          d.each(e.content, d.bind(function (e) {
            new _({
              css: 't-help__content--header',
              text: e.title,
              parent: this.helpContent
            });
            var t = new h({
              css: 't-help__content--questions',
              parent: this.helpContent
            });
            d.each(e.questions, function (e) {
              new _({
                css: 't-help__content--question',
                text: e.question,
                parent: t
              }),
              new _({
                css: 't-help__content--answer',
                text: e.answer,
                parent: t
              })
            })
          }, this))
        }, this)).fail(function (e) {
          c.showError(l.ErrorMessage.APP_GENERAL),
          n.error(e)
        }).done()
      }
    })
  }),
  define('app/template/details/DetailsModel', [
    'xdk-base/class',
    'xdk-ax/mvc/Model',
    'app/model/ShowModel',
    'app/model/BeltModel',
    'app/helper/helpers',
    'xdk-base/util',
    'xdk-base/console'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a = new t;
    return e.create(t, {
      defaults: {
        showDetailsModel: a,
        belts: [
        ]
      }
    }, {
      _parseAttrs: function (e, t) {
        switch (e) {
          case 'showDetailsModel':
            return this._parseShowDetails(t);
          case 'belts':
            return this._parseBelts(t);
          default:
            return t
        }
      },
      _parseShowDetails: function (e) {
        e = e || {
        };
        var t = {
        },
        n = e.episodes || [
        ];
        e.seasons && (n = e.seasons[0].episodes || [
        ]);
        var o;
        t.title = e.name || '',
        t.synopsis = e.synopsis || '',
        t.images = e.images || {
        },
        t.isMovie = s.isMovie(e.genres),
        n = r.map(n, function (e) {
          return new i(e)
        }),
        t.episodes = n,
        o = n.length > 0 ? n[0] : new i({
        }),
        this._setShowDetailsModel(o, t)
      },
      _setShowDetailsModel: function (e, t) {
        var i = {
          showId: e.get('showId'),
          episodeName: '',
          classification: '',
          synopsis: t.synopsis,
          type: e.get('type')
        };
        return t && (i.showTitle = t.title, i.episodes = t.episodes, i.isMovie = t.isMovie, i.backgroundImage = this._getBackgroundImage(t.images)),
        a.set(i)
      },
      _setShowDetailsModelOnFocus: function (e) {
        var t = e.get('classificationWarnings'),
        i = e.get('vodClassification') + (t ? '-' + t : '') + ' ',
        n = {
          showId: e.get('showId'),
          episodeName: e.get('name'),
          duration: e.get('duration'),
          classification: i,
          synopsis: e.get('synopsis'),
          availableDate: e.get('availableDate'),
          expiryDate: e.get('expiryDate'),
          type: e.get('type')
        };
        return a.set(n)
      },
      _parseBelts: function (e) {
        e = r.isArray(e) ? e : [
        ];
        var t = [
        ];
        return r.each(e, function (e, i) {
          var s;
          e.index = i,
          e.totalBelts = e.length,
          s = new n(e),
          s.isValid() && t.push(s)
        }),
        t
      },
      _getBackgroundImage: function (e) {
        var t = s.getProperty(e, 'showHero');
        return t ? s.resizeImage(t, 1061, 579) : ''
      },
      set: function (e, t) {
        this._super(e, this._parseAttrs(e, t))
      },
      updateModelByEpisode: function (e) {
        var t = s.getProperty(a, [
          'episodes',
          e
        ]);
        if (!t) return void o.error('No episode found');
        this._setShowDetailsModelOnFocus(t)
      },
      clear: function () {
        a.clear(),
        this._super()
      }
    })
  }),
  define('app/template/details/detailsView', [
    'xdk-ax/mvc/ModelRef',
    'xdk-ui-basic/Label',
    'xdk-ui-basic/Button',
    'xdk-ui-basic/Layout',
    'xdk-ui-basic/Image',
    'xdk-ax/Container',
    'app/wgt/MultiBelts'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    return function (a) {
      var d = a.get('showDetailsModel');
      return {
        klass: n,
        id: 'detailsContainer',
        css: 't-details',
        alignment: n.VERTICAL,
        children: [
          {
            klass: r,
            css: 'details-panel',
            children: [
              {
                klass: r,
                css: 'details-panel__background-container',
                children: [
                  {
                    klass: s,
                    src: new e(d, 'backgroundImage'),
                    css: 'details-panel__background-image'
                  }
                ]
              },
              {
                klass: r,
                css: 'details-panel__content',
                children: [
                  {
                    klass: r,
                    css: 'details-panel__title-container',
                    children: [
                      {
                        klass: t,
                        text: new e(d, 'showTitle'),
                        css: 'details-panel__title'
                      },
                      {
                        klass: t,
                        text: new e(d, 'episodeName'),
                        css: 'details-panel__saison-detail'
                      },
                      {
                        klass: r,
                        css: 'details-panel__description',
                        children: [
                          {
                            klass: t,
                            text: new e(d, 'classification'),
                            id: 'classification',
                            css: 'details-panel__classification'
                          },
                          {
                            klass: t,
                            text: new e(d, 'synopsis'),
                            id: 'description',
                            css: 'details-panel__synopsis'
                          }
                        ]
                      },
                      {
                        klass: t,
                        text: new e(d, 'synopsis'),
                        id: 'descriptionHeight',
                        css: 'details-panel__description-hidden'
                      },
                      {
                        klass: i,
                        text: 'MORE',
                        id: 'moreDetails',
                        css: 'details-panel__more',
                        nextUp: 'mainMenu',
                        nextDown: 'watchmeButton'
                      }
                    ]
                  },
                  {
                    klass: r,
                    id: 'timeContainer',
                    visible: !1,
                    css: 'details-panel__time-container',
                    children: [
                      {
                        klass: t,
                        id: 'availableDate',
                        text: new e(d, 'availableDate'),
                        css: 'details-panel__time'
                      },
                      {
                        klass: t,
                        id: 'duration',
                        text: new e(d, 'duration'),
                        css: 'details-panel__time--inline'
                      },
                      {
                        klass: t,
                        text: ' | ',
                        css: 'details-panel__time--inline'
                      },
                      {
                        klass: t,
                        id: 'expiryDate',
                        text: new e(d, 'expiryDate'),
                        css: 'details-panel__time--inline'
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            klass: o,
            id: 'multiBelts',
            css: 'details-multi-belts',
            nextUp: 'moreDetails',
            data: new e(a, 'belts')
          }
        ]
      }
    }
  }),
  define('app/template/details/DetailsCtrl', [
    'app/core/RoutableController',
    'xdk-ax/mvc/view',
    'xdk-base/class',
    'app/template/details/DetailsModel',
    'app/template/details/detailsView',
    'xdk-base/config',
    'xdk-base/util',
    'xdk-ax/evt/type',
    'app/service/MwApiService',
    'xdk-ax/focusManager',
    'app/mgr/UserManager',
    'xdk-base/promise',
    'app/model/ShowModel',
    'xdk-base/console',
    'app/helper/helpers',
    'app/utils/Constants',
    'xdk-ax/mediator',
    'app/wgt/AlertWgt',
    'app/wgt/LoadingWgt',
    'vdk-lib-moment/moment',
    'app/mgr/SegmentTrackingManager'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p, g, v, m, E, b) {
    'use strict';
    var y = d.singleton(),
    k = l.singleton(),
    S = b.singleton(),
    x = p.Details,
    T = p.Events;
    return i.create(e, {
    }, {
      lastWatched: null,
      isHistoryBack: !1,
      init: function () {
        this.detailsModel = new n,
        this.setView(t.render(s, this.detailsModel))
      },
      setup: function (e) {
        this._super(e),
        this._setBackgroundClass(!1),
        this._isLoaded = !1,
        e.historyBack || (this._setElements(), this._showId = e.showModel.get('id'), c.focus(this._belts), this.getView().getRootController().focusOnMainMenu()),
        this._addModelListeners(),
        S.trackScreenView('show-page')
      },
      postSetup: function (e) {
        return this._isLoaded ? u.resolve() : (this._isLoaded = !0, this.isHistoryBack = e.historyBack, this._loadData(this.isHistoryBack).then(o.bind(this._postLoadData, this)))
      },
      positionCarousel: function (e, t, i) {
        f.positionCarousel(this.container, e, t, i, 0)
      },
      reset: function () {
        this.lastWatched = null,
        this._setBackgroundClass(!0),
        this._storeFocusHistory(),
        this.detailsModel.clear(),
        this._super(),
        this._removeEventListeners(),
        this._removeModelListeners(),
        this._sections = [
        ]
      },
      _setElements: function () {
        var e = this.getView();
        this._belts = e.find('multiBelts'),
        this.container = e.find('detailsContainer'),
        this.availableDate = e.find('availableDate'),
        this.expiryDate = e.find('expiryDate'),
        this.duration = e.find('duration'),
        this.moreDetails = e.find('moreDetails'),
        this.descriptionHeight = e.find('descriptionHeight'),
        this.timeContainer = e.find('timeContainer'),
        c.focus(this._belts)
      },
      _loadData: function (e) {
        var t = [
        ];
        return e && this.showResponse ? t.push(u.resolve(this.showResponse)) : t.push(y.getShow(this._showId)),
        k.getLoginStatus() && t.push(y.getHistory()),
        u.all(t).spread(o.bind(function (e, t) {
          e = e || {
          },
          this.showResponse = o.clone(e, !0);
          var i = e.show || {
          },
          n = [
          ],
          s = e.show.seasons || [
          ],
          r = i.episodes || [
          ],
          a = i.extras || [
          ];
          s.length > 0 ? (s.forEach(o.bind(function (e) {
            this._checkHistory(e.episodes, t)
          }, this)), n = this.loadSeasonBelt(s, n), n = this.loadExtrasBelt(s, n)) : (this._checkHistory(r, t), r.length > 0 && n.push({
            title: i.name || x.EPISODES_BELT_TITLE,
            items: r,
            showItemsTitle: !0
          }), a.length > 0 && n.push({
            title: x.EXTRAS_BELT_TITLE,
            items: a,
            showItemsTitle: !0
          })),
          n = n.concat(e.sections),
          this._show = i,
          this._sections = n
        }, this)).fail(function (e) {
          f.showError(p.ErrorMessage.APP_GENERAL),
          _.error(e)
        })
      },
      loadSeasonBelt: function (e, t) {
        return e.forEach(function (e) {
          t.push({
            title: e.name || x.SEASONS_BELT_TITLE,
            items: e.episodes,
            episodeOrder: e.episodeOrder,
            showItemsTitle: !0
          })
        }),
        t
      },
      loadExtrasBelt: function (e, t) {
        var i = [
        ];
        return e.forEach(function (e) {
          if (e.extras.length > 0) {
            e.extras.forEach(function (e) {
              i.push(e)
            })
          }
        }),
        i.length > 0 && t.push({
          title: x.EXTRAS_BELT_TITLE,
          items: i,
          showItemsTitle: !0
        }),
        t
      },
      _postLoadData: function () {
        this._addEventListeners(),
        this._setDetailsModel(),
        this.descriptionHeight.getRoot().getHTMLElement().scrollHeight < 90 && this.moreDetails.hide(),
        m.close()
      },
      _setDetailsModel: function () {
        this.detailsModel.set('showDetailsModel', this._show),
        this.detailsModel.set('belts', this._sections)
      },
      _checkHistory: function (e, t) {
        if (k.getLoginStatus()) {
          var i;
          f.getProperty(t, 'history', [
          ]).forEach(o.bind(function (t) {
            o.find(e, function (e) {
              t.videoId === e.videoId && (i || (i = e.videoId, e.isLastWatched = !0), e && !t.isComplete && (e.isResume = !0, e.currentPosition = t.currentPosition))
            }),
            i && (this.lastWatched = i),
            _.info('matchedItem:' + i)
          }, this))
        }
      },
      _onWatchmeButtonClick: function () {
        if (!k.getLoginStatus()) return void f.showLoginToWatchError(o.bind(this._onWatchmeButtonClick, this));
        if (this._movie.get('isResume')) {
          var e = this._movie.get('currentPosition');
          return void f.showContinuePopup(e, this._movie)
        }
        f.navigate('FULLSCREENPLAYER', !1, {
          showModel: this._movie
        })
      },
      _onMoreButtonClick: function () {
        var e = this.episode ? this.episode.get('synopsis') : this._show.synopsis;
        new v({
          title: 'Description',
          message: e
        })
      },
      _onSessionUpdate: function () {
        return this._loadData().then(o.bind(this._postLoadData, this)).done()
      },
      _addEventListeners: function () {
        this._onMoreButtonClickRef = o.bind(this._onMoreButtonClick, this),
        this.moreDetails.addEventListener(a.CLICK, this._onMoreButtonClickRef),
        this._beltsAttachedRef = o.bind(this._beltsAttached, this),
        g.subscribe(T.LAST_BELT_LOADED, this._beltsAttachedRef),
        this._onSessionUpdateRef = o.bind(this._onSessionUpdate, this),
        g.subscribe(T.USER_SESSION_UPDATED, this._onSessionUpdateRef),
        this._onBeltsFocusRef = o.bind(this._onBeltsFocus, this),
        this._belts.addEventListener(a.FOCUS, this._onBeltsFocusRef)
      },
      _removeEventListeners: function () {
        this.moreDetails.removeEventListener(a.CLICK, this._onMoreButtonClickRef),
        this._onMoreButtonClickRef = null,
        g.unsubscribe(T.LAST_BELT_LOADED, this._beltsAttachedRef),
        this._beltsAttachedRef = null,
        g.unsubscribe(T.USER_SESSION_UPDATED, this._onSessionUpdateRef),
        this._onSessionUpdateRef = null,
        this._belts.removeEventListener(a.FOCUS, this._onBeltsFocusRef),
        this._onBeltsFocusRef = null
      },
      _addModelListeners: function () {
        var e = this.availableDate.getOption('text'),
        t = this.expiryDate.getOption('text'),
        i = this.duration.getOption('text');
        this._setAvailableDateRef = o.bind(this._setAvailableDate, this),
        this._setExpiryDateRef = o.bind(this._setExpiryDate, this),
        this._setDurationRef = o.bind(this._setDuration, this),
        e.getModel().on('change:' + e.getAttr(), this._setAvailableDateRef),
        t.getModel().on('change:' + t.getAttr(), this._setExpiryDateRef),
        i.getModel().on('change:' + i.getAttr(), this._setDurationRef)
      },
      _removeModelListeners: function () {
        var e = this.availableDate.getOption('text'),
        t = this.expiryDate.getOption('text'),
        i = this.duration.getOption('text');
        e.getModel().off('change:' + e.getAttr(), this._setAvailableDateRef),
        t.getModel().off('change:' + t.getAttr(), this._setExpiryDateRef),
        i.getModel().off('change:' + i.getAttr(), this._setDurationRef),
        this._setAvailableDateRef = null,
        this._setExpiryDateRef = null,
        this._setDurationRef = null
      },
      _onBeltsFocus: function (e) {
        var t = this._belts,
        i = f.getProperty(t, [
          'model',
          'belts',
          0,
          'index'
        ], 0);
        if (!(t.getSelectedDsIndex() > 0 || i > 0)) {
          this.episode = f.getProperty(e, [
            'target',
            'showModel'
          ], new h({
          }));
          var n = this.episode.get('index') || 0;
          this.detailsModel.updateModelByEpisode(n),
          this.descriptionHeight.getRoot().getHTMLElement().scrollHeight < 90 ? this.moreDetails.hide() : this.moreDetails.show()
        }
      },
      _beltsAttached: function () {
        this._ensureBeltFocus(),
        this.lastWatched && this.isHistoryBack,
        g.unsubscribe(T.LAST_BELT_LOADED, this._beltsAttachedRef)
      },
      _storeFocusHistory: function () {
        var e = this._belts;
        this.lastWatchedItem = c.getCurFocus();
        var t = e.getSelectedComp(),
        i = t.belt;
        if (i) {
          var n = e.getSelectedPosition() || {
          };
          this._lastSelectedBeltIndex = e.getSelectedDsIndex(),
          this._lastSelectedBeltRow = n.row || 0;
          var s = i.getSelectedPosition() || {
          };
          this._lastSelectedTileIndex = i.getSelectedDsIndex(),
          this._lastSelectedTileRow = s.row || 0
        }
      },
      _ensureBeltFocus: function () {
        o.isUndefined(this._lastSelectedBeltIndex) || o.isUndefined(this._lastSelectedTileIndex) || this._belts.selectCompByDsIndex(this._lastSelectedBeltIndex, this._lastSelectedBeltRow).then(o.bind(function () {
          var e = this._belts.getSelectedComp();
          e && e.belt.select(this._lastSelectedTileIndex, this._lastSelectedTileRow)
        }, this))
      },
      _setDuration: function (e) {
        var t = e.newVal,
        i = f.formatSecondToHHmmss(t);
        this.duration.setText(i),
        this.timeContainer.show()
      },
      _setAvailableDate: function (e) {
        var t = e.newVal,
        i = E(t);
        i.isValid() && (t = i.format('ddd, D MMM YYYY')),
        t = x.AVAIABLE_FROM + ' ' + t,
        this.availableDate.setText(t),
        this.timeContainer.show()
      },
      _setExpiryDate: function (e) {
        var t = e.newVal,
        i = E(t),
        n = E(new Date),
        s = 0;
        i.isValid() && n.isValid() && (s = Math.ceil(E.duration(i.diff(n)).asDays()));
        var r = s > 1 ? x.DAYS : x.DAY;
        this.expiryDate.setText([s,
        r,
        x.LEFT_TO_VIEW].join(' ')),
        this.timeContainer.show()
      },
      _setBackgroundClass: function (e) {
        e && this.subCtrlView ? (this.subCtrlView.removeClass('sub-ctrl-container--details'), this.subCtrlView = null) : (this.subCtrlView = this.getView().getParent(), this.subCtrlView.addClass('sub-ctrl-container--details'))
      }
    })
  }),
  define('app/core/nav/destinations', [
    'app/template/fullscreenPlayer/FullscreenPlayerCtrl',
    'app/template/main/MainCtrl',
    'app/template/maintenance/MaintenanceCtrl',
    'app/template/browse/BrowseCtrl',
    'app/template/home/HomeCtrl',
    'app/template/search/SearchCtrl',
    'app/template/help/HelpCtrl',
    'app/template/details/DetailsCtrl'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    return {
      FULLSCREENPLAYER: [
        e
      ],
      HOME: [
        t,
        s
      ],
      BROWSE: [
        t,
        n
      ],
      HELP: [
        t,
        o
      ],
      SEARCH: [
        t,
        r
      ],
      DETAILS: [
        t,
        a
      ]
    }
  }),
  define('app/core/appRouter', [
    'app/core/nav/destinations',
    'app/core/RoutableController',
    'app/mgr/MessageDisplayHelper',
    'app/mgr/UserManager',
    'require',
    'vdk/errors/VIAError',
    'app/wgt/LoadingWgt',
    'xdk-ax/focusManager',
    'xdk-ax/mediator',
    'xdk-ax/mvc/AppRoot',
    'xdk-ax/mvc/ControllerManager',
    'xdk-base/config',
    'xdk-base/console',
    'xdk-base/core',
    'xdk-base/promise',
    'xdk-base/util'
  ], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p) {
    function g() {
      S = !1,
      x = null
    }
    function v(e, i) {
      var n,
      s,
      r,
      o = {
      },
      d = e.page,
      u = e.state,
      g = e.message,
      v = e.historySkip;
      i ? (n = i.currentController, s = i.navigated) : (n = c.singleton(), s = !1);
      var m,
      b = 0,
      y = 0;
      return r = n.getSubControllers(),
      (s || v) && (o = {
        historySkip: !0
      }),
      o.context = u ? p.extend(d.getDefaultRouteState(), u) : d.getDefaultRouteState(),
      g && p.keys(g).length > 0 && (b = p.keys(o.context).length, y = p.keys(g).length, h.info('state keys: ' + p.keys(o.context).join()), h.info('message keys: ' + p.keys(g).join()), p.extend(o.context, g), y + b !== p.keys(o.context).length) ? f.reject(_.createException('appRouter', 'Repeated item in state or context,')) : (o.historyFocus = a.getCurFocus(), r.length > 1 && f.reject(_.createException('appRouter', 'IncorrectController ,the number of subcontroller is more than 1.')), d.prototype instanceof t || f.reject(_.createException('appRouter', 'the target Controller is not instance of RoutableController')), 0 === r.length ? (m = n.getSubRouteContainer ? n.getSubRouteContainer() : c.singleton().getView(), l.singleton().open(d, m, o).then(function (e) {
        return f.when(o.context.setupPending, function () {
          return {
            navigated: !0,
            currentController: e
          }
        })
      })) : r[0] instanceof d && (E(r[0], u) || r[0].retainView()) ? f.resolve({
        navigated: !1,
        currentController: r[0]
      }) : l.singleton().replace(r[0], d, o).then(function (e) {
        return f.when(o.context.setupPending, function () {
          return {
            navigated: !0,
            currentController: e
          }
        })
      }))
    }
    function m(e) {
      var t,
      i = e.destinations,
      n = 0,
      s = e.state || null,
      r = e.message || null,
      a = e.historySkip || !1;
      if (S) return h.info('appRouter is processing. Further action is not allowed.'),
      f.reject();
      for (S = !0, o.open(), n = 0; n < i.length; n++) t = t ? t.then(p.bind(v, null, {
        page: i[n],
        state: s,
        message: r,
        historySkip: a
      })) : v({
        page: i[n],
        state: s,
        message: r,
        historySkip: a
      });
      return t.then(function () {
        return d.publish('navigated', e),
        h.info('finish loading'),
        p.delay(0)
      }).complete(function () {
        o.close(),
        S = !1
      })
    }
    function E(e, t) {
      if (!t) return !0;
      var i,
      n = e.getRouteState();
      for (i in t) if (!p.isUndefined(n[i]) && n[i] !== t[i]) return !1;
      return !0
    }
    var b,
    y = u.get('approuter', null),
    k = {
    },
    S = !1,
    x = null;
    if (y) {
      if (!y.base) throw _.createException('appRouter', 'the base is not set.');
      if (y.paths) for (b in y.paths) k[b] = y.paths[b]
    }
    return {
      __currentDestination: null,
      __destinationHistoryStack: [
      ],
      navigate: function (t, i) {
        if (i = i || {
        }, !e[t]) return f.reject(new r(r.FACILITY.GENERAL, r.ERROR.INVALID, 'Wrong destination: ' + t));
        if (i.state && i.state.pageData && i.state.pageData.state) {
          var s = i.state.pageData.state,
          o = n.singleton().getUserState();
          if ( - 1 === s.indexOf(o)) return f.reject(new r(r.FACILITY.GENERAL, r.ERROR.INVALID, 'Wrong state.'))
        }
        return x = m({
          destinations: e[t],
          state: i.state || null,
          message: i.message || null,
          historySkip: i.historySkip || !1
        }).then(p.bind(function () {
          this.__currentDestination && this.__destinationHistoryStack.push(this.__currentDestination),
          this.__currentDestination = t,
          x = null
        }, this), null, function () {
          g()
        })
      },
      getCurrentDestination: function () {
        return this.__currentDestination
      },
      destinationEquals: function (e, t) {
        if (e.destination !== t.destination) return !1;
        if (!e.newState && !t.newState) return !0;
        var i = e.newState,
        n = t.newState;
        for (var s in i) if (i.hasOwnProperty(s)) {
          if (!n.hasOwnProperty(s)) return !1;
          if (i[s] !== n[s] && !p.isPlainObject(i[s])) return !1
        }
        for (s in n) if (n.hasOwnProperty(s) && !i.hasOwnProperty(s)) return !1;
        return !0
      },
      cancelCurrentNavigation: function () {
        x && x.cancel()
      },
      setToLastDestination: function () {
        this.__currentDestination = this.__destinationHistoryStack.pop()
      }
    }
  }),
  define('app/mgr/ErrorManager', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/promise',
    'xdk-base/console',
    'app/service/MwApiService',
    'app/mgr/MessageDisplayHelper',
    'app/utils/Constants'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    var a,
    d,
    c = s.singleton(),
    l = r.singleton(),
    u = o.ErrorMessage;
    return a = e.create({
      singleton: function () {
        return d || (d = new a),
        d
      }
    }, {
      _errors: null,
      getAllErrors: function () {
        return this._errors ? i.resolve(this._errors) : c.getKbErrors().then(t.bind(function (e) {
          return e = e || {
          },
          this._errors = e.content,
          this._errors
        }, this))
      },
      showError: function (e, i) {
        i = i || {
        };
        var n = t.find(this._errors, function (t) {
          return t.id.trim() === e
        });
        n || (n = {
          values: {
            title: u.ERROR_UNKNOWN
          }
        });
        var s = n.values || {
        };
        t.extend(i, {
          type: r.TYPE.ALERT,
          title: s.title,
          message: s.text
        }),
        l.showMessage(i)
      }
    })
  }),
  define('app/core/nav/interface/DestinationParser', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    return e.create('DestinationParser', {
      canParse: [
        'source'
      ],
      parseFrom: [
        'source'
      ]
    })
  }),
  define('app/core/nav/parser/VikiActionParser', [
    'app/core/nav/interface/DestinationParser',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/exception',
    'xdk-base/QueryString',
    'xdk-base/util'
  ], function (e, t, i, n, s, r) {
    'use strict';
    return t.create([e], {
    }, {
      init: function (e) {
        this.__pages = e
      },
      canParse: function (e) {
        return !(!r.isString(e) || 0 !== e.indexOf('vdk://action/'))
      },
      parseFrom: function (e) {
        var t,
        r,
        o,
        a = {
        };
        if (t = e.substring('vdk://action/'.length), r = t.indexOf('?'), r > 0 && (o = s.parse(t.substring(r + 1)), t = t.substring(0, r)), t) return a.actionId = t,
        a.state = o || {
        },
        a;
        throw i.createException(n.INTERNAL, 'ParserError: The parser cannot parse the source: ' + e)
      }
    })
  }),
  define('app/core/nav/parser/VikiPageDestinationParser', [
    'app/core/nav/interface/DestinationParser',
    'xdk-base/class',
    'xdk-base/core',
    'xdk-base/exception',
    'xdk-base/QueryString',
    'xdk-base/util'
  ], function (e, t, i, n, s, r) {
    'use strict';
    return t.create([e], {
    }, {
      init: function (e) {
        this.__pages = e
      },
      canParse: function (e) {
        return !(!r.isString(e) || 0 !== e.indexOf('vdk://page/'))
      },
      parseFrom: function (e) {
        var t,
        r,
        o,
        a,
        d = {
        };
        if (t = e.substring('vdk://page/'.length), o = t.indexOf('?'), o > 0 && (a = s.parse(t.substring(o + 1)), t = t.substring(0, o)), (r = this.__getPageDataById(t)) && r.template) return d.destination = r.template,
        d.newState = {
        },
        a && (d.newState = a),
        d.newState.pageId = t,
        d.newState.pageData = r,
        d;
        throw i.createException(n.INTERNAL, 'ParserError: The parser cannot parse the source: ' + e)
      },
      __getPageDataById: function (e) {
        for (var t = 0, i = this.__pages.length; t < i; t++) if (this.__pages[t].id === e) return this.__pages[t];
        return null
      }
    })
  }),
  define('xdk-base/device/interface/System', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    var t = e.create('System', {
      setScreenSaver: [
        'flag'
      ],
      setSystemMute: [
        'flag'
      ],
      powerOff: [
      ],
      exit: [
      ],
      hasMouse: [
      ],
      hasFixedKeyboard: [
      ],
      getDisplayResolution: [
      ],
      supportSSL: [
      ],
      getNetworkStatus: [
      ],
      redraw: [
        'element'
      ]
    });
    return t.EVT_NETWORK_STATUS_CHANGED = 'device:system:network-status-changed',
    t.EVT_RESIZE = 'device:system:resize',
    t.EVT_APPCONTROL = 'appcontrol',
    t
  }),
  define('xdk-base/device/interface/Id', [
    'xdk-base/Interface'
  ], function (e) {
    'use strict';
    var t = e.create('Id', {
      getDeviceType: [
      ],
      getHardwareType: [
      ],
      getMac: [
      ],
      getFirmware: [
      ],
      getFirmwareYear: [
      ],
      getUniqueID: [
      ],
      getModel: [
      ],
      getIP: [
      ]
    });
    return t.HARDWARE_TYPE = {
      BD: 'Bluray',
      TV: 'TV',
      MONITOR: 'Monitor',
      HOME_THEATRE: 'Home Theatre',
      EMULATOR: 'Emulator',
      WORKSTATION: 'Workstation',
      STB: 'Set Top Box',
      CONSOLE: 'Console',
      CONSOLE_MONITOR: 'Console Monitor',
      MOBILE: 'Mobile Device',
      UNKNOWN: 'Unknown'
    },
    t
  }),
  define('xdk-mouse/mouseHandler', [
    'xdk-base/core',
    'xdk-ax/focusManager',
    'xdk-base/Env',
    'xdk-base/device',
    'xdk-base/util',
    'xdk-ax/mvc/AppRoot',
    'xdk-ax/evt/type',
    'xdk-base/console',
    'xdk-base/device/interface/Id',
    'xdk-base/config'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    function l(e) {
      return e ? !e.__comp && e.parentNode && e.parentNode !== document.body ? l(e.parentNode) : e.__comp || null : null
    }
    var u,
    h,
    _,
    f,
    p,
    g,
    v,
    m,
    E,
    b,
    y,
    k,
    S,
    x,
    T,
    C,
    A = null,
    w = null,
    I = !1,
    L = null,
    R = null,
    P = null,
    D = !1,
    O = null,
    M = null,
    N = null,
    F = !1;
    p = function (e) {
      var t;
      if (e !== I) {
        if (t = U(), I = e) return void t.addClass('mouse-on');
        t.removeClass('mouse-on'),
        f()
      }
    },
    f = function (e) {
      if (U().removeClass('mouse-focus-on-non-focusable'), I) {
        if (e && t.focus(e, {
          skipForwardFocus: !0
        })) return;
        if (!_) return void t.focus(null);
        U().addClass('mouse-focus-on-non-focusable')
      }
      t.ensureFocus()
    },
    m = function () {
      if (O && !1 === O()) return !0;
      p(!0)
    },
    E = function (e) {
      if (e && e.source && 'device' !== e.source) return a.debug('[mouseHandler] Mouse Off Handler is fired by: ' + e.source),
      !0;
      if (!I) return !0;
      return !(!M || !1 !== M()) || (p(!1), !1)
    },
    b = function (e) {
      e = e || window.event;
      var i = e.target || e.srcElement,
      n = l(i);
      if (G().isBlockingMouse()) return !0;
      if (I || (m(), U().addClass('mouse-on')), I = !0, !n) return f(null),
      !0;
      for (; n && !t.isCompFocusable(n); ) n = n.getParent();
      return !(!N || !1 !== N(n)) || (n ? (f(n), !0) : (f(null), !0))
    },
    y = function () {
      return !!G().isBlockingMouse() || (f(null), !0)
    },
    P = function (e) {
      var t = e.keyCode,
      i = !1;
      switch (t) {
        case 1536:
          m(),
          i = !0;
          break;
        case 1537:
          E(),
          i = !0,
          D = !0,
          s.defer().then(function () {
            D = !1
          }).done()
      }
      return !i && !D || (e.stopPropagation(), e.preventDefault(), !1)
    },
    k = function () {
      if ('webos' === n.platform) return void document.addEventListener('keydown', P, !0);
      if ('lg' === n.platform && !(n.id.getFirmwareYear() <= 2011 && n.id.getHardwareType() === d.HARDWARE_TYPE.EMULATOR)) return L = window.onmouseon,
      R = window.onmouseoff,
      window.onmouseon = m,
      void (window.onmouseoff = E);
      if ('wiiu' === n.platform && nwf && window === nwf.display.DisplayManager.singleton().getTVDisplay().window) {
        var e,
        t,
        i = [
        ];
        i[0] = nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_1),
        i[1] = nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_2),
        i[2] = nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_3),
        i[3] = nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_4);
        for (e in i) t = i[e],
        t.cursor.addEventListener(nwf.events.DPDControlEvent.UPDATE, g);
        E = s.wrap(E, function (e) {
          return !!F || e()
        })
      }
      U().addEventListener(o.KEY, E, !0)
    },
    g = function (t) {
      F = !0,
      I || (a.info('[Wii]Mouse ON with the evt' + t), m()),
      w && s.clearDelay(w),
      w = e.getGuid(),
      s.delay(0.2, w).then(v).done()
    },
    v = function () {
      a.info('[Wii]Mouse off outside the screen'),
      F = !1,
      w = null
    },
    S = function () {
      if ('webos' === n.platform) return void document.removeEventListener('keydown', P);
      if ('lg' === n.platform && !(n.id.getFirmwareYear() <= 2011 && n.id.getHardwareType() === d.HARDWARE_TYPE.EMULATOR)) return window.onmouseon = L,
      void (window.onmouseoff = R);
      if ('wiiu' === n.platform && nwf) {
        var e,
        t,
        i = [
        ];
        i[0] = nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_1),
        i[1] = nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_2),
        i[2] = nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_3),
        i[3] = nwf.input.WiiRemote.getController(nwf.input.WiiRemote.REMOTE_4);
        for (e in i) t = i[e],
        t.cursor.removeEventListener(nwf.events.DPDControlEvent.UPDATE, g)
      }
      U().removeEventListener(o.KEY, E, !0)
    },
    x = function () {
      C(!0)
    },
    T = function () {
      C(!1)
    },
    C = function (e) {
      var t = n.id.getHardwareType() === d.HARDWARE_TYPE.MOBILE,
      i = t ? 'touchstart' : 'mouseover',
      s = (e ? 'add' : 'remove') + 'EventListener';
      A[s](i, b),
      t && A[s]('touchend', y)
    };
    var B = function (e) {
      var t = e.target || e.srcElement,
      i = {
        deltaY: e.wheelDelta,
        target: l(t)
      },
      n = G();
      n.dispatchEvent(n.EVT_ON_MOUSE_WHEEL, i)
    },
    G = function () {
      return u = u || i.singleton()
    },
    U = function () {
      return h = h || r.singleton(),
      h.getView()
    };
    return {
      start: function () {
        var e = 'mouse.keep-focus-' + n.platform;
        if (A = A || U().getRoot(), _ = c.get(e), s.isUndefined(_) && (_ = c.get('mouse.keep-focus', !1)), k(), x(), 'lg' === n.platform && window.NetCastGetMouseOnOff) {
          var t = 'ON' === window.NetCastGetMouseOnOff().toUpperCase();
          p(t)
        }
        A.addEventListener('mousewheel', B)
      },
      stop: function () {
        A = A || U().getRoot(),
        S(),
        T(),
        A.removeEventListener('mousewheel', B),
        I = !1
      },
      isMouseOn: function () {
        return I
      },
      setMouseOnCallback: function (e) {
        O = e
      },
      setMouseOffCallback: function (e) {
        M = e
      },
      setMouseOverCallback: function (e) {
        N = e
      }
    }
  }),
  require(['app/core/RoutableController',
  'app/core/appRouter',
  'app/mgr/AppConfigManager',
  'app/mgr/ErrorManager',
  'app/core/History',
  'app/mgr/MessageDisplayHelper',
  'app/mgr/UserManager',
  'app/core/nav/DestinationParserManager',
  'app/core/nav/parser/VikiActionParser',
  'app/core/nav/parser/VikiPageDestinationParser',
  'app/service/ServiceHolder',
  'vdk/errors/VIAError',
  'xdk-ax/mediator',
  'xdk-base/config',
  'xdk-base/console',
  'xdk-base/device',
  'xdk-base/device/interface/System',
  'xdk-base/Env',
  'xdk-base/util',
  'xdk-mouse/mouseHandler',
  'xdk-base/promise',
  'xdk-base/device/vKey',
  'app/helper/helpers',
  'app/utils/Constants'], function (e, t, i, n, s, r, o, a, d, c, l, u, h, _, f, p, g, v, m, E, b, y, k, S) {
    'use strict';
    var x,
    T = v.singleton(),
    C = i.singleton(),
    A = r.singleton(),
    w = o.singleton(),
    I = n.singleton(),
    L = S.Messages;
    x = {
      removeSplashScreen: function () {
        var e = document.getElementById('splashScreen');
        e && (e.parentNode.removeChild(e), e = null)
      },
      setMessages: function () {
        C.getMessagesConfig().then(function (e) {
          _.set('app.messages', e)
        }).done()
      },
      subscribeErrors: function () {
        var e = l.singleton().getLoggingService();
        e && h.subscribe(u.Event.ErrorOccurred, function (t) {
          if (t && t.getCode) {
            var i = A.findMessageById(t.getCode());
            (!i || i && i.log) && e.error(t.getCode(), t.getMessage())
          }
        })
      },
      addListenerToNetworkStatus: function () {
        window.addEventListener('offline', function () {
          var e = L.Network;
          A.isOpen() || m.delay(3).then(function () {
            window.navigator.onLine || A.showMessage({
              type: r.TYPE.ALERT,
              title: e.TITLE
            })
          })
        })
      },
      goToStaticLaunchPage: function () {
        e.getAppRouter().navigate('MAINTENANCE', {
          historySkip: !0
        }).complete(function () {
          x.removeSplashScreen()
        }).done()
      },
      activateHistory: function () {
        s.singleton().activate()
      },
      registerAllParsers: function (e) {
        var t = a.singleton();
        t.addDestinationParser(new c(e)),
        t.addDestinationParser(new d)
      },
      goToLaunchPage: function (t) {
        var i = [
          C.getLandingPageEntryId(),
          w.restorePersistentLogin(),
          I.getAllErrors(),
          m.delay(2.5)
        ];
        b.all(i).spread(function (i) {
          for (var n, s, o, a = 0, d = t.length; a < d; a++) if (n = t[a], n.id === i) {
            s = n;
            break
          }
          if (!s || !s.id) throw o = new u(u.FACILITY.CONFIGURATION_SERVICE, u.ERROR.INVALID, 'The app cannot get the launch page to start.'),
          r.singleton().showError(o),
          x.removeSplashScreen(),
          o;
          e.getAppRouter().navigate(s.template, {
            historySkip: !0,
            state: {
              pageId: s.id,
              pageData: s
            }
          }).complete(x.removeSplashScreen).done()
        }).done()
      },
      goToMaintenancePage: function () {
        e.getAppRouter().navigate('MAINTENANCE', {
          historySkip: !0
        }).complete(x.removeSplashScreen).done()
      },
      startMouseHandler: function () {
        E.start()
      }
    },
    T.addEventListener(T.EVT_ONLOAD, function () {
      C.getStatus().then(function (e) {
        return (e = e.toLowerCase()) !== i.STATUS.ACTIVE && e !== i.STATUS.OFFLINE ? void x.goToMaintenancePage() : (x.setMessages(), x.subscribeErrors(), x.addListenerToNetworkStatus(), x.activateHistory(), !1 === _.get('useVikiMap') ? void x.goToStaticLaunchPage() : void C.getPagesMetadata().then(function (e) {
          x.registerAllParsers(e),
          x.goToLaunchPage(e)
        }).done())
      }).done()
    }),
    b.onerror = function (e) {
      f.error(e),
      k.showError(S.ErrorMessage.APP_GENERAL)
    },
    window.onerror = function (e, t, i, n, s) {
      f.error({
        messageOrEvent: e,
        source: t,
        lineno: i,
        colno: n,
        erro: s
      }),
      k.showError(S.ErrorMessage.APP_GENERAL)
    }
  }),
  define('app', [
    'xdk-base/amd',
    'xdk-base/domReady',
    '../dep/dep.config.js',
    '../dep/img.map.js',
    'amd.config.js'
  ], function () {
  }),
  define('xdk-base/device/workstation/detection', [
  ], function () {
    'use strict';
    return function () {
      var e;
      return !(!navigator || !navigator.userAgent || (e = navigator.userAgent.toLowerCase(), !( - 1 !== e.indexOf('windows nt') && !window.Windows || - 1 !== e.indexOf('linux') && - 1 !== e.indexOf('x11') || - 1 !== e.indexOf('macintel') || - 1 !== e.indexOf('macintosh')) || - 1 === e.indexOf('chrome') && - 1 === e.indexOf('firefox')))
    }()
  }),
  define('xdk-base/device/shared/browser/TvKey', [
    'xdk-base/class',
    'xdk-base/console',
    'xdk-base/util',
    'xdk-base/device/shared/browser/keyMap',
    'require'
  ], function (e, t, i, n, s) {
    'use strict';
    return e.create({
    }, {
      __keys: null,
      __chars: null,
      init: function () {
        this.initKeyMapping(n.REMOTE)
      },
      initKeyMapping: function (e, t) {
        e && (this.__keys || (this.__keys = {
        }), i.each(e.VKey, i.bind(function (e) {
          this.__keys[e.key] = e.value
        }, this))),
        t && t.VKey && (this.__chars || (this.__chars = {
        }), i.each(t.VKey, i.bind(function (e) {
          this.__chars[e.key] = e.value
        }, this)))
      },
      initKeyHandling: function () {
        document.onkeypress = i.bind(this.keyHandler, this),
        document.onkeydown = i.bind(this.keyHandler, this)
      },
      keyHandler: function (e) {
        var t,
        i,
        n;
        return n = s('xdk-base/device').getDeviceHandler(),
        t = this.getVirtualKey(e),
        !(i = this.getMappedKey(t)) || (n.onDeviceKey(i), e.preventDefault(), !1)
      },
      __isCharTyped: function (e) {
        return e >= 65 && e <= 90 || e >= 48 && e <= 57 || e >= 96 && e <= 111 || 32 === e
      },
      getMappedKey: function (e) {
        var i = e.code,
        n = e.isChar;
        if (t.info('Received key, code :' + i + ' isChar : ' + n), n) {
          if (this.__chars && this.__chars[i]) return this.__chars[i]
        } else {
          if (this.__chars && this.__isCharTyped(i)) return !1;
          if (this.__keys[i]) return this.__keys[i]
        }
        return !1
      },
      getVirtualKey: function (e) {
        return 'keypress' === e.type.toLowerCase() ? {
          code: e.charCode,
          isChar: !0
        }
         : {
          code: e.keyCode,
          isChar: !1
        }
      },
      getKeyMapping: function () {
        var e = {
          keyCode: this.__keys
        };
        return this.__chars && (e.charCode = this.__chars),
        e
      }
    })
  }),
  define('xdk-base/device/workstation/TvKey', [
    'xdk-base/device/shared/browser/TvKey',
    'xdk-base/class',
    'xdk-base/device/vKey',
    'xdk-base/util',
    'xdk-base/device/shared/browser/keyMap'
  ], function (e, t, i, n, s) {
    'use strict';
    return t.create(e, {
    }, {
      init: function () {
        var e = n.clone(s.KEYBOARD_KEY, !0);
        e.VKey[118] = i.RED,
        e.VKey[119] = i.GREEN,
        e.VKey[120] = i.YELLOW,
        e.VKey[121] = i.BLUE,
            e.VKey[27] = i.BACK,
            e.VKey[179] = i.PLAY_PAUSE,
            e.VKey[176] = i.FF,
            e.VKey[177] = i.RW,
            e.VKey[8] = i.BACK,
        e.VKey[145] = i.EXIT,
        this.initKeyMapping(e, s.KEYBOARD_CHAR)
      }
    })
  }),
  define('xdk-base/device/helper/storageUniqueId', [
    'require',
    'xdk-base/core',
    'xdk-base/exception'
  ], function (e, t, i) {
    'use strict';
    var n = null;
    return {
      getUniqueID: function () {
        var s,
        r,
        o;
        if (!(s = e('xdk-base/device')) || !s.storage) throw t.createException(i.ILLEGAL_STATE, 'device storage is not ready and fail to generate unique id');
        if (null === n && !(n = s.storage.get('__UUID__'))) {
          for (n = '', r = 0; r < 32; r++) o = 16 * Math.random() | 0,
          8 !== r && 12 !== r && 16 !== r && 20 !== r || (n += '-'),
          n += (12 === r ? 4 : 16 === r ? 3 & o | 8 : o).toString(16);
          s.storage.set('__UUID__', n)
        }
        return n
      }
    }
  }),
  define('xdk-base/device/AbstractId', [
    'xdk-base/class',
    'xdk-base/device/interface/Id',
    'require',
    'xdk-base/device/helper/storageUniqueId'
  ], function (e, t, i, n) {
    'use strict';
    return e.createAbstract([t], {
    }, {
      getDeviceType: function () {
        return this.getHardwareType()
      },
      getMac: function () {
        return null
      },
      getFirmware: function () {
        return 'dummyFirmware'
      },
      getFirmwareYear: function () {
        return 0
      },
      getUniqueID: function () {
        return n.getUniqueID()
      },
      getModel: function () {
        return 'dummyModel'
      },
      getIP: function () {
        return '0.0.0.0'
      }
    })
  }),
  define('xdk-base/device/workstation/Id', [
    'xdk-base/class',
    'xdk-base/device/AbstractId',
    'xdk-base/device/interface/Id',
    'xdk-base/console'
  ], function (e, t, i, n) {
    'use strict';
    return e.create(t, [
      i
    ], {
    }, {
      getDeviceType: function () {
        return 'Workstation'
      },
      getHardwareType: function () {
        return i.HARDWARE_TYPE.WORKSTATION
      },
      getFirmware: function () {
        var e = 'workstation',
        t = 'DummyFirmware',
        i = navigator.userAgent.toLowerCase();
        try {
          - 1 !== i.indexOf('chrome') ? (e = 'Chrome', t = /chrome\/([\d.]+)/.exec(i) [1]) : - 1 !== i.indexOf('firefox') ? (e = 'Firefox', t = /firefox\/([\d.]+)/.exec(i) [1]) : - 1 !== i.indexOf('opera') ? (e = 'opera', t = /version\/([\d.]+)/.exec(i) [1]) : - 1 !== i.indexOf('safari') && (e = 'safari', t = /version\/([\d.]+)/.exec(i) [1])
        } catch (e) {
          n.warn('unable to determine the firmware')
        }
        return e + '/' + t
      }
    })
  }),
  define('xdk-base/device/shared/Html5System', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/core',
    'xdk-base/console',
    'require',
    'xdk-base/EventDispatcher',
    'xdk-base/device/interface/System'
  ], function (e, t, i, n, s, r, o) {
    'use strict';
    return e.createAbstract(r, [
      o
    ], {
    }, {
      _device: void 0,
      _document: void 0,
      __bindedOnVisibilityChange: void 0,
      init: function () {
        this._document = i.root.document,
        this._device = s('xdk-base/device'),
        t.isUndefined(this._document) || this._addVisibilityChangeListener()
      },
      _getDevice: function () {
        return this._device
      },
      _getDocument: function () {
        return this._document
      },
      _addVisibilityChangeListener: function () {
        var e = this._getDocument(),
        i = this._getVisibility();
        t.isUndefined(i) || (this.__bindedOnVisibilityChange = t.bind(this._onVisibilityChange, this), e.addEventListener(i.eventName, this.__bindedOnVisibilityChange, !1))
      },
      _getVisibility: function () {
        var e,
        i,
        s = this._getDocument();
        if (t.isUndefined(s.hidden)) if (t.isUndefined(s.mozHidden)) if (t.isUndefined(s.msHidden)) {
          if (t.isUndefined(s.webkitHidden)) return void n.warn('Page Visibility API is not supported in this environment.');
          e = 'webkitHidden',
          i = 'webkitvisibilitychange'
        } else e = 'msHidden',
        i = 'msvisibilitychange';
         else e = 'mozHidden',
        i = 'mozvisibilitychange';
         else e = 'hidden',
        i = 'visibilitychange';
        return {
          hidden: e,
          eventName: i
        }
      },
      _onVisibilityChange: function (e) {
        var t = this._getDevice(),
        i = t.getDeviceHandler();
        this._getDocument() [this._getVisibility().hidden] ? i.onDevicePause() : i.onDeviceResume()
      },
      deinit: function () {
        var e,
        i;
        t.isUndefined(this.__bindedOnVisibilityChange) || (e = this._getDocument(), i = this._getVisibility(), e.removeEventListener(i.eventName, this.__bindedOnVisibilityChange))
      },
      setSystemMute: e.abstractFn,
      exit: e.abstractFn,
      hasMouse: e.abstractFn,
      getDisplayResolution: e.abstractFn,
      supportSSL: e.abstractFn,
      getNetworkStatus: e.abstractFn,
      hasSOP: e.abstractFn,
      setScreenSaver: e.abstractFn,
      powerOff: e.abstractFn,
      redraw: e.abstractFn,
      hasFixedKeyboard: e.abstractFn
    })
  }),
  define('xdk-base/device/shared/ConnectionPoller', [
    'xdk-base/core',
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/console',
    'xdk-base/config',
    'xdk-base/exception'
  ], function (e, t, i, n, s, r) {
    'use strict';
    var o = t.create({
      POLLING_INTERVAL_LOWER_BOUND: 30
    }, {
      __timer: null,
      __pollingInterval: 30,
      __currentStatus: !0,
      __consecFailure: 0,
      __consecFailureThreshold: 3,
      _checkStatus: null,
      _onStatusChange: null,
      init: function (t, o, a) {
        var d;
        if (!i.isFunction(t) || !i.isFunction(o)) throw e.createException(r.ILLEGAL_ARGUMENT, 'Either checkStatus or onStatusChange function is not defined properly.');
        return this._checkStatus = t,
        this._onStatusChange = o,
        a = a || {
        },
        this.__currentStatus = !i.isBoolean(a.networkStatus) || a.networkStatus,
        this.__consecFailureThreshold = i.isNumber(a.consecFailureThreshold) ? a.consecFailureThreshold : s.get('device.connection-poller.consec-failure-threshold', this.__consecFailureThreshold),
        (d = a.pollingInterval) && this.setPollingInterval(d) ? void n.debug('[ConnectionPoller] Polling interval defined in init.') : (d = s.get('device.connection-poller.interval')) && this.setPollingInterval(d) ? void n.debug('[ConnectionPoller] Polling interval defined in XDK configuration.') : void n.info('[ConnectionPoller] Using default polling interval value, ' + this.__pollingInterval)
      },
      isConnected: function () {
        return this.__currentStatus
      },
      startPolling: function () {
        this.__timer = e.getGuid() + '-ConnectionPoller-polling',
        i.delay(this.__pollingInterval, this.__timer).then(i.bind(this.__poll, this), function () {
        }).done()
      },
      isPolling: function () {
        return null !== this.__timer
      },
      __poll: function () {
        var e = i.bind(function (t, i) {
          return t === i ? void this.startPolling() : (n.info('[ConnectionPoller] Was: ' + t + ', now: ' + i), i || !i && this.__consecFailure >= this.__consecFailureThreshold - 1 ? (this.__currentStatus = i, this._onStatusChange(this.__currentStatus), this.__consecFailure = 0, void this.startPolling()) : (this.__consecFailure++, void this._checkStatus(e)))
        }, this, this.__currentStatus);
        this._checkStatus(e)
      },
      stopPolling: function () {
        i.clearDelay(this.__timer),
        this.__timer = null,
        this.__consecFailure = 0
      },
      setPollingInterval: function (e) {
        var t = o.POLLING_INTERVAL_LOWER_BOUND;
        return !i.isNumber(e) || e < 1 ? (n.warn('[ConnectionPoller] Invalid interval, ' + e + '.'), !1) : (e < t && n.warn('[ConnectionPoller] Interval, ' + e + ', is less than the recommended value, ' + t + '.'), this.__pollingInterval = e, !0)
      },
      getPollingInterval: function () {
        return this.__pollingInterval
      }
    });
    return o
  }),
  define('xdk-base/device/workstation/System', [
    'xdk-base/class',
    'xdk-base/device/shared/Html5System',
    'xdk-base/config',
    'xdk-base/device/shared/ConnectionPoller',
    'xdk-base/device/interface/System',
    'xdk-base/util',
    'xdk-base/core',
    'xdk-base/promise'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    return e.create(t, {
    }, {
      _device: void 0,
      _document: void 0,
      __bindedOnVisibilityChange: void 0,
      __networkEventListenerCount: 0,
      init: function () {
        this._super(),
        this.__checkNetworkStatus(),
        i.get('device.workstation.resize', !1) && this.__addResizeListener()
      },
      __addResizeListener: function () {
        o.root.addEventListener('resize', r.bind(function () {
          this.dispatchEvent(s.EVT_RESIZE, this.getDisplayResolution())
        }, this))
      },
      hasMouse: function () {
        return !0
      },
      hasFixedKeyboard: function () {
        return !0
      },
      getDisplayResolution: function () {
        return i.get('device.workstation.resize', !1) ? {
          width: null !== window.innerWidth ? window.innerWidth : null !== document.body ? document.body.clientWidth : null,
          height: null !== window.innerHeight ? window.innerHeight : null !== document.body ? document.body.clientHeight : null
        }
         : i.get('device.workstation.1080p', !1) ? {
          width: 1920,
          height: 1080
        }
         : {
          width: 1280,
          height: 720
        }
      },
      supportSSL: function () {
        return !0
      },
      getNetworkStatus: function () {
        return a.resolve(this._isInternetConnected())
      },
      _isInternetConnected: function () {
        return navigator.onLine
      },
      __checkNetworkStatus: function () {
        var e,
        t;
        e = r.bind(function (e) {
          e(this._isInternetConnected())
        }, this),
        t = r.bind(function (e) {
          this.dispatchEvent(s.EVT_NETWORK_STATUS_CHANGED, e)
        }, this),
        this._internetPoller = new n(e, t, {
          networkStatus: this._isInternetConnected()
        })
      },
      addEventListener: function (e, t, i) {
        return this._internetPoller && e === s.EVT_NETWORK_STATUS_CHANGED && (0 === this.__networkEventListenerCount && this._internetPoller.startPolling(), this.__networkEventListenerCount++),
        this._super(e, t, i)
      },
      removeEventListener: function (e, t) {
        return this._internetPoller && e === s.EVT_NETWORK_STATUS_CHANGED && 0 === --this.__networkEventListenerCount && this._internetPoller.stopPolling(),
        this._super(e, t)
      },
      setScreenSaver: function (e) {
        return !1
      },
      setSystemMute: function (e) {
        return !1
      },
      powerOff: function () {
        return !1
      },
      redraw: function (e) {
        return !1
      },
      exit: function () {
        return !1
      },
      hasSOP: function () {
        return !0
      }
    })
  }),
  define('xdk-base/device/workstation/DevicePackage', [
    'xdk-base/device/AbstractDevicePackage',
    'xdk-base/device/shared/LocalStorage',
    'xdk-base/device/workstation/TvKey',
    'xdk-base/device/workstation/Id',
    'xdk-base/device/workstation/System',
    'xdk-base/device/Media',
    'xdk-base/class',
    'xdk-base/util'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    return o.create(e, {
    }, {
      _shouldSetup: !0,
      getId: function () {
        return 'workstation'
      },
      setup: function (e) {
        var t;
        this._super(e),
        t = this.getInterfaceTypes(),
        a.each(t, a.bind(function (e) {
          this.addInterfaceType(e.key, e.value.handle, e.value.interfaceObj)
        }, this)),
        this.ready()
      },
      getDefaultPlayer: function () {
        return ['xdk-ext-device-windows/Html5Player']
      },
      getInterfaceTypes: function () {
        var o = {
        };
        return o[e.STORAGE] = {
          handle: e.STORAGE_HANDLE,
          interfaceObj: new t
        },
        o[e.MEDIA_PLAYER] = {
          handle: e.MEDIA_PLAYER_HANDLE,
          interfaceObj: r.singleton()
        },
        o[e.TV_KEY] = {
          handle: e.TV_KEY_HANDLE,
          interfaceObj: new i
        },
        o[e.ID] = {
          handle: e.ID_HANDLE,
          interfaceObj: new n
        },
        o[e.SYSTEM] = {
          handle: e.SYSTEM_HANDLE,
          interfaceObj: new s
        },
        o
      }
    })
  }),
  define('xdk-base/device/shared/Html5Player', [
    'xdk-base/core',
    'xdk-base/class',
    'xdk-base/device/AbstractPlayer',
    'xdk-base/device/interface/Player',
    'xdk-base/device/Media',
    'xdk-base/util',
    'xdk-base/console',
    'require'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    var d = s.singleton(),
    c = null,
    l = function () {
      return c || (c = a('xdk-base/device').system.getDisplayResolution())
    },
    u = n.PLAYBACK_ERRORS;
    return t.create(i, {
    }, {
      _onLoaded: !1,
      _CONTAINER_NAME: 'Html5PlayerContainer',
      _parentNode: null,
      _playerObject: null,
      _prepared: !1,
      _duration: 0,
      _connectionTimeLimit: 90,
      _connectionTimeOut: null,
      _connected: !1,
      _pausedVideo: !1,
      _supportHLS: !1,
      _supportDASH: !1,
      _support: !0,
      _seek: !1,
      _seekTime: 0,
      _url: null,
      __hasFinished: !0,
      __errorReported: !1,
      init: function () {
        this.__bindedOnLoad = r.bind(this._onLoad, this),
        this.__bindedOnTimeUpdate = r.bind(this._onTimeUpdate, this),
        this.__bindedOnWaiting = r.bind(this._onWaiting, this),
        this.__bindedOnPlaying = r.bind(this._onPlaying, this),
        this.__bindedOnPause = r.bind(this._onPause, this),
        this.__bindedOnError = r.bind(this._onError, this),
        this.__bindedOnFinished = r.bind(this._onFinished, this),
        this.__bindedOnCanPlay = r.bind(this._onCanPlay, this),
        this.__bindedOnDurationChange = r.bind(this._onDurationChange, this),
        this.__bindedOnRateChange = r.bind(this._onRateChange, this)
      },
      prepare: function (e) {
        o.info('html5 player prepare' + e),
        this._prepared || (this._parentNode = document.getElementsByTagName('body') [0], this._playerContainer = document.createElement('div'), this._playerContainer.id = this._CONTAINER_NAME, this._playerContainer.className = 'playerContainer', this._playerObject = document.createElement('video'), this._playerObject.id = 'Html5Player', this._playerObject.className = 'playerObject', this._playerContainer.appendChild(this._playerObject), this._parentNode.appendChild(this._playerContainer), this._addVideoEventListeners(this._playerObject), this.hide(), this._prepared = !0)
      },
      reset: function () {
        this._prepared && (this.hide(), this._stopPlayback(), this._removeVideoEventListeners(this._playerObject), this.deinit())
      },
      deinit: function () {
        this._prepared && (this._prepared = !1, this._stopPlayback(), this._playerContainer ? (this._playerContainer.removeChild(this._playerObject), this._parentNode.removeChild(this._playerContainer), this._playerContainer = null) : this._parentNode.removeChild(this._playerObject), o.info('HTML5 video player deinit successfull.'))
      },
      play: function (t) {
        if (this.__errorReported) return void o.warn('[Html5Player] Play after error. A load() operation is expected to reset the state.');
        if (o.info('[XKD HTML5] Play requested.'), !this._support) return this._stopPlayback(),
        void d._onError(u.RENDER.UNSUPPORTED, 'unsupport format in the html5 video player');
        if (!this.url || this._playerObject.getAttribute('src') && this._playerObject.getAttribute('src') === this.url || (this._playerObject.setAttribute('src', this.url), this._playerObject.load()), this.show(), this._connected || (this._connected = !0, d._onConnecting(), this._doPlay(), this._removeConnectionTimeOut(), this._connectionTimeOut = e.getGuid(), r.delay(this._connectionTimeLimit, this._connectionTimeOut).then(r.bind(this._onConnectionTimeout, this), function () {
        }).done()), this.__hasFinished = !1, this._pausedVideo = !1, this._seek = !1, t && !r.isUndefined(t.sec) && (this._seek = !0, this._seekTime = t.sec), 1 !== this.getPlaybackSpeed() && (this._playerObject.playbackRate = 1), this._onLoaded && (this._removeConnectionTimeOut(), this._seek && this._seekTime > 0)) {
          var i = r.bind(function () {
            this._playerObject.removeEventListener('seeked', i),
            this._pausedVideo || this._doPlay()
          }, this);
          return this._playerObject.addEventListener('seeked', i),
          this.__setCurrentTime(this._seekTime),
          void (this._seek = !1)
        }
        this._doPlay()
      },
      pause: function () {
        o.info('[XDK HTML5] Pausing video.'),
        this._pausedVideo = !0,
        this._doPause(),
        d._onPause()
      },
      stop: function () {
        o.info('[XDK HTML5] Stopping video'),
        this._stopPlayback(),
        d._onStopped()
      },
      _stopPlayback: function () {
        this._doPause(),
        this.hide(),
        this._removeConnectionTimeOut(),
        this._connected = !1,
        this._onLoaded && !this.__hasFinished && this.__setCurrentTime(0)
      },
      resume: function () {
        o.info('[XDK HTML5] Resuming...'),
        this._doPlay(),
        this._pausedVideo = !1,
        1 !== this.getPlaybackSpeed() && (this._playerObject.playbackRate = 1)
      },
      skip: function (e) {
        this.__setCurrentTime(this.getCurTime() + e)
      },
      seek: function (e) {
        e === this._duration && (e = Math.floor(this.getDuration() - 1)),
        this.__setCurrentTime(e)
      },
      getPlaybackSpeed: function () {
        return this._playerObject.playbackRate
      },
      getCurTime: function () {
        return this._playerObject.currentTime
      },
      _setDuration: function () {
        var e = this._playerObject.duration;
        this._duration = r.isNumber(e) && !r.isNaN(e) ? e : 0
      },
      getDuration: function () {
        return this._duration
      },
      show: function () {
        this._playerObject && (this._playerObject.style.visibility = 'visible')
      },
      hide: function () {
        this._playerObject && (this._playerObject.style.visibility = 'hidden')
      },
      getCapabilities: function () {
        var e = {
          type: [
            'mp4',
            'mp3'
          ]
        };
        return this._supportHLS && e.type.push('hls'),
        this._supportDASH && e.type.push('dash'),
        e
      },
      load: function (e, t) {
        return this.url = e,
        !!this._prepared && (t = t || {
        }, this._preparePlayerObject(t) && this._doLoad(e, t), e)
      },
      isMetadataLoaded: function () {
        return this._onLoaded
      },
      setWindowSize: function (e) {
        if (!this._playerObject) return void o.warn('[Html5Player] Fail to set the size due to no playerObject');
        var t = 'playerObject',
        i = l();
        e.relativeToParent && (t += ' relative'),
        e.width === i.width && e.height === i.height && (t += ' fullscreen'),
        this._playerObject.className = t,
        this._playerObject.style.width = e.width + 'px',
        this._playerObject.style.height = e.height + 'px',
        this._playerObject.style.left = e.left + 'px',
        this._playerObject.style.top = e.top + 'px',
        this._currentWindowSize = e
      },
      setFullscreen: function () {
        var e = l();
        this.setWindowSize({
          top: 0,
          left: 0,
          height: e.height,
          width: e.width
        })
      },
      _preparePlayerObject: function (e) {
        return !!this._playerObject && (e.parentNode && (this._playerContainer && (this._parentNode.removeChild(this._playerContainer), this._playerContainer = null), this._parentNode = e.parentNode, this._parentNode.appendChild(this._playerObject)), !0)
      },
      _doLoad: function (e, t) {
        this.__hasFinished = !1,
        this.__errorReported = !1,
        this._onLoaded = !1,
        this._connected = !1,
        this._pausedVideo = !0,
        this._playerObject.setAttribute('src', e),
        this._playerObject.load(),
        this.hide(),
        'mp3' === t.type && this.setWindowSize({
          width: 0,
          height: 0,
          top: 0,
          left: 0
        }),
        this._support = this._canPlayMedia(t)
      },
      _doPlay: function () {
        this._playerObject.play()
      },
      _doPause: function () {
        this._playerObject.pause()
      },
      _canPlayMedia: function (e) {
        var t = this.getCapabilities(),
        i = e.type,
        n = e.drm,
        s = !(i && - 1 === t.type.indexOf(i)) || '*' === i,
        r = !(n && - 1 === t.drms.indexOf(n));
        return s && r
      },
      _onCanPlay: function () {
        !this._pausedVideo && this._connected && this._doPlay()
      },
      _onConnectionTimeout: function () {
        this._stopPlayback(),
        d._onError(u.NETWORK.FAILED)
      },
      _onDurationChange: function () {
        this._onLoaded = !0,
        this._setDuration(),
        this._performInitialSeek()
      },
      _onLoad: function () {
        this._removeConnectionTimeOut(),
        this._onDurationChange(),
        this._connected && 1 === this.getPlaybackSpeed() && (o.info('[XDK HTML5] onload event'), d._onBufferingStart(), d._onBufferingProgress())
      },
      _performInitialSeek: function () {
        !this._seek || this._seekTime < 0 || this._seekTime > this._duration || (this.__setCurrentTime(this._seekTime), this._seek = !1)
      },
      _addVideoEventListeners: function (e) {
        e.addEventListener('loadedmetadata', this.__bindedOnLoad),
        e.addEventListener('waiting', this.__bindedOnWaiting),
        e.addEventListener('timeupdate', this.__bindedOnTimeUpdate),
        e.addEventListener('seeking', this.__bindedOnWaiting),
        e.addEventListener('seeked', this.__bindedOnPlaying),
        e.addEventListener('playing', this.__bindedOnPlaying),
        e.addEventListener('pause', this.__bindedOnPause),
        e.addEventListener('error', this.__bindedOnError),
        e.addEventListener('ended', this.__bindedOnFinished),
        e.addEventListener('canplay', this.__bindedOnCanPlay),
        e.addEventListener('durationchange', this.__bindedOnDurationChange),
        e.addEventListener('ratechange', this.__bindedOnRateChange)
      },
      _removeVideoEventListeners: function (e) {
        e.removeEventListener('loadedmetadata', this.__bindedOnLoad),
        e.removeEventListener('waiting', this.__bindedOnWaiting),
        e.removeEventListener('timeupdate', this.__bindedOnTimeUpdate),
        e.removeEventListener('seeking', this.__bindedOnWaiting),
        e.removeEventListener('seeked', this.__bindedOnPlaying),
        e.removeEventListener('playing', this.__bindedOnPlaying),
        e.removeEventListener('pause', this.__bindedOnPause),
        e.removeEventListener('error', this.__bindedOnError),
        e.removeEventListener('ended', this.__bindedOnFinished),
        e.removeEventListener('canplay', this.__bindedOnCanPlay),
        e.removeEventListener('durationchange', this.__bindedOnDurationChange),
        e.removeEventListener('ratechange', this.__bindedOnRateChange)
      },
      _removeConnectionTimeOut: function () {
        null !== this._connectionTimeOut && (r.clearDelay(this._connectionTimeOut), this._connectionTimeOut = null)
      },
      _onWaiting: function () {
        d.isState(d.CONNECTING) || this.__needBlockStateChange() || (o.info('[xdk html5] waiting'), d._onBufferingStart(), d._onBufferingProgress())
      },
      __needBlockStateChange: function () {
        return !this._connected || 1 !== this.getPlaybackSpeed()
      },
      _onPlaying: function () {
        this.__needBlockStateChange() || (o.info('[xdk html5] onplaying event'), this._removeConnectionTimeOut(), this._pausedVideo ? d._onPause() : d._onPlaying(), d.isState(d.BUFFERING) && d._onBufferingFinish())
      },
      _onPause: function () {
        o.info('[xdk html5] onpause event'),
        d.isState(d.STOPPED) || d._onPause()
      },
      _onTimeUpdate: function () {
        var e;
        this._connected && (e = this.getCurTime(), e < 0 && (e = 0), d._onTimeUpdate(e))
      },
      _onFinished: function () {
        o.info('[XDK HTML5] finished event'),
        this.__hasFinished = !0,
        this._stopPlayback(),
        d._onFinish()
      },
      _onError: function (e) {
        if (!this.__hasFinished && !this.__errorReported) {
          var t;
          if (this._playerObject.networkState === this._playerObject.NETWORK_NO_SOURCE) t = u.NETWORK.FILE,
          this._removeConnectionTimeOut(),
          this.hide(),
          this._connected = !1,
          this._onLoaded = !1;
           else {
            switch (e.target.error.code) {
              case e.target.error.MEDIA_ERR_ABORTED:
                t = u.RENDER.ABORTED;
                break;
              case e.target.error.MEDIA_ERR_NETWORK:
                t = u.NETWORK.FAILED;
                break;
              case e.target.error.MEDIA_ERR_DECODE:
                t = u.RENDER.DECODE;
                break;
              case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:
                t = u.RENDER.UNSUPPORTED;
                break;
              default:
                t = u.RENDER.FAILED
            }
            this._stopPlayback()
          }
          this.__errorReported = !0,
          o.error('[XDK HTML5] onRenderError : '),
          d._onError(t)
        }
      },
      _onRateChange: function () {
        if (1 !== this._playerObject.playbackRate) return void d._onSpeeding();
        d._onPlaying()
      },
      getPlayerObject: function () {
        return this._playerObject
      },
      speed: function (e) {
        return r.isNumber(e) ? e <= 0 ? void o.warn('Negative playbackRate is not supported') : (d.isState(d.PAUSED) && this._doPlay(), this._playerObject.playbackRate = e, void (this._pausedVideo = !1)) : void o.warn('Speed value must be a number')
      },
      __setCurrentTime: function (e) {
        this._playerObject.currentTime = e
      }
    })
  }),

  define('xdk-ext-device-windows/DrmMessenger', [
    'xdk-base/console',
    'xdk-base/util',
    'xdk-base/promise'
  ], function (e, t, i) {
    'use strict';
    function n(e) {
      if (!e) return '( Service Request Object ' + e + ')';
      var t = '';
      switch (e.type) {
        case d.licenseAcquirerServiceRequestType:
          t = l.LICENSE_ACQUIRE;
          break;
        case d.individualizationServiceRequestType:
          t = l.INDIVIDUALIZATION_;
          break;
        case d.domainJoinServiceRequestType:
          t = l.DOMAIN_JOIN;
          break;
        case d.domainLeaveServiceRequestType:
          t = l.DOMAIN_LEAVE;
          break;
        case d.meteringReportServiceRequestType:
          t = l.DOMAIN_METERING;
          break;
        case d.secureStopServiceRequestType:
          t = l.SECURE_STOP;
          break;
        default:
          t = '( UNKNOWN TYPE! )' + e.type
      }
      return t
    }
    function s(t, i, n) {
      var s,
      r = n.drmUrl,
      o = n.customData;
      if (t.uri && e.debug('current LA serviceRequest URL = ' + t.uri.absoluteUri, 3), t.challengeCustomData && e.debug('current LA serviceRequest challengeCustomData = ' + t.challengeCustomData, 3), r) {
        e.debug('override lauri = ' + r, 3);
        try {
          t.uri = Windows.Foundation.Uri(r)
        } catch (t) {
          e.debug('exception(configLASR) uri:', t)
        }
      } else e.debug('use default url from header: ' + t.uri, 3);
      if (o) {
        e.debug('setting custom data - objLASR.challengeCustomData = ' + o, 3);
        try {
          t.challengeCustomData = o
        } catch (t) {
          e.debug('exception(configLASR) customData:', t)
        }
      }
      if (t.contentHeader) {
        if (!(s = t.contentHeader.keyIdStrings)) return s = t.contentHeader.keyIdString,
        void e.debug('Enabler KeyId: ' + s, 6);
        for (var a = 0; a < s.length; a++) e.debug('Enabler KeyId[' + a + ']:' + s[a], 6)
      }
    }
    function r(t, i, n) {
      t.uri || e.debug('current domain join serviceRequest URL = ' + t.uri.absoluteUri, 3);
      var s = n.joinDomain,
      r = n.domainId,
      o = n.serviceId;
      e.debug('override domainUri = ' + s, 3);
      try {
        t.uri = Windows.Foundation.Uri(s),
        t.domainServiceId = r,
        t.domainAccountId = o
      } catch (t) {
        e.debug('exception(configDomainSR):', t)
      }
    }
    function o(t, i, n) {
      try {
        t.uri || e.debug('current secure stop serviceRequest URL = ' + t.uri.absoluteUri, 3);
        var s = n.actualLaurl;
        e.debug('override securesStopUri = ' + s, 3),
        t.uri = Windows.Foundation.Uri(s)
      } catch (t) {
        e.debug('exception(configSecureStopSR):', t)
      }
    }
    function a(e, t, i) {
      switch (n(e)) {
        case l.LICENSE_ACQUIRE:
          s(e, t, i);
          break;
        case l.DOMAIN_JOIN:
        case l.DOMAIN_LEAVE:
          r(e, t, i);
          break;
        case l.SECURE_STOP:
          o(e, t, i)
      }
    }
    var l = {
      LICENSE_ACQUIRE: 'PlayReadyLicenseAcquirerServiceRequest',
      INDIVIDUALIZATION: 'IndividualizationServiceRequest',
      DOMAIN_JOIN: 'PlayReadyDomainJoinServiceRequest',
      DOMAIN_LEAVE: 'PlayReadyDomainLeaveServiceRequest',
      DOMAIN_METERING: 'PlayReadyMeteringServiceRequest',
      SECURE_STOP: 'PlayReadySecureStopServiceRequest'
    },
    d = Windows.Media.Protection.PlayReady.PlayReadyStatics;
    return {
      sendLicense: function (s, r, o, d) {
        d = d || i.defer();
        var u = n(s);
        e.debug('service request type ' + u),
        a(s, r, o),
        e.debug('Querying Data set on service request\n', 3),
        e.debug('Protection System ID:' + s.protectionSystem, 6),
        e.debug('Service request type:' + u, 6),
        s.uri ? e.debug('Default Uri:' + s.uri.absoluteUri, 6) : e.debug('Default Uri: (NULL)\n', 6),
        e.debug('Starting PlayReadyServiceRequest processing ', 3);
        var c = function () {
          e.debug(u + ' operation completed successfully'),
          u === l.INDIVIDUALIZATION && e.debug('playready security version is ' + Windows.Media.Protection.PlayReady.PlayReadyStatics.playReadySecurityVersion),
          d.resolve()
        },
        h = function (t) {
          if (e.debug('operation errored out!'), - 2147174251 === t.number) {
            e.debug('onServiceRequestError MSPR_E_CONTENT_ENABLING_ACTION_REQUIRED (0x8004b895)');
            var i = s.nextServiceRequest();
            if (e.debug('serviceRequest for the next service' + s), i) return e.debug('NextServiceRequest returned a new SR'),
            void this.sendLicense(i, r, o, d)
          }
          e.debug('exception(onServiceRequestError)', t),
          d.reject(t)
        };
        return e.debug('using promises model ( serviceRequest.then(..) )', 3),
        s.beginServiceRequest().then(c, t.bind(h, this)).done(),
        d.promise
      }
    }
  }),
  define('xdk-ext-device-windows/Html5Player', [
    'xdk-base/class',
    'xdk-base/device/shared/Html5Player',
    'xdk-base/console',
    './DrmMessenger',
    'xdk-base/util',
    'xdk-base/device/Media',
    'xdk-base/device/interface/Player',
    'xdk-base/core',
    'app/helper/helpers'
  ], function (e, t, i, n, s, r, o, a, l, d, u) {
    'use strict';
    function c() {
      var e = new Windows.Media.MediaExtensionManager;
      try {
        e.registerByteStreamHandler('Microsoft.Media.AdaptiveStreaming.SmoothByteStreamHandler', '.ism', 'text/xml'),
        e.registerByteStreamHandler('Microsoft.Media.AdaptiveStreaming.SmoothByteStreamHandler', '.ism', 'application/vnd.ms-ss'),
        e.registerByteStreamHandler('Windows.Media.Protection.PlayReady.PlayReadyByteStreamHandler', '.pyv', null),
        e.registerByteStreamHandler('Windows.Media.Protection.PlayReady.PlayReadyByteStreamHandler', '.pya', null)
      } catch (e) {
        i.debug(m + 'Fail to register the stream handler' + e.message)
      }
    }
    var h,
    p,
    g,
    _ = r.singleton(),
    f = o.PLAYBACK_ERRORS,
    v = Windows.Media.Streaming.Adaptive,
    m = '[' + '] >>---[XBOXONE Html5Player Override]---> ',
    y = {
      401: f.NETWORK.FILE
    };
    return e.create(t, {
    }, {
      __lastPlayPosition: 0,
      _startBufferingCheck: function () {
        if (this._stopBufferingCheck(), _.isState(_.PAUSED)) return void i.debug(m + 'Abort _startBufferingCheck in PAUSED state');
        s.delay(0.1, 'html5player:buffering-check').then(s.bind(function () {
          if (!this._connected) return void i.debug(m + 'Not connected. Ignore buffering check.');
          var e = Math.floor(1000 * this.getCurTime()),
          t = _.isState(_.BUFFERING),
          n = e >= this.__lastPlayPosition + 95;
          if (!t && !n) {
            i.debug(m + 'Enter buffering state...'),
            _._onBufferingStart(),
            _._onBufferingProgress();
            try {
              //a.youboraPlugin.getAdapter().fireBufferBegin()
            } catch (e) {
              i.error(m + 'Error in Youbora call fireBufferBegin' + e)
            }
          }
          if (t && n) {
            _._onBufferingFinish(),
            i.debug(m + '... Buffering state ended.');
            try {
              //a.youboraPlugin.getAdapter().fireBufferEnd()
            } catch (e) {
              i.error(m + 'Error in Youbora call fireBufferEnd' + e)
            }
          }
          this.__lastPlayPosition = e,
          this._startBufferingCheck()
        }, this))
      },
      _stopBufferingCheck: function () {
        s.clearDelay('html5player:buffering-check')
      },
      _doPause: function () {
        this._stopBufferingCheck(),
        this._super()
      },
      getCapabilities: function () {
        return {
          type: [
            'mp4',
            'asf',
            'mp3',
            'hls',
            'dash'
          ],
          drms: [
            'playready'
          ]
        }
      },
      prepare: function (e) {
        this._prepared && (this._prepared = !1, this._stopPlayback(), this._playerContainer ? (this._playerContainer.removeChild(this._playerObject), this._parentNode.removeChild(this._playerContainer), this._playerContainer = null) : this._parentNode.removeChild(this._playerObject), URL.revokeObjectURL(g), this.isMediaSourceCreated = null, i.debug(m + 'HTML5 video player unprepared successfully')),
        this._super(e),
        e.drm && c()
      },
      load: function (e, t) {
        this._super(e, t),
        this.__opts = t,
        this.__setupMediaProtectionManager();
        try {
          this.getPlayerObject().msSetMediaProtectionManager(this.__mediaProtectionManager)
        } catch (e) {
          i.debug(m + '>>setting the protection', e)
        }
        try {
          Windows.Media.SystemMediaTransportControls.getForCurrentView().playbackStatus = Windows.Media.MediaPlaybackStatus.stopped
        } catch (e) {
          i.warn(m + '[HTML5Player] Could not set the transport controls to stopped')
        }
      },
      isStreamNonDash: function () {
        return this.url.indexOf('.mp4') > - 1 || this.url.indexOf('.m3u8') > - 1
      },
      _doLoad: function (e, t) {
        i.debug(m + '[HTML5Player] DOLOAD', e, t),
        this.__hasFinished = !1,
        this.__errorReported = !1,
        this._onLoaded = !1,
        this._connected = !1,
        this._pausedVideo = !0;
        var n = this,
        r = s.bind(function () {
          i.debug(m + '[HTML5Player] _DOLOAD callback fired!'),
          'mp3' === t.type && this.setWindowSize({
            width: 0,
            height: 0,
            top: 0,
            left: 0
          }),
          this._support = this._canPlayMedia(t)
        }, this);
        if (this.isStreamNonDash()) return i.debug(m + '[HTML5Player] Video format is MP4! _doLoadCallback immediately!'),
        void r();
        h = new Windows.Foundation.Uri(e),
        p = null,
        v.AdaptiveMediaSource.createFromUriAsync(h).done(function (e) {
          n.onMediaSourceCreated(e, r)
        })
      },
      __setupMediaProtectionManager: function () {
        var e,
        t;
        try {
          i.debug(m + 'Creating new Windows.Media.Protection.MediaProtectionManager'),
          e = new Windows.Media.Protection.MediaProtectionManager,
          i.debug(m + '--- Setting up MediaProtectionSystemId'),
          e.properties['Windows.Media.Protection.MediaProtectionContainerGuid'] = '{9A04F079-9840-4286-AB92-E65BE0885F95}',
          t = new Windows.Foundation.Collections.PropertySet,
          t['{F4637010-03C3-42CD-B932-B48ADF3A6A54}'] = 'Windows.Media.Protection.PlayReady.PlayReadyWinRTTrustedInput',
          e.properties['Windows.Media.Protection.MediaProtectionSystemIdMapping'] = t,
          e.properties['Windows.Media.Protection.MediaProtectionSystemId'] = '{F4637010-03C3-42CD-B932-B48ADF3A6A54}';
          var n = Windows.Storage.ApplicationData.current.localSettings;
          i.debug(m + 'set up media protection manager with local settings', n);
          var r;
          n.containers.hasKey('PlayReady') && 'undefined' !== (r = n.containers.lookup('PlayReady').values.SoftwareOverride) && 1 === r && (i.debug(m + '***** Use Software Protection Layer ******'), e.properties['Windows.Media.Protection.UseSoftwareProtectionLayer'] = !0)
        } catch (e) {
          i.debug(m + 'Exception(setupMediaProtectionManager): ' + e.message)
        }
        e.addEventListener('componentloadfailed', this.__onComponentLoadFailed, !1),
        e.addEventListener('servicerequested', s.bind(this.__onServiceRequested, this), !1),
        this.__mediaProtectionManager = e
      },
      __onComponentLoadFailed: function (e) {
        i.debug(m + e.information.items.size + ' failed components!'),
        s.each(e.information.items, function (e) {
          i.debug(m + e.name + '\nReasons=0x' + e.reasons + '\nRenewal Id=' + e.renewalId)
        }),
        e.completion.complete(!1),
        i.debug(m + 'Resumed source (false)')
      },
      __onServiceRequested: function (e) {
        try {
          i.debug(m + 'calling onServiceRequested');
          var t = e.request,
          s = e.completion;
          n.sendLicense(t, this.url, this.__opts).then(function () {
            i.debug(m + 'send license complete true'),
            s.complete(!0)
          }, function (e) {
              i.debug(m + 'send license fail'),
            u.setNativePlayerError({
              message: 'Send license fail',
              code: f.DRM.FAILED
            }),
            _._onError(f.DRM.FAILED);
            try {
              //a.youboraAdapter.fireFatalError(f.DRM.FAILED.code, f.DRM.FAILED.desc),
              //a.youboraPlugin.disable()
            } catch (e) {
              i.error('Error in Youbora call fireFatalError' + e)
            }
          })
        } catch (e) {
          i.debug(m + 'Exception(onServiceRequested): ', e),
          u.setNativePlayerError({
            message: 'Exception(onServiceRequested)',
            error: e
          })
        }
      },
      _onPlaying: function () {
        var e = this;
        try {
          Windows.Media.SystemMediaTransportControls.getForCurrentView().playbackStatus = Windows.Media.MediaPlaybackStatus.playing
        } catch (e) {
          i.warn(m + '[HTML5Player] Could not set the transport controls to playing')
        }
        s.clearDelay('html5player:delayed-start-buffering-check'),
        s.delay(1, 'html5player:delayed-start-buffering-check').then(function () {
          i.debug(m + '_onPlaying delayed _startBufferingCheck'),
          e._startBufferingCheck()
        }),
        this._super()
      },
      pause: function () {
        try {
          //a.youboraPlugin.getAdapter().firePause()
        } catch (e) {
          i.error(m + 'Error in Youbora call firePause' + e)
        }
        try {
          Windows.Media.SystemMediaTransportControls.getForCurrentView().playbackStatus = Windows.Media.MediaPlaybackStatus.paused
        } catch (e) {
          i.warn(m + '[HTML5Player] Could not set the transport controls to paused')
        }
        this._super()
      },
      _stopPlayback: function () {
        this._super(),
        this._stopBufferingCheck(),
        this.__lastPlayPosition = 0
      },
      resume: function () {
        try {
          //a.youboraPlugin.getAdapter().fireResume()
        } catch (e) {
          i.error(m + 'Error in Youbora call fireResume' + e)
        }
        i.debug(m + '[XDK HTML5] Resuming...'),
        this._doPlay(),
        this._pausedVideo = !1,
        1 !== this.getPlaybackSpeed() && (this._playerObject.playbackRate = 1)
      },
      skip: function (e) {
        try {
          //a.youboraPlugin.getAdapter().fireSeekBegin()
        } catch (e) {
          i.error(m + 'Error in Youbora call fireSeekBegin' + e)
        }
        this.__setCurrentTime(this.getCurTime() + e)
      },
      seek: function (e) {
        try {
          //a.youboraPlugin.getAdapter().fireSeekBegin()
        } catch (e) {
          i.error(m + 'Error in Youbora call fireSeekBegin' + e)
        }
        e === this.getDuration() && (e = Math.floor(this.getDuration() - 1)),
        this.__setCurrentTime(e)
      },
      _onLoad: function () {
        if (this._onDurationChange(), this._connected && 1 === this.getPlaybackSpeed()) {
          try {
            //a.youboraPlugin.getAdapter().fireBufferBegin()
          } catch (e) {
            i.error(m + 'Error in Youbora call fireBufferBegin' + e)
          }
          i.debug(m + '[XDK HTML5] onload event'),
          _._onBufferingStart(),
          _._onBufferingProgress()
        }
      },
      onMediaSourceCreated: function (e, t) {
        if (i.debug(m + 'this.isMediaSourceCreated=' + this.isMediaSourceCreated), this.isMediaSourceCreated) return i.debug(m + '...CALLBACK!'),
        void (s.isFunction(t) && t());
        this.isMediaSourceCreated = !0;
        var n = function (e) {
          var t = [
            'Success',
            'ManifestDownloadFailure',
            'ManifestParseFailure',
            'UnsupportedManifestContentType',
            'UnsupportedManifestVersion',
            'UnsupportedManifestProfile',
            'UnknownFailure'
          ];
          return e < 0 || e > t.length ? 'Unknown AdaptiveMediaSourceCreationStatus' : t[e]
        };
        if (e.status === v.AdaptiveMediaSourceCreationStatus.success) {
          try {
            //a && a.youboraPlugin && a.youboraPlugin.getAdapter() && a.youboraPlugin.getAdapter().setMediaSource(e.mediaSource)
          } catch (e) {
            i.error(m + ' Error while setting Media Source in Youbora' + e)
          }
          i.log(m + 'AdaptiveMediaSource.createFromUriAsync completed with status: ' + e.status + ' - ' + n(e.status), 'sample', 'status'),
          p = e.mediaSource;
          try {
            p && (g = URL.createObjectURL(p, {
              oneTimeOnly: !0
            }), this._playerObject.setAttribute('src', g), this._playerObject.load(), i.log(m + 'Set media element src to the AdaptiveMediaSource for url: ' + g, 'sample', 'status'), s.isFunction(t) && t())
          } catch (e) {
            i.log(m + 'EXCEPTION: ' + e.toString(), 'sample', 'error')
          }
        } else {
          var r = '',
          o = e.httpResponseMessage;
          null != o && (r = ' (HTTP response: ' + o.statusCode + ' - ' + o.reasonPhrase, o.isSuccessStatusCode && e.status == v.AdaptiveMediaSourceCreationStatus.unsupportedManifestContentType && null != o.content && (r += '; Content-Type: ' + o.content.headers.contentType), r += ')');
          var l = n(e.status);
          i.log(m + 'Failed to create adaptive media source: ' + l + r, 'sample', 'error');
          try {
            //a.youboraPlugin.getAdapter().fireError(e.status, l)
          } catch (e) {
            i.error(m + 'Error in youbora call fireError' + e)
          }
          i.log(m + 'result.httpResponseMessage.statusCode=>', e.httpResponseMessage.statusCode),
              console.log({
                  error: {
                      extendedError: e.extendedError,
                      statusCode: e.httpResponseMessage.statusCode,
                      source: e.httpResponseMessage.source,
                      version: e.httpResponseMessage.version,
                      isSuccessStatusCode: e.httpResponseMessage.isSuccessStatusCode,
                      reasonPhrase: e.httpResponseMessage.reasonPhrase
                  },
                  message1: r,
                  message2: l,
                  code: e.httpResponseMessage.statusCode
              })
          _._onError(y[e.httpResponseMessage.statusCode])
        }
      },
      deinit: function () {
        this._prepared && (this._prepared = !1, this._stopPlayback(), this._playerContainer ? (this._playerContainer.removeChild(this._playerObject), this._parentNode.removeChild(this._playerContainer), this._playerContainer = null) : this._parentNode.removeChild(this._playerObject), i.info(m + 'deinit this.url=', this.url), this.isStreamNonDash() ? this._playerObject.setAttribute('src', '') : URL.revokeObjectURL(g), this.isMediaSourceCreated = null, i.debug(m + 'HTML5 video player deinit successfully'))
      },
      play: function (e) {
        i.debug(m + '[Html5Player] PLAY', e);
        var t = this,
        n = s.bind(function () {
          if (i.debug(m + '[HTML5Player] PLAY callback fired!'), this.show(), this._connected || (this._connected = !0, _._onConnecting(), this._doPlay()), this.__hasFinished = !1, this._pausedVideo = !1, this._seek = !1, e && !s.isUndefined(e.sec) && (this._seek = !0, this._seekTime = e.sec), 1 !== this.getPlaybackSpeed() && (this._playerObject.playbackRate = 1), this._onLoaded && this._seek && this._seekTime > 0) {
            var t = s.bind(function () {
              this._playerObject.removeEventListener('seeked', t),
              this._pausedVideo || this._doPlay()
            }, this);
            return this._playerObject.addEventListener('seeked', t),
            this.__setCurrentTime(this._seekTime),
            void (this._seek = !1)
          }
          this._doPlay()
        }, this);
        if (this.__errorReported) return void i.warn(m + '[Html5Player] Play after error. A load() operation is expected to reset the state.');
        if (i.debug(m + '[XKD HTML5] Play requested.'), !this._support) return this._stopPlayback(),
        u.setNativePlayerError({
          message: 'Unsupported format in the html5 video player',
          code: f.RENDER.UNSUPPORTED
        }),
        void _._onError(f.RENDER.UNSUPPORTED, 'unsupport format in the html5 video player');
        if (this.url && (!this._playerObject.getAttribute('src') || this._playerObject.getAttribute('src') !== this.url)) {
          if (this.isStreamNonDash()) return this._playerObject.setAttribute('src', this.url),
          this._playerObject.load(),
          void n();
          h = new Windows.Foundation.Uri(this.url),
          p = null,
          v.AdaptiveMediaSource.createFromUriAsync(h).done(function (e) {
            t.onMediaSourceCreated(e, n)
          })
        }
      }
    })
  }),


  define('xdk-ext-device-sagemcom/detection', [
  ], function () {
    return function () {
      var e = navigator.userAgent.toLowerCase();
      return - 1 !== e.indexOf('sagemcom') || - 1 !== e.indexOf('linux armv7l') || - 1 !== e.indexOf('demo-blink')
    }()
  }),
  define('xdk-ext-device-sagemcom/TvKey', [
    'xdk-base/device/shared/browser/TvKey',
    'xdk-base/class',
    'xdk-base/device/vKey',
    'xdk-base/util',
    'xdk-base/device/shared/browser/keyMap'
  ], function (e, t, i, n, s) {
    'use strict';
    return t.create(e, {
      INFO: {
        id: 'keyboard:vkey:info'
      },
      SEARCH: {
        id: 'sagemcom:vkey:search'
      },
      JUMP_RIGHT: {
        id: 'sagemcom:vkey:jumpright'
      },
      JUMP_LEFT: {
        id: 'sagemcom:vkey:jumpleft'
      }
    }, {
      init: function () {
        var e = n.clone(s.REMOTE, !0);
        i.INFO = this.constructor.INFO,
        i.SEARCH = this.constructor.SEARCH,
        e.VKey[window.VK_RED] = i.RED,
        e.VKey[window.VK_GREEN] = i.GREEN,
        e.VKey[window.VK_YELLOW] = i.YELLOW,
        e.VKey[window.VK_BLUE] = i.BLUE,
        e.VKey[window.VK_TRACK_PREV] = this.constructor.JUMP_LEFT,
        e.VKey[window.VK_TRACK_NEXT] = this.constructor.JUMP_RIGHT,
        e.VKey[window.VK_0] = i.KEY_0,
        e.VKey[window.VK_1] = i.KEY_1,
        e.VKey[window.VK_2] = i.KEY_2,
        e.VKey[window.VK_3] = i.KEY_3,
        e.VKey[window.VK_4] = i.KEY_4,
        e.VKey[window.VK_5] = i.KEY_5,
        e.VKey[window.VK_6] = i.KEY_6,
        e.VKey[window.VK_7] = i.KEY_7,
        e.VKey[window.VK_8] = i.KEY_8,
        e.VKey[window.VK_9] = i.KEY_9,
        e.VKey[window.VK_LEFT] = i.LEFT,
        e.VKey[window.VK_UP] = i.UP,
        e.VKey[window.VK_RIGHT] = i.RIGHT,
        e.VKey[window.VK_DOWN] = i.DOWN,
        e.VKey[window.VK_BACK] = i.BACK,
        e.VKey[window.VK_PLAY_PAUSE] = i.PLAY_PAUSE,
        e.VKey[window.VK_REWIND] = i.RW,
        e.VKey[window.VK_FAST_FWD] = i.FF,
        e.VKey[window.VK_ESCAPE] = i.EXIT,
        e.VKey[window.VK_ENTER] = i.OK,
        this.initKeyMapping(e)
      }
    })
  }),
  define('xdk-ext-device-sagemcom/Id', [
    'xdk-base/class',
    'xdk-base/device/AbstractId',
    'xdk-base/device/interface/Id'
  ], function (e, t, i) {
    'use strict';
    var n = {
      localSystem: {
      }
    };
    try {
      n = window.oipfObjectFactory.createConfigurationObject()
    } catch (e) {
      console.info('[[ sagemcom/Id ]] sagemcom oipfObjectFactory not available')
    }
    return e.create(t, [
      i
    ], {
    }, {
      __configurationObject: n,
      getDeviceType: function () {
        return 'STB'
      },
      getHardwareType: function () {
        return i.HARDWARE_TYPE.STB
      },
      getDeviceId: function () {
        return this.__configurationObject.localSystem.serialNumber
      },
      getModel: function () {
        return this.__configurationObject.localSystem.modelName
      },
      getFirmware: function () {
        return this.__configurationObject.localSystem.softwareVersion
      }
    })
  }),
  define('xdk-base/device/AbstractSystem', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/config',
    'xdk-base/device/shared/ConnectionPoller',
    'xdk-base/console',
    'xdk-base/core',
    'xdk-base/ajax',
    'xdk-base/device/interface/System',
    'xdk-base/EventDispatcher',
    'xdk-base/promise'
  ], function (e, t, i, n, s, r, o, a, d, c) {
    'use strict';
    function l(e) {
      var t = i.get(u) + '?_=' + Date.now();
      return o.request(t, {
        timeOut: i.get('device.ajax-network-check.timeout', 10)
      }).then(function () {
        return s.debug('[System] Connected to ' + t),
        !e || e(!0)
      }, function () {
        return s.error('[System] Cannot connect to ' + t),
        !!e && e(!1)
      })
    }
    var u = 'device.ajax-network-check.url',
    h = e.createAbstract(d, [
      a
    ], {
      POLLER_URL_BLACKLIST: [
        'connectionpoller.accedo.tv'
      ]
    }, {
      _internetPoller: null,
      __networkStatus: !0,
      init: function () {
        this._super(),
        this._postInit()
      },
      setScreenSaver: function (e) {
        return !1
      },
      setSystemMute: function (e) {
        return !1
      },
      powerOff: function () {
        return !1
      },
      exit: function () {
        return !1
      },
      hasMouse: function () {
        return !1
      },
      hasFixedKeyboard: function () {
        return !1
      },
        getDisplayResolution: function () {
            return {
                width: window.innerWidth || document.body.clientWidth || null,
                height: window.innerHeight || document.body.clientHeight || null
            }
        },
      supportSSL: function () {
        return !1
      },
      hasSOP: function () {
        return !0
      },
      getNetworkStatus: function () {
        return this._internetPoller && this._internetPoller.isPolling() ? c.resolve(this._internetPoller.isConnected()) : i.get(u) ? l() : c.reject()
      },
      _postInit: function () {
        var e,
        o,
        d = h.POLLER_URL_BLACKLIST,
        c = i.get(u),
        _ = '[AbstractSystem] Internet poller cannot be initialised. `' + u + '` ';
        if (!t.isString(c) || t.empty(c)) return _ += 'needs to be defined for connection poller to function.',
        void s.error(_);
        if (t.some(d, function (e) {
          return c.indexOf(e) > - 1 && (_ += 'found in the blacklist.', !0)
        })) throw r.createException('IncorrectParam', _);
        e = t.bind(function (e) {
          l(e).done()
        }, this),
        o = t.bind(this.dispatchEvent, this, a.EVT_NETWORK_STATUS_CHANGED),
        this._internetPoller = new n(e, o)
      },
      addEventListener: function (e, t, i) {
        var n = this._super(e, t, i);
        return this._internetPoller && e === a.EVT_NETWORK_STATUS_CHANGED && this._internetPoller.startPolling(),
        n
      },
      removeEventListener: function (e, t) {
        return this._internetPoller && e === a.EVT_NETWORK_STATUS_CHANGED && this._internetPoller.stopPolling(),
        this._super(e, t)
      },
      redraw: function (e) {
      }
    });
    return h
  }),
  define('xdk-ext-device-sagemcom/System', [
    'xdk-base/class',
    'xdk-base/device/AbstractSystem',
    'xdk-base/console'
  ], function (e, t, i) {
    'use strict';
    return e.create(t, {
    }, {
      getDisplayResolution: function () {
        return {
          width: window.innerWidth || document.body.clientWidth || null,
          height: window.innerHeight || document.body.clientHeight || null
        }
      },
      exit: function () {
        i.log('Trying to exit the app'),
        window.close()
      }
    })
  }),
  define('xdk-ext-device-sagemcom/DevicePackage', [
    'xdk-base/device/AbstractDevicePackage',
    'xdk-base/device/shared/LocalStorage',
    'xdk-ext-device-sagemcom/TvKey',
    'xdk-ext-device-sagemcom/Id',
    'xdk-ext-device-sagemcom/System',
    'xdk-base/device/Media',
    'xdk-base/class',
    'xdk-base/util'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    var d = r.singleton();
    return o.create(e, {
    }, {
      _shouldSetup: !0,
      inited: !1,
      getId: function () {
        return 'sagemcom'
      },
      setup: function (e) {
        var t,
        i;
        this._super(e),
        t = this.getInterfaceTypes(),
        a.each(t, a.bind(function (e) {
          this.addInterfaceType(e.key, e.value.handle, e.value.interfaceObj)
        }, this)),
        i = a.bind(this.ready, this),
        this._preparePlayerList(i)
      },
      _getDefaultPlayer: function () {
        return ['xdk-ext-device-windows/Html5Player']
      },
      getInterfaceTypes: function () {
        var r = {
        };
        return r[e.STORAGE] = {
          handle: e.STORAGE_HANDLE,
          interfaceObj: new t
        },
        r[e.MEDIA_PLAYER] = {
          handle: e.MEDIA_PLAYER_HANDLE,
          interfaceObj: d
        },
        r[e.TV_KEY] = {
          handle: e.TV_KEY_HANDLE,
          interfaceObj: new i
        },
        r[e.ID] = {
          handle: e.ID_HANDLE,
          interfaceObj: new n
        },
        r[e.SYSTEM] = {
          handle: e.SYSTEM_HANDLE,
          interfaceObj: new s
        },
        r
      }
    })
  }),
  define('xdk-ext-device-sagemcom/NativePlayer', [
    'xdk-base/class',
    'xdk-base/Element',
    'xdk-base/util',
    'xdk-base/device/AbstractPlayer',
    'xdk-base/device/interface/Player',
    'xdk-base/device/Media',
    'xdk-base/device',
    'xdk-base/console'
  ], function (e, t, i, n, s, r, o, a) {
    'use strict';
    var d = r.singleton();
    return e.create(n, {
    }, {
      __videoPlayerContainer: null,
      _playerObject: null,
      __parentNode: null,
      _progressCheckFuncId: null,
      _checkingInterval: 500,
      _seek: null,
      init: function () {
        this.__bindedOnPlayStateChange = i.bind(this._onPlayStateChange, this),
        this.__bindedOnReadyStateChange = i.bind(this._onReadyStateChange, this),
        this.__bindedOnError = i.bind(this._onError, this),
        this.__bindedOnPlayPositionChanged = i.bind(this._onPlayPositionChanged, this),
        this.__bindedOnBuffering = i.bind(this._onBuffering, this)
      },
      reset: function () {
        clearInterval(this._progressCheckFuncId),
        this._playerObject.data = '',
        this._progressCheckFuncId = void 0
      },
      getCapabilities: function () {
        return {
          type: [
            'mp4'
          ],
          drms: [
            'playready'
          ]
        }
      },
      _onPlayStateChange: function () {
        if (!this._progressCheckFuncId) return void this._playerObject.stop();
        switch (this._playerObject.playState) {
          case 1:
            d._onPlaying();
            break;
          case 2:
            d._onPause();
            break;
          case 3:
            d._onConnecting();
            break;
          case 4:
            d._onBufferingStart();
            break;
          case 6:
            d._onError();
            break;
          case 5:
            this.hide(),
            d._onFinish();
            break;
          case 0:
            d._onStopped()
        }
      },
      _onReadyStateChange: function (e) {
      },
      _onError: function (e) {
        d._onError('generic error', 'generic message')
      },
      _onPlayPositionChanged: function (e) {
      },
      _onBuffering: function (e) {
      },
      prepare: function (e) {
        this._prepared || (this.createNativePlayer(e), this.addEventListners(), this._inited = !0)
      },
      load: function (e, t) {
        return !!this._prepared && (t = t || {
        }, 'playready' === t.drm && t.drmUrl && (e = e + '&la_url=' + encodeURIComponent(t.drmUrl)), this._playerObject.data = e, this.url = e, e)
      },
      play: function (e) {
        e = e || {
        },
        this._playerObject.play(1),
        e && i.isNumber(e.sec) && e.sec > 0 && this.seek(e.sec),
        clearInterval(this._progressCheckFuncId),
        this._progressCheckFuncId = window.setInterval(i.bind(function () {
          this._setCurTime()
        }, this), this._checkingInterval),
        this.show(),
        this.setFullscreen()
      },
      stop: function () {
        this._playerObject.stop(),
        this.hide(),
        d._onStopped()
      },
      pause: function () {
        this._playerObject.play(0),
        d._onPause()
      },
      resume: function () {
        this._playerObject.play(1)
      },
      seek: function (e) {
        if (!this._inited || e < 0 || !this.url) return !1;
        e > this.getDuration() && (e = this.getDuration()),
        d.isState(d.PAUSED) && d._onTimeUpdate(e),
        this._playerObject.seek(1000 * e)
      },
      speed: function (e) {
        e = Math.floor(e),
        e > 16 && (e = 16),
        e < - 16 && (e = - 16),
        this._playerObject.play(this._playbackSpeed),
        d._onSpeeding()
      },
      skip: function (e) {
        var t = this.getCurTime();
        this.seek(t + e)
      },
      setWindowSize: function (e) {
        this.__videoPlayerContainer.removeClass('fullscreen')
      },
      setFullscreen: function () {
        this.__videoPlayerContainer.addClass('fullscreen');
        var e = o.system.getDisplayResolution();
        this._playerObject.height = e.height,
        this._playerObject.width = e.width
      },
      hide: function () {
        this._playerObject && (this._playerObject.style.visibility = 'hidden', this._playerObject.height = '', this._playerObject.width = '')
      },
      show: function () {
        this._playerObject && (this._playerObject.style.visibility = 'visible')
      },
      getCurTime: function () {
        return Math.floor(this._playerObject.playPosition / 1000) || 0
      },
      getDuration: function () {
        return Math.floor(this._playerObject.playTime / 1000) || 0
      },
      _setDuration: function () {
        this._playerObject && this._playerObject.playTime && (this._duration = this._playerObject.playTime)
      },
      _setCurTime: function () {
        if (!d.isState(d.PAUSED) && 4 !== this._playerObject.playState) {
          d.isState(d.CONNECTING) && d._onPlaying();
          var e = this.getCurTime();
          e && d._onTimeUpdate(e)
        }
      },
      createNativePlayer: function () {
        var e,
        i;
        this.__parentNode = document.getElementsByTagName('body') [0],
        this.__videoPlayerContainer || (e = document.createElement('div'), e.id = 'playerContainer'),
        this._playerObject || (this._playerObject = window.oipfObjectFactory.createVideoMpegObject(), this._playerObject.id = 'sagemcomVideoPlayer', this._playerObject.className = 'playerObject'),
        e.appendChild(this._playerObject),
        this.__parentNode.appendChild(e),
        i = o.system.getDisplayResolution(),
        this.__videoPlayerContainer = new t(e, {
          class : 'playerContainer'
        }),
        this.__videoPlayerContainer.addClass('_' + i.width + 'x' + i.height),
        this._prepared = !0
      },
      addEventListners: function () {
        this._playerObject.onPlayStateChange = this.__bindedOnPlayStateChange,
        this._playerObject.onReadyStateChange = this.__bindedOnReadyStateChange,
        this._playerObject.onError = this.__bindedOnError,
        this._playerObject.onPlayPositionChanged = this.__bindedOnPlayPositionChanged,
        this._playerObject.onBuffering = this.__bindedOnBuffering
      },
      deinit: function () {
        this._prepared && (this._prepared = !1, this.stop(), this.reset(), this.__videoPlayerContainer ? (this.__videoPlayerContainer.removeChild(this._playerObject), this._parentNode.removeChild(this.__videoPlayerContainer), this.__videoPlayerContainer = null) : this._parentNode.removeChild(this._playerObject))
      }
    })
  }),
  define('xdk-ext-device-sagemcom/Storage', [
    'xdk-base/class',
    'xdk-base/util',
    'xdk-base/device/interface/Storage'
  ], function (e, t, i) {
    return e.create([i], {
      __storageDeferred: null,
      __localData: null,
      init: function () {
      },
      get: function (e) {
        return window.localStorage.getItem(e)
      },
      set: function (e, t) {
        return window.localStorage.setItem(e, t)
      },
      unset: function (e) {
        return window.localStorage.removeItem(e)
      },
      clear: function () {
      }
    })
  });
  